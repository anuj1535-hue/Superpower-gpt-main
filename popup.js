const DEFAULT_ICON_PATH={16:chrome.runtime.getURL("images/icon-16.png"),32:chrome.runtime.getURL("images/icon-32.png"),48:chrome.runtime.getURL("images/icon-48.png"),128:chrome.runtime.getURL("images/icon-128.png")},DISABLED_ICON_PATH={16:chrome.runtime.getURL("images/icon-16-disabled.png"),32:chrome.runtime.getURL("images/icon-32-disabled.png"),48:chrome.runtime.getURL("images/icon-48-disabled.png"),128:chrome.runtime.getURL("images/icon-128-disabled.png")},CACHED_DEFAULT_ICON_IMAGE_DATA={},CACHED_DISABLED_ICON_IMAGE_DATA={};async function preloadIconImages(n,e){for(const o of Object.keys(n)){const t=Number(o),a=n[t];try{const s=await fetch(a);if(!s.ok)throw new Error(`Failed to load ${a}: ${s.status}`);const i=await s.blob(),c=await createImageBitmap(i),r=new OffscreenCanvas(t,t).getContext("2d");r.drawImage(c,0,0);const m=r.getImageData(0,0,t,t);e[t]=m}catch(s){throw console.error(`Error preloading icon ${a} for size ${t}:`,s),s}}}async function preloadAllIcons(){try{await preloadIconImages(DEFAULT_ICON_PATH,CACHED_DEFAULT_ICON_IMAGE_DATA),await preloadIconImages(DISABLED_ICON_PATH,CACHED_DISABLED_ICON_IMAGE_DATA)}catch(n){console.error("Failed to preload all icons:",n)}}function initializeVersionNumber(){const n=document.getElementById("version-number");n&&(n.textContent=chrome.runtime.getManifest().version)}async function initializeSuperpowerSwitch(){const n=document.getElementById("superpower-switch");if(n){const{settings:e}=await chrome.storage.local.get(["settings"]),{superpowerIsEnabled:o=!0}=e;n.checked=o}n?.addEventListener("change",async e=>{const{settings:o}=await chrome.storage.local.get(["settings"]),t=e.target.checked;await chrome.storage.local.set({settings:{...o,superpowerIsEnabled:t}}),await updateExtensionIcon(!t),chrome.tabs.query({url:"https://chatgpt.com/*"},a=>{a.forEach(s=>{chrome.tabs.reload(s.id)})}),window.close()})}chrome.tabs.onUpdated.addListener(async(n,e,o)=>{if(e.status==="complete"&&o.url){const{settings:t}=await chrome.storage.local.get(["settings"]),{superpowerIsEnabled:a=!0}=t;updateExtensionIcon(!a)}});async function initializeButtons(){const{settings:n}=await chrome.storage.local.get(["settings"]),{superpowerIsEnabled:e=!0}=n,o=document.getElementById("settings-button"),t=document.getElementById("manager-button");o&&(o.disabled=!e,o.style.opacity=e?"1":"0.5",o.style.setProperty("pointerEvents",e?"auto":"none","important"),o.style.setProperty("cursor",e?"pointer":"not-allowed","important")),t&&(t.disabled=!e,t.style.opacity=e?"1":"0.5",t.style.setProperty("pointerEvents",e?"auto":"none","important"),t.style.setProperty("cursor",e?"pointer":"not-allowed","important"))}async function updateExtensionIcon(n=!1){initializeButtons(n);const e=n?CACHED_DISABLED_ICON_IMAGE_DATA:CACHED_DEFAULT_ICON_IMAGE_DATA;if([16,32,48,128].every(t=>e[t]))await chrome.action.setIcon({imageData:e});else{const t=n?DISABLED_ICON_PATH:DEFAULT_ICON_PATH;await chrome.action.setIcon({path:t})}}preloadAllIcons(),initializeVersionNumber(),initializeSuperpowerSwitch(),initializeButtons();
