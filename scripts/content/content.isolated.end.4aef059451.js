const pdfStyles={style1:`
      body {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
          font-size: 11pt;
          color: #333;
          background: #ffffff;
          padding-right: 20px;
      }
      article {
          margin-top: 10px;
          margin-bottom: 10px;
          padding: 15px;
          border-radius: 8px;
          background: #F7F9FC;
          box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1);
          border-left: 5px solid #3498DB;
      }
      article:nth-child(odd) {
          border-left-color: #333;
      }
      article:nth-child(even) {
          margin-bottom: 16px;
      }

      h5, h6 {
          font-size: 14pt;
          font-weight: bold;
          color: #2C3E50;
          margin-top: 2px;
          margin-bottom: 10px;
          border-bottom: 2px solid #3498DB;
          padding-bottom: 5px;
      }

      p {
          margin: 0;
          padding: 0;
      }

      footer {
          font-size: 10pt;
          color: #777;
          writing-mode: vertical-rl; /* Makes text vertical */
          text-orientation: mixed; /* Ensures proper character orientation */
          position: fixed; /* Keeps it fixed on the right */
          right: 0; /* Aligns it to the right edge */
          bottom: -100px; /* Centers it vertically */
          transform: translateY(-50%); /* Ensures it stays centered */
          padding-left: 4px;
      }

      footer a {
          color: #3498DB;
          text-decoration: none;
          font-weight: bold;
      }`,style2:`
      body {
        font-family: 'Courier New', Courier, monospace;
        font-size: 10pt;
        color: #EEE;
        background: #1E1E1E;
        padding: 20px;
      }
      article {
        margin: 20px 0;
        padding: 20px;
        border-radius: 0;
        background: #2C2C2C;
        border-left: 6px solid #FF9800;
      }
      article:nth-child(odd) {
        border-left-color: #FF5722;
      }
      article:nth-child(even) {
        margin-bottom: 24px;
      }
      h5, h6 {
        font-size: 16pt;
        font-weight: normal;
        color: #FFF;
        margin-top: 5px;
        margin-bottom: 15px;
        border-bottom: 1px solid #FF9800;
        padding-bottom: 3px;
      }
      p {
        margin: 5px 0;
        line-height: 1.5;
      }
      footer {
        font-size: 9pt;
        color: #BBB;
        writing-mode: vertical-lr;
        text-orientation: upright;
        position: fixed;
        left: 0;
        bottom: 20px;
        transform: translateY(0);
        padding-right: 5px;
      }
      footer a {
        color: #FF9800;
        text-decoration: none;
        font-weight: normal;
      }
    `,style3:`
      body {
        font-family: Georgia, 'Times New Roman', Times, serif;
        font-size: 12pt;
        color: #4A4A4A;
        background: #FAF9F6;
        padding: 30px;
      }
      article {
        margin: 15px 0;
        padding: 25px;
        border-radius: 5px;
        background: #FFF;
        border-left: 4px solid #8C8C8C;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }
      article:nth-child(odd) {
        border-left-color: #B47D56;
      }
      article:nth-child(even) {
        margin-bottom: 20px;
      }
      h5, h6 {
        font-size: 18pt;
        font-weight: bold;
        color: #333;
        margin-top: 10px;
        margin-bottom: 8px;
        border-bottom: 1px solid #B47D56;
        padding-bottom: 5px;
      }
      p {
        margin: 0 0 10px 0;
        line-height: 1.6;
      }
      footer {
        font-size: 10pt;
        color: #7D7D7D;
        writing-mode: vertical-rl;
        text-orientation: sideways;
        position: fixed;
        right: 10px;
        bottom: 10px;
        transform: rotate(180deg);
        padding-left: 8px;
      }
      footer a {
        color: #B47D56;
        text-decoration: underline;
        font-weight: bold;
      }
    `,style4:`
      body {
        font-family: 'Lucida Console', Monaco, monospace;
        font-size: 11pt;
        color: #E0E0E0;
        background: #000;
        padding: 20px;
      }
      article {
        margin: 10px 0;
        padding: 20px;
        border-radius: 10px;
        background: #111;
        box-shadow: 0 0 10px #00FFFF;
        border-left: 5px solid #00FF00;
      }
      article:nth-child(odd) {
        border-left-color: #FF00FF;
      }
      article:nth-child(even) {
        margin-bottom: 18px;
      }
      h5, h6 {
        font-size: 15pt;
        font-weight: bold;
        color: #00FFFF;
        margin-top: 5px;
        margin-bottom: 10px;
        border-bottom: 2px dashed #FF00FF;
        padding-bottom: 4px;
      }
      p {
        margin: 0;
        padding: 0;
      }
      footer {
        font-size: 10pt;
        color: #AAAAAA;
        writing-mode: vertical-rl;
        text-orientation: upright;
        position: fixed;
        right: 0;
        bottom: 0;
        transform: translateY(0);
        padding-left: 6px;
      }
      footer a {
        color: #FF00FF;
        text-decoration: none;
        font-weight: bold;
      }
    `,style5:`
      body {
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        font-size: 11pt;
        color: #222;
        background: #F5F5F5;
        padding: 25px;
      }
      article {
        margin: 20px 0;
        padding: 20px;
        border-radius: 3px;
        background: #FFF;
        border-left: 4px solid #4CAF50;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
      }
      article:nth-child(odd) {
        border-left-color: #8BC34A;
      }
      article:nth-child(even) {
        margin-bottom: 22px;
      }
      h5, h6 {
        font-size: 14pt;
        font-weight: 600;
        color: #333;
        margin-top: 10px;
        margin-bottom: 12px;
        border-bottom: 3px solid #4CAF50;
        padding-bottom: 6px;
      }
      p {
        margin: 0;
        padding: 0 0 10px 0;
        line-height: 1.6;
      }
      footer {
        font-size: 9pt;
        color: #555;
        writing-mode: vertical-rl;
        text-orientation: sideways;
        position: fixed;
        left: 10px;
        bottom: 10px;
        transform: translateY(0);
        padding-right: 8px;
      }
      footer a {
        color: #4CAF50;
        text-decoration: none;
        font-weight: 600;
      }
    `,style6:`
      body {
        font-family: 'Courier New', Courier, monospace;
        font-size: 12pt;
        color: #3E3A33;
        background: #F4F1E9;
        padding: 30px;
        line-height: 1.5;
      }
      article {
        margin: 20px 0;
        padding: 20px;
        border-radius: 4px;
        background: #FFF;
        border-left: 4px dotted #A67B5B;
        box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
      }
      article:nth-child(odd) {
        border-left-color: #7D5A50;
      }
      article:nth-child(even) {
        margin-bottom: 25px;
      }
      h5, h6 {
        font-size: 16pt;
        font-weight: bold;
        color: #5B4636;
        margin-top: 10px;
        margin-bottom: 8px;
        border-bottom: 1px dashed #A67B5B;
        padding-bottom: 4px;
      }
      p {
        margin: 0 0 12px 0;
      }
      footer {
        font-size: 10pt;
        color: #7D5A50;
        writing-mode: vertical-rl;
        text-orientation: sideways;
        position: fixed;
        left: 14px;
        bottom: 20px;
        transform: rotate(0deg);
        padding-right: 6px;
      }
      footer a {
        color: #A67B5B;
        text-decoration: underline;
        font-weight: normal;
      }
    `,style7:`
      body {
        font-family: 'Roboto', sans-serif;
        font-size: 11pt;
        color: #C0C0C0;
        background: linear-gradient(135deg, #0D0D0D, #1A1A1A);
        padding: 25px;
      }
      article {
        margin: 15px 0;
        padding: 20px;
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.05);
        border-left: 4px solid #00E5FF;
        box-shadow: 0 0 10px rgba(0, 229, 255, 0.5);
      }
      article:nth-child(odd) {
        border-left-color: #FF4081;
      }
      article:nth-child(even) {
        margin-bottom: 18px;
      }
      h5, h6 {
        font-size: 18pt;
        font-weight: 700;
        color: #00E5FF;
        margin-top: 8px;
        margin-bottom: 10px;
        border-bottom: 2px solid #FF4081;
        padding-bottom: 5px;
        text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7);
      }
      p {
        margin: 0 0 10px 0;
      }
      footer {
        font-size: 10pt;
        color: #BDBDBD;
        writing-mode: vertical-rl;
        text-orientation: mixed;
        position: fixed;
        right: 8px;
        bottom: 30px;
        transform: translateY(-10%);
        padding-left: 8px;
      }
      footer a {
        color: #FF4081;
        text-decoration: none;
        font-weight: 700;
      }
    `,style8:`
      body {
        font-family: 'Palatino Linotype', 'Book Antiqua', Palatino, serif;
        font-size: 12pt;
        color: #3B2F2F;
        background: #FFF8F0;
        padding: 30px;
        /* Optional: add a subtle paper texture as a background image */
        /* background-image: url('data:image/svg+xml;base64,...'); */
      }
      article {
        margin: 18px 0;
        padding: 22px;
        border-radius: 12px;
        background: #FDF6E3;
        border-left: 5px solid #8F9779;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      }
      article:nth-child(odd) {
        border-left-color: #A3B18A;
      }
      article:nth-child(even) {
        margin-bottom: 20px;
      }
      h5, h6 {
        font-size: 17pt;
        font-weight: bold;
        color: #6B4F4F;
        margin-top: 10px;
        margin-bottom: 10px;
        border-bottom: 2px solid #8F9779;
        padding-bottom: 6px;
        font-style: italic;
      }
      p {
        margin: 0 0 12px 0;
        line-height: 1.7;
      }
      footer {
        font-size: 10pt;
        color: #6B4F4F;
        writing-mode: vertical-rl;
        text-orientation: upright;
        position: fixed;
        left: 4px;
        bottom: 15px;
        transform: translateY(5%);
        padding-right: 6px;
      }
      footer a {
        color: #8F9779;
        text-decoration: none;
        font-weight: bold;
      }
    `,style9:`
      body {
        font-family: 'Comic Sans MS', cursive, sans-serif;
        font-size: 13pt;
        color: #222;
        background: #FFEB3B;
        padding: 20px;
      }
      article {
        margin: 15px 0;
        padding: 20px;
        border-radius: 15px;
        background: #FFF;
        border-left: 6px solid #F44336;
        box-shadow: 4px 4px 0px #3F51B5;
      }
      article:nth-child(odd) {
        border-left-color: #E91E63;
      }
      article:nth-child(even) {
        margin-bottom: 20px;
      }
      h5, h6 {
        font-size: 20pt;
        font-weight: bold;
        color: #3F51B5;
        margin-top: 12px;
        margin-bottom: 8px;
        border-bottom: 3px dashed #F44336;
        padding-bottom: 5px;
        text-shadow: 2px 2px 0px #FF5722;
      }
      p {
        margin: 0 0 15px 0;
      }
      footer {
        font-size: 10pt;
        color: #3F51B5;
        writing-mode: vertical-rl;
        text-orientation: sideways;
        position: fixed;
        right: 0px;
        bottom: 10px;
        transform: rotate(0deg);
        padding-left: 8px;
      }
      footer a {
        color: #E91E63;
        text-decoration: underline;
        font-weight: bold;
      }
    `,style10:`
      body {
        font-family: 'Arial', sans-serif;
        font-size: 11pt;
        color: #222;
        background: linear-gradient(45deg, #ECE9E6, #FFFFFF);
        padding: 25px;
      }
      article {
        margin: 20px 0;
        padding: 25px;
        border-radius: 10px;
        background: #FFF;
        border-left: 6px double #FF6F61;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        transform: skew(-2deg);
      }
      article:nth-child(odd) {
        border-left-color: #6B5B95;
      }
      article:nth-child(even) {
        margin-bottom: 28px;
        transform: skew(2deg);
      }
      h5, h6 {
        font-size: 16pt;
        font-weight: bold;
        color: #FF6F61;
        margin-top: 8px;
        margin-bottom: 8px;
        border-bottom: 2px solid #6B5B95;
        padding-bottom: 4px;
        letter-spacing: 1px;
      }
      p {
        margin: 0 0 12px 0;
        line-height: 1.5;
      }
      footer {
        font-size: 10pt;
        color: #6B5B95;
        writing-mode: vertical-rl;
        text-orientation: upright;
        position: fixed;
        left: 12px;
        bottom: 25px;
        transform: translateY(0);
        padding-right: 10px;
      }
      footer a {
        color: #FF6F61;
        text-decoration: none;
        font-weight: bold;
      }
    `,style11:`
      body {
        font-family: 'Montserrat', sans-serif;
        font-size: 12pt;
        color: #E0E8F9;
        background: radial-gradient(circle at center, #1B2735, #090A0F);
        padding: 20px;
      }
      article {
        margin: 20px 0;
        padding: 20px;
        border-radius: 15px;
        background: radial-gradient(circle at center, #1B2735, #090A0F);
        border: 1px dashed #E0E8F9;
        position: relative;
        overflow: hidden;
      }
      article::before {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(224,232,249,0.2), transparent 10%);
        transform: rotate(45deg);
      }
      h5, h6 {
        font-size: 16pt;
        font-weight: bold;
        color: #F0F8FF;
        margin: 10px 0;
        border-bottom: 2px solid #8BAEDC;
        padding-bottom: 5px;
        text-transform: uppercase;
      }
      p {
        margin: 0 0 15px;
        line-height: 1.6;
      }
      footer {
        font-size: 10pt;
        color: #A0AEC0;
        writing-mode: vertical-rl;
        text-orientation: mixed;
        position: fixed;
        right: 0px;
        bottom: 10px;
        border-left: 2px solid #8BAEDC;
        padding-left: 10px;
      }
      footer a {
        color: #F0F8FF;
        text-decoration: none;
        font-weight: bold;
      }
    `,style12:`
      body {
        font-family: 'Comic Sans MS', cursive, sans-serif;
        font-size: 13pt;
        color: #000;
        background: repeating-linear-gradient(45deg, #FF6B6B, #FF6B6B 10px, #FFF200 10px, #FFF200 20px);
        padding: 20px;
      }
      article {
        margin: 15px 0;
        padding: 25px;
        border-radius: 0;
        background: #fff;
        border: 3px solid #000;
        transform: rotate(-2deg);
      }
      h5, h6 {
        font-size: 18pt;
        font-weight: bold;
        color: #FF6B6B;
        margin: 10px 0;
        text-decoration: underline wavy #000;
      }
      p {
        margin: 0 0 12px;
      }
      footer {
        font-size: 11pt;
        color: #000;
        writing-mode: vertical-rl;
        text-orientation: upright;
        position: fixed;
        left: 4px;
        bottom: 15px;
        transform: rotate(0deg);
        padding-right: 8px;
      }
      footer a {
        color: #FF6B6B;
        text-decoration: none;
        font-weight: bold;
      }
    `,style13:`
      body {
        font-family: 'Roboto Mono', monospace;
        font-size: 11pt;
        color: #1C2833;
        background: #ECF0F1;
        padding: 25px;
      }
      article {
        margin: 20px 0;
        padding: 20px;
        background: #fff;
        border: 2px solid #2980B9;
        border-radius: 0;
        position: relative;
      }
      /* A subtle blueprint overlay */
      article::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIiIGhlaWdodD0iMTIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTAgMGgxMnYxMkgweiIgZmlsbD0iI0U0RTVFNiIvPjwvc3ZnPg==');
        opacity: 0.05;
      }
      h5, h6 {
        font-size: 16pt;
        font-weight: bold;
        color: #2980B9;
        margin: 5px 0 10px;
        border-bottom: 1px dashed #1C2833;
        padding-bottom: 4px;
      }
      p {
        margin: 0 0 10px;
        line-height: 1.4;
      }
      footer {
        font-size: 10pt;
        color: #1C2833;
        writing-mode: vertical-rl;
        text-orientation: upright;
        position: fixed;
        right: 10px;
        bottom: 10px;
        transform: translateY(-10%);
        padding-left: 6px;
      }
      footer a {
        color: #2980B9;
        text-decoration: none;
        font-weight: bold;
      }
    `,style14:`
      body {
        font-family: 'Dancing Script', cursive;
        font-size: 12pt;
        color: #4A4A4A;
        background: #FAF3F0;
        padding: 30px;
        background-image: url('https://www.transparenttextures.com/patterns/woven.png');
      }
      article {
        margin: 20px 0;
        padding: 25px;
        border-radius: 20px;
        background: rgba(255, 255, 255, 0.8);
        border: none;
        position: relative;
        overflow: hidden;
      }
      article::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, transparent, rgba(255, 183, 197, 0.3));
        mix-blend-mode: multiply;
      }
      h5, h6 {
        font-size: 20pt;
        font-weight: bold;
        color: #D32F2F;
        margin: 10px 0;
        text-shadow: 1px 1px 3px rgba(211,47,47,0.5);
      }
      p {
        margin: 0 0 15px;
        line-height: 1.6;
      }
      footer {
        font-size: 10pt;
        color: #D32F2F;
        writing-mode: vertical-rl;
        text-orientation: upright;
        position: fixed;
        left: 20px;
        bottom: 20px;
        transform: rotate(0deg);
        padding-right: 10px;
      }
      footer a {
        color: #D32F2F;
        text-decoration: none;
        font-weight: bold;
      }
    `,style15:`
      body {
        font-family: 'Orbitron', sans-serif;
        font-size: 12pt;
        color: #F8F8F8;
        background: radial-gradient(circle at 50% 50%, #000428, #004e92);
        padding: 20px;
      }
      article {
        margin: 20px 0;
        padding: 25px;
        border-radius: 10px;
        background: rgba(0, 68, 146, 0.8);
        border: 3px solid rgba(255, 255, 255, 0.2);
        position: relative;
      }
      article::after {
        content: "";
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        background: url('https://www.transparenttextures.com/patterns/asfalt-light.png');
        opacity: 0.1;
      }
      h5, h6 {
        font-size: 18pt;
        font-weight: bold;
        color: #00FFAB;
        margin: 10px 0;
        letter-spacing: 2px;
      }
      p {
        margin: 0 0 15px;
        line-height: 1.5;
      }
      footer {
        font-size: 10pt;
        color: #00FFAB;
        writing-mode: vertical-rl;
        text-orientation: upright;
        position: fixed;
        right: 4px;
        bottom: 15px;
        transform: rotate(0deg);
        padding-left: 10px;
      }
      footer a {
        color: #00FFAB;
        text-decoration: none;
        font-weight: bold;
      }
    `,style16:`
      body {
        font-family: 'Lora', serif;
        font-size: 12pt;
        color: #2C3E50;
        background: #ECF0F1;
        padding: 25px;
        background-image: url('https://www.transparenttextures.com/patterns/old-wall.png');
      }
      article {
        margin: 20px 0;
        padding: 25px;
        border-radius: 8px;
        background: #FFF;
        border-top: 5px solid #27AE60;
        border-bottom: 5px solid #27AE60;
        position: relative;
      }
      article::before {
        content: "";
        position: absolute;
        top: 0;
        right: 0;
        width: 60px;
        height: 60px;
        background: url('https://via.placeholder.com/60') no-repeat center center;
        background-size: cover;
        opacity: 0.3;
      }
      h5, h6 {
        font-size: 18pt;
        font-weight: bold;
        color: #27AE60;
        margin: 10px 0;
        border-bottom: 2px dotted #2C3E50;
        padding-bottom: 5px;
      }
      p {
        margin: 0 0 15px;
        line-height: 1.5;
      }
      footer {
        font-size: 10pt;
        color: #2C3E50;
        writing-mode: vertical-rl;
        text-orientation: sideways;
        position: fixed;
        left: 20px;
        bottom: 20px;
        transform: rotate(0deg);
        padding-right: 10px;
      }
      footer a {
        color: #27AE60;
        text-decoration: none;
        font-weight: bold;
      }
    `,style17:`
      body {
        font-family: 'Indie Flower', cursive;
        font-size: 13pt;
        color: #444;
        background: #FFFBEC;
        padding: 20px;
        background-image: url('https://www.transparenttextures.com/patterns/diagonal-noise.png');
      }
      article {
        margin: 15px 0;
        padding: 20px;
        border-radius: 50px;
        background: #fff;
        border: 4px double #F39C12;
        position: relative;
      }
      h5, h6 {
        font-size: 20pt;
        font-weight: bold;
        color: #F39C12;
        margin: 10px 0;
        text-decoration: overline;
      }
      p {
        margin: 0 0 15px;
        line-height: 1.5;
      }
      footer {
        font-size: 11pt;
        color: #F39C12;
        writing-mode: vertical-rl;
        text-orientation: upright;
        position: fixed;
        left: 4px;
        bottom: 15px;
        transform: translateY(0) rotate(0deg);
        padding-right: 10px;
      }
      footer a {
        color: #F39C12;
        text-decoration: none;
        font-weight: bold;
      }
    `,style18:`
      body {
        font-family: 'Roboto', sans-serif;
        font-size: 12pt;
        color: #fff;
        background: #000;
        padding: 20px;
      }
      article {
        margin: 20px 0;
        padding: 25px;
        border-radius: 0;
        background: #222;
        position: relative;
        overflow: hidden;
      }
      article::before,
      article::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: inherit;
        mix-blend-mode: difference;
        opacity: 0.1;
        animation: glitch 2s infinite;
      }
      @keyframes glitch {
        0% { clip: rect(5px, 9999px, 15px, 0); }
        20% { clip: rect(15px, 9999px, 25px, 0); }
        40% { clip: rect(10px, 9999px, 20px, 0); }
        60% { clip: rect(0px, 9999px, 10px, 0); }
        80% { clip: rect(20px, 9999px, 30px, 0); }
        100% { clip: rect(5px, 9999px, 15px, 0); }
      }
      h5, h6 {
        font-size: 18pt;
        font-weight: bold;
        color: #FF4081;
        margin: 10px 0;
        text-shadow: 2px 2px 0 #000;
      }
      p {
        margin: 0 0 15px;
        line-height: 1.4;
      }
      footer {
        font-size: 10pt;
        color: #FF4081;
        writing-mode: vertical-rl;
        text-orientation: upright;
        position: fixed;
        right: 10px;
        bottom: 20px;
        transform: rotate(0deg);
        padding-left: 10px;
      }
      footer a {
        color: #FF4081;
        text-decoration: none;
        font-weight: bold;
      }
    `,style19:`
      body {
        font-family: 'Roboto', sans-serif;
        font-size: 12pt;
        color: #333;
        background: linear-gradient(135deg, #f0f0f0, #ffffff);
        padding: 20px;
      }
      article {
        margin: 20px 0;
        padding: 30px;
        background: #FFF;
        border-radius: 10px;
        transform: perspective(600px) rotateY(5deg);
        border: 2px solid #ccc;
      }
      h5, h6 {
        font-size: 18pt;
        font-weight: bold;
        color: #ff4081;
        margin: 10px 0;
        transform: rotate(-1deg);
      }
      p {
        margin: 0 0 15px;
        line-height: 1.5;
      }
      footer {
        font-size: 10pt;
        color: #ff4081;
        writing-mode: vertical-rl;
        text-orientation: sideways;
        position: fixed;
        left: 20px;
        bottom: 20px;
        transform: translateY(0) rotate(0deg);
        padding-right: 10px;
      }
      footer a {
        color: #ff4081;
        text-decoration: none;
        font-weight: bold;
      }
    `,style20:`
      body {
        font-family: 'Lucida Console', Monaco, monospace;
        font-size: 10pt;
        color: #33FF00;
        background: linear-gradient(90deg, #000, #222);
        padding: 20px;
      }
      article {
        margin: 20px 0;
        padding: 20px;
        border-radius: 0;
        background: #111;
        border: 1px solid #33FF00;
        position: relative;
      }
      h5, h6 {
        font-size: 14pt;
        font-weight: bold;
        color: #33FF00;
        margin: 10px 0;
        text-shadow: 1px 1px 2px #000;
      }
      p {
        margin: 0 0 12px;
        line-height: 1.4;
      }
      footer {
        font-size: 10pt;
        color: #33FF00;
        writing-mode: vertical-rl;
        text-orientation: upright;
        position: fixed;
        right: 4px;
        bottom: 20px;
        transform: rotate(0deg);
        padding-left: 10px;
      }
      footer a {
        color: #33FF00;
        text-decoration: none;
        font-weight: bold;
      }
    `,style21:`
   body {
     font-family: 'Open Sans', sans-serif;
     font-size: 12pt;
     color: #FFFFFF;
     background: linear-gradient(to bottom, #2C3E50, #4CA1AF);
     padding: 20px;
   }
   article {
     margin: 20px 0;
     padding: 20px;
     border-radius: 10px;
     background: linear-gradient(to bottom, #2C3E50, #4CA1AF);
     border: 1px solid rgba(255, 255, 255, 0.3);
     position: relative;
     overflow: hidden;
   }
   article::before {
     content: "";
     position: absolute;
     top: -50%;
     left: -50%;
     width: 200%;
     height: 200%;
     background: radial-gradient(circle at center, rgba(255,255,255,0.2), transparent 70%);
     transform: rotate(30deg);
   }
   h5, h6 {
     font-size: 16pt;
     font-weight: bold;
     color: #E0F7FA;
     margin: 10px 0;
     border-bottom: 2px solid rgba(255,255,255,0.4);
     padding-bottom: 5px;
   }
   p {
     margin: 0 0 15px;
     line-height: 1.6;
   }
   footer {
     font-size: 10pt;
     color: #B2EBF2;
     writing-mode: vertical-rl;
     text-orientation: mixed;
     position: fixed;
     right: 4px;
     bottom: 15px;
     padding-left: 10px;
   }
   footer a {
     color: #E0F7FA;
     text-decoration: none;
     font-weight: bold;
   }
 `,style22:`
   body {
     font-family: 'Merriweather', serif;
     font-size: 12pt;
     color: #2E2E2E;
     background: linear-gradient(135deg, #dfe9f3, #ffffff);
     padding: 25px;
     background-image: url('https://www.transparenttextures.com/patterns/wood-pattern.png');
   }
   article {
     margin: 20px 0;
     padding: 20px;
     border-radius: 12px;
     background: #fff;
     border-left: 5px solid #6B8E23;
     box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
     position: relative;
   }
   article::after {
     content: "";
     position: absolute;
     top: 0;
     right: 0;
     bottom: 0;
     left: 0;
     background: url('https://www.transparenttextures.com/patterns/leather.png');
     opacity: 0.05;
   }
   h5, h6 {
     font-size: 18pt;
     font-weight: bold;
     color: #4E6E1F;
     margin: 10px 0;
     border-bottom: 2px dotted #6B8E23;
     padding-bottom: 6px;
   }
   p {
     margin: 0 0 15px;
     line-height: 1.6;
   }
   footer {
     font-size: 10pt;
     color: #6B8E23;
     writing-mode: vertical-rl;
     text-orientation: upright;
     position: fixed;
     left: 4px;
     bottom: 15px;
     transform: rotate(0deg);
     padding-right: 10px;
   }
   footer a {
     color: #4E6E1F;
     text-decoration: none;
     font-weight: bold;
   }
 `,style23:`
   body {
     font-family: 'Lato', sans-serif;
     font-size: 12pt;
     color: #FFFFFF;
     background: linear-gradient(135deg, #0F2027, #203A43, #2C5364);
     padding: 20px;
   }
   article {
     margin: 20px 0;
     padding: 25px;
     border-radius: 8px;
     background: linear-gradient(135deg, #0F2027, #203A43, #2C5364);
     border: 2px solid rgba(255,255,255,0.3);
     position: relative;
   }
   article::before {
     content: "";
     position: absolute;
     top: 0;
     left: 0;
     width: 100%;
     height: 100%;
     background: linear-gradient(45deg, rgba(255,0,150,0.2), rgba(0,229,255,0.2));
     mix-blend-mode: overlay;
     pointer-events: none;
   }
   h5, h6 {
     font-size: 17pt;
     font-weight: bold;
     color: #B2DFDB;
     margin: 10px 0;
     border-bottom: 2px solid rgba(255,255,255,0.5);
     padding-bottom: 5px;
   }
   p {
     margin: 0 0 15px;
     line-height: 1.5;
   }
   footer {
     font-size: 10pt;
     color: #B2DFDB;
     writing-mode: vertical-rl;
     text-orientation: mixed;
     position: fixed;
     right: 4px;
     bottom: 15px;
     padding-left: 10px;
   }
   footer a {
     color: #B2DFDB;
     text-decoration: none;
     font-weight: bold;
   }
 `,style24:`
   body {
     font-family: 'Roboto', sans-serif;
     font-size: 12pt;
     color: #4E342E;
     background: linear-gradient(135deg, #D7CCC8, #FFF3E0);
     padding: 25px;
   }
   article {
     margin: 20px 0;
     padding: 20px;
     border-radius: 10px;
     background: #fff7e6;
     position: relative;
   }
   article::after {
     content: "";
     position: absolute;
     top: 0;
     left: 0;
     width: 100%;
     height: 100%;
     background: url('https://www.transparenttextures.com/patterns/sandpaper.png');
     opacity: 0.1;
   }
   h5, h6 {
     font-size: 16pt;
     font-weight: bold;
     color: #8D6E63;
     margin: 10px 0;
     border-bottom: 2px dashed #D7CCC8;
     padding-bottom: 4px;
   }
   p {
     margin: 0 0 15px;
     line-height: 1.5;
   }
   footer {
     font-size: 10pt;
     color: #8D6E63;
     writing-mode: vertical-rl;
     text-orientation: sideways;
     position: fixed;
     left: 4px;
     bottom: 15px;
     transform: rotate(0deg);
     padding-right: 10px;
   }
   footer a {
     color: #8D6E63;
     text-decoration: none;
     font-weight: bold;
   }
 `,style25:`
   body {
     font-family: 'Playfair Display', serif;
     font-size: 12pt;
     color: #333;
     background: #f2f2f2;
     padding: 25px;
     background-image: url('https://www.transparenttextures.com/patterns/marble.png');
   }
   article {
     margin: 20px 0;
     padding: 25px;
     border-radius: 15px;
     background: rgba(255, 255, 255, 0.9);
     border: 1px solid #ccc;
     position: relative;
     box-shadow: 0 4px 10px rgba(0,0,0,0.1);
   }
   h5, h6 {
     font-size: 18pt;
     font-weight: bold;
     color: #555;
     margin: 10px 0;
     border-bottom: 2px solid #ccc;
     padding-bottom: 5px;
   }
   p {
     margin: 0 0 15px;
     line-height: 1.6;
   }
   footer {
     font-size: 10pt;
     color: #777;
     writing-mode: vertical-rl;
     text-orientation: mixed;
     position: fixed;
     left: 4px;
     bottom: 15px;
     padding-right: 10px;
   }
   footer a {
     color: #555;
     text-decoration: none;
     font-weight: bold;
   }
 `,style26:`
   body {
     font-family: 'Poppins', sans-serif;
     font-size: 12pt;
     color: #fff;
     background: linear-gradient(135deg, #FF5F6D, #FFC371);
     padding: 20px;
   }
   article {
     margin: 20px 0;
     padding: 25px;
     border-radius: 10px;
     background: linear-gradient(135deg, #FF5F6D, #FFC371);
     border-left: 5px solid #FF5F6D;
     position: relative;
   }
   article::before {
     content: "";
     position: absolute;
     top: 0;
     left: 0;
     width: 100%;
     height: 100%;
     background: url('https://www.transparenttextures.com/patterns/purty-wood.png');
     opacity: 0.05;
   }
   h5, h6 {
     font-size: 18pt;
     font-weight: bold;
     color: #FFF;
     margin: 10px 0;
     border-bottom: 2px solid rgba(255,255,255,0.5);
     padding-bottom: 5px;
   }
   p {
     margin: 0 0 15px;
     line-height: 1.6;
   }
   footer {
     font-size: 10pt;
     color: #FFF;
     writing-mode: vertical-rl;
     text-orientation: upright;
     position: fixed;
     left: 4px;
     bottom: 15px;
     transform: rotate(0deg);
     padding-right: 10px;
   }
   footer a {
     color: #FF5F6D;
     text-decoration: none;
     font-weight: bold;
   }
 `,style27:`
   body {
     font-family: 'Fira Sans', sans-serif;
     font-size: 12pt;
     color: #000;
     background: radial-gradient(ellipse at center, #3a3a3a 0%, #000 80%);
     padding: 20px;
     background-image: url('https://www.transparenttextures.com/patterns/asfalt-light.png');
   }
   article {
     margin: 20px 0;
     color: #FFF;
     padding: 25px;
     border-radius: 10px;
     background: rgba(50, 50, 50, 0.8);
     border: 2px solid #7F00FF;
     position: relative;
   }
   article::after {
     content: "";
     position: absolute;
     top: 0;
     left: 0;
     width: 100%;
     height: 100%;
     background: radial-gradient(circle, rgba(127,0,255,0.2), transparent 70%);
     pointer-events: none;
   }
   h5, h6 {
     font-size: 17pt;
     font-weight: bold;
     color: #D1C4E9;
     margin: 10px 0;
     border-bottom: 2px solid rgba(255,255,255,0.3);
     padding-bottom: 5px;
   }
   p {
     margin: 0 0 15px;
     line-height: 1.5;
   }
   footer {
     font-size: 10pt;
     color: #D1C4E9;
     writing-mode: vertical-rl;
     text-orientation: upright;
     position: fixed;
     right: 4px;
     bottom: 15px;
     transform: rotate(0deg);
     padding-left: 10px;
   }
   footer a {
     color: #7F00FF;
     text-decoration: none;
     font-weight: bold;
   }
 `,style28:`
   body {
     font-family: 'Raleway', sans-serif;
     font-size: 12pt;
     color: #333;
     background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
     padding: 25px;
     background-image: url('https://www.transparenttextures.com/patterns/cubes.png');
     background-blend-mode: multiply;
   }
   article {
     margin: 20px 0;
     padding: 25px;
     border-radius: 15px;
     background: rgba(255,255,255,0.8);
     border: 2px dashed #fda085;
     position: relative;
   }
   article::before {
     content: "";
     position: absolute;
     top: 0;
     left: 0;
     width: 100%;
     height: 100%;
     background: linear-gradient(135deg, transparent, rgba(253,160,133,0.2));
     pointer-events: none;
   }
   h5, h6 {
     font-size: 17pt;
     font-weight: bold;
     color: #fda085;
     margin: 10px 0;
     border-bottom: 2px solid #f6d365;
     padding-bottom: 5px;
   }
   p {
     margin: 0 0 15px;
     line-height: 1.6;
   }
   footer {
     font-size: 10pt;
     color: #fda085;
     writing-mode: vertical-rl;
     text-orientation: upright;
     position: fixed;
     left: 4px;
     bottom: 15px;
     transform: rotate(0deg);
     padding-right: 10px;
   }
   footer a {
     color: #f6d365;
     text-decoration: none;
     font-weight: bold;
   }
 `},commonStyle=`
@media print {
  .hidden-print {
    display: none !important;
  }
}
.hidden-print {
  display: flex;
  align-items: center;
}
body {
  direction: ltr;
  unicode-bidi: embed;
  line-height: 2;
}
/*
  article {
    -webkit-print-color-adjust:exact;
    -webkit-filter:opacity(1);
  }
*/
table {
  table-layout: fixed;
  border-collapse: collapse;
  width: 100%;
}
th, td {
  border: 1px solid #ddd;
  padding: 8px;
  text-align: left;
}
th {
  background-color: #f2f2f230;
}

li > p {
  display: inline;
  text-align: justify;
}
pre {
  text-align: left;
  white-space: normal;
  font-family: inherit;
}
pre code {
  white-space: pre-wrap;
}
code:not(:is(div[data-message-author-role="user"] *)) {
  display: inline-block;
  font-family: 'Fira Code', 'Source Code Pro', monospace;
  font-size: 11pt;
  background-color: #f0f0f0;
  color: #c7254e;
  padding: 2px 4px;
  border: 1px solid #ddd;
  border-radius: 8px;
  margin: 8px 0;
}
img {
  max-width: 400px;
  max-height: fit-content;
  object-fit: contain;
  border: 1px solid #ddd;
  border-radius: 16px;
  margin: 8px 0;
}
blockquote, q {
  font-style: italic;
  border-left: 2px solid #ddd;
  padding-left: 8px;
  margin: 8px 0;
}
button:not(:has(img)), select, [role="button"] {
  background-color: rgb(216, 216, 216);
  border-radius: 8px;
  border: 1px solid rgba(51, 51, 51);
  shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  color: #333333;
  cursor: pointer;
  display: inline-block;
  font-size: 14px;
  font-weight: 500;
  line-height: 20px;
  list-style: none;
  margin: 8px;
  padding: 4px 12px;
  text-align: center;
  transition: all 200ms;
  vertical-align: baseline;
  white-space: nowrap;
  user-select: none;
  -webkit-user-select: none;
  touch-action: manipulation;
}
button:has(img) {
  background: none;
  border: none;
  padding: 0;
}
`;function getPDFStyle(e){const t=pdfStyles[e];return`
    ${commonStyle}
    ${t}
  `}let translation={};async function setTranslation(){const e=window.localStorage.getItem("oai/apps/locale")?.replace(/['"]+/g,"")?.split("-")[0]||"en";try{translation=await(await fetch(chrome.runtime.getURL(`_locales/${e}/messages.json`))).json()}catch{translation=await(await fetch(chrome.runtime.getURL("_locales/en/messages.json"))).json()}}function translate(e){const t=e.toLowerCase().replace(/[- ]/g,"_");return translation[t]?.message||e}const librarySortByList=[{code:"recent",name:"New"},{code:"use",name:"Most Used"},{code:"vote",name:"Most Votes"},{code:"mine",name:"My prompts"}],gizmoSortByList=[{code:"recent",name:"Recently updated"},{code:"popular",name:"Most popular"}],notesSortByList=[{code:"alphabetical",name:"Alphabetical (A\u2192Z)"},{code:"alphabetical-reverse",name:"Alphabetical (Z\u2192A)"},{code:"created_at",name:"Create date"},{code:"updated_at",name:"Update date"}],promptsSortByList=[{code:"alphabetical",name:"Alphabetical (A\u2192Z)"},{code:"alphabetical-reverse",name:"Alphabetical (Z\u2192A)"},{code:"use",name:"Most used"},{code:"vote",name:"Most upvotes"},{code:"created_at",name:"Create date"},{code:"updated_at",name:"Update date"}],conversationsSortByList=[{code:"alphabetical",name:"Alphabetical (A\u2192Z)"},{code:"alphabetical-reverse",name:"Alphabetical (Z\u2192A)"},{code:"created_at",name:"Create date"},{code:"updated_at",name:"Update date"}],profilesSortByList=[{code:"alphabetical",name:"Alphabetical (A\u2192Z)"},{code:"alphabetical-reverse",name:"Alphabetical (Z\u2192A)"},{code:"created_at",name:"Create date"},{code:"updated_at",name:"Update date"}],toneList=[{code:"default",name:"Default",description:"No specific tone instruction"},{code:"authoritative",name:"Authoritative",description:"This tone is used to convey expertise or knowledge on a subject. It is characterized by a commanding and confident tone. Example: &quot;As a renowned surgeon with over 20 years of experience, I can assure you that this procedure is safe and effective.&quot;"},{code:"clinical",name:"Clinical",description:"This tone is used in technical or medical writing and is characterized by a straightforward, objective, and factual tone. Example: &quot;The results of the study show that the medication reduced symptoms in 75% of patients.&quot;"},{code:"concise",name:"Concise",description:"This tone responds with the fewest words & characters possible. It skips extra words & gets right to it. Example: &quot;Data shows sales up 50%,&quot; instead of &quot;Based on the data that we have collected, it appears that there has been an increase in sales by 50%.&quot;"},{code:"cold",name:"Cold",description:"This tone is detached, impersonal, and lacking in emotion. Example: &quot;The news of the disaster was reported in a cold and unfeeling manner.&quot;"},{code:"confident",name:"Confident",description:"This tone is marked by self-assurance and certainty. Example: &quot;I am confident that with hard work and dedication, we can achieve our goals.&quot;"},{code:"cynical",name:"Cynical",description:"This tone is sarcastic and distrustful of human nature. Example: &quot;Oh sure, like that politician really cares about the average person.&quot;"},{code:"emotional",name:"Emotional",description:"This tone is characterized by an emphasis on feelings and emotions. Example: &quot;Her heart-wrenching story of survival touched the hearts of many.&quot;"},{code:"empathetic",name:"Empathetic",description:"This tone shows understanding and compassion for another person\u2019s perspective or situation. Example: &quot;I understand how difficult this must be for you, and I am here to support you in any way I can.&quot;"},{code:"formal",name:"Formal",description:"This tone is used in professional or academic writing and is characterized by a serious and objective tone. Example: &quot;The purpose of this report is to present the findings of our research.&quot;"},{code:"friendly",name:"Friendly",description:"This tone is warm, approachable, and welcoming. Example: &quot;Hey there, how\u2019s it going? It\u2019s great to see you again!&quot;"},{code:"humorous",name:"Humorous",description:"This tone is light-hearted and amusing, often using wordplay, puns, or jokes. Example: &quot;Why don\u2019t scientists trust atoms? Because they make up everything!&quot;"},{code:"informal",name:"Informal",description:"This tone is casual and conversational, often using contractions and colloquial language. Example: &quot;Yo, what\u2019s up? Wanna grab a burger?&quot;"},{code:"ironic",name:"Ironic",description:"This tone uses language that expresses the opposite of the intended meaning. Example: &quot;Oh great, another rainy day in paradise.&quot;"},{code:"optimistic",name:"Optimistic",description:"This tone is hopeful and positive, expecting the best possible outcome. Example: &quot;Despite the challenges we face, I believe that we can overcome them and create a brighter future.&quot;"},{code:"pessimistic",name:"Pessimistic",description:"This tone is negative and expects the worst possible outcome. Example: &quot;I don\u2019t see how we can possibly succeed given the current circumstances.&quot;"},{code:"persuasive",name:"Persuasive",description:"This tone is used to convince or influence the reader to take a particular action or adopt a particular viewpoint. It is characterized by the use of rhetorical strategies such as appeals to emotion, logic, and authority. Example: &quot;By choosing to recycle and reduce waste, each one of us has the power to make a meaningful difference for our planet and future generations\u2014let\u2019s take action together today.&quot;"},{code:"playful",name:"Playful",description:"This tone is lighthearted and fun, often using playful language and tone. Example: &quot;Come on, don\u2019t be such a party pooper!&quot;"},{code:"sarcastic",name:"Sarcastic",description:"This tone is marked by the use of irony and mocking humor. Example: &quot;Oh yeah, that\u2019s a great idea - let\u2019s all jump off a cliff together!&quot;"},{code:"serious",name:"Serious",description:"This tone is formal and business-like, often used in professional settings. Example: &quot;I need you to take this matter seriously and provide a detailed report by tomorrow.&quot;"},{code:"sympathetic",name:"Sympathetic",description:"This tone is caring and compassionate, showing concern for another person\u2019s feelings. Example: &quot;I\u2019m so sorry to hear about your loss. Please know that I am here for you.&quot;"},{code:"tentative",name:"Tentative",description:" This tone is uncertain and hesitant, often used when expressing doubt or asking for permission. Example: &quot;I was wondering if it might be possible to ask for an extension on the deadline?&quot;"},{code:"warm",name:"Warm",description:"This tone is friendly, inviting, and creates a sense of closeness or intimacy with the reader. It often uses positive language and expresses appreciation or gratitude. Example: &quot;Thank you so much for your kindness and support. Your encouragement means the world to me and I feel grateful to have you in my life.&quot;"}],writingStyleList=[{code:"default",name:"Default",description:"No specific writing style instruction"},{code:"academic",name:"Academic",description:"This style is used in scholarly writing and emphasizes precision, clarity, and objectivity. It often involves using formal language and adhering to specific citation and formatting guidelines. Example: &quot;In this study, we aim to investigate the impact of climate change on global food security using a combination of statistical analysis and field research.&quot;"},{code:"analytical",name:"Analytical",description:"This style is characterized by a focus on breaking down complex ideas into smaller parts and analyzing them in detail. It often involves using logic and evidence to support an argument. Example: &quot;By examining the historical and cultural context of the text, we can gain a deeper understanding of its meaning and significance.&quot;"},{code:"argumentative",name:"Argumentative",description:"This style involves presenting a clear and compelling argument on a particular topic, often using evidence and logical reasoning. It aims to persuade the reader to accept a particular viewpoint or opinion. Example: &quot;The evidence clearly shows that implementing stricter gun control measures will reduce the incidence of gun violence in our communities.&quot;"},{code:"conversational",name:"Conversational",description:"This style is casual and informal, often using contractions and colloquial language. It is characterized by a friendly, approachable tone and aims to create a sense of connection with the reader. Example: &quot;Hey, have you heard about that new restaurant down the street? I tried it last week and it was amazing!&quot;"},{code:"creative",name:"Creative",description:"This style is characterized by a focus on imagination, expression, and originality. It often involves using literary devices such as metaphors, imagery, and symbolism to convey meaning. Example: &quot;The sunset painted the sky with a palette of fiery oranges and deep purples, as if nature itself were an artist at work.&quot;"},{code:"critical",name:"Critical",description:"This style involves analyzing and evaluating a particular topic or issue, often with a focus on identifying flaws or weaknesses. It aims to provide a balanced and objective assessment of the subject matter. Example: &quot;Although the company\u2019s financial reports appear to show healthy growth, a closer examination reveals several areas of concern, including high levels of debt and a lack of diversity in revenue streams.&quot;"},{code:"descriptive",name:"Descriptive",description:"This style is characterized by a focus on vividly describing a particular object, person, or experience, often using sensory details. It aims to create a clear and immersive picture in the reader\u2019s mind. Example: &quot;The old, weathered barn creaked and groaned in the wind, its paint peeling and roof sagging under the weight of years of neglect.&quot;"},{code:"epigrammatic",name:"Epigrammatic",description:"This style involves using short, witty statements or aphorisms to convey a particular message or idea. It often aims to be memorable and thought-provoking. Example: &quot;The only way to do great work is to love what you do.&quot; - Steve Jobs"},{code:"epistolary",name:"Epistolary",description:"This style involves using letters or other forms of correspondence to convey a story or message. It often aims to create a sense of intimacy or immediacy with the reader. Example: &quot;Dear John, I can hardly believe it\u2019s been a year since we last spoke. I hope this letter finds you well and that you are enjoying life as much as ever.&quot;"},{code:"expository",name:"Expository",description:"This style is characterized by a focus on explaining or informing the reader about a particular topic, often in a clear and concise manner. It aims to provide a comprehensive understanding of the subject matter. Example: &quot;In this essay, we will explore the history and evolution of the internet, from its origins as a military communications network to its current status as a ubiquitous tool for communication and information exchange.&quot;"},{code:"informative",name:"Informative",description:"This style aims to provide information on a particular topic or subject, often using a straightforward and objective tone. Example: &quot;This brochure provides an overview of the services offered by our company, including pricing, hours of operation, and contact information.&quot;"},{code:"instructive",name:"Instructive",description:"This style is focused on providing guidance or directions on how to perform a specific task or achieve a particular goal. It often involves using a step-by-step approach and clear, concise language. Example: &quot;To make a perfect cup of coffee, start by measuring out the right amount of grounds and heating your water to the proper temperature.&quot;"},{code:"journalistic",name:"Journalistic",description:"This style is used in news reporting and aims to provide timely, accurate, and objective information on current events or issues. It often involves using a clear and concise writing style, as well as adhering to established journalistic principles such as objectivity and fairness. Example: &quot;In the wake of the recent political scandal, many are calling for a full investigation into allegations of corruption and misconduct.&quot;"},{code:"metaphorical",name:"Metaphorical",description:" This style involves using figurative language and metaphors to convey a particular message or idea. It often aims to create a sense of imagery or evoke a particular emotion in the reader. Example: &quot;Life is a journey, with each step leading us closer to our destination.&quot;"},{code:"narrative",name:"Narrative",description:"This style involves telling a story or recounting a particular experience, often using descriptive language and vivid details. It aims to engage the reader and create a sense of suspense or drama. Example: &quot;As I walked through the dark, abandoned alleyway, I could feel my heart pounding in my chest. Suddenly, a figure emerged from the shadows, and I knew I was in trouble.&quot;"},{code:"persuasive",name:"Persuasive",description:"This style aims to persuade the reader to accept a particular viewpoint or opinion, often using emotional appeals and logical arguments. It involves using evidence and reasoning to support a particular position. Example: &quot;By implementing renewable energy sources, we can not only reduce our carbon footprint, but also create new jobs and stimulate economic growth.&quot;"},{code:"poetic",name:"Poetic",description:"This style is characterized by a focus on language, rhythm, and sound. It often uses literary devices such as metaphor and symbolism to convey meaning and create an emotional impact. Example: &quot;The wind whispered through the trees, its voice a haunting melody that echoed through the night.&quot;"},{code:"satirical",name:"Satirical",description:"This style involves using irony, sarcasm, and humor to critique or expose the flaws and shortcomings of a particular subject or idea. It aims to entertain while also making a serious point. Example: &quot;In a shocking display of political posturing, the senator proposed a bill to ban water, citing concerns about its potentially harmful effects on the environment.&quot;"},{code:"technical",name:"Technical",description:"This style is used in writing about technical or specialized subjects, such as science or engineering. It often involves using precise and technical language and adhering to established conventions and guidelines. Example: &quot;The results of our experiment were consistent with previous studies, indicating a strong correlation between temperature and pressure in the system.&quot;"}],languageList=[{code:"default",name:"Default"},{code:"en",name:"English"},{code:"en-gb",name:"English (UK)"},{code:"zh",name:"Chinese"},{code:"hi",name:"Hindi"},{code:"es",name:"Spanish"},{code:"fr",name:"French"},{code:"ar",name:"Arabic"},{code:"bn",name:"Bengali (Bangla)"},{code:"ru",name:"Russian"},{code:"pt-br",name:"Portuguese (Brazilian)"},{code:"pt-pt",name:"Portuguese (Portugal)"},{code:"in",name:"Indonesian"},{code:"ur",name:"Urdu"},{code:"ja",name:"Japanese"},{code:"de",name:"German"},{code:"tr",name:"Turkish"},{code:"ab",name:"Abkhazian"},{code:"aa",name:"Afar"},{code:"af",name:"Afrikaans"},{code:"ak",name:"Akan"},{code:"sq",name:"Albanian"},{code:"gsw",name:"Alsatian (dialects of German)"},{code:"am",name:"Amharic"},{code:"an",name:"Aragonese"},{code:"hy",name:"Armenian"},{code:"as",name:"Assamese"},{code:"syr",name:"Assyrian"},{code:"ast",name:"Asturian"},{code:"av",name:"Avaric"},{code:"ae",name:"Avestan"},{code:"ay",name:"Aymara"},{code:"az",name:"Azerbaijani"},{code:"bm",name:"Bambara"},{code:"ba",name:"Bashkir"},{code:"eu",name:"Basque"},{code:"bar",name:"Bavarian"},{code:"be",name:"Belarusian"},{code:"bh",name:"Bihari"},{code:"bi",name:"Bislama"},{code:"bs",name:"Bosnian"},{code:"br",name:"Breton"},{code:"bg",name:"Bulgarian"},{code:"my",name:"Burmese"},{code:"ca",name:"Catalan"},{code:"ch",name:"Chamorro"},{code:"ce",name:"Chechen"},{code:"ny",name:"Chichewa, Chewa, Nyanja"},{code:"zh-hans",name:"Chinese (Simplified)"},{code:"zh-hant",name:"Chinese (Traditional)"},{code:"cv",name:"Chuvash"},{code:"kw",name:"Cornish"},{code:"co",name:"Corsican"},{code:"cr",name:"Cree"},{code:"hr",name:"Croatian"},{code:"cop",name:"Coptic"},{code:"cs",name:"Czech"},{code:"da",name:"Danish"},{code:"dv",name:"Divehi, Dhivehi, Maldivian"},{code:"nl",name:"Dutch"},{code:"dz",name:"Dzongkha"},{code:"eo",name:"Esperanto"},{code:"et",name:"Estonian"},{code:"ee",name:"Ewe"},{code:"fo",name:"Faroese"},{code:"fj",name:"Fijian"},{code:"fi",name:"Finnish"},{code:"fur",name:"Friulian"},{code:"ff",name:"Fula, Fulah, Pulaar, Pular"},{code:"gl",name:"Galician"},{code:"gd",name:"Gaelic (Scottish)"},{code:"gv",name:"Gaelic (Manx)"},{code:"ka",name:"Georgian"},{code:"el",name:"Greek"},{code:"kl",name:"Greenlandic"},{code:"gn",name:"Guarani"},{code:"gu",name:"Gujarati"},{code:"ht",name:"Haitian Creole"},{code:"ha",name:"Hausa"},{code:"he",name:"Hebrew"},{code:"hz",name:"Herero"},{code:"ho",name:"Hiri Motu"},{code:"hu",name:"Hungarian"},{code:"is",name:"Icelandic"},{code:"io",name:"Ido"},{code:"ig",name:"Igbo"},{code:"ia",name:"Interlingua"},{code:"ie",name:"Interlingue"},{code:"iu",name:"Inuktitut"},{code:"ik",name:"Inupiak"},{code:"ga",name:"Irish"},{code:"it",name:"Italian"},{code:"jv",name:"Javanese"},{code:"kl",name:"Kalaallisut, Greenlandic"},{code:"kn",name:"Kannada"},{code:"kr",name:"Kanuri"},{code:"ks",name:"Kashmiri"},{code:"kk",name:"Kazakh"},{code:"km",name:"Khmer"},{code:"ki",name:"Kikuyu"},{code:"rw",name:"Kinyarwanda (Rwanda)"},{code:"rn",name:"Kirundi"},{code:"ky",name:"Kyrgyz"},{code:"kv",name:"Komi"},{code:"kg",name:"Kongo"},{code:"ko",name:"Korean"},{code:"ku",name:"Kurdish"},{code:"kj",name:"Kwanyama"},{code:"lo",name:"Lao"},{code:"la",name:"Latin"},{code:"lv",name:"Latvian (Lettish)"},{code:"lij",name:"Ligurian"},{code:"li",name:"Limburgish (Limburger)"},{code:"ln",name:"Lingala"},{code:"lt",name:"Lithuanian"},{code:"lmo",name:"Lombard"},{code:"lu",name:"Luga-Katanga"},{code:"lg",name:"Luganda, Ganda"},{code:"lb",name:"Luxembourgish"},{code:"gv",name:"Manx"},{code:"mk",name:"Macedonian"},{code:"mg",name:"Malagasy"},{code:"ms",name:"Malay"},{code:"ml",name:"Malayalam"},{code:"mt",name:"Maltese"},{code:"mi",name:"Maori"},{code:"mr",name:"Marathi"},{code:"mh",name:"Marshallese"},{code:"mo",name:"Moldavian"},{code:"mn",name:"Mongolian"},{code:"na",name:"Nauru"},{code:"nv",name:"Navajo"},{code:"ng",name:"Ndonga"},{code:"nd",name:"Northern Ndebele"},{code:"nap",name:"Neapolitan"},{code:"ne",name:"Nepali"},{code:"no",name:"Norwegian"},{code:"nb",name:"Norwegian bokm\xE5l"},{code:"nn",name:"Norwegian nynorsk"},{code:"ii",name:"Nuosu"},{code:"oc",name:"Occitan"},{code:"oj",name:"Ojibwe"},{code:"cu",name:"Old Church Slavonic, Old Bulgarian"},{code:"or",name:"Oriya"},{code:"om",name:"Oromo (Afaan Oromo)"},{code:"os",name:"Ossetian"},{code:"pi",name:"P\u0101li"},{code:"ps",name:"Pashto, Pushto"},{code:"fa",name:"Persian (Farsi)"},{code:"pl",name:"Polish"},{code:"pa",name:"Punjabi (Eastern)"},{code:"qu",name:"Quechua"},{code:"rm",name:"Romansh"},{code:"ro",name:"Romanian"},{code:"se",name:"Sami"},{code:"sm",name:"Samoan"},{code:"sg",name:"Sango"},{code:"srd",name:"Sardinian"},{code:"sa",name:"Sanskrit"},{code:"sr",name:"Serbian"},{code:"sh",name:"Serbo-Croatian"},{code:"st",name:"Sesotho"},{code:"tn",name:"Setswana"},{code:"sn",name:"Shona"},{code:"ii",name:"Sichuan Yi"},{code:"scn",name:"Sicilian"},{code:"sd",name:"Sindhi"},{code:"si",name:"Sinhalese"},{code:"ss",name:"Siswati"},{code:"sk",name:"Slovak"},{code:"sl",name:"Slovenian"},{code:"so",name:"Somali"},{code:"nr",name:"Southern Ndebele"},{code:"su",name:"Sundanese"},{code:"sw",name:"Swahili (Kiswahili)"},{code:"ss",name:"Swati"},{code:"sv",name:"Swedish"},{code:"tl",name:"Tagalog"},{code:"ty",name:"Tahitian"},{code:"tg",name:"Tajik"},{code:"ta",name:"Tamil"},{code:"tt",name:"Tatar"},{code:"te",name:"Telugu"},{code:"th",name:"Thai"},{code:"bo",name:"Tibetan"},{code:"ti",name:"Tigrinya"},{code:"to",name:"Tonga"},{code:"ts",name:"Tsonga"},{code:"tk",name:"Turkmen"},{code:"tw",name:"Twi"},{code:"ug",name:"Uyghur"},{code:"uk",name:"Ukrainian"},{code:"uz",name:"Uzbek"},{code:"ve",name:"Venda"},{code:"vec",name:"Venetian"},{code:"vi",name:"Vietnamese"},{code:"vo",name:"Volap\xFCk"},{code:"wa",name:"Wallon"},{code:"cy",name:"Welsh"},{code:"wo",name:"Wolof"},{code:"fy",name:"Western Frisian"},{code:"xh",name:"Xhosa"},{code:"sah",name:"Yakut"},{code:"yi",name:"Yiddish"},{code:"yo",name:"Yoruba"},{code:"za",name:"Zhuang, Chuang"},{code:"zu",name:"Zulu"}],speechToTextLanguageList=[{name:"Afrikaans (South Africa)",code:"af-ZA"},{name:"Albanian (Albania)",code:"sq-AL"},{name:"Amharic (Ethiopia)",code:"am-ET"},{name:"Arabic (Algeria)",code:"ar-DZ"},{name:"Arabic (Bahrain)",code:"ar-BH"},{name:"Arabic (Egypt)",code:"ar-EG"},{name:"Arabic (Iraq)",code:"ar-IQ"},{name:"Arabic (Israel)",code:"ar-IL"},{name:"Arabic (Jordan)",code:"ar-JO"},{name:"Arabic (Kuwait)",code:"ar-KW"},{name:"Arabic (Lebanon)",code:"ar-LB"},{name:"Arabic (Mauritania)",code:"ar-MR"},{name:"Arabic (Morocco)",code:"ar-MA"},{name:"Arabic (Oman)",code:"ar-OM"},{name:"Arabic (Qatar)",code:"ar-QA"},{name:"Arabic (Saudi Arabia)",code:"ar-SA"},{name:"Arabic (State of Palestine)",code:"ar-PS"},{name:"Arabic (Tunisia)",code:"ar-TN"},{name:"Arabic (United Arab Emirates)",code:"ar-AE"},{name:"Arabic (Yemen)",code:"ar-YE"},{name:"Armenian (Armenia)",code:"hy-AM"},{name:"Azerbaijani (Azerbaijan)",code:"az-AZ"},{name:"Basque (Spain)",code:"eu-ES"},{name:"Bengali (Bangladesh)",code:"bn-BD"},{name:"Bengali (India)",code:"bn-IN"},{name:"Bosnian (Bosnia and Herzegovina)",code:"bs-BA"},{name:"Bulgarian (Bulgaria)",code:"bg-BG"},{name:"Burmese (Myanmar)",code:"my-MM"},{name:"Catalan (Spain)",code:"ca-ES"},{name:"Chinese, Cantonese (Traditional Hong Kong)",code:"yue-Hant-HK"},{name:"Chinese, Mandarin (Simplified, China)",code:"zh"},{name:"Chinese, Mandarin (Traditional, Taiwan)",code:"zh-TW"},{name:"Croatian (Croatia)",code:"hr-HR"},{name:"Czech (Czech Republic)",code:"cs-CZ"},{name:"Danish (Denmark)",code:"da-DK"},{name:"Dutch (Belgium)",code:"nl-BE"},{name:"Dutch (Netherlands)",code:"nl-NL"},{name:"English (Australia)",code:"en-AU"},{name:"English (Canada)",code:"en-CA"},{name:"English (Ghana)",code:"en-GH"},{name:"English (Hong Kong)",code:"en-HK"},{name:"English (India)",code:"en-IN"},{name:"English (Ireland)",code:"en-IE"},{name:"English (Kenya)",code:"en-KE"},{name:"English (New Zealand)",code:"en-NZ"},{name:"English (Nigeria)",code:"en-NG"},{name:"English (Pakistan)",code:"en-PK"},{name:"English (Philippines)",code:"en-PH"},{name:"English (Singapore)",code:"en-SG"},{name:"English (South Africa)",code:"en-ZA"},{name:"English (Tanzania)",code:"en-TZ"},{name:"English (United Kingdom)",code:"en-GB"},{name:"English (United States)",code:"en-US"},{name:"Estonian (Estonia)",code:"et-EE"},{name:"Filipino (Philippines)",code:"fil-PH"},{name:"Finnish (Finland)",code:"fi-FI"},{name:"French (Belgium)",code:"fr-BE"},{name:"French (Canada)",code:"fr-CA"},{name:"French (France)",code:"fr-FR"},{name:"French (Switzerland)",code:"fr-CH"},{name:"Galician (Spain)",code:"gl-ES"},{name:"Georgian (Georgia)",code:"ka-GE"},{name:"German (Austria)",code:"de-AT"},{name:"German (Germany)",code:"de-DE"},{name:"German (Switzerland)",code:"de-CH"},{name:"Greek (Greece)",code:"el-GR"},{name:"Gujarati (India)",code:"gu-IN"},{name:"Hebrew (Israel)",code:"iw-IL"},{name:"Hindi (India)",code:"hi-IN"},{name:"Hungarian (Hungary)",code:"hu-HU"},{name:"Icelandic (Iceland)",code:"is-IS"},{name:"Indonesian (Indonesia)",code:"id-ID"},{name:"Italian (Italy)",code:"it-IT"},{name:"Italian (Switzerland)",code:"it-CH"},{name:"Japanese (Japan)",code:"ja-JP"},{name:"Javanese (Indonesia)",code:"jv-ID"},{name:"Kannada (India)",code:"kn-IN"},{name:"Kazakh (Kazakhstan)",code:"kk-KZ"},{name:"Khmer (Cambodia)",code:"km-KH"},{name:"Kinyarwanda (Rwanda)",code:"rw-RW"},{name:"Korean (South Korea)",code:"ko-KR"},{name:"Lao (Laos)",code:"lo-LA"},{name:"Latvian (Latvia)",code:"lv-LV"},{name:"Lithuanian (Lithuania)",code:"lt-LT"},{name:"Macedonian (North Macedonia)",code:"mk-MK"},{name:"Malay (Malaysia)",code:"ms-MY"},{name:"Malayalam (India)",code:"ml-IN"},{name:"Marathi (India)",code:"mr-IN"},{name:"Mongolian (Mongolia)",code:"mn-MN"},{name:"Nepali (Nepal)",code:"ne-NP"},{name:"Norwegian Bokm\xE5l (Norway)",code:"no-NO"},{name:"Persian (Iran)",code:"fa-IR"},{name:"Polish (Poland)",code:"pl-PL"},{name:"Portuguese (Brazil)",code:"pt-BR"},{name:"Portuguese (Portugal)",code:"pt-PT"},{name:"Punjabi (Gurmukhi India)",code:"pa-Guru-IN"},{name:"Romanian (Romania)",code:"ro-RO"},{name:"Russian (Russia)",code:"ru-RU"},{name:"Serbian (Serbia)",code:"sr-RS"},{name:"Sinhala (Sri Lanka)",code:"si-LK"},{name:"Slovak (Slovakia)",code:"sk-SK"},{name:"Slovenian (Slovenia)",code:"sl-SI"},{name:"Southern Sotho (South Africa)",code:"st-ZA"},{name:"Spanish (Argentina)",code:"es-AR"},{name:"Spanish (Bolivia)",code:"es-BO"},{name:"Spanish (Chile)",code:"es-CL"},{name:"Spanish (Colombia)",code:"es-CO"},{name:"Spanish (Costa Rica)",code:"es-CR"},{name:"Spanish (Dominican Republic)",code:"es-DO"},{name:"Spanish (Ecuador)",code:"es-EC"},{name:"Spanish (El Salvador)",code:"es-SV"},{name:"Spanish (Guatemala)",code:"es-GT"},{name:"Spanish (Honduras)",code:"es-HN"},{name:"Spanish (Mexico)",code:"es-MX"},{name:"Spanish (Nicaragua)",code:"es-NI"},{name:"Spanish (Panama)",code:"es-PA"},{name:"Spanish (Paraguay)",code:"es-PY"},{name:"Spanish (Peru)",code:"es-PE"},{name:"Spanish (Puerto Rico)",code:"es-PR"},{name:"Spanish (Spain)",code:"es-ES"},{name:"Spanish (United States)",code:"es-US"},{name:"Spanish (Uruguay)",code:"es-UY"},{name:"Spanish (Venezuela)",code:"es-VE"},{name:"Sundanese (Indonesia)",code:"su-ID"},{name:"Swahili (Kenya)",code:"sw-KE"},{name:"Swahili (Tanzania)",code:"sw-TZ"},{name:"Swati (Latin, South Africa)",code:"ss-Latn-ZA"},{name:"Swedish (Sweden)",code:"sv-SE"},{name:"Tamil (India)",code:"ta-IN"},{name:"Tamil (Malaysia)",code:"ta-MY"},{name:"Tamil (Singapore)",code:"ta-SG"},{name:"Tamil (Sri Lanka)",code:"ta-LK"},{name:"Telugu (India)",code:"te-IN"},{name:"Thai (Thailand)",code:"th-TH"},{name:"Tsonga (South Africa)",code:"ts-ZA"},{name:"Tswana (Latin, South Africa)",code:"tn-Latn-ZA"},{name:"Turkish (Turkey)",code:"tr-TR"},{name:"Ukrainian (Ukraine)",code:"uk-UA"},{name:"Urdu (India)",code:"ur-IN"},{name:"Urdu (Pakistan)",code:"ur-PK"},{name:"Uzbek (Uzbekistan)",code:"uz-UZ"},{name:"Venda (South Africa)",code:"ve-ZA"},{name:"Vietnamese (Vietnam)",code:"vi-VN"},{name:"Xhosa (South Africa)",code:"xh-ZA"},{name:"Zulu (South Africa)",code:"zu-ZA"}],reportReasonList=[{code:"select",name:"Select reason"},{code:"discriminatory",name:"Racism, sexism, homophobia, hate, or other discrimination"},{code:"spam",name:"Spam"},{code:"irrelevant",name:"Irrelevant or annoying"},{code:"wrong",name:"Wrong tag or language"}],backupModels=[{slug:"gpt-5-2",max_tokens:44815,title:"GPT-5.2",description:"Our latest and most advanced model",tags:["history_off_approved"],capabilities:{},product_features:{attachments:{type:"retrieval",can_accept_all_mime_types:!0},contextual_answers:{is_eligible_for_contextual_answers:!0}},enable_infer:!1,enable_infer_opt_out:!1,reasoning_type:"auto",configurable_thinking_effort:!1,thinking_efforts:[],enabled_tools:["tools","tools2","search","canvas","image_gen_tool_enabled"]},{slug:"gpt-5-2-instant",max_tokens:44815,title:"GPT-5.2 Instant",description:"Our latest and most advanced model",tags:["history_off_approved"],capabilities:{},product_features:{attachments:{type:"retrieval",can_accept_all_mime_types:!0},contextual_answers:{is_eligible_for_contextual_answers:!0}},enable_infer:!1,enable_infer_opt_out:!1,reasoning_type:"none",configurable_thinking_effort:!1,thinking_efforts:[],enabled_tools:["tools","tools2","search","canvas","image_gen_tool_enabled"]},{slug:"gpt-5-2-thinking",max_tokens:196608,title:"GPT-5.2 Thinking",description:"Our latest and most advanced model",tags:["history_off_approved"],capabilities:{},product_features:{attachments:{type:"retrieval",can_accept_all_mime_types:!0},contextual_answers:{is_eligible_for_contextual_answers:!0}},enable_infer:!1,enable_infer_opt_out:!1,reasoning_type:"reasoning",configurable_thinking_effort:!0,thinking_efforts:[{thinking_effort:"standard",full_label:"Thinking",mobile_full_label:"Thinking",short_label:"Standard",description:"Balanced thinking and speed"},{thinking_effort:"extended",full_label:"Extended thinking",mobile_full_label:"Extended",short_label:"Extended",description:"Thinks longer for complex questions"}],enabled_tools:["tools","tools2","search","canvas","image_gen_tool_enabled"]},{slug:"gpt-5-1",max_tokens:35815,title:"GPT-5.1",description:"Our latest and most advanced model",tags:["history_off_approved"],capabilities:{},product_features:{attachments:{type:"retrieval",can_accept_all_mime_types:!0},contextual_answers:{is_eligible_for_contextual_answers:!0}},enable_infer:!1,enable_infer_opt_out:!1,reasoning_type:"auto",configurable_thinking_effort:!1,enabled_tools:["tools","tools2","search","canvas","image_gen_tool_enabled"]},{slug:"gpt-5-1-instant",max_tokens:35815,title:"GPT-5.1 Instant",description:"Our latest and most advanced model",tags:["history_off_approved"],capabilities:{},product_features:{attachments:{type:"retrieval",can_accept_all_mime_types:!0},contextual_answers:{is_eligible_for_contextual_answers:!0}},enable_infer:!1,enable_infer_opt_out:!1,reasoning_type:"none",configurable_thinking_effort:!1,enabled_tools:["tools","tools2","search","canvas","image_gen_tool_enabled"]},{slug:"gpt-5-1-thinking",max_tokens:196608,title:"GPT-5.1 Thinking",description:"Our latest and most advanced model",tags:["history_off_approved"],capabilities:{},product_features:{attachments:{type:"retrieval",can_accept_all_mime_types:!0},contextual_answers:{is_eligible_for_contextual_answers:!0}},enable_infer:!1,enable_infer_opt_out:!1,reasoning_type:"reasoning",configurable_thinking_effort:!0,enabled_tools:["tools","tools2","search","canvas","image_gen_tool_enabled"]},{slug:"gpt-5",max_tokens:34815,title:"GPT-5 Auto",description:"GPT-5 Auto",tags:["history_off_approved","gpt4"],capabilities:{},product_features:{attachments:{type:"retrieval",can_accept_all_mime_types:!0},contextual_answers:{is_eligible_for_contextual_answers:!0}},enable_infer:!1,enable_infer_opt_out:!0,reasoning_type:"auto",enabled_tools:["tools","tools2","search","canvas","image_gen_tool_enabled"]},{slug:"gpt-5-mini",max_tokens:8191,title:"GPT-5 Mini",description:"GPT-5 Mini",tags:["history_off_approved","gpt3.5"],capabilities:{},product_features:{},enable_infer:!1,enable_infer_opt_out:!1,reasoning_type:"none",enabled_tools:["image_gen_tool_enabled"]},{slug:"gpt-5-instant",max_tokens:34815,title:"GPT-5 Fast",description:"GPT-5 Fast",tags:["history_off_approved","gpt4"],capabilities:{},product_features:{attachments:{type:"retrieval",can_accept_all_mime_types:!0},contextual_answers:{is_eligible_for_contextual_answers:!0}},enable_infer:!1,enable_infer_opt_out:!1,reasoning_type:"none",enabled_tools:["tools","tools2","search","canvas","image_gen_tool_enabled"]},{slug:"gpt-5-thinking",max_tokens:196608,title:"GPT-5 Thinking",description:"GPT-5 Thinking",tags:["history_off_approved"],capabilities:{},product_features:{attachments:{type:"retrieval",can_accept_all_mime_types:!0},contextual_answers:{is_eligible_for_contextual_answers:!0}},enable_infer:!1,enable_infer_opt_out:!0,reasoning_type:"reasoning",enabled_tools:["tools","tools2","search","canvas","image_gen_tool_enabled"]},{slug:"gpt-5-t-mini",max_tokens:196608,title:"GPT-5 Thinking Mini",description:"GPT-5 Thinking mini",tags:["history_off_approved"],capabilities:{},product_features:{attachments:{type:"retrieval",can_accept_all_mime_types:!0},contextual_answers:{is_eligible_for_contextual_answers:!0}},enable_infer:!1,enable_infer_opt_out:!0,reasoning_type:"reasoning",enabled_tools:["tools","tools2","search","canvas","image_gen_tool_enabled"]},{slug:"gpt-4o",max_tokens:34815,title:"GPT-4o",description:"GPT-4o",tags:["gpt4o","history_off_approved","gpt4"],capabilities:{},product_features:{attachments:{type:"retrieval",can_accept_all_mime_types:!0},contextual_answers:{is_eligible_for_contextual_answers:!0}},enable_infer:!1,enable_infer_opt_out:!0,reasoning_type:"none",enabled_tools:["tools","tools2","search","canvas","image_gen_tool_enabled"]},{slug:"gpt-4-1",max_tokens:34815,title:"GPT-4.1",description:"GPT-4.1",tags:["history_off_approved","gpt4"],capabilities:{},product_features:{attachments:{type:"retrieval",can_accept_all_mime_types:!0},contextual_answers:{is_eligible_for_contextual_answers:!0}},enable_infer:!1,enable_infer_opt_out:!1,reasoning_type:"none",enabled_tools:["tools","tools2","search","canvas","image_gen_tool_enabled"]},{slug:"gpt-4-1-mini",max_tokens:32767,title:"GPT-4.1 Mini",description:"Browsing, Advanced Data Analysis, and DALL\xB7E are now built into GPT-4",tags:["gpt4o","history_off_approved","gpt3.5","gpt4"],capabilities:{},product_features:{attachments:{type:"retrieval",can_accept_all_mime_types:!0}},enable_infer:!1,enable_infer_opt_out:!1,reasoning_type:"none",enabled_tools:["tools","tools2","search","canvas","image_gen_tool_enabled"]},{slug:"o3",max_tokens:196608,title:"o3",description:"O3",tags:["history_off_approved"],capabilities:{},product_features:{attachments:{type:"retrieval",can_accept_all_mime_types:!0},contextual_answers:{is_eligible_for_contextual_answers:!0}},enable_infer:!1,enable_infer_opt_out:!1,reasoning_type:"reasoning",enabled_tools:["tools","tools2","search","canvas","image_gen_tool_enabled"]},{slug:"o4-mini",max_tokens:196608,title:"o4-mini",description:"O4 mini",tags:["history_off_approved"],capabilities:{},product_features:{attachments:{type:"retrieval",can_accept_all_mime_types:!0},contextual_answers:{is_eligible_for_contextual_answers:!0}},enable_infer:!1,enable_infer_opt_out:!1,reasoning_type:"reasoning",enabled_tools:["tools","tools2","search","canvas","image_gen_tool_enabled"]},{slug:"o4-mini-high",max_tokens:196608,title:"o4-mini-high",description:"O4 mini high",tags:["history_off_approved"],capabilities:{},product_features:{attachments:{type:"retrieval",can_accept_all_mime_types:!0},contextual_answers:{is_eligible_for_contextual_answers:!0}},enable_infer:!1,enable_infer_opt_out:!1,reasoning_type:"reasoning",enabled_tools:["tools","tools2","search","canvas","image_gen_tool_enabled"]},{slug:"text-davinci-002-render-sha",max_tokens:8191,title:"GPT-3.5",description:"Our fastest model, great for most everyday tasks.",tags:["history_off_approved","gpt3.5"],capabilities:{},product_features:{},enable_infer:!1,enable_infer_opt_out:!1,reasoning_type:"none",enabled_tools:["image_gen_tool_enabled"]}];let cachedAudios={},historyCache={},textDocCache={},conversationsCache={},fileIdToDownloadUrlCache={},conversationTextDocsCache={},sharePostCache={},gizmoMap={};function flushCache(){historyCache={},textDocCache={},cachedAudios={},conversationsCache={},conversationTextDocsCache={},fileIdToDownloadUrlCache={},sharePostCache={},gizmoMap={}}let API_URL="https://api.wfh.team";chrome.storage.local.get({API_URL:"https://api.wfh.team"},e=>{API_URL=e.API_URL});let lastPromptSuggestions=[];const citationAttributions=[],defaultHeaders={"content-type":"application/json","Oai-Language":"en-US"},openAIDeviceId=window.localStorage.getItem("oai-did")?.replaceAll('"',"");openAIDeviceId&&(defaultHeaders["Oai-Device-Id"]=openAIDeviceId);function getChatGPTAccountIdFromCookie(){const e=document?.cookie?.split("; ")?.find(t=>t?.startsWith("_account="))?.split("=")?.[1];return e==="personal"?"default":e||"default"}const newChatgptAccountId=getChatGPTAccountIdFromCookie();newChatgptAccountId!=="default"?defaultHeaders["Chatgpt-Account-Id"]=newChatgptAccountId:delete defaultHeaders["Chatgpt-Account-Id"];let loadingChatRequirements=!1,lastChatRequirementsFetch=new Date;function getChatRequirements(){const e=window.localStorage.getItem("sp/chatRequirementsToken"),t=window.localStorage.getItem("sp/proofOfWorkToken"),o=window.localStorage.getItem("sp/turnstileToken"),r=window.localStorage.getItem("sp/arkoseDX");return loadingChatRequirements?Promise.resolve({}):e&&o&&t&&r&&new Date-lastChatRequirementsFetch<1e3*60*5?Promise.resolve({arkoseDX:r}):(loadingChatRequirements=!0,chrome.storage.sync.get(["accessToken"]).then(n=>fetch("/backend-api/sentinel/chat-requirements",{method:"POST",headers:{...defaultHeaders,Authorization:n.accessToken},body:JSON.stringify({p:window.localStorage.getItem("sp/chatRequirementsPayload")})}).then(i=>i.json()).then(async i=>(lastChatRequirementsFetch=new Date,loadingChatRequirements=!1,await processChatRequirements(i),{arkoseDX:i.arkose?.dx}))))}function arkoseDX(){return chrome.storage.sync.get(["accessToken"]).then(e=>fetch("/backend-api/sentinel/arkose/dx",{method:"POST",headers:{...defaultHeaders,Authorization:e.accessToken}}).then(t=>t.json()))}function getSession(){return fetch("/api/auth/session",{method:"GET",headers:{...defaultHeaders}}).then(e=>e.ok?e.json():Promise.reject(e))}function me(e=null){return chrome.storage.sync.get(["accessToken"]).then(t=>fetch("/backend-api/me",{method:"GET",headers:{...defaultHeaders,Authorization:e||t.accessToken}}).then(o=>o.ok?o.json():(console.warn("Failed to fetch me"),Promise.reject(o))))}function gizmoCreatorProfile(){return chrome.storage.sync.get(["accessToken"]).then(e=>fetch("/backend-api/gizmo_creator_profile",{method:"GET",headers:{...defaultHeaders,Authorization:e.accessToken}}).then(t=>t.ok?t.json():Promise.reject(t)))}function checkout(e){return chrome.storage.sync.get(["accessToken"]).then(t=>fetch("/backend-api/payments/checkout",{method:"POST",headers:{...defaultHeaders,Authorization:t.accessToken},body:JSON.stringify(e)}).then(o=>o.ok?o.json():Promise.reject(o)).then(o=>{window.history.pushState({},"",`${o.url}`),window.dispatchEvent(new PopStateEvent("popstate",{state:{}}))}))}function getExamplePrompts(e=0,t=4){const o=new URL(`https://${window.location.host}/backend-api/prompt_library/`),r={offset:e,limit:t};return o.search=new URLSearchParams(r).toString(),chrome.storage.sync.get(["accessToken"]).then(n=>fetch(o,{method:"GET",headers:{...defaultHeaders,Authorization:n.accessToken}}).then(i=>i.json())).then(n=>(lastPromptSuggestions=n?.items?.map(i=>i.prompt),n))}function generateSuggestions(e,t,o,r=2){const n={message_id:t,model:o,num_suggestions:r};return chrome.storage.sync.get(["accessToken"]).then(i=>fetch(`/backend-api/conversation/${e}/experimental/generate_suggestions`,{method:"POST",headers:{...defaultHeaders,Authorization:i.accessToken},body:JSON.stringify(n)}).then(a=>a.json())).then(i=>(lastPromptSuggestions=i.suggestions,i))}let playingAudios={};function synthesize(e,t,o="juniper",r="aac"){if(cachedAudios[t])return cachedAudios[t].currentTime=0,cachedAudios[t].play(),playingAudios[t]=cachedAudios[t],Promise.resolve(cachedAudios[t]);const n=new URL(`https://${window.location.host}/backend-api/synthesize`);return chrome.storage.local.get(["openAIUserSettings"]).then(i=>{const a=i.openAIUserSettings?.settings?.voice_name||o,s={message_id:t,conversation_id:e,voice:a,format:r};return n.search=new URLSearchParams(s).toString(),chrome.storage.sync.get(["accessToken"]).then(l=>fetch(n,{method:"GET",headers:{...defaultHeaders,Authorization:l.accessToken}}).then(d=>{if(d.headers.get("content-type")!=="audio/aac")return toast("Failed to synthesize audio","error"),Promise.reject(d);const c=new MediaSource,u=URL.createObjectURL(c),m=new Audio(u);let g;const p=[];return c.addEventListener("sourceopen",()=>{g||(g=c.addSourceBuffer("audio/aac"),g.addEventListener("updateend",()=>{p.length>0&&!g.updating?g.appendBuffer(p.shift()):p.length===0&&!g.updating&&c.endOfStream()})),d.body.locked||d.body.pipeTo(new WritableStream({write(h){g.updating||p.length>0?p.push(h):g.appendBuffer(h)},close:()=>{!g.updating&&c.readyState==="open"&&c.endOfStream()}})).catch(h=>{console.error("Error piping the response body:",h)})}),m.play(),playingAudios[t]=m,cachedAudios[t]=m,Object.keys(cachedAudios).length>20&&delete cachedAudios[Object.keys(cachedAudios)[0]],m}))})}async function downloadAudio(e,t,o="juniper",r="aac"){if(cachedAudios[t]){const g=document.createElement("a");g.href=cachedAudios[t],g.download=`${t}.${r}`,document.body.appendChild(g),g.click(),g.remove();return}const n=new URL(`https://${window.location.host}/backend-api/synthesize`),{openAIUserSettings:i}=await chrome.storage.local.get(["openAIUserSettings"]),a=i?.settings?.voice_name||o,s={message_id:t,conversation_id:e,voice:a,format:r};n.search=new URLSearchParams(s).toString();const{accessToken:l}=await chrome.storage.sync.get(["accessToken"]),d=await fetch(n,{method:"GET",headers:{...defaultHeaders,Authorization:l}});if(d.headers.get("content-type")!=="audio/aac")throw toast("Failed to download audio","error"),new Error(`Unexpected content-type: ${d.headers.get("content-type")}`);const c=await d.blob(),u=URL.createObjectURL(c);cachedAudios[t]=u,Object.keys(cachedAudios).length>20&&delete cachedAudios[Object.keys(cachedAudios)[0]];const m=document.createElement("a");m.href=u,m.download=`${t}.${r}`,document.body.appendChild(m),m.click(),m.remove()}function convertGizmoToPayload(e){return{id:e.gizmo.id,name:e.gizmo.display.name,author:e.gizmo.author,config:{context_message:e.gizmo.instructions,model_slug:null,assistant_welcome_message:e.gizmo.display.welcome_message,prompt_starters:e.gizmo.display.prompt_starters,enabled_tools:e.tools.map(t=>({tool_id:t.type})),files:e.files,tags:e.gizmo.tags},description:e.gizmo.display.description,owner_id:e.gizmo.author.user_id.split("__")?.[0],updated_at:e.gizmo.updated_at,profile_pic_permalink:e.gizmo.display.profile_picture_url,share_recipient:e.gizmo.share_recipient,version:e.gizmo.version,live_version:e.gizmo.live_version,short_url:e.gizmo.short_url,vanity_metrics:e.gizmo.vanity_metrics,allowed_sharing_recipients:e.gizmo.allowed_sharing_recipients,product_features:e.product_features}}function initConversation(e=null){return chrome.storage.sync.get(["accessToken"]).then(t=>{const o={conversation_id:e,gizmo_id:null,requested_default_model:null,timezone_offset_min:new Date().getTimezoneOffset()};return fetch("/backend-api/conversation/init",{method:"POST",headers:{...defaultHeaders,Authorization:t.accessToken},body:JSON.stringify(o)}).then(r=>r.ok?r.json():Promise.reject(r)).then(r=>{updateRateLimitBanner(r?.banner_info)})})}function getConversation(e,t=!1){return conversationsCache[e]&&!t?Promise.resolve(conversationsCache[e]):chrome.storage.sync.get(["accessToken"]).then(o=>fetch(`/backend-api/conversation/${e}`,{method:"GET",headers:{...defaultHeaders,Authorization:o.accessToken},signal:AbortSignal.timeout(1e4)}).then(r=>r.ok?r.json():(r?.status===404&&chrome.runtime.sendMessage({type:"deleteConversations",detail:{conversationIds:[e]}}),r?.status&&r?.status?.toString()?.startsWith("5")?Promise.resolve(r):Promise.reject(r))).then(r=>(conversationsCache[e]=r,r)).catch(r=>Promise.reject(r)))}function getCitationAttributions(e){return chrome.storage.sync.get(["accessToken"]).then(t=>fetch("/backend-api/attributions",{method:"POST",headers:{...defaultHeaders,Authorization:t.accessToken},body:JSON.stringify({urls:e})}).then(o=>{if(o.ok){const r=o.headers.get("content-type");return r&&r.includes("application/json")?o.json():o.text().then(n=>n.split(`
`).map(i=>{try{return JSON.parse(i)}catch{return null}}).filter(i=>i))}return Promise.reject(o)}).then(o=>(citationAttributions.push(...o),o)))}function getAccount(){return chrome.storage.sync.get(["accessToken"]).then(e=>fetch("/backend-api/accounts/check/v4-2023-04-27",{method:"GET",headers:{...defaultHeaders,Authorization:e.accessToken}}).then(t=>t.ok?t.json():Promise.reject(t)).then(t=>(chrome.storage.local.set({account:t}),t)))}function getConversationTemplates(e,t){return chrome.storage.sync.get(["accessToken"]).then(o=>fetch(`/backend-api/workspaces/${e}/conversation_templates/${t}`,{method:"GET",headers:{...defaultHeaders,Authorization:o.accessToken}}).then(r=>r.ok?r.json():Promise.reject(r)))}function getMemories(e){return chrome.storage.sync.get(["accessToken"]).then(t=>fetch(`/backend-api/memories${e?"":"?include_memory_entries=false"}`,{method:"GET",headers:{...defaultHeaders,Authorization:t.accessToken}}).then(o=>o.ok?o.json():Promise.reject(o)))}function getGizmosBootstrap(e=!1,t=2){return chrome.storage.local.get(["gizmosBootstrap"]).then(o=>{const{gizmosBootstrap:r}=o;return r&&!e?r:chrome.storage.sync.get(["accessToken"]).then(n=>fetch("/backend-api/gizmos/bootstrap",{method:"GET",headers:{...defaultHeaders,Authorization:n.accessToken}}).then(i=>i.ok?i.json():Promise.reject(i)).then(i=>(chrome.storage.local.set({gizmosBootstrap:i}),i)))})}function getGizmosPinned(e=!1){return chrome.storage.local.get(["gizmosPinned"]).then(t=>{const{gizmosPinned:o}=t;return o&&!e?o:chrome.storage.sync.get(["accessToken"]).then(r=>fetch("/backend-api/gizmos/pinned",{method:"GET",headers:{...defaultHeaders,Authorization:r.accessToken}}).then(n=>n.ok?n.json():Promise.reject(n)).then(n=>(chrome.storage.local.set({gizmosPinned:n.items}),n)))})}function updateGizmoSidebar(e,t){return chrome.storage.sync.get(["accessToken"]).then(o=>fetch(`/backend-api/gizmos/${e}/sidebar`,{method:"POST",headers:{...defaultHeaders,Authorization:o.accessToken},body:JSON.stringify({action:t})}).then(r=>{getGizmosBootstrap(!0)}))}function getGizmosByUser(e,t=null){const o=new URL(`https://${window.location.host}/backend-api/gizmo_creators/${e}/gizmos`);return t&&o.searchParams.append("cursor",t),chrome.storage.sync.get(["accessToken"]).then(r=>fetch(o,{method:"GET",headers:{...defaultHeaders,Authorization:r.accessToken}}).then(n=>n.ok?n.json():Promise.reject(n)))}function deleteGizmo(e){return chrome.storage.sync.get(["accessToken"]).then(t=>fetch(`/backend-api/gizmos/${e}`,{method:"DELETE",headers:{...defaultHeaders,Authorization:t.accessToken}}).then(o=>o.ok?(chrome.runtime.sendMessage({type:"deleteSuperpowerGizmo",detail:{gizmoId:e}}),o.json()):Promise.reject(o)))}function getGizmoById(e,t=!1){return e?chrome.storage.local.get(["gizmosBootstrap","gizmoPinned"]).then(o=>{const{gizmosBootstrap:r,gizmoPinned:n}=o,i=gizmoMap[e]||r?.gizmos?.find(a=>a?.resource?.gizmo?.id===e)||n?.find(a=>a?.gizmo?.id===e);return i&&!t?i:chrome.storage.sync.get(["accessToken"]).then(a=>fetch(`/backend-api/gizmos/${e}`,{method:"GET",headers:{...defaultHeaders,Authorization:a.accessToken}}).then(s=>s.ok?s.json():(s?.status===404&&chrome.runtime.sendMessage({type:"deleteSuperpowerGizmo",detail:{gizmoId:e}}),Promise.resolve({}))).then(s=>(s?.gizmo&&chrome.runtime.sendMessage({type:"submitSuperpowerGizmos",detail:{gizmos:[s.gizmo]}}),gizmoMap[e]={flair:{kind:"recent"},resource:s},gizmoMap[e])))}):Promise.resolve(null)}function getGizmoAbout(e){return chrome.storage.sync.get(["accessToken"]).then(t=>fetch(`/backend-api/gizmos/${e}/about`,{method:"GET",headers:{...defaultHeaders,Authorization:t.accessToken}}).then(o=>o.ok?o.json():Promise.resolve({})).then(o=>o))}function getGizmoDiscovery(e,t,o=24,r="global",n=!0){return chrome.storage.local.get(["gizmoDiscovery"]).then(i=>{const{gizmoDiscovery:a}=i;if(!n&&a&&a?.[e])return a[e];let s=new URL(`https://${window.location.host}/public-api/gizmos/discovery`);return e&&(s=new URL(`https://${window.location.host}/public-api/gizmos/discovery/${e}`)),t&&s.searchParams.append("cursor",t),o&&s.searchParams.append("limit",o),r&&s.searchParams.append("locale",r),chrome.storage.sync.get(["accessToken"]).then(l=>fetch(s,{method:"GET",headers:{...defaultHeaders,Authorization:l.accessToken}}).then(d=>d.ok?d.json():Promise.reject(d)).then(d=>{chrome.storage.local.get({gizmoDiscovery:{}},u=>{chrome.storage.local.set({gizmoDiscovery:{...u.gizmoDiscovery,[e]:d}})});const c=e?d.list.items.map(u=>u.resource.gizmo):d.cuts.map(u=>u.list.items.map(m=>m.resource.gizmo)).flat();return chrome.runtime.sendMessage({type:"submitSuperpowerGizmos",detail:{gizmos:c,category:e}}),d}))})}function updateActionSettings(e,t,o,r){const n={domain:t,gizmo_action_id:o,action_settings:r};return chrome.storage.sync.get(["accessToken"]).then(i=>fetch("/backend-api/gizmos/action_settings",{method:"POST",headers:{...defaultHeaders,Authorization:i.accessToken},body:JSON.stringify(n)}).then(a=>a.ok?(getGizmoUserActionSettings(e,!0),a.json()):Promise.reject(a)))}function openOAuthDialog(e,t,o,r){const n={gizmo_id:e,domain:t,gizmo_action_id:o,redirect_to:r};return chrome.storage.sync.get(["accessToken"]).then(i=>fetch("/backend-api/gizmos/oauth_redirect",{method:"POST",headers:{...defaultHeaders,Authorization:i.accessToken},body:JSON.stringify(n)}).then(a=>a.ok?a.json():Promise.reject(a)).then(a=>{window.history.pushState({},"",`${a.redirect_uri}`),window.dispatchEvent(new PopStateEvent("popstate",{state:{}}))}))}function getGizmoUserActionSettings(e,t=!1){return chrome.storage.local.get(["gizmoUserActionSettings"]).then(o=>{const r=o.gizmoUserActionSettings||{};return r[e]&&!t?r[e]:chrome.storage.sync.get(["accessToken"]).then(n=>fetch(`/backend-api/gizmos/user_action_settings?gizmo_id=${e}`,{method:"GET",headers:{...defaultHeaders,Authorization:n.accessToken}}).then(i=>i.ok?i.json():Promise.reject(i)).then(i=>(r[e]=i,chrome.storage.local.set({gizmoUserActionSettings:r}),i)))})}function accountTransfer(e){const t={workspace_id:e};return chrome.storage.sync.get(["accessToken"]).then(o=>fetch("/backend-api/accounts/transfer",{method:"POST",headers:{...defaultHeaders,Authorization:o.accessToken},body:JSON.stringify(t)}).then(r=>r.ok?r.json():Promise.reject(r)))}function getVoices(){return chrome.storage.sync.get(["accessToken"]).then(e=>fetch("/backend-api/settings/voices",{method:"GET",headers:{...defaultHeaders,Authorization:e.accessToken}}).then(t=>t.ok?t.json():Promise.reject(t)))}function getUserSettings(){return chrome.storage.sync.get(["accessToken"]).then(e=>fetch("/backend-api/settings/user",{method:"GET",headers:{...defaultHeaders,Authorization:e.accessToken}}).then(t=>t.ok?t.json():Promise.reject(t)).then(t=>(chrome.storage.local.set({openAIUserSettings:t}),t)))}function updateAccountUserSetting(e,t){return chrome.storage.sync.get(["accessToken"]).then(o=>fetch(`/backend-api/settings/account_user_setting?feature=${e}&value=${t}`,{method:"PATCH",headers:{...defaultHeaders,Authorization:o.accessToken}}).then(r=>r.ok?r.json():Promise.reject(r)).then(r=>(getUserSettings(),chrome.storage.local.get(["openAIUserSettings"],n=>{chrome.storage.local.set({openAIUserSettings:{...n.openAIUserSettings,settings:{...n.openAIUserSettings.settings,[e]:t}}})}),r)))}function createFileInServer(e,t){const o={file_name:e.name,file_size:e.size,use_case:t};return chrome.storage.sync.get(["accessToken"]).then(r=>fetch("/backend-api/files",{method:"POST",headers:{...defaultHeaders,Authorization:r.accessToken},body:JSON.stringify(o)}).then(n=>n.ok?n.json():Promise.reject(n)))}function getFileStatus(e){return chrome.storage.sync.get(["accessToken"]).then(t=>fetch(`/backend-api/files/${e}`,{method:"GET",headers:{...defaultHeaders,Authorization:t.accessToken}}).then(o=>o.ok?o.json():Promise.reject(o)))}function uploadFileAPI(e,t,o){return fetch(t,{method:"PUT",headers:{"x-ms-blob-type":"BlockBlob"},body:o}).then(r=>r.ok?Promise.resolve(r):Promise.reject(r))}function uploadedAPI(e){return chrome.storage.sync.get(["accessToken"]).then(t=>fetch(`/backend-api/files/uploaded/${e}`,{method:"POST",headers:{...defaultHeaders,Authorization:t.accessToken}}).then(o=>o.ok?o.json():Promise.reject(o)))}function getDownloadUrlFromFileId(e,t,o=!1){if(fileIdToDownloadUrlCache[t]?.timestamp&&new Date().getTime()-fileIdToDownloadUrlCache[t].timestamp<1e3*60*3&&!o)return Promise.resolve({...fileIdToDownloadUrlCache[t].data});const r=t.startsWith("file_")?`/backend-api/conversation/${e}/attachment/${t}/download`:`/backend-api/files/download/${t}`;return chrome.storage.sync.get(["accessToken"]).then(n=>fetch(r,{method:"GET",headers:{...defaultHeaders,Authorization:n.accessToken}}).then(i=>i.ok?i.json():Promise.reject(i)).then(i=>(t&&(fileIdToDownloadUrlCache[t]={timestamp:new Date().getTime(),data:i}),i)))}function getDownloadUrlFromSandBoxPath(e,t,o){return chrome.storage.sync.get(["accessToken"]).then(r=>fetch(`/backend-api/conversation/${e}/interpreter/download?message_id=${t}&sandbox_path=${o}`,{method:"GET",headers:{...defaultHeaders,Authorization:r.accessToken}}).then(n=>n.ok?n.json():Promise.reject(n)))}async function setUserSystemMessage(e,t,o,r,n,i,a,s=[]){s.includes("chatgpt_voice")?(s=s.filter(d=>d!=="chatgpt_voice"),a?updateAccountUserSetting("voice_enabled",!1):updateAccountUserSetting("voice_enabled",!0)):updateAccountUserSetting("voice_enabled",!0),s.includes("connector_search")?(s=s.filter(d=>d!=="connector_search"),a?updateAccountUserSetting("connector_search_enabled",!1):updateAccountUserSetting("connector_search_enabled",!0)):updateAccountUserSetting("connector_search_enabled",!0);const l={object:"user_system_message_detail",about_model_message:a&&o?.toString()||"",about_user_message:a&&r?.toString()||"",name_user_message:a&&e?.toString()||"",other_user_message:a&&r?.toString()||"",role_user_message:a&&t?.toString()||"",traits_model_message:a&&o?.toString()||"",personality_type_selection:a&&n||"default",personality_traits:a?i||{}:{},traits_enabled:!0,enabled:!0,disabled_tools:a?s:[]};return chrome.storage.sync.get(["accessToken"]).then(d=>fetch("/backend-api/user_system_messages",{method:"POST",headers:{...defaultHeaders,Authorization:d.accessToken},body:JSON.stringify(l)}).then(c=>c.json()))}function getUserSystemMessage(e=!1){return chrome.storage.sync.get(["accessToken"]).then(t=>fetch("/backend-api/user_system_messages",{method:"GET",headers:{...defaultHeaders,Authorization:t.accessToken}}).then(o=>o.json())).then(t=>(e&&chrome.runtime.sendMessage({type:"updateCustomInstructionProfileByData",detail:{profile:{aboutModelMessage:t.about_model_message?.toString()||"",aboutUserMessage:t.about_user_message?.toString()||"",nameUserMessage:t.name_user_message?.toString()||"",roleUserMessage:t.role_user_message?.toString()||"",otherUserMessage:t.other_user_message?.toString()||"",traitsModelMessage:t.traits_model_message?.toString()||"",personalityTypeSelection:t.personality_type_selection||"default",personalityTraits:t.personality_traits||{},enabled:t.enabled,disabledTools:t.disabled_tools}}}),t))}let cachedTraitPills=[];function getUserSystemMessageTraitPills(){return cachedTraitPills.length>0?Promise.resolve(cachedTraitPills):chrome.storage.sync.get(["accessToken"]).then(e=>fetch("/backend-api/user_system_message_trait_pills",{method:"GET",headers:{...defaultHeaders,Authorization:e.accessToken}}).then(t=>t.json()).then(t=>(cachedTraitPills=t,t)))}function getModels(){return chrome.storage.sync.get(["accessToken"]).then(e=>e.accessToken?fetch("/backend-api/models",{method:"GET",headers:{...defaultHeaders,Authorization:e.accessToken}}).then(t=>t.json()):Promise.resolve()).then(e=>{const t=backupModels;t?chrome.storage.local.get(["selectedModel","settings"],o=>{const{selectedModel:r}=o,n=r&&t?.find(i=>i.slug===r.slug)?r:t?.[0];chrome.storage.local.set({models:t,selectedModel:n}),o.settings.overrideModelSwitcher&&window.sessionStorage.setItem("sp/selectedModel",n.slug)}):chrome.storage.local.set({models:backupModels,selectedModel:null})}).catch(e=>{console.error("Error getting models",e,backupModels),chrome.storage.local.set({models:backupModels,selectedModel:null})})}function getConversationLimit(){return chrome.storage.sync.get(["accessToken"]).then(e=>fetch("/public-api/conversation_limit",{method:"GET",headers:{...defaultHeaders,Authorization:e.accessToken}}).then(t=>t.json()).then(t=>{t.message_cap&&chrome.storage.local.set({conversationLimit:t})}))}function openGraph(e){return chrome.storage.sync.get(["accessToken"]).then(t=>fetch(`/backend-api/opengraph/tags?url=${e}`,{method:"GET",headers:{...defaultHeaders,Authorization:t.accessToken}}).then(o=>o.json()))}function messageFeedback(e,t,o,r=""){const n={conversation_id:e,message_id:t,rating:o,tags:[]};return r&&(n.text=r),chrome.storage.sync.get(["accessToken"]).then(i=>fetch("/backend-api/conversation/message_feedback",{method:"POST",headers:{...defaultHeaders,Authorization:i.accessToken},body:JSON.stringify(n)}).then(a=>a.json()))}function createShare(e,t,o=!0){const r=new URL(`https://${window.location.host}/backend-api/share/create`),n={is_anonymous:o,conversation_id:e,current_node_id:t};return chrome.storage.sync.get(["accessToken"]).then(i=>fetch(r,{method:"POST",headers:{...defaultHeaders,Authorization:i.accessToken},body:JSON.stringify(n)}).then(a=>a.json()))}function shareConv(e){const t=new URL(`https://${window.location.host}/backend-api/share/${e.share_id}`),o={current_node_id:e.current_node_id,highlighted_message_id:e.highlighted_message_id,is_anonymous:e.is_anonymous,is_discoverable:e.is_discoverable,is_public:e.is_public,is_visible:e.is_visible,share_id:e.share_id,title:e.title};return chrome.storage.sync.get(["accessToken"]).then(r=>fetch(t,{method:"PATCH",headers:{...defaultHeaders,Authorization:r.accessToken},body:JSON.stringify(o)}).then(n=>n.ok?n.json():Promise.reject(n)))}function sharePost(e,t=!1){if(sharePostCache[e.shareId]&&!t)return Promise.resolve(sharePostCache[e.shareId]);const o=new URL(`https://${window.location.host}/backend-api/share/post`),r={attachments_to_create:e.attachments_to_create,post_text:e.post_text};return chrome.storage.sync.get(["accessToken"]).then(n=>fetch(o,{method:"POST",headers:{...defaultHeaders,Authorization:n.accessToken},body:JSON.stringify(r)}).then(i=>i.ok?(sharePostCache[e.shareId]=i.json(),sharePostCache[e.shareId]):Promise.reject(i)))}function deleteShare(e){const t=new URL(`https://${window.location.host}/backend-api/share/${e}`);return chrome.storage.sync.get(["accessToken"]).then(o=>fetch(t,{method:"DELETE",headers:{...defaultHeaders,Authorization:o.accessToken}}).then(r=>r.ok?r.json():Promise.reject(r)))}const projectCache={};async function getProjects(e=null,t=1){if(e||(e=0),projectCache[e])return Promise.resolve(projectCache[e]);const o=new URL(`https://${window.location.host}/backend-api/gizmos/snorlax/sidebar`);return t&&o.searchParams.append("conversations_per_gizmo",t),e&&o.searchParams.append("cursor",e),chrome.storage.sync.get(["accessToken"]).then(r=>fetch(o,{method:"GET",headers:{...defaultHeaders,Authorization:r.accessToken}}).then(n=>n.ok?n.json().then(i=>(projectCache[e]=i,i)):Promise.reject(n)))}async function getProjectConversations(e){async function t(o=null){const r=new URL(`https://${window.location.host}/backend-api/gizmos/${e}/conversations`);o&&r.searchParams.append("cursor",o);const n=await chrome.storage.sync.get(["accessToken"]).then(i=>fetch(r,{method:"GET",headers:{...defaultHeaders,Authorization:i.accessToken}}).then(a=>a.ok?a.json():Promise.reject(a)));return n.cursor?n.items.concat(await t(n.cursor)):n.items}return t()}async function addConversationToProject(e,t){const o=new URL(`https://${window.location.host}/backend-api/conversation/${e}`),r={gizmo_id:t};return chrome.storage.sync.get(["accessToken"]).then(n=>fetch(o,{method:"PATCH",headers:{...defaultHeaders,Authorization:n.accessToken},body:JSON.stringify(r)}).then(i=>{if(i.ok){const a=new CustomEvent("conversationProjectUpdated",{detail:{conversationId:e,gizmoId:t}});return window.dispatchEvent(a),i.json()}return Promise.reject(i)}))}async function getConversationsByIds(e){if(!e||e.length===0)return[];const t=[];for(let o=0;o<e.length;o+=1){const r=e[o];if(r)try{const n=await getConversation(r);n&&(n.conversation_id||n.id)&&t.push({...n,conversation_id:n.conversation_id||n.id})}catch(n){console.error(`Failed to get conversation with ID: ${r}`,n)}}return t}function getSelectedConversations(e=[],t=!0){return new Promise(o=>{e?.length>0?o(e):o(getConversationIds(null,null,t))})}function searchConversations(e,t=null){const o=new URL(`https://${window.location.host}/backend-api/conversations/search`);return o.searchParams.append("query",e),t&&o.searchParams.append("cursor",t),chrome.storage.sync.get(["accessToken"]).then(r=>fetch(o,{method:"GET",headers:{...defaultHeaders,Authorization:r.accessToken}}).then(n=>n.ok?n.json():Promise.reject(n)))}function getAllConversationsOld(){return new Promise(e=>{const t=[];getConversations(0,100).then(o=>{const{limit:r,offset:n,items:i,total:a}=o;if(typeof o.total<"u"&&chrome.storage.local.set({totalConversations:o.total}),i.length===0||a===0){e([]);return}if(t.push(...i),n+r<a){const s=[];for(let l=1;l<Math.ceil(a/r);l+=1)s.push(getConversations(l*r,r));Promise.all(s).then(l=>{l.forEach(d=>{d.items&&t.push(...d.items)}),e(t.map(d=>({...d,conversation_id:d.id})))},l=>{console.warn("error getting conversations promise",l),e(Promise.reject(l))})}else e(t.map(s=>({...s,conversation_id:s.id})))},o=>{console.warn("error getting conversations",o),e(Promise.reject(o))})})}async function getAllConversations(){const e=[],t=await getConversations(0,1),{total:o}=t,r=100;typeof o<"u"&&chrome.storage.local.set({totalConversations:o});for(let n=0;n<o;n+=r){const i=await getConversations(n,r);if(!i||!i.items||i.items.length===0)break;const a=i.items.map(s=>({...s,conversation_id:s.id}));e.push(...a)}return e}async function getConversationIds(e=null,t=null,o=!0,r=!1){return await chrome.runtime.sendMessage({type:"getConversationIds",detail:{startDate:e,endDate:t,includeArchived:o,excludeConvInFolders:r}})}async function getConversationIdsByDateRange(e,t){let o=!1;const r=await getConversations(0,1),{total:n}=r,i=100,a=[];for(let s=0;s<n&&!o;s+=i){const l=await getConversations(s,i);if(!l||!l.items||l.items.length===0)break;const{items:d}=l;for(const c of d){const u=new Date(c.update_time.split("T")[0]).getTime();if(u>=e&&u<=t)a.push(c.id);else if(u<e)o=!0;else if(o)break}}return a}function getSharedConversations(e=0,t=100){const o=new URL(`https://${window.location.host}/backend-api/shared_conversations`);return chrome.storage.sync.get(["accessToken"]).then(r=>fetch(o,{method:"GET",headers:{...defaultHeaders,Authorization:r.accessToken}}).then(n=>n.ok?n.json():Promise.reject(n)))}function getConversations(e=0,t=100,o="updated",r=!1,n=!1){const i=`${e}-${t}-${o}-${r}`;if(historyCache[i]&&!n)return Promise.resolve(historyCache[i]);const a=new URL(`https://${window.location.host}/backend-api/conversations`),s={offset:e,limit:t,order:o};return a.search=new URLSearchParams(s).toString(),a.searchParams.append("is_archived",r),chrome.storage.sync.get(["accessToken"]).then(l=>fetch(a,{method:"GET",headers:{...defaultHeaders,Authorization:l.accessToken}}).then(d=>d.ok?d.json().then(c=>({...c,items:c.items.map(u=>({...u,conversation_id:u.id}))})):{items:[],total:0}).then(d=>(historyCache[i]=d,d)))}chrome.runtime.onMessage.addListener((e,t,o)=>((async()=>{const r=e.type,n=e.detail;r==="getConversations"&&getConversations(n.offset,n.limit,n.order,n.isArchived,!0).then(i=>{o(i)})})(),!0));function getConversationsGraphql(e=100,t="aWR4Oi0x",o="updated",r=!0,n=!1){const i=new URL("https://chatgpt.com/graphql"),a={first:e,after:t,order:o,expand:r,isArchived:n},s={persistedQuery:{sha256Hash:"5f5770417560c56ba8fa929b84900b53f40cdcc3906d5197003e9ecf7adf3bb7",version:1}};return i.searchParams.append("variables",JSON.stringify(a)),i.searchParams.append("extensions",JSON.stringify(s)),chrome.storage.sync.get(["accessToken"]).then(l=>fetch(i,{method:"GET",headers:{...defaultHeaders,Authorization:l.accessToken}}).then(d=>d.ok?d.json():Promise.reject(d)).then(d=>({items:d.data.conversationDisplayHistory.edges.map(c=>c.node),pageInfo:d.data.conversationDisplayHistory.pageInfo})))}function updateConversation(e,t){return chrome.storage.sync.get(["accessToken"]).then(o=>fetch(`/backend-api/conversation/${e}`,{method:"PATCH",headers:{...defaultHeaders,Authorization:o.accessToken},body:JSON.stringify(t)}).then(r=>r.json()))}function generateTitle(e,t){const o={message_id:t};return chrome.storage.sync.get(["accessToken"]).then(r=>fetch(`/backend-api/conversation/gen_title/${e}`,{method:"POST",headers:{...defaultHeaders,Authorization:r.accessToken},body:JSON.stringify(o)}).then(n=>n.json()))}function renameConversation(e,t){return historyCache={},delete conversationsCache[e],chrome.storage.sync.get(["accessToken"]).then(o=>fetch(`/backend-api/conversation/${e}`,{method:"PATCH",headers:{...defaultHeaders,Authorization:o.accessToken},body:JSON.stringify({title:t})}).then(r=>r.json()))}function archiveAllConversations(){return historyCache={},conversationsCache={},chrome.storage.sync.get(["accessToken"]).then(e=>fetch("/backend-api/conversations",{method:"PATCH",headers:{...defaultHeaders,Authorization:e.accessToken},body:JSON.stringify({is_archived:!0})}).then(t=>t.ok?(toast("All conversations are archived","success"),document.querySelector("#conversation-list").querySelectorAll("[id^=conversation-button]").forEach(o=>{o.remove()}),t.json()):Promise.reject(t)))}function archiveConversation(e){return historyCache={},delete conversationsCache[e],chrome.storage.sync.get(["accessToken"]).then(t=>fetch(`/backend-api/conversation/${e}`,{method:"PATCH",headers:{...defaultHeaders,Authorization:t.accessToken},body:JSON.stringify({is_archived:!0})}).then(o=>o.ok?o.json():Promise.reject(o)))}function unarchiveConversation(e){return historyCache={},delete conversationsCache[e],chrome.storage.sync.get(["accessToken"]).then(t=>fetch(`/backend-api/conversation/${e}`,{method:"PATCH",headers:{...defaultHeaders,Authorization:t.accessToken},body:JSON.stringify({is_archived:!1})}).then(o=>o.ok?o.json():Promise.reject(o)))}function deleteConversation(e){return historyCache={},delete conversationsCache[e],chrome.storage.sync.get(["accessToken"]).then(t=>fetch(`/backend-api/conversation/${e}`,{method:"PATCH",headers:{...defaultHeaders,Authorization:t.accessToken},body:JSON.stringify({is_visible:!1})}).then(o=>o.ok?o.json():Promise.reject(o)))}function deleteAllConversations(){return historyCache={},conversationsCache={},chrome.storage.sync.get(["accessToken"]).then(e=>fetch("/backend-api/conversations",{method:"PATCH",headers:{...defaultHeaders,Authorization:e.accessToken},body:JSON.stringify({is_visible:!1})}).then(t=>t.ok?t.json():Promise.reject(t)))}function updateAsyncStatus(e){const t=document.querySelector(`#conversation-button-${e} #async-indicator-${e}`);return t&&t.remove(),chrome.storage.sync.get(["accessToken"]).then(o=>fetch(`/backend-api/conversation/${e}/async-status`,{method:"POST",headers:{...defaultHeaders,Authorization:o.accessToken}}).then(async r=>r.ok?r.json():Promise.reject(r)))}function getConversationTextDocs(e,t=!1){return conversationTextDocsCache[e]&&!t?Promise.resolve(conversationTextDocsCache[e]):chrome.storage.sync.get(["accessToken"]).then(o=>fetch(`/backend-api/conversation/${e}/textdocs`,{method:"GET",headers:{...defaultHeaders,Authorization:o.accessToken}}).then(r=>r.ok?r.json():Promise.reject(r)))}function getTextDoc(e,t=!1){return textDocCache[e]&&!t?Promise.resolve(textDocCache[e]):chrome.storage.sync.get(["accessToken"]).then(o=>fetch(`/backend-api/textdoc/${e}`,{method:"GET",headers:{...defaultHeaders,Authorization:o.accessToken}}).then(r=>r.ok?r.json():Promise.reject(r)))}function getTextDocHistory(e,t){return chrome.storage.sync.get(["accessToken"]).then(o=>fetch(`/backend-api/textdoc/${e}/history?before_version=${t}`,{method:"GET",headers:{...defaultHeaders,Authorization:o.accessToken}}).then(r=>r.ok?r.json():Promise.reject(r)))}let firstPageSynced=!1,postSubmitTriggerMessageId,checkPostSubmitInterval,authReceivedDispatched=!1;const galleyImageAddedFileIdsCache=[];window.addEventListener("historyLoadedReceived",e=>{e?.detail?.total&&chrome.storage.local.set({totalConversations:e.detail.total});const{offset:t,limit:o}=e.detail,r="updated",n=e.detail.items?.[0]?.is_archived,i=`${t}-${o}-${r}-${n}`;historyCache[i]=e.detail,!firstPageSynced&&e.detail.offset===0&&e.detail.items.length>0&&(syncHistoryResponseToConversationDB(e.detail,n,!0),firstPageSynced=!0),e.detail.offset>0&&e.detail.items.length>0&&cachedSettings.syncHistoryResponses&&syncHistoryResponseToConversationDB(e.detail,n,!0),chrome.storage.sync.get(["isBanned"],a=>{a?.isBanned||initializePostHistoryLoad()})});const syncConvCache={};window.addEventListener("projectsReceived",e=>{const t=e.detail.cursor?e.detail.cursor:0;if(projectCache[t]=e.detail.responseData,cachedSettings?.syncProjects){const o=e.detail?.responseData?.items?.map(n=>n.conversations.items)?.flat()||[];if(!o.length)return;const r=o?.filter(n=>{const i=n.id||n.conversation_id,a=syncConvCache[i];return!a||new Date(a).getTime()<new Date(n.update_time).getTime()?(syncConvCache[i]=n.update_time,!0):!1});if(!r.length)return;chrome.runtime.sendMessage({type:"addConversations",detail:{conversations:r}})}}),window.addEventListener("fileReceived",async e=>{const{fileId:t,data:o}=e.detail;if(!t||galleyImageAddedFileIdsCache.includes(t))return;galleyImageAddedFileIdsCache.push(t);const{file_name:r,download_url:n,creation_time:i,metadata:a}=o;if(r&&r?.endsWith(".json")||r&&r?.endsWith(".csv")||r&&r?.endsWith(".xlsx")||r&&r?.endsWith(".txt")||r&&r?.endsWith(".pdf")||r&&r?.endsWith(".md")||r&&r?.endsWith(".docx"))return;fileIdToDownloadUrlCache[t]={timestamp:new Date().getTime(),data:o};let s;const l=document.querySelectorAll('main article div[data-message-author-role="user"]');setTimeout(async()=>{const d=getConversationIdFromUrl(),c=await getConversation(d,!0),u=`://${t}`,m=findDalleImageInMapping(c,u),g=findChartImageInMapping(c,u),p=m||g;if(!p)return;const h=p?.title,f=p?.message_id,v=p?.create_time,x=p?.parent,y=p?.asset_object,b=p?.status;if(b&&b!=="finished_successfully")return;x&&(s=extractPromptFromNode(c.mapping,x));const w=document.querySelector(`img[src*="${t}"]`),k=!y?.metadata?.dalle&&!y?.metadata?.generation&&!y?.code,S={image_id:t,message_id:f,title:h,width:y?.width||y?.messages?.[0]?.width||w?.getAttribute("width")||a?.ace?.image_width,height:y?.height||y?.messages?.[0]?.height||w?.getAttribute("height")||a?.ace?.image_height,download_url:n,prompt:s||y?.metadata?.dalle?.prompt||y?.code||w?.alt,gen_id:y?.metadata?.dalle?.gen_id||y?.metadata?.generation?.gen_id,seed:y?.metadata?.dalle?.seed,is_public:!1,category:k?"upload":y?.code||Object.keys(a||{}).includes("ace")?"chart":"dalle",conversation_id:d,created_at:i?new Date(i):v?new Date(formatTime(v)):new Date};chrome.runtime.sendMessage({type:"addGalleryImages",detail:{images:[S]}}).then(M=>{if(!M||M.status!=="success"){console.error("Failed to add gallery image",M);return}if(M?.failed_upload_ids?.length!==0&&n?.startsWith("https://chatgpt.com/")){const $=document.querySelector(`img[src="${n}"]`);if($){const q=document.createElement("canvas");q.width=$.naturalWidth,q.height=$.naturalHeight,q.style.display="none",q.getContext("2d").drawImage($,0,0);const E=q.toDataURL("image/png");try{chrome.runtime.sendMessage({type:"uploadImageToGallery",detail:{imageId:t,imageName:r,dataURI:E,downloadUrl:n}}).then(()=>{q.remove()})}catch(C){console.error("Network error during upload",C)}}else downloadAndUploadImages([{fileId:t,fileName:r,downloadUrl:n}])}})},l&&l.length>1?5e3:1e4)});async function downloadAndUploadImages(e){if(!(!e||!e.length))for(const t of e){await sleep(2e3);const{fileId:o,fileName:r,downloadUrl:n}=t;await downloadFileFromUrl(n,r,!0).then(async i=>{const a=await blobToDataURI(i);chrome.runtime.sendMessage({type:"uploadImageToGallery",detail:{imageId:o,imageName:r,dataURI:a,downloadUrl:n}})})}}window.addEventListener("textdocsReceived",e=>{const{conversationId:t,textdocs:o}=e.detail;o.length&&(conversationTextDocsCache[t]=o,chrome.runtime.sendMessage({type:"addTextdocs",detail:{conversationId:t,textdocs:o}}))}),window.addEventListener("authReceived",e=>{authReceivedDispatched=!0,chrome.runtime.sendMessage({type:"authReceived",detail:e.detail})}),window.addEventListener("signoutReceived",e=>{chrome.runtime.sendMessage({type:"signoutReceived",detail:e.detail})}),window.addEventListener("accountReceived",e=>{const t=e.detail.responseData;chrome.storage.local.set({account:t})}),window.addEventListener("gizmoNotFound",e=>{const t=getGizmoIdFromUrl(e.detail.url);chrome.runtime.sendMessage({type:"deleteSuperpowerGizmo",detail:{gizmoId:t}})}),window.addEventListener("gizmoReceived",async e=>{cachedSettings?.syncGizmos&&chrome.runtime.sendMessage({type:"submitSuperpowerGizmos",detail:{gizmos:[e.detail.gizmo]}})}),window.addEventListener("gizmosBootstrapReceived",e=>{const t=Math.random()<.3&&cachedSettings?.syncGizmos&&(!cachedSettings?.lastGizmosBootstrapReceivedTimestamp||new Date().getTime()-cachedSettings.lastGizmosBootstrapReceivedTimestamp>216e5);chrome.storage.local.set({gizmosBootstrap:e.detail},async()=>{if(t){const o={...cachedSettings,lastGizmosBootstrapReceivedTimestamp:new Date().getTime()};chrome.storage.local.set({settings:o}),chrome.runtime.sendMessage({type:"submitSuperpowerGizmos",detail:{gizmos:e.detail.gizmos.map(r=>r.resource.gizmo)}})}})}),window.addEventListener("gizmoDiscoveryReceived",async e=>{if(Math.random()<.3&&cachedSettings?.syncGizmos&&(!cachedSettings?.lastGizmoDiscoveryReceivedTimestamp||new Date().getTime()-cachedSettings.lastGizmoDiscoveryReceivedTimestamp>216e5)){const t={...cachedSettings,lastGizmoDiscoveryReceivedTimestamp:new Date().getTime()};chrome.storage.local.set({settings:t});const{cuts:o}=e.detail,r=[];for(const n of o){const i=n.info.id,a=n.list.items.map(s=>s.resource.gizmo);a.forEach(s=>{s.display?.categories.includes(i)||s.display.categories.push(i)}),r.push(...a)}chrome.runtime.sendMessage({type:"submitSuperpowerGizmos",detail:{gizmos:r}})}}),window.addEventListener("conversationRenameReceived",e=>{historyCache={},delete conversationsCache[e.detail.conversationId],chrome.runtime.sendMessage({type:"renameConversation",detail:{conversationId:e.detail.conversationId,title:e.detail.title}});const t=document.querySelector(`#sidebar-folder-content #conversation-card-${e.detail.conversationId} #conversation-title`);t&&(t.innerText=e.detail.title)}),window.addEventListener("deleteAllReceived",()=>{historyCache={},conversationsCache={},resetConversationCounts(),chrome.runtime.sendMessage({type:"deleteAllConversations"}),document.querySelector("#sidebar-folder-drawer #folder-breadcrumb-root")?.click()}),window.addEventListener("conversationDeleteReceived",e=>{historyCache={},delete conversationsCache[e.detail.conversationId],chrome.runtime.sendMessage({type:"deleteConversations",detail:{conversationIds:[e.detail.conversationId]}}),removeConversationElements(e.detail.conversationId)}),window.addEventListener("archivedAllReceived",()=>{historyCache={},conversationsCache={},resetConversationCounts(),chrome.runtime.sendMessage({type:"archiveAllConversations"}),document.querySelector("#sidebar-folder-drawer #folder-breadcrumb-root")?.click()}),window.addEventListener("conversationArchivedReceived",e=>{historyCache={},delete conversationsCache[e.detail.conversationId],chrome.runtime.sendMessage({type:"archiveConversations",detail:{conversationIds:[e.detail.conversationId]}}),document.querySelector(`#sidebar-folder-content #conversation-card-${e.detail.conversationId}`)?.remove()}),window.addEventListener("conversationUnarchivedReceived",e=>{historyCache={},delete conversationsCache[e.detail.conversationId],chrome.runtime.sendMessage({type:"unarchiveConversations",detail:{conversationIds:[e.detail.conversationId]}})}),window.addEventListener("conversationProjectUpdated",e=>{historyCache={},delete conversationsCache[e.detail.conversationId],toggleProjectIndicators(e.detail.conversationId,e.detail.gizmoId),chrome.runtime.sendMessage({type:"updateConversationProject",detail:{conversationId:e.detail.conversationId,gizmoId:e.detail.gizmoId}})}),window.addEventListener("subscriptionsReceived",e=>{chrome.storage.local.set({chatgptAccountId:e.detail.accountId||"default"})}),window.addEventListener("userSettingsReceived",e=>{const{accessToken:t}=e.detail;if(delete e.detail.accessToken,setTimeout(()=>{authReceivedDispatched||me(t).then(o=>{const r=new CustomEvent("authReceived",{detail:{...o,accessToken:t}});window.dispatchEvent(r)})},1e3),e.detail?.settings){chrome.storage.local.set({openAIUserSettings:e.detail});const{sunshine:o,moonshine:r}=e.detail?.settings||{};if(!document.querySelector("#memory-toggles-wrapper"))return;const n=document.querySelector('main form input[id="switch-memory"]');n&&(n.checked=o,n.dispatchEvent(new Event("change",{bubbles:!0})));const i=document.querySelector('main form input[id="switch-reference-chats"]');i&&(i.checked=r,i.dispatchEvent(new Event("change",{bubbles:!0})))}}),window.addEventListener("profileUpdatedReceived",e=>{chrome.runtime.sendMessage({type:"updateEnabledCustomInstructionProfile",detail:{profile:e.detail}})}),window.addEventListener("modelsReceived",e=>{const t=e.detail;chrome.storage.local.get(["selectedModel"],o=>{const{selectedModel:r}=o,n=r&&t?.models?.find(i=>i.slug===r.slug)?r:t.models?.[0];chrome.storage.local.set({models:backupModels,selectedModel:n}),cachedSettings.overrideModelSwitcher&&window.sessionStorage.setItem("sp/selectedModel",n.slug)})});let faviconTimeout;window.addEventListener("conversationSubmitted",async e=>{resetPostSubmit();const{messages:t,instructions:o}=e.detail,r=getConversationIdFromUrl(),n=t.find(i=>i.author.role==="user");if(n){const i=n?.content?.parts?.filter(a=>typeof a=="string")?.join(" ");addUserPromptToHistory(i),o&&setTimeout(()=>{const a=n.id,s=document.querySelector(`main article div[data-message-id="${a}"]`);addInstructionIndicators(s,o)},r?0:1e3)}historyCache={},r?delete conversationsCache[r]:conversationsCache={},faviconTimeout=cachedSettings.animateFavicon?animateFavicon():void 0}),window.addEventListener("stopConversationReceived",()=>{setTimeout(async()=>{resetPostSubmit(),stopAnimateFavicon(faviconTimeout),resetPromptChain();const e=Array.from(document.querySelectorAll("main article")),t=e?.pop(),o=t?.querySelector("div[data-message-id]")?.getAttribute("data-message-id"),r=getConversationIdFromUrl();historyCache={},r?delete conversationsCache[r]:conversationsCache={},addPinToArticle(t,o,r,!1);const n=e?.pop(),i=n?.querySelector("div[data-message-id]")?.getAttribute("data-message-id");addPinToArticle(n,i,r,!1);const a=getConversationName();addConversationToSidebarAndSync(a,r)},100)});let lastCurrentNode=null;window.addEventListener("conversationReceived",async e=>{const t=e?.detail?.conversation?.conversation_id;if(!t)return;if(e?.detail?.conversation?.detail?.code==="conversation_not_found"){delete conversationsCache[t],chrome.runtime.sendMessage({type:"deleteConversations",detail:{conversationIds:[t]}});return}const o=document.querySelector("#sidebyside-voice-button"),{conversation:r}=e.detail,n=r.current_node,i=getConversationIdFromUrl();o&&n&&n!==lastCurrentNode&&(lastCurrentNode=n,addConversationToSidebarAndSync(r.title,i)),initializePostHistoryLoad(),document.querySelector("#sidebar-note-input")||(addSidebarNoteInput(),loadNote())});async function setFolderImageFromGizmo(e,t){const o=e.gizmo_id,r=await downloadFileFromUrl(t?.resource?.gizmo?.display?.profile_picture_url,o,!0),n=new FileReader;n.onload=async()=>{const i={image:{base64:n.result.split(",")[1],type:r.type||"image/png",name:`${o}.png`}};chrome.runtime.sendMessage({type:"updateConversationFolder",detail:{folderId:e.id,newData:i}})},n.readAsDataURL(r)}const COMPRESSION_FORMAT="gzip";async function decompressGzip(e){const t=e instanceof Uint8Array?e.buffer:e,o=new Blob([t]).stream(),r=new DecompressionStream(COMPRESSION_FORMAT),n=o.pipeThrough(r),i=await new Response(n).arrayBuffer();return new TextDecoder("utf-8").decode(i)}window.addEventListener("conversationAsyncMessageReceived",async e=>{const{conversationId:t}=e.detail;checkPostSubmit(null,t)}),window.addEventListener("rgstrEventReceived",async e=>{const{payload:t}=e.detail,o=await decompressGzip(t);if(o)try{const{events:r}=JSON.parse(o);if(!r||!Array.isArray(r))return;for(const n of r){const{eventName:i,statsigMetadata:a,metadata:s}=n;i==="chatgpt_conversation_turn_turn_exchange_complete"&&s?.result==="success"&&checkPostSubmit()}}catch(r){console.error("Error parsing rgstrEventReceived payload:",r)}}),window.addEventListener("conversationResponseEnded",async e=>{const{conversationTitle:t,conversationId:o}=e.detail;checkPostSubmit(t,o)}),window.addEventListener("deepResearchFinalMessageReceived",async()=>{const e=getConversationName();checkPostSubmit(e)});async function checkPostSubmit(e=null,t=null){const o=document.querySelectorAll('main article div[data-message-author-role="user"]'),r=o?.[o?.length-1]?.getAttribute("data-message-id");postSubmitTriggerMessageId&&postSubmitTriggerMessageId===r||(postSubmitTriggerMessageId=r,canSubmit()?runPostSubmit(e,t):(clearInterval(checkPostSubmitInterval),checkPostSubmitInterval=setInterval(()=>{canSubmit()&&(clearInterval(checkPostSubmitInterval),runPostSubmit(e,t))},3e3)))}function resetPostSubmit(){lastFocusedArticle=null,clearInterval(checkPostSubmitInterval)}async function runPostSubmit(e=null,t=null){const o=window.location.href.includes("temporary-chat=true");(!e||e==="New chat")&&(e=getConversationName(t)),cachedSettings?.autoSpeak&&handleAutoSpeak(),stopAnimateFavicon(faviconTimeout);const r=Array.from(document.querySelectorAll("main article")),n=r?.pop(),i=n?.querySelector("div[data-message-id]")?.getAttribute("data-message-id"),a=r?.pop(),s=a?.querySelector("div[data-message-id]")?.getAttribute("data-message-id"),l=o?null:getConversationIdFromUrl()||getFirstConversationIdFromSidebar(),d=t||l;historyCache={},o||(d?delete conversationsCache[d]:conversationsCache={}),d&&(addPinToArticle(n,i,d,!1),addPinToArticle(a,s,d,!1),createConversationMiniMap(!0));const c=document.querySelector("#continue-conversation-button");cachedSettings.autoClick&&c?setTimeout(()=>{c.click()},2e3):runningPromptChain&&runningPromptChain.steps.length>1&&runningPromptChainStepIndex<runningPromptChain.steps.length-1?(runningPromptChainStepIndex===0&&addConversationToSidebarAndSync(e,d),setTimeout(()=>{insertNextChain(runningPromptChain,runningPromptChainStepIndex+1)},runningPromptChain.steps_delay||2e3)):(resetPromptChain(),cachedSettings?.chatEndedSound&&playSound("beep"),addConversationToSidebarAndSync(e,d))}async function addConversationToSidebarAndSync(e,t){if(!t||window.location.href.includes("temporary-chat=true"))return;const o=await getConversationsByIds([t]);folderForNewChat&&(o[0].folder=folderForNewChat.id);let r=null;const n=o[0].gizmo_id;if(!folderForNewChat&&n&&!n.startsWith("g-p-")&&cachedSettings.autoFolderCustomGPTs&&await chrome.runtime.sendMessage({type:"checkHasSubscription"})){if(r=await chrome.runtime.sendMessage({type:"getConversationFolderByGizmoId",forceRefresh:!0,detail:{gizmoId:n}}),!r||!r.id){const i=await getGizmoById(n);r=(await chrome.runtime.sendMessage({type:"addConversationFolders",detail:{folders:[{name:i?.resource?.gizmo?.display?.name||n,gizmo_id:n,image_url:i?.resource?.gizmo?.display?.profile_picture_url,color:"#2e2e2e"}]}}))[0],setFolderImageFromGizmo(r,i)}else if(!r.image){const i=await getGizmoById(n);setFolderImageFromGizmo(r,i)}if(r){const i=r?.breadcrumb||[];await goToFolder([...i,r]),o[0].folder=r.id}}o?.length&&((!o[0].title||o[0].title==="New chat")&&(o[0].title=e||o[0].title),chrome.runtime.sendMessage({type:"addConversations",detail:{conversations:o}},i=>{addConversationToSidebarFolder(o[0],folderForNewChat?.id||r?.id||"all"),folderForNewChat=null,initiateNewChatFolderIndicator()}))}const sleep=e=>new Promise(t=>setTimeout(t,e));function isWindows(){return navigator.platform.indexOf("Win")>-1}function isDarkMode(){return document.querySelector("html").classList.contains("dark")}function getBrowser(){return typeof chrome<"u"?typeof browser<"u"?"Firefox":"Chrome":"Edge"}function openLinksInNewTab(){const e=document.createElement("base");e.target="_blank",document.head.appendChild(e)}function areSameArrays(e,t){if(!Array.isArray(e)||!Array.isArray(t))return!0;if(e?.length!==t?.length)return!1;for(let o=0;o<e.length;o+=1)if(!t.includes(e[o]))return!1;return!0}function setChatGPTAccountIdFromCookie(){const e=getChatGPTAccountIdFromCookie();chrome.storage.local.set({chatgptAccountId:e})}const unsafeLangs=["vue","liquid","razor"],markdown=e=>new markdownit({html:e==="assistant",linkify:!0,highlight(t,o){const{language:r,value:n}=o&&hljs.getLanguage(o)?hljs.highlight(t,{language:o}):{language:o,value:unsafeLangs.includes(o)||t.includes("</")?sanitizeHtml(t):t};return`<pre dir="ltr" class="w-full"><div class="dark bg-black mb-4 rounded-md"><div id='code-header' class="flex select-none items-center relative text-token-text-tertiary bg-token-sidebar-surface-primary px-4 py-2 text-xs font-sans rounded-t-md" style='border-top-left-radius:6px;border-top-right-radius:6px;'><span class="">${r}</span><button id='copy-code' data-initialized="false" class="flex ms-auto gap-2 text-token-text-tertiary hover:text-token-text-primary"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg>Copy code</button></div><div class="p-4 overflow-y-auto"><code id="code-content" class="!whitespace-pre hljs language-${r}">${n}</code></div></div></pre>`}});function addSounds(){setTimeout(()=>{const e=document.createElement("audio");e.id="beep-sound",e.src=chrome.runtime.getURL("sounds/beep.mp3"),document.body.appendChild(e)},2e3)}function playSound(e){const t=document.querySelector(`#${e}-sound`);t&&t.play()}function showRandomReminder(e){new Date().getMinutes()%3===0?showInviteReminder(e):showReviewReminder(e)}function showReviewReminder(e){e||setTimeout(()=>{chrome.storage.local.get(["dontShowReviewReminder","lastReviewReminderTimestamp","installDate"],({dontShowReviewReminder:t,lastReviewReminderTimestamp:o,installDate:r})=>{t||r&&Date.now()-r<1e3*60*60*24*7||o&&Date.now()-o<1e3*60*60*24*3||showConfirmDialog("\u{1F381} Are you enjoying Superpower ChatGPT?",'Consider leaving us a review for a chance to win a <a class="underline font-semibold" style="color:deepskyblue;" target="_blank" href="https://www.superpowerdaily.com/p/win-1-year-free-pro-subscription-to-superpower-chatgpt">One Year Free Pro Subscription*</a>.',"Remind me later","Leave a review",()=>{chrome.storage.local.set({lastReviewReminderTimestamp:Date.now()})},()=>{chrome.storage.local.set({lastReviewReminderTimestamp:Date.now()}),window.open("https://chrome.google.com/webstore/detail/superpower-chatgpt/amhmeenmapldpjdedekalnfifgnpfnkc/reviews","_blank")},"green",!0,n=>{chrome.storage.local.set({dontShowReviewReminder:n,lastReviewReminderTimestamp:Date.now()})},"Do not show again","* Reviews are optional")})},1e3*60*1)}function showInviteReminder(e){e||setTimeout(()=>{chrome.storage.local.get(["dontShowInviteReminder","lastInviteReminderTimestamp","installDate"],({dontShowInviteReminder:t,lastInviteReminderTimestamp:o,installDate:r})=>{t||r&&Date.now()-r<1e3*60*60*24*1||o&&Date.now()-o<1e3*60*60*24*3||showConfirmDialog("Invite friends. Earn Pro Subscription","Get a free month of Pro Subscription for every friend you invite after they upgrade to the Pro subscription.","Remind me later","Invite friends",()=>{chrome.storage.local.set({lastInviteReminderTimestamp:Date.now()})},()=>{chrome.storage.local.set({lastInviteReminderTimestamp:Date.now()}),createManager("invite")},"green",!0,n=>{chrome.storage.local.set({dontShowInviteReminder:n,lastInviteReminderTimestamp:Date.now()})})})},1e3*60*1)}const debounce=(e,t=1e3)=>{let o;return function(...r){const n=()=>{clearTimeout(o),e(...r)};if(clearTimeout(o),typeof t=="function"){const i=t();o=setTimeout(n,i)}else o=setTimeout(n,t)}},throttle=(e,t=100)=>{let o;return function(...r){const n=this;o||(e.apply(n,r),o=!0,setTimeout(()=>o=!1,t))}},copyRichText=e=>{let t=e.cloneNode(!0);t.querySelectorAll("pre").forEach(r=>{r.innerHTML=r.firstChild.lastElementChild.outerHTML}),t=t.innerHTML.trim();const o=new ClipboardItem({"text/html":new Blob([t],{type:"text/html"}),"text/plain":new Blob([t],{type:"text/plain"})});navigator.clipboard.write([o])};function isVisible(e){if(window.getComputedStyle(e).display==="none"||window.getComputedStyle(e).visibility==="hidden")return!1;let t=e.parentElement;for(;t;){if(window.getComputedStyle(t).display==="none")return!1;t=t.parentElement}return!0}function adjustMenuPosition(e){const t=e.getBoundingClientRect(),o=window.innerHeight;if(t.bottom>o){const r=e.offsetHeight;e.style.top=`-${r+8}px`;const n=e.getBoundingClientRect();if(n.top<0){const i=n.top;e.style.top=`-${r+i-24}px`}}}function convertNumberToHumanReadable(e){if(!e)return 0;if(e===0)return e;const t=["","k","M","G","T","P","E"],o=Math.log10(e)/3|0;if(o===0)return e;const r=t[o],n=10**(o*3);return(e/n).toFixed(1)+r}function changeFavicon(e){const t=document.createElement("link"),o=document.querySelectorAll('link[rel="icon"]');t.rel="icon",t.type="image/gif",t.href=e,o&&o.forEach(r=>{r.href.includes("favicon")&&document.head.removeChild(r)}),document.head.appendChild(t)}function getCharCount(e){return e&&e.length||0}function getWordCount(e){return e&&e.split(/[\s\n]+/).length||0}function createInfoIcon(e="",t="top",o=""){const r=document.createElement("span");return r.style=o,r.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md ps-0.5 text-token-text-tertiary h-5 w-5 ms-2" style="${o}"><path fill="currentColor" d="M13 12a1 1 0 1 0-2 0v4a1 1 0 1 0 2 0zM12 9.5A1.25 1.25 0 1 0 12 7a1.25 1.25 0 0 0 0 2.5"></path><path fill="currentColor" fill-rule="evenodd" d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2M4 12a8 8 0 1 1 16 0 8 8 0 0 1-16 0" clip-rule="evenodd"></path></svg>`,addTooltip(r,{value:e,position:t}),r}function switchFavicon(){switch(typeof switchFavicon.i>"u"&&(switchFavicon.i=0),switchFavicon.i){case 0:changeFavicon(chrome.runtime.getURL("icons/favicon-1.png"));break;case 1:changeFavicon(chrome.runtime.getURL("icons/favicon-0.png"));break;default:changeFavicon(chrome.runtime.getURL("icons/favicon-0.png"))}switchFavicon.i=switchFavicon.i===1?0:1}function animateFavicon(){return setInterval(switchFavicon,500)}function stopAnimateFavicon(e){changeFavicon(chrome.runtime.getURL("icons/favicon-0.png")),clearTimeout(e)}function flashArticle(e,t="up"){e.style.transition="background-color 0.5s ease",e.style.backgroundColor="#ffd70030",setTimeout(()=>{e.style.backgroundColor=""},1e3);const o=e.getBoundingClientRect();o.top>=0&&o.bottom<=window.innerHeight||e.scrollIntoView({behavior:"smooth",inline:"start",block:"start",container:"nearest"})}let lastFocusedArticle=null;function scrollUpOneArticle(){if(lastFocusedArticle){const r=lastFocusedArticle.previousElementSibling?.previousElementSibling;r&&r.tagName==="ARTICLE"?(lastFocusedArticle=r,flashArticle(r,"up")):flashArticle(lastFocusedArticle,"up");return}const e=document.querySelectorAll("article[data-testid^=conversation-turn]");if(e.length===0)return;let t=e[0],o=Math.abs(t.getBoundingClientRect().top);e.forEach(r=>{if(r.querySelector('div[data-message-author-role="assistant"]'))return;const n=r.getBoundingClientRect().top;if(n>0)return;const i=Math.abs(n);i<o&&(t=r,o=i)}),lastFocusedArticle=t,flashArticle(t,"up")}function scrollDownOneArticle(){if(lastFocusedArticle){const n=lastFocusedArticle.nextElementSibling?.nextElementSibling;n&&n.tagName==="ARTICLE"?(lastFocusedArticle=n,flashArticle(n,"down")):flashArticle(lastFocusedArticle,"down");return}const e=document.querySelectorAll("article[data-testid^=conversation-turn]");if(e.length===0)return;let t=e[e.length-2],o=Math.abs(t.getBoundingClientRect().top);e.forEach((n,i)=>{if(n.querySelector('div[data-message-author-role="assistant"]'))return;const a=n.getBoundingClientRect().top;if(a>60&&i<e.length-2)return;const s=Math.abs(a);s<o&&(t=n,o=s)});const r=t?.nextElementSibling?.nextElementSibling;if(!r||r.tagName!=="ARTICLE"){lastFocusedArticle=t,flashArticle(t,"down");return}lastFocusedArticle=r,flashArticle(r,"down")}function addFloatingButtons(){if(document.querySelector("#floating-button-wrapper"))return;const e=window.location.pathname.includes("/gpts"),t=window.location.pathname.includes("/admin"),o=document.createElement("div");o.id="floating-button-wrapper",o.classList="absolute flex items-center justify-center text-xs font-sans cursor-pointer rounded-md z-10 transition-all duration-300",o.style="bottom: 8rem;right: 3rem;width: 2rem;flex-wrap:wrap;";const r=document.querySelector('div[class*="@container/main"]');sidebarFolderIsOpen()&&!e&&!t?o.style.right=`calc(1rem + ${sidebarFolderDrawerWidth}px)`:sidebarNoteIsOpen&&!e&&!t?o&&(o.style.right=`calc(1rem + ${r.offsetWidth*(sidebarNoteInputWrapperWidth/100)}px)`):o.style.right="3rem";const n=document.createElement("button");n.id="scroll-up-button",n.innerHTML='<svg stroke="currentColor" fill="none" stroke-width="4" viewBox="0 0 48 48" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M24 44V4m20 20L24 4 4 24"></path></svg>',n.classList="flex items-center justify-center border border-token-border-medium text-token-text-tertiary hover:text-token-text-primary bg-token-main-surface-primary text-xs font-sans cursor-pointer rounded-t-md z-10",n.style="width: 2rem;height: 2rem;",n.addEventListener("click",a=>{if(a.shiftKey){scrollUpOneArticle();return}const s=document.querySelector("[id^=message-wrapper-]");if(s){s.parentElement.scrollIntoView({behavior:"smooth"});return}const l=document.querySelector("main div[slot=content]");if(l){l.scrollIntoView({behavior:"smooth"});return}const d=document.querySelectorAll("article[data-testid^=conversation-turn]");d.length>0&&d[d.length-1].parentElement.scrollIntoView({behavior:"smooth",block:"start"})});const i=document.createElement("button");i.id="scroll-down-button",i.innerHTML='<svg stroke="currentColor" fill="none" stroke-width="4" viewBox="0 0 48 48" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M24 4v40M4 24l20 20 20-20"></path></svg>',i.classList="flex items-center justify-center border border-token-border-medium text-token-text-tertiary hover:text-token-text-primary bg-token-main-surface-primary text-xs font-sans cursor-pointer rounded-b-md z-10",i.style="width: 2rem;height: 2rem; border-top: none;",i.addEventListener("click",a=>{if(a.shiftKey){scrollDownOneArticle();return}const s=document.querySelector("#conversation-bottom");if(s){s.scrollIntoView({behavior:"smooth",block:"end"});return}const l=document.querySelector("main div[slot=content]");if(l){l.scrollIntoView({behavior:"smooth",block:"end"});return}const d=document.querySelectorAll("article[data-testid^=conversation-turn]");d.length>0&&d[d.length-1].parentElement.scrollIntoView({behavior:"smooth",block:"end"})}),o.appendChild(n),o.appendChild(i),document.body.appendChild(o)}function showConfirmDialog(e,t,o,r,n,i,a="red",s=!0,l=!1,d="Do not show again",c=""){const u=document.querySelector("#confirm-action-dialog");u&&u.remove();const m={red:"btn-danger",orange:"btn-warning",green:"btn-success"},g=`<div data-state="open" class="fixed inset-0 bg-black/50 dark:bg-black/80" style="pointer-events: auto;">
    <div class="h-full w-full grid grid-cols-[10px_1fr_10px] grid-rows-[minmax(10px,1fr)_auto_minmax(10px,1fr)] md:grid-rows-[minmax(20px,1fr)_auto_minmax(20px,1fr)] overflow-y-auto">
      <div id="confirm-action-dialog-content" role="dialog" data-state="open" class="relative col-auto col-start-2 row-auto row-start-2 w-full rounded-xl text-start shadow-xl transition-all start-1/2 ltr:-translate-x-1/2 rtl:translate-x-1/2 bg-token-sidebar-surface-primary max-w-xl border-token-border-medium border" tabindex="-1" style="pointer-events: auto;">
        <div class="px-4 pb-4 pt-5 flex items-center justify-between border-b border-token-border-medium">
          <div class="flex">
            <div class="flex items-center">
              <div class="flex grow flex-col gap-1">
                <h2 as="h3" class="text-lg font-medium leading-6 text-token-text-tertiary">${translate(e)}</h2>
              </div>
            </div>
          </div>
        </div>
        <div class="p-4">
          <div class="text-sm text-token-text-primary">${translate(t)}</div>
          <div class="mt-5">
            <div class="mt-5 flex justify-between">${l?`
              <div style="display: flex; justify-content: flex-start; align-items: center;">
                <input type="checkbox" id="do-not-show-checkbox" style="margin-right: 8px; width: 12px; height: 12px;" />
                <label for="do-not-show-checkbox" class="text-sm text-token-text-tertiary">${translate(d)}</label>
              </div>`:""}
              <div class="flex flex-row-reverse gap-3 ms-auto">
                <button autofocus tabindex="0" id="confirm-button" class="btn relative ${m[a]} text-white" as="button">
                  <div class="flex w-full gap-2 items-center justify-center">${translate(r)}</div>
                </button>
                <button tabindex="0" id="cancel-button" class="btn relative btn-secondary" as="button">
                  <div class="flex w-full gap-2 items-center justify-center">${translate(o)}</div>
                </button>
              </div>
            </div>
            <div class="w-full flex justify-end mt-2 text-token-text-primary text-xs">${c}</div>
          </div>
        </div>
      </div>
    </div>
  </div>
  `,p=document.createElement("div");p.id="confirm-action-dialog",p.classList="absolute inset-0",p.style="z-index: 100101;",p.innerHTML=g,document.body.appendChild(p);const h=document.querySelector("#confirm-action-dialog #confirm-button"),f=document.querySelector("#confirm-action-dialog #cancel-button");h.focus(),h.addEventListener("click",x=>{x.preventDefault(),x.stopPropagation(),closeMenus(),!document.querySelector("#confirm-action-dialog #confirm-button")?.querySelector("#progress-spinner")&&(i&&i(),s&&p.remove())}),f.addEventListener("click",x=>{x.preventDefault(),x.stopPropagation(),closeMenus(),!document.querySelector("#confirm-action-dialog #confirm-button")?.querySelector("#progress-spinner")&&(n&&n(),p.remove())}),p.addEventListener("click",x=>{if(document.querySelector("#confirm-action-dialog #confirm-button").querySelector("#progress-spinner"))return;const y=document.querySelector("#confirm-action-dialog-content");isDescendant(y,x.target)||(n&&n(),p.remove())});const v=document.querySelector("#do-not-show-checkbox");v&&v.addEventListener("change",x=>{const{checked:y}=v;l&&l(y)})}function showDateSelectorDialog(e="",t="Select date range",o="Cancel",r="Confirm",n=null,i=null,a="red",s=!0){const l=document.querySelector("#date-selector-dialog");l&&l.remove();const d={red:"btn-danger",orange:"btn-warning",green:"btn-success"},c=`<div data-state="open" class="fixed inset-0 bg-black/50 dark:bg-black/80" style="pointer-events: auto;">
  <div class="h-full w-full grid grid-cols-[10px_1fr_10px] grid-rows-[minmax(10px,1fr)_auto_minmax(10px,1fr)] md:grid-rows-[minmax(20px,1fr)_auto_minmax(20px,1fr)] overflow-y-auto">
    <div id="date-selector-dialog-content" role="dialog" data-state="open" class="relative col-auto col-start-2 row-auto row-start-2 w-full rounded-xl text-start shadow-xl transition-all start-1/2 ltr:-translate-x-1/2 rtl:translate-x-1/2 bg-token-sidebar-surface-primary max-w-xl border-token-border-medium border" tabindex="-1" style="pointer-events: auto;">
      <div class="p-4 flex items-center justify-between border-b border-token-border-medium">
        <div class="flex">
          <div class="flex items-center">
            <div class="flex grow flex-col gap-1">
              <h2 as="h2" class="text-lg font-medium leading-6 text-token-text-tertiary">${translate(e)}</h2>
            </div>
          </div>
        </div>
      </div>
      <div class="p-4">
        <h4 as="h4" class="text-md mt-2 text-token-text-primary">${translate(t)}</h2>
        <div class="flex items-center justify-center mt-4">
          <div class="flex flex-col flex-wrap mx-10">
            <label for="start-date" class="text-sm text-token-text-tertiary mb-1">Start Date</label>
            <input id="start-date" type="date" class="p-2 rounded-md border border-token-border-medium bg-token-main-surface-primary text-token-text-primary" placeholder="Select start date" />
          </div>
          <span class="text-xl text-token-text-tertiary relative top-3">\u2192</span>
          <div class="flex flex-col flex-wrap mx-10">
            <label for="end-date" class="text-sm text-token-text-tertiary mb-1">End Date</label>
            <input id="end-date" type="date" class="p-2 rounded-md border border-token-border-medium bg-token-main-surface-primary text-token-text-primary" placeholder="Select end date" />
          </div>
        </div>
        <div class="mt-10">
          <div class="mt-5 flex justify-between">
            <div class="flex gap-3 ms-auto">
              <button id="cancel-button" class="btn relative btn-secondary" as="button">
                <div class="flex w-full gap-2 items-center justify-center">${translate(o)}</div>
              </button>
              <button id="confirm-button" class="btn relative ${d[a]} text-white w-32" as="button">
                <div class="flex w-full gap-2 items-center justify-center">${translate(r)}</div>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>`,u=document.createElement("div");u.id="date-selector-dialog",u.classList="absolute inset-0",u.style="z-index: 100001;",u.innerHTML=c,document.body.appendChild(u);const m=document.querySelector("#date-selector-dialog #confirm-button"),g=document.querySelector("#date-selector-dialog #cancel-button");m.addEventListener("click",p=>{p.preventDefault(),p.stopPropagation(),closeMenus();const h=document.querySelector("#date-selector-dialog #confirm-button");if(h?.querySelector("#progress-spinner"))return;const f=document.querySelector("#start-date").value,v=document.querySelector("#end-date").value;if(!f||!v){toast("Please select start and end date","error");return}if(f>v){toast("Start date cannot be greater than end date","error");return}h.disabled=!0;const x=h.querySelector("div");x.innerHTML='<div class="w-full h-full inset-0 flex items-center justify-center text-white"><svg id="progress-spinner" x="0" y="0" viewbox="0 0 40 40" class="spinner icon icon-md"><circle fill="transparent" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-dasharray="125.6" cx="20" cy="20" r="18"></circle></svg></div>',i&&i(new Date(f).getTime(),new Date(v).getTime()),s&&u.remove()}),g.addEventListener("click",p=>{p.preventDefault(),p.stopPropagation(),closeMenus(),!document.querySelector("#date-selector-dialog #confirm-button")?.querySelector("#progress-spinner")&&(n&&n(),u.remove())}),u.addEventListener("click",p=>{if(document.querySelector("#date-selector-dialog #confirm-button").querySelector("#progress-spinner"))return;const h=document.querySelector("#date-selector-dialog-content");isDescendant(h,p.target)||(n&&n(),u.remove())})}function closeMenusEventListener(){document.body.addEventListener("click",()=>closeMenus())}function closeMenus(){const e=document.querySelectorAll("[id$=-menu]");e.length>0&&e.forEach(t=>t.remove())}function closeModals(){const e=document.querySelectorAll("[id^=modal-]");e.length>0&&e.forEach(t=>t.remove())}function closeRadix(e,t=null){(e.target.closest("div[data-radix-popper-content-wrapper]")||t&&t.closest("div[data-radix-popper-content-wrapper]"))&&(document.dispatchEvent(new KeyboardEvent("keydown",{key:"Escape"})),document.body.style.pointerEvents="auto",document.body.click())}function makeEventInit(e){const t=e.getBoundingClientRect(),o=t.left+t.width/2,r=t.top+t.height/2;return{bubbles:!0,cancelable:!0,composed:!0,view:window,clientX:Math.max(0,o),clientY:Math.max(0,r),screenX:0,screenY:0,button:0,buttons:1,pointerId:1,pointerType:"mouse",isPrimary:!0}}function dispatchPointerClick(e){try{const t=makeEventInit(e);e.dispatchEvent(new PointerEvent("pointerover",t)),e.dispatchEvent(new MouseEvent("mouseover",t)),e.dispatchEvent(new PointerEvent("pointerenter",t)),e.dispatchEvent(new MouseEvent("mouseenter",t)),e.dispatchEvent(new PointerEvent("pointerdown",t)),e.dispatchEvent(new MouseEvent("mousedown",t)),typeof e.focus=="function"&&e.focus();const o={...t,buttons:0};e.dispatchEvent(new PointerEvent("pointerup",o)),e.dispatchEvent(new MouseEvent("mouseup",o)),e.dispatchEvent(new MouseEvent("click",o))}catch(t){console.warn("Error dispatching pointer click",t)}}function dispatchKeyboardFallback(e){try{const t=[new KeyboardEvent("keydown",{key:"Enter",code:"Enter",bubbles:!0,cancelable:!0}),new KeyboardEvent("keyup",{key:"Enter",code:"Enter",bubbles:!0,cancelable:!0}),new KeyboardEvent("keydown",{key:" ",code:"Space",bubbles:!0,cancelable:!0}),new KeyboardEvent("keyup",{key:" ",code:"Space",bubbles:!0,cancelable:!0})];for(const o of t)e.dispatchEvent(o)}catch(t){console.warn("Error dispatching keyboard fallback",t)}}async function openRadixMenu(e){try{if(!e||e.getAttribute("aria-disabled")==="true"||e.hasAttribute("disabled"))return null;e.scrollIntoView({block:"center",inline:"center"}),await sleep(30),dispatchPointerClick(e),await sleep(30),e.getAttribute("aria-expanded")==="true"||(dispatchKeyboardFallback(e),await sleep(30)),await sleep(300)}catch(t){return console.warn("Error in openMoreActionsMenu",t),null}}function getGizmoIdFromUrl(e=null){const t=e||window.location.href,o=/\/g\/(g-[A-Za-z0-9]+)/,r=t.match(o);return r?r[1]:null}function generateRandomDarkColor(){const e=Math.floor(Math.random()*180),t=Math.floor(Math.random()*180),o=Math.floor(Math.random()*180),r=[e,t,o];r.sort(()=>Math.random()-.5);const n=r[0],i=r[1],a=r[2];return`#${n.toString(16).padStart(2,"0")}${i.toString(16).padStart(2,"0")}${a.toString(16).padStart(2,"0")}`}function resetQueryParams(){const e=new URL(window.location.href);e.search="",e.hash="",window.history.replaceState({},"",e)}function capitalize(e){return e.replace(/\b\w/g,t=>t.toUpperCase())}function findValueByKey(e,t){let o=null;function r(n){if(n&&typeof n=="object")for(const i in n){if(i===t){o=n[i];return}typeof n[i]=="object"&&r(n[i])}}return r(e),o}function extractPromptFromNode(e,t){const o=e[t];if(!o||!o.message||!o.message.content||!o.message.content.parts&&!o.message.content.text)return null;try{const{parts:r=[],text:n,content_type:i}=o.message.content;n&&r.push(n);for(const a of r)try{const s=JSON.parse(a);if(s.prompt||i==="code")return s.prompt}catch{}}catch(r){return console.error("Failed to parse content parts as JSON:",r),null}return null}function findDalleImageInMapping(e,t){if(typeof e!="object"||e===null)return null;if(e?.message?.content?.parts){for(const o of e.message.content.parts)if(o.asset_pointer&&o.asset_pointer?.includes(t)){const r=Date.now()/1e3;return{title:e?.message?.metadata?.image_gen_title||"",create_time:e?.message?.create_time||r,message_id:e?.id,parent:e?.parent,asset_object:o,status:e?.message?.status||"finished_successfully"}}}for(const o in e)if(e.hasOwnProperty(o)){const r=findDalleImageInMapping(e[o],t);if(r)return r}return null}function extraxtTitleFromCode(e){let t="";if(e&&e.includes("title")){const o=e.match(/plt\.title\(['"]([^'"]+)['"]\)/);o&&o[1]&&(t=o[1])}return t}function findChartImageInMapping(e,t){if(typeof e!="object"||e===null)return null;const o=e?.message?.metadata?.aggregate_result?.messages;if(o&&o?.some(r=>r?.image_url?.includes(t))){const r=e?.message?.metadata?.aggregate_result,n=Date.now()/1e3,i=r?.code;return{title:extraxtTitleFromCode(i),create_time:e?.message?.create_time||n,message_id:e?.id,parent:e?.parent,asset_object:r,status:e?.message?.status||"finished_successfully"}}for(const r in e)if(e.hasOwnProperty(r)){const n=findChartImageInMapping(e[r],t);if(n)return n}return null}function handleQueryParams(){const e=window.location.search.substring(1),t=new URLSearchParams(e),o=t.get("p"),r=t.get("pid"),n=t.get("mid");if(window.location.hash.startsWith("#manager")){const a=window.location.hash.split("/")[1];createManager(a)}if(window.location.hash.startsWith("#setting")&&!window.location.hash.startsWith("#settings")){const a=window.location.hash.split("/")[1];createSettingsModal(a)}const i=document.querySelector("#prompt-textarea");if(o){setTextAreaElementValue(o),i.focus();const a=getSubmitButton();a&&a.click()}else r?chrome.runtime.sendMessage({type:"getPrompt",detail:{promptId:r}},a=>{setTextAreaElementValue(a?.steps[0]||""),i.focus()}):n&&setTimeout(()=>{const a=document.querySelector(`main [data-message-id="${n}"]`);a&&a.closest("article")?.scrollIntoView({block:"nearest",inline:"nearest"})},1500)}function getMousePosition(e){const t=e.clientX,o=e.clientY;return{x:t,y:o}}function isDescendant(e,t){let o=t?.parentNode;for(;o!=null;){if(o===e)return!0;o=o.parentNode}return!1}function animatePing(e){const t=document.createElement("span");t.classList="absolute flex h-3 w-3",t.style="top: -6px; right: -6px;",t.id="ping";const o=document.createElement("span");o.classList="animate-ping absolute inline-flex h-full w-full rounded-full",o.style=`background-color: ${e}; opacity: 0.75;`;const r=document.createElement("span");return r.classList="relative inline-flex rounded-full h-3 w-3",r.style=`background-color: ${e};`,t.appendChild(o),t.appendChild(r),t}function addTooltip(e,t,o={top:0,left:0}){if(!e||!t||!t.value)return;removeAllTooltips();let r=null;const n=8,i=async()=>{try{let s=t.value;if(typeof s=="function"&&(s=await s(e)),!s)return;if(r=document.createElement("div"),r.id=t.id||"",r.classList="sp-tooltip",typeof s=="string")r.innerHTML=s;else if(s instanceof HTMLElement)r.appendChild(s);else return;document.body.appendChild(r);const{width:l,height:d,top:c,left:u}=e.getBoundingClientRect(),{offsetWidth:m,offsetHeight:g}=r;let p,h;switch(t.position){case"top":p=u+l/2-m/2,h=c-g-n;break;case"bottom":p=u+l/2-m/2,h=c+d+n;break;case"left":p=u-m-n,h=c+d/2-g/2;break;case"right":p=u+l+n,h=c+d/2-g/2;break;case"top-left":p=u-m-n,h=c-g-n;break;case"top-right":p=u+l+n,h=c-g-n;break;case"bottom-left":p=u-m-n,h=c+d+n;break;case"bottom-right":p=u+l+n,h=c+d+n;break;default:p=u+l/2-m/2,h=c-g-n}r.style.left=`${p+(o.left||0)}px`,r.style.top=`${h+(o.top||0)}px`,r.classList.add("tooltip-visible")}catch(s){console.error("Error showing tooltip:",s)}},a=()=>{removeAllTooltips(),r&&(r.remove(),r=null)};e.addEventListener("mouseenter",i),e.addEventListener("mouseleave",a),e.addEventListener("mousedown",a),e.addEventListener("scroll",a)}function removeAllTooltips(){document.querySelectorAll(".sp-tooltip").forEach(e=>e.remove())}document.addEventListener("click",()=>{removeAllTooltips()}),document.addEventListener("scroll",()=>{removeAllTooltips()},!0),document.addEventListener("keydown",()=>{removeAllTooltips()});function getUserProfile(){gizmoCreatorProfile().then(e=>{const t=e?.name,o=e?.website_url,r={};t&&(r.name=t),o&&(r.url=o),chrome.storage.sync.set(r)})}function checkForNewUpdate(){cachedSettings?.hideUpdateNotification||chrome.runtime.sendMessage({type:"getLatestVersion"},e=>{e?.status==="update_available"&&showUpdateAvailableNotification(e?.version)})}chrome.runtime.onMessage.addListener((e,t,o)=>((async()=>e.type==="updateAvailable"&&showUpdateAvailableNotification(e.detail?.version))(),!0));function showUpdateAvailableNotification(e=""){showConfirmDialog("New update available",`A new version${e?` (v${e})`:""} of <b>Superpower ChatGPT</b> is available. Update now to get the latest features and bug fixes.`,"Cancel","Update now",null,()=>{chrome.runtime.sendMessage({type:"reloadExtension",forceRefresh:!0},()=>{window.location.reload()})},"green",!0)}function formatTime(e){return e&&(e.toString().indexOf("T")!==-1?new Date(e).getTime():e.toString().indexOf(".")!==-1&&e.toString().split(".")[0].length===10?new Date(e*1e3).getTime():e.toString().indexOf(".")!==-1&&e.toString().split(".")[0].length===13?new Date(e).getTime():e.toString().length===13?new Date(e).getTime():e.toString().length===10?new Date(e*1e3).getTime():e)}function formatDate(e){if(!e)return e;const t=new Date,o=new Date;o.setDate(o.getDate()-1);const r=t.getDate(),n=t.getMonth()+1,i=t.getFullYear(),a=e.getDate(),s=e.getMonth()+1,l=e.getFullYear();return r===a&&n===s&&i===l?`Today ${e.toLocaleTimeString("en-US",{hour:"numeric",minute:"numeric"})}`:o.getDate()===a&&o.getMonth()+1===s&&o.getFullYear()===l?`Yesterday ${e.toLocaleTimeString("en-US",{hour:"numeric",minute:"numeric"})}`:`${e.toLocaleDateString("en-US",{year:"2-digit",month:"2-digit",day:"2-digit"})} ${e.toLocaleTimeString("en-US",{hour:"numeric",minute:"numeric"})}`}function formatDateDalle(){const e=new Date,t=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0"),n=String(e.getHours()).padStart(2,"0"),i=String(e.getMinutes()).padStart(2,"0"),a=String(e.getSeconds()).padStart(2,"0");return`${t}-${o}-${r} ${n}.${i}.${a}`}function getFirstConversationIdFromSidebar(){const e=document.querySelectorAll('nav div[id="history"] a[href*="/c/"]');if(e.length>0){const t=e[0];return getConversationIdFromUrl(t.href)}return null}function getConversationIdFromUrl(e=null){e||(e=window.location.href);const t=/\/c\/(.*?)(\/|\?|#|$)/,o=e.match(t);return o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(o[1])?o[1]:null}function getConversationName(e=null){if(!e){const r=getConversationIdFromUrl();if(!r)return"New chat";e=r}const t=document.querySelector(`nav a[href$="/c/${e}"]`);if(t)return t.textContent;const o=conversationsCache[e];return o?o.title:"New chat"}function getProjectIdFromUrl(e){const t=e.match(/g-(p-[a-f0-9]+)/);return t?`g-${t[1]}`:null}function getProjectName(e=null){if(!e){const r=getProjectIdFromUrl();if(!r)return"New project";e=r}const t=document.querySelector(`nav a[href^="/g/${e}"]`);if(t)return t.textContent;const o=Object.values(projectCache).map(r=>r.items)?.flat()?.find(r=>r.gizmo.gizmo.id===e);return o?o.title:"New project"}function sanitizeHtml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function escapeHTML(e){const t=document.createTextNode(e),o=document.createElement("p");return o.appendChild(t),o.innerHTML}function highlightSearch(e,t){debounce(highlightSearchDebounced,100)(e,t)}function highlightSearchDebounced(e,t){if(!e)return;if(!t){CSS.highlights.clear();return}const o=[];for(let a=0;a<e.length;a+=1){if(!e[a])continue;const s=document.createTreeWalker(e[a],NodeFilter.SHOW_TEXT);let l=s.nextNode();for(;l;)o.push(l),l=s.nextNode()}if(!CSS.highlights)return;CSS.highlights.clear();const r=t.toLowerCase();if(!r.trim())return;const n=o.map(a=>({el:a,text:a.textContent.toLowerCase()})).map(({text:a,el:s})=>{const l=[];let d=0;for(;d<a.length;){const c=a.indexOf(r,d);if(c===-1)break;l.push(c),d=c+r.length}return l.map(c=>{const u=new Range;return u.setStart(s,c),u.setEnd(s,c+r.length),u})}),i=new Highlight(...n.flat());CSS.highlights.set("search-results",i)}function getCustomHighlights(){if(!CSS.highlights)return[];const e=[];if(typeof CSS.highlights.forEach=="function")return CSS.highlights.forEach((t,o)=>e.push({name:o,highlight:t})),e;if(typeof CSS.highlights.entries=="function"){for(const[t,o]of CSS.highlights.entries())e.push({name:t,highlight:o});return e}if(CSS.highlights[Symbol.iterator])for(const[t,o]of CSS.highlights)e.push({name:t,highlight:o});return e}function getAllHighlightRanges(){const e=getCustomHighlights(),t=[];for(const{highlight:o}of e)if(o)for(const r of o)r instanceof Range&&t.push(r);return t}function scrollToHighlight(e=null){if(!CSS.highlights)return;const t=getAllHighlightRanges();if(!t.length)return;t.sort((i,a)=>i.compareBoundaryPoints(Range.START_TO_START,a));const o=t[0];try{const i=o.getClientRects(),a=i&&i.length?Array.from(i).find(s=>s.width>0&&s.height>0)||i[0]:o.getBoundingClientRect();if(a&&(a.width>0||a.height>0)){e?.scrollTo({top:e.scrollTop+a.top-e.clientHeight/2,left:e.scrollLeft+a.left-e.clientWidth/2,behavior:"instant"});return}}catch{}const r=o.startContainer,n=r?.nodeType===Node.TEXT_NODE?r.parentElement:r;n&&typeof n.scrollIntoView=="function"&&n.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})}function createHighlightOverlay(e,t){const o=document.createElement("div");return o.id=`${e.id}-highlight-overlay`,o.classList=`${e.classList} highlight-overlay`,o.innerText=e.value,e.appendChild(o),highlightSearch([o],t),e.addEventListener("input",()=>{const r=document.querySelector(`#${e.id}-highlight-overlay`);if(!r)return;const n=document.querySelector(`#${e.id}`);r.innerHTML=n.value.replace(/\n/g,"<br>"),t&&highlightSearch([r],t)}),e.addEventListener("scroll",()=>{const r=document.querySelector(`#${e.id}-highlight-overlay`);if(!r)return;const n=document.querySelector(`#${e.id}`);r.scrollTop=n.scrollTop}),o}function highlightBracket(e){return e&&(e.trim().length===0?"":e.replace(/\{\{.*?\}\}/g,t=>`<strong data-word="${t.replace(/[{}]/g,"")}" class="rounded-md bg-token-main-surface-tertiary italic border-2 border-token-border-medium" style="margin:0 2px; padding:1px 4px;">${t.replace(/[{}]/g,"")}</strong>`))}function getRedirectUrl(e){return chrome.storage.sync.get(["accessToken"]).then(t=>fetch(e,{headers:{Authorization:t.accessToken}}).then(o=>o.redirected?o.url:e))}function normalizeString(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}function makeElementDraggable(e){let t=0,o=0,r=0,n=0;document.getElementById(`${e.id}header`)?document.getElementById(`${e.id}header`).onmousedown=i:e.onmousedown=i;function i(l){e.style.cursor="grabbing",l=l||window.event,l.preventDefault(),r=l.clientX,n=l.clientY,document.onmouseup=s,document.onmousemove=a}function a(l){l=l||window.event,l.preventDefault(),t=r-l.clientX,o=n-l.clientY,r=l.clientX,n=l.clientY,e.style.top=`${e.offsetTop-o}px`,e.style.left=`${e.offsetLeft-t}px`}function s(){e.style.cursor="grab",document.onmouseup=null,document.onmousemove=null}}function disableDraggable(e){document.getElementById(`${e.id}header`)?document.getElementById(`${e.id}header`).onmousedown=null:e.onmousedown=null}const dataURItoBlob=e=>{const[t,o]=e.split(","),r=atob(o),n=new ArrayBuffer(r.length),i=new Uint8Array(n);for(let a=0;a<r.length;a+=1)i[a]=r.charCodeAt(a);return new Blob([n],{type:t.split(":")[1].split(";")[0]})};async function blobToDataURI(e){return new Promise((t,o)=>{const r=new FileReader;r.onloadend=()=>{t(r.result)},r.onerror=o,r.readAsDataURL(e)})}async function downloadFileFromUrl(e,t,o=!1){if((e.startsWith("/api/content")||e.startsWith("/backend-api/content"))&&(e=await getRedirectUrl(`https://chatgpt.com${e}`)),e.includes("a0.wfh.team")){const r=new URL(e);r.searchParams.set("cache","false"),e=r.toString()}return await fetch(e,{method:"GET",headers:{origin:"https://chatgpt.com"}}).then(r=>r.blob()).then(r=>{if(o)return r;const n=URL.createObjectURL(r),i=document.createElement("a");return i.href=n,i.style.display="none",i.download=t,document.body.appendChild(i),i.click(),i.remove(),r})}const rgba2hex=e=>e?`#${e?.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+\.{0,1}\d*))?\)$/)?.slice(1)?.map((t,o)=>(o===3?Math.round(parseFloat(t)*255):parseFloat(t)).toString(16).padStart(2,"0").replace("NaN",""))?.join("")}`:"";function remoteFunction(e){for(let t=0;t<e.length;t+=1){const o=e[t];switch(o.functionName){case"removeElements":removeElements(o.args);break;case"addCSS":addCSS(o.args);break;case"toast":toast(o.args.html,o.args.type,o.args.duration);break;default:break}}}function removeElements(e){e?.selector&&document.querySelectorAll(e.selector).forEach(t=>{t.remove()})}function addCSS(e){if(e?.css){const t=document.createElement("style");t.innerHTML=e.css,document.head.appendChild(t)}}function loadingSpinner(e){const t=document.createElement("div");return t.id=`loading-spinner-${e}`,t.classList="absolute top-0 start-0 flex items-center justify-center w-full h-full",t.innerHTML=`<svg x="0" y="0" viewbox="0 0 40 40" class="spinner icon icon-xl"><circle fill="transparent" stroke="${isDarkMode()?"#fff":"#000"}" stroke-width="2" stroke-linecap="round" stroke-dasharray="125.6" cx="20" cy="20" r="18"></circle></svg>`,t}function toast(e,t="success",o=4e3){const r=document.querySelector("#gptx-toast");r&&r.remove();const n=document.createElement("div");n.id="gptx-toast",n.style="position:fixed;right:24px;top:24px;border-radius:4px;background-color:#19c37d;padding:8px 16px;z-index:1000001;max-width:600px; color:white;",t==="error"&&(n.style.backgroundColor="#ef4146"),t==="warning"&&(n.style.backgroundColor="#e06c2b"),n.innerHTML=translate(e),document.body.appendChild(n),setTimeout(()=>{isAltKeyDown||n.remove()},o)}function createSlider(e,t,o,r,n,i,a,s=null,l=[],d=!1){const c=document.createElement("div");c.style="display: flex; flex-direction:column; justify-content: flex-start; align-items: flex-start; width: 100%; margin: 8px 0;";const u=document.createElement("div");u.style="display:flex; align-items: center; width: 100%; margin: 8px 0;";const m=document.createElement("div");m.style="min-width: fit-content; font-size: 16px;",m.innerHTML=translate(e);const g=document.createElement("div");g.style="font-size: 12px; color: #999;",g.innerHTML=translate(t),u.appendChild(m);const p=document.createElement("input");p.id=`sp-range-slider-${o}`,p.classList="sp-range-slider",p.style="width: 100%; margin: 8px",p.type="range",p.min=n,p.max=i,p.step=a,p.disabled=d;const h=document.createElement("span");if(h.id=`sp-range-slider-value-${o}`,h.style="min-width: fit-content;font-size: 14px; color: #999; margin: 0 16px;",h.textContent=r,o){const f=cachedSettings[o];if(f===void 0&&r!==void 0){const v={...cachedSettings};v[o]=r,h.textContent=r,chrome.storage.local.set({settings:v})}else p.value=f,h.textContent=f;p.addEventListener("input",()=>{h.textContent=p.value}),p.addEventListener("change",()=>{const v=cachedSettings[o],x={...cachedSettings};x[o]=p.value,h.textContent=p.value,chrome.storage.local.set({settings:x},()=>{s&&s(v,p.value)})})}else p.value=r,h.textContent=r,p.addEventListener("change",()=>{s&&s(p.value)});return u.appendChild(h),u.appendChild(p),c.appendChild(u),c.appendChild(g),c}function createSwitch(e,t,o,r,n=null,i=[],a=!1,s=!0,l=!1){const d=document.createElement("div");d.id=`sp-switch-wrapper-${e.toLowerCase().replaceAll(" ","-")}`,d.style=`display: flex; flex-direction: column; justify-content: start; align-items: start; width: 100%; ${l?"":"padding: 8px 0;"} ${s?"border-bottom: 1px solid #333;":""} transition: all 0.2s ease-in-out;`;const c=document.createElement("div");c.style=`display: flex; flex-direction: row; justify-content: start; align-items: center; width: 100%; ${l?"":"margin: 8px 0;"}`,c.innerHTML=`<div style="white-space: nowrap;">${translate(e)}</div>`;const u=document.createElement("label");u.classList="sp-switch",u.style.marginLeft="auto",l&&(u.style.transform="scale(0.75)",u.style.margin=0),u.style.opacity=a?"0.5":"1";const m=document.createElement("input");m.id=`switch-${e.toLowerCase().replaceAll(" ","-")}`,m.type="checkbox",m.disabled=a;const g=document.createElement("div");g.classList="flex items-center gap-2 mx-2",i.forEach(f=>{const v=document.createElement("span");v.style=`${f==="\u26A1\uFE0F Requires Pro Account"?"background-color: #19c37d; color: black;":f==="New"?"background-color: #ef4146; color: white;":"background-color: #ff9800; color: black;"}  padding: 2px 4px; border-radius: 8px; font-size: 0.7em;`,v.textContent=f,f==="\u26A1\uFE0F Requires Pro Account"&&(v.role="button",v.addEventListener("click",()=>{document.querySelector("#upgrade-to-pro-button-settings")?.click()})),g.appendChild(v)});const p=document.createElement("div");if(p.style="font-size: 12px; color: #999;",p.innerHTML=translate(t),o){const f=cachedSettings[o];if(f===void 0&&r!==void 0){const v={...cachedSettings};v[o]=r,chrome.storage.local.set({settings:v}),m.checked=r}else m.checked=f;m.addEventListener("change",v=>{chrome.runtime.sendMessage({type:"checkHasSubscription"},x=>{if(!x&&i.includes("\u26A1\uFE0F Requires Pro Account"))toast("This feature is only available for Pro users. Please upgrade to Pro to use this feature.","error"),m.checked=r;else{const y={...cachedSettings};y[o]=m.checked,chrome.storage.local.set({settings:y},()=>{n&&n(m.checked,v)})}})})}else chrome.runtime.sendMessage({type:"checkHasSubscription"},f=>{!f&&i.includes("\u26A1\uFE0F Requires Pro Account")?(toast("This feature is only available for Pro users. Please upgrade to Pro to use this feature.","error"),m.checked=r):(m.checked=r,m.addEventListener("change",v=>{n&&n(m.checked,v)}))});const h=document.createElement("span");return h.classList="sp-switch-slider round",i.length>0&&c.appendChild(g),u.appendChild(m),u.appendChild(h),c.appendChild(u),d.appendChild(c),d.appendChild(p),d}function getFileType(e){switch(e?.split(".").pop()){case"png":case"jpg":case"jpeg":case"gif":case"webp":return"Image";case"pdf":return"PDF";case"doc":case"docx":case"txt":return"Document";case"csv":case"xls":case"xlsx":return"Spreadsheet";case"js":return"JavaScript";case"py":return"Python";default:return"File"}}function navigationObserver(e){new MutationObserver((t,o)=>{const r=new URL(e.destination.url);createSidebarNotesButton(r),createSidebarFolderButton(r),initializeInput(),setContentWidth(),addManagerButton(),setTimeout(()=>{createSidebarFolderButton(r)},2e3),o.disconnect()}).observe(document.body,{childList:!0,subtree:!0})}function initializeNavigation(){if("navigation"in window){let e="";navigation.addEventListener("navigate",t=>{const o=window.location.href,r=t.destination.url;if(new URL(r).hostname==="chatgpt.com"&&(debounceCreateConversationMiniMap(),window.localStorage.setItem("sp/messagesToggleState",null),e=document.querySelector("#prompt-textarea")?.innerHTML,newConversationStarted(o,r)&&(resetPostSubmit(),resetInstructions(),resetPromptChain(),updateSelectedConvCard(null,!0)),conversationIdHasChanged(o,r)&&(resetPostSubmit(),resetInstructions(),stopAnimateFavicon(faviconTimeout),resetPromptChain()),pathHasChanged(o,r))){resetPostSubmit(),resetInstructions();const n=()=>{window.location.href===r?(setTimeout(()=>{navigationObserver(t),updateTextArea(e)},500),setTimeout(()=>{showRerunLastPromptChain()},1500)):requestAnimationFrame(n)};requestAnimationFrame(n)}})}else console.log("Navigation API is not supported in this browser.")}function updateTextArea(e){if(!e)return;const t=document.querySelector("#prompt-textarea");if(t){t.innerHTML=e,setSelectionAtEnd(t);return}new MutationObserver((o,r)=>{const n=document.querySelector("#prompt-textarea");n&&(n.innerHTML=e,setSelectionAtEnd(t),r.disconnect())}).observe(document.body,{childList:!0,subtree:!0})}function conversationIdHasChanged(e,t){const o=getConversationIdFromUrl(e),r=getConversationIdFromUrl(t);return!o||!r?!1:o!==r}function pathHasChanged(e,t){const o=new URL(e).pathname,r=new URL(t).pathname;return o!==r}function newConversationStarted(e,t){const o=getConversationIdFromUrl(e),r=getConversationIdFromUrl(t);return o&&!r}async function generalObserver(){const e=await chrome.runtime.sendMessage({type:"checkHasSubscription"});new MutationObserver((t,o)=>{customWidthObserverCallback(),continueButtonObserverCallback(),memoryTogglesObserverCallback(),promptRewriterObserverCallback(),bloopObserverCallback(),attachObserverCallback(e),customInstructionProfileSelectorObserverCallback(),canvasObserverCallback(),topNavObserverCallback(t)}).observe(document.body,{childList:!0,subtree:!0})}const sidebysideExpandSVG='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="icon icon-lg text-token-main-surface-primary-inverse" viewBox="0 0 512 512"><path d="M183 295l-81.38 81.38l-47.03-47.03c-6.127-6.117-14.29-9.367-22.63-9.367c-4.117 0-8.279 .8086-12.25 2.43c-11.97 4.953-19.75 16.63-19.75 29.56v135.1C.0013 501.3 10.75 512 24 512h136c12.94 0 24.63-7.797 29.56-19.75c4.969-11.97 2.219-25.72-6.938-34.87l-47.03-47.03l81.38-81.38c9.375-9.375 9.375-24.56 0-33.94S192.4 285.7 183 295zM487.1 0h-136c-12.94 0-24.63 7.797-29.56 19.75c-4.969 11.97-2.219 25.72 6.938 34.87l47.04 47.03l-81.38 81.38c-9.375 9.375-9.375 24.56 0 33.94s24.56 9.375 33.94 0l81.38-81.38l47.03 47.03c6.127 6.117 14.3 9.35 22.63 9.35c4.117 0 8.275-.7918 12.24-2.413C504.2 184.6 512 172.9 512 159.1V23.1C512 10.75 501.3 0 487.1 0z"/></svg>',sidebysideCollapseSVG='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="icon icon-lg text-token-main-surface-primary-inverse" viewBox="0 0 512 512"><path d="M488.1 23.03c-9.375-9.375-24.56-9.375-33.94 0l-81.38 81.38l-47.03-47.03c-6.127-6.117-14.3-9.35-22.63-9.35c-4.117 0-8.275 .7918-12.24 2.413c-11.97 4.953-19.75 16.63-19.75 29.56v135.1c0 13.25 10.74 23.1 24 23.1h136c12.94 0 24.63-7.797 29.56-19.75c4.969-11.97 2.219-25.72-6.938-34.87l-47.04-47.03l81.38-81.38C498.3 47.59 498.3 32.41 488.1 23.03zM215.1 272h-136c-12.94 0-24.63 7.797-29.56 19.75C45.47 303.7 48.22 317.5 57.37 326.6l47.04 47.03l-81.38 81.38c-9.375 9.375-9.375 24.56 0 33.94s24.56 9.375 33.94 0l81.38-81.38l47.03 47.03c6.127 6.117 14.29 9.367 22.63 9.367c4.117 0 8.279-.8086 12.25-2.43c11.97-4.953 19.75-16.63 19.75-29.56V296C239.1 282.7 229.3 272 215.1 272z"/></svg>';function bloopObserverCallback(){const{sidebysideVoice:e}=cachedSettings;if(!document.querySelector("#sidebyside-voice-button")&&document.querySelector('div[class*="min-h-bloop min-w-bloop"]')){const t=document.querySelector('div[class*="lk-room-container"] button svg > use[href*="85f94b"]')?.closest("button");if(!t)return;t.id="sidebyside-close-button";const o=t?.parentElement?.parentElement;if(!o)return;const r=o?.cloneNode(!0);r.id="sidebyside-voice-button",e?r.querySelector("svg").outerHTML=sidebysideExpandSVG:r.querySelector("svg").outerHTML=sidebysideCollapseSVG,r.addEventListener("click",async()=>{if(!await chrome.runtime.sendMessage({type:"checkHasSubscription"})){errorUpgradeConfirmation({title:"This is a Pro feature",message:"Using the Side by Side voice mode requires a Pro subscription. Upgrade to Pro to remove all limits."});return}setVoiceModeWrapper(!cachedSettings.sidebysideVoice),chrome.storage.local.set({settings:{...cachedSettings,sidebysideVoice:!cachedSettings.sidebysideVoice}})}),o?.parentElement?.appendChild(r),setVoiceModeWrapper(e)}}async function setVoiceModeWrapper(e){const t=document.querySelector('div[class*="lk-room-container"] button svg > use[href*="85f94b"]')?.closest("button");if(!t)return;const o=t?.parentElement?.parentElement;if(!o)return;const r=o.closest('div[class*="top-0 z-50 flex h-full w-full"]');if(!r)return;r.classList.add("end-0","border","border-token-border-medium","rounded-2xl","shadow-long"),r.classList.remove("start-0"),e?(r.style="opacity: 1; will-change: auto; height: 500px; width: 300px; transform: scale(.5);cursor: grab;",makeElementDraggable(r)):(r.style="opacity: 1; will-change: auto;",disableDraggable(r));const n=document.querySelector("#sidebyside-voice-button");if(!n)return;const i=n.querySelector("svg");i&&(i.outerHTML=e?sidebysideExpandSVG:sidebysideCollapseSVG)}function customWidthObserverCallback(){cachedSettings.customConversationWidth&&setConversationWidth(cachedSettings.conversationWidth)}function memoryTogglesObserverCallback(){cachedSettings.showMemoryTogglesInInput&&debounceAddMemoryToggleButtonsToInput()}function promptRewriterObserverCallback(){cachedSettings.showPromptRewriterButtonInInput&&debounceAddPromptRewriteButtonToPromptInput()}function continueButtonObserverCallback(){cachedSettings.showFavoritePromptsButton&&debounceInitializeContinueButton()}async function attachObserverCallback(e){if(document.querySelector("#select-from-gallery-button"))return;const t=document.querySelector('div[data-radix-popper-content-wrapper] div[role="menuitem"] svg > use[href*="712359"]')?.closest('div[role="menuitem"]');if(!t||t.parentElement.innerText.includes("Delete"))return;const o=t.cloneNode(!0);o.id="select-from-gallery-button",o.classList.add("gap-1.5"),o.innerHTML=`<div class="flex shrink-0 items-center justify-center group-disabled:opacity-50 group-data-disabled:opacity-50 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon icon-sm" fill="currentColor"><path d="M152 120c-26.51 0-48 21.49-48 48s21.49 48 48 48s48-21.49 48-48S178.5 120 152 120zM447.1 32h-384C28.65 32-.0091 60.65-.0091 96v320c0 35.35 28.65 64 63.1 64h384c35.35 0 64-28.65 64-64V96C511.1 60.65 483.3 32 447.1 32zM463.1 409.3l-136.8-185.9C323.8 218.8 318.1 216 312 216c-6.113 0-11.82 2.768-15.21 7.379l-106.6 144.1l-37.09-46.1c-3.441-4.279-8.934-6.809-14.77-6.809c-5.842 0-11.33 2.529-14.78 6.809l-75.52 93.81c0-.0293 0 .0293 0 0L47.99 96c0-8.822 7.178-16 16-16h384c8.822 0 16 7.178 16 16V409.3z"/></svg></div>Select from gallery  ${e?"":'<span class="ms-auto text-white rounded-md bg-green-500 px-2 text-sm">Pro</span>'}</div>`,o.addEventListener("click",async r=>{if(closeMenus(),closeRadix(r),!e){errorUpgradeConfirmation({title:"This is a Pro feature",message:"Using the Gallery requires a Pro subscription. Upgrade to Pro to remove all limits."});return}showImagePicker()}),t.parentElement.appendChild(o)}function customInstructionProfileSelectorObserverCallback(){cachedSettings.showCustomInstructionProfileSelector&&debounceInitializeCustomInstructionProfileSelector()}function canvasObserverCallback(){const e=document.querySelectorAll("header").length>=2,t=document.querySelector('header button svg > use[href*="1a24f4"]')?.closest("button"),o=document.querySelector('div[style*="width: 450px"]'),r=document.querySelector('div[class*="lk-room-container"]');e||t||o||r?throttleInitializeCanvasChanges():throttleUndoCanvasChanges()}async function topNavObserverCallback(e){removeUpdateButton(),throttleSetContentWidth(),cachedSettings?.overrideModelSwitcher?overrideModelSwitchers():window.sessionStorage.removeItem("sp/selectedModel");for(const t of e){const o=getConversationIdFromUrl(),r=document.querySelector("main");if(!r)continue;const n=r.querySelectorAll("article");if(o&&n.length===0)continue;o&&throttleReplaceShareButtonWithConversationMenu();const i=r.querySelectorAll('article div[data-message-author-role="user"]');if(!(o&&i.length===0)){if(!o&&n.length===0){initializeNavbar();return}t.target.nodeType===Node.ELEMENT_NODE&&isArticleOrSubArticle(t.target)&&(throttleReplaceAllInstructionsInConversation(),cachedSettings.showMessageCharWordCount&&debounceAddMessageCharWordCounters(),cachedSettings.showMessageTimestamp&&debounceAddMessageTimestamps(),await debounceCreatePinButtons(),await debounceAddToggleButtonToArticle(),debounceCreateConversationMiniMap())}}}function sidebarObserverCallback(){if(!document.querySelector("nav"))return;const e=document.querySelector("#limit-width");if(!e)return;const t=window.localStorage.getItem("sp/appSidebarWidth")||260;window.localStorage.getItem("sp/canvasIsOpen")==="true"?e.parentElement.style.minWidth="0px":e.parentElement.style.width=`${t}px`}function resizeObserverCallback(e,t){if(t.startsWith("sp/"))window.localStorage.setItem(t,Math.round(e));else{const o=cachedSettings;o[t]=Math.round(e),chrome.storage.local.set({settings:o})}}function elementResizeObserver(e,t){new ResizeObserver(o=>{if(window.localStorage.getItem("sp/mouseDown")!=="true"||o.length===0||!o[0].contentRect||o[0].target!==e)return;const{width:r}=o[0].contentRect;r!==0&&resizeObserverCallback(r,t)}).observe(e)}function mainResizeObserver(){const e=new ResizeObserver(()=>{const o=document.querySelector('div[class*="@container/main"]');if(!o)return;const r=document.querySelector("#sidebar-note-input-wrapper"),n=window.location.pathname.includes("/gpts"),i=window.location.pathname.includes("/admin"),a=document.querySelector("#floating-button-wrapper");r&&sidebarNoteIsOpen&&!n&&!i&&a&&(a.style.right=`calc(1rem + ${o.offsetWidth*(sidebarNoteInputWrapperWidth/100)}px)`)}),t=document.querySelector('div[class*="@container/main"]');t&&e.observe(t)}function isArticleOrSubArticle(e){for(;e;){if(e.tagName==="ARTICLE")return!0;e=e.parentElement}return!1}const throttleInitializeCanvasChanges=throttle(()=>{initializeCanvasChanges()},100);function initializeCanvasChanges(){window.localStorage.setItem("sp/canvasIsOpen","true"),document.body.querySelector("#floating-button-wrapper")?.classList.add("hidden"),document.body.querySelector("#sidebar-note-button")?.classList.add("hidden"),document.body.querySelector("#sidebar-folder-button")?.classList.add("hidden"),document.body.querySelector("#gptx-nav-wrapper")?.classList?.add("hidden"),document.body.querySelector("#memory-toggles-wrapper")?.classList.add("hidden"),sidebarNoteIsOpen&&toggleSidebarNote(),sidebarFolderIsOpen()&&toggleSidebarFolder()}const throttleUndoCanvasChanges=throttle(()=>{undoCanvasChanges()},100);function undoCanvasChanges(){window.localStorage.setItem("sp/canvasIsOpen","false");const e=window.location.pathname.includes("/gpts"),t=window.location.pathname.includes("/admin"),o=window.location.pathname.startsWith("/g/g-p-")&&window.location.pathname.endsWith("/project"),{showSidebarNoteButton:r,showSidebarFolderButton:n}=cachedSettings;!e&&!t&&!o&&(r&&document.body.querySelector("#sidebar-note-button")?.classList.remove("hidden"),n&&(document.body.querySelector("#sidebar-folder-button")?.classList.remove("hidden"),createSidebarFolderButton())),document.body.querySelector("#floating-button-wrapper")?.classList.remove("hidden"),document.body.querySelector("#gptx-nav-wrapper")?.classList?.remove("hidden"),document.body.querySelector("#memory-toggles-wrapper")?.classList.remove("hidden")}let speakingMessageId,isAltKeyDown=!1;const autoSpeackQueue=[];function initializeSpeechToText(){if(isFirefox||isOpera||!initializePromptInputPlaceholder())return;let e,t="",o=!1;const r=window.SpeechRecognition||window.webkitSpeechRecognition,n=new r;n.continuous=!1,n.maxAlternatives=1,n.onresult=function(i){const a=i.results.length-1,s=i.results[a][0].transcript.trim();setTextAreaElementValue(`${t?`${t} `:""}${s}`)},n.onspeechend=function(){n.stop(),setTimeout(()=>{isAltKeyDown&&(t=document.querySelector("#prompt-textarea").innerText,n.start())},200)},n.onerror=function(i){setTimeout(()=>{isAltKeyDown&&i.error==="no-speech"&&(t=document.querySelector("#prompt-textarea").innerText,n.start())},200)},document.addEventListener("keyup",i=>{isAltKeyDown=!1,clearTimeout(e),n.abort();const a=getSubmitButton();a&&o&&(o=!1,toast("Stopped listening"),(i.key==="Alt"||i.keyCode===18)&&cachedSettings.autoSubmitWhenReleaseAlt&&a.click())}),document.addEventListener("keydown",i=>{if(i.altKey&&!(i.ctrlKey||i.shiftKey||i.metaKey||i.key==="Tab"||[8,46,37,38,39,40,36,35,33,34,13,32].includes(i.keyCode))){if(isAltKeyDown)return;isAltKeyDown=!0,e=setTimeout(()=>{i.ctrlKey||i.shiftKey||i.metaKey||i.key==="Tab"||[8,46,37,38,39,40,36,35,33,34,13,32].includes(i.keyCode)||isAltKeyDown&&chrome.runtime.sendMessage({type:"checkHasSubscription"},a=>{a?(stopAllAudios(),t=document.querySelector("#prompt-textarea").innerText,n.lang=cachedSettings.speechToTextLanguage.code,n.interimResults=cachedSettings.speechToTextInterimResults,o||(o=!0,n.start(),toast("Started listening"))):toast("\u26A1\uFE0F Speech to text requires the Pro Subscription.","success",6e3)})},1500)}else clearTimeout(e),n.abort(),o&&(o=!1,toast("Stopped listening"))}),window.addEventListener("blur",()=>{clearTimeout(e),n.abort(),o&&(o=!1,toast("Stopped listening"))})}function initializePromptInputPlaceholder(){if(!cachedSettings.enableSpeechToTextShortkey){const o=document.createElement("style");return o.innerHTML=`
    .placeholder:after {
      --tw-content: "Type / for Prompts" !important;
    }
    `,document.head.appendChild(o),!1}const e=navigator.platform.toUpperCase().indexOf("MAC")>=0,t=document.createElement("style");return e?t.innerHTML=`
    .placeholder:after {
      --tw-content: "Type / for Prompts \u2014 Hold down \u2325 (Option) to enable speaking" !important;
    }
    `:t.innerHTML=`
    .placeholder:after {
      --tw-content: "Type / for Prompts \u2014 Hold down ALT to enable speaking" !important;
    }
    `,document.head.appendChild(t),!0}function stopAllAudios(e=!0){e&&(speakingMessageId=""),Object.values(playingAudios).forEach(t=>{t.pause()}),playingAudios={},document.querySelectorAll('[id^="text-to-speech-button-"]').forEach(t=>{t.style="",t.disabled=!1,t.innerHTML='<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md-heavy"><path fill-rule="evenodd" clip-rule="evenodd" d="M11 4.9099C11 4.47485 10.4828 4.24734 10.1621 4.54132L6.67572 7.7372C6.49129 7.90626 6.25019 8.00005 6 8.00005H4C3.44772 8.00005 3 8.44776 3 9.00005V15C3 15.5523 3.44772 16 4 16H6C6.25019 16 6.49129 16.0938 6.67572 16.2629L10.1621 19.4588C10.4828 19.7527 11 19.5252 11 19.0902V4.9099ZM8.81069 3.06701C10.4142 1.59714 13 2.73463 13 4.9099V19.0902C13 21.2655 10.4142 22.403 8.81069 20.9331L5.61102 18H4C2.34315 18 1 16.6569 1 15V9.00005C1 7.34319 2.34315 6.00005 4 6.00005H5.61102L8.81069 3.06701ZM20.3166 6.35665C20.8019 6.09313 21.409 6.27296 21.6725 6.75833C22.5191 8.3176 22.9996 10.1042 22.9996 12.0001C22.9996 13.8507 22.5418 15.5974 21.7323 17.1302C21.4744 17.6185 20.8695 17.8054 20.3811 17.5475C19.8927 17.2896 19.7059 16.6846 19.9638 16.1962C20.6249 14.9444 20.9996 13.5175 20.9996 12.0001C20.9996 10.4458 20.6064 8.98627 19.9149 7.71262C19.6514 7.22726 19.8312 6.62017 20.3166 6.35665ZM15.7994 7.90049C16.241 7.5688 16.8679 7.65789 17.1995 8.09947C18.0156 9.18593 18.4996 10.5379 18.4996 12.0001C18.4996 13.3127 18.1094 14.5372 17.4385 15.5604C17.1357 16.0222 16.5158 16.1511 16.0539 15.8483C15.5921 15.5455 15.4632 14.9255 15.766 14.4637C16.2298 13.7564 16.4996 12.9113 16.4996 12.0001C16.4996 10.9859 16.1653 10.0526 15.6004 9.30063C15.2687 8.85905 15.3578 8.23218 15.7994 7.90049Z" fill="currentColor"></path></svg>'})}function addAudioEventListener(){const e=document.querySelector("audio.fixed.bottom-0.start-0.hidden.h-0.w-0");e&&e.addEventListener("ended",()=>{autoSpeackQueue.shift(),autoSpeackQueue.length>0&&autoSpeackQueue[0].click()})}async function handleAutoSpeak(){const e=document.querySelectorAll("article[data-testid^=conversation-turn]");if(e.length>0){const t=e[e.length-1];let o=t.querySelector("[data-testid=voice-play-turn-action-button]");if(!o){const r=getMoreActionsButton(t);if(await openRadixMenu(r),o=document.querySelector('div[role="menuitem"][data-testid=voice-play-turn-action-button]'),!o)return}autoSpeackQueue.length===0&&o.click(),autoSpeackQueue.push(o)}}function addMessageMoreActionMenuEventListener(){document.body.addEventListener("click",e=>{const t=e.target.closest("button");if(!t||!t.querySelector('svg > use[href*="f6d0e2"]')||t.getAttribute("aria-haspopup")!=="menu"||!t.parentElement?.id.startsWith("message-actions-"))return;const o=getConversationIdFromUrl(),r=t.parentElement.id.replace("message-actions-","");addDownloadAudioMenuItem(o,r)})}async function addDownloadAudioMenuItem(e,t){const o=document.body.querySelector('div[role="menu"]');if(!o)return;const r=o.querySelectorAll('div[role="menuitem"]');if(!r)return;const n=await chrome.runtime.sendMessage({type:"checkHasSubscription"});if(!document.querySelector('div[role="menuitem"][data-testid=voice-play-turn-action-button]'))return;const i=[{text:"Download audio",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md text-token-text-primary"><path fill-rule="evenodd" clip-rule="evenodd" d="M7.70711 10.2929C7.31658 9.90237 6.68342 9.90237 6.29289 10.2929C5.90237 10.6834 5.90237 11.3166 6.29289 11.7071L11.2929 16.7071C11.6834 17.0976 12.3166 17.0976 12.7071 16.7071L17.7071 11.7071C18.0976 11.3166 18.0976 10.6834 17.7071 10.2929C17.3166 9.90237 16.6834 9.90237 16.2929 10.2929L13 13.5858L13 4C13 3.44771 12.5523 3 12 3C11.4477 3 11 3.44771 11 4L11 13.5858L7.70711 10.2929ZM5 19C4.44772 19 4 19.4477 4 20C4 20.5523 4.44772 21 5 21H19C19.5523 21 20 20.5523 20 20C20 19.4477 19.5523 19 19 19L5 19Z" fill="currentColor"></path></svg>',requirePro:!0,click:async l=>{if(!n){errorUpgradeConfirmation({title:"This is a Pro feature",message:"Downloading message audio requires a Pro subscription. Upgrade to Pro to remove all limits."}),closeRadix(l.event,l.menuButton);return}l.menuButton.innerHTML=`<div class="flex min-w-0 grow items-center gap-2.5"><svg x="0" y="0" viewbox="0 0 40 40" class="spinner icon icon-md"><circle fill="transparent" stroke="${isDarkMode()?"#fff":"#000"}" stroke-width="2" stroke-linecap="round" stroke-dasharray="125.6" cx="20" cy="20" r="18"></circle></svg>Downloading...</div>`,await downloadAudio(l.conversationId,l.messageId),closeRadix(l.event,l.menuButton)}}],a=r[0],s=r[r.length-1];i.forEach(l=>{const d=a.cloneNode(!0);d.removeAttribute("data-color"),d.classList.add("hover:bg-token-surface-hover"),s.after(d),d.innerHTML=`<div class="flex min-w-0 grow items-center gap-2.5">${l.icon}${translate(l.text)}${!l.requirePro||n?"":'<span class="text-white rounded-md bg-green-500 px-2 text-sm ml-auto">Pro</span>'}</div>`,d.addEventListener("click",c=>{c.stopPropagation(),c.preventDefault(),l.click({menuButton:d,conversationId:e,messageId:t,hasSubscription:n,event:c})})})}function makeSidebarResizable(){if(document.querySelector("#limit-width"))return;const e=window.localStorage.getItem("sp/appSidebarWidth")||260,t=document.querySelector('div[class*="w-[260px]"]');t&&(t.id="limit-width",t.style.width="100%",t.parentElement.classList.add("resize-x"),t.parentElement.style.minWidth=`${e}px`,elementResizeObserver(t.parentElement,"sp/appSidebarWidth"))}function removeUpdateButton(){const e=document.querySelectorAll("nav");if(e.length!==0)for(let t=0;t<e.length;t+=1){const o=e[t];o.parentElement.parentElement.style.zIndex=1e5,o.parentElement.parentElement.style.position="relative";const r=o.querySelector('div[data-testid="accounts-profile-button"] > div > button[class*="__menu-item"]');if(r){const n=r.parentElement;n&&(n.style.display="none")}}}function addNavClickEventListener(){document.body.addEventListener("click",e=>{if(!e.isTrusted)return;const t=document.querySelector("nav");if(!t)return;const o=document.querySelector("#sidebar-folder-drawer");t.contains(e.target)&&(o?.contains(e.target)||(folderForNewChat=null,initiateNewChatFolderIndicator()))})}function addSidebarOpenButtonEventListener(){document.body.addEventListener("click",e=>{if(!e.isTrusted)return;const t=document.querySelector('button svg > use[href*="836f7a"]')?.closest("button");t&&t.contains(e.target)&&setTimeout(()=>{createSidebarFolderButton()},500)})}async function initiateNewChatFolderIndicator(){const e=document.querySelector("#new-chat-folder-indicator-wrapper");if(e&&e.remove(),!folderForNewChat||folderForNewChat.gizmo_id)return;let t=isOnNewChatPage(!1),o=Array.from(document.querySelectorAll("main article"));if(!t||o.length>0){let i=0;const a=setInterval(()=>{t=isOnNewChatPage(!1),o=Array.from(document.querySelectorAll("main article")),(t&&o.length===0||i>=50)&&(clearInterval(a),initiateNewChatFolderIndicator()),i+=1},300)}if(!t)return;const r=document.createElement("div");r.id="new-chat-folder-indicator-wrapper",r.classList="w-full flex flex-wrap items-center justify-start relative",r.style.top="-24px",r.innerHTML='<div class="w-full flex items-center justify-start text-xs mb-2 text-token-text-tertiary">Starting new chat in</div>',r.appendChild(conversationFolderElement(folderForNewChat,!0,!1,!0,!0,!0));const n=document.querySelector("main form");if(n&&(n.parentElement.parentElement.classList.add("flex-wrap"),n.parentElement.parentElement.prepend(r),folderForNewChat.profile?.id)){const i=await chrome.runtime.sendMessage({type:"getConversationFolder",forceRefresh:!0,detail:{folderId:folderForNewChat.id}});updateCustomInstructionProfileSelector(i.profile,!0)}}function addConversationMenuEventListener(){document.body.addEventListener("click",e=>{const t=e.target.closest("button");if(!t)return;const o=t.closest('a[href*="/c/"]');if(!o||!o.closest("nav"))return;const r=o.href.split("/").pop();addExtraConversationMenuItems(r)})}async function addExtraConversationMenuItems(e){const t=document.body.querySelector('div[role="menu"]');if(!t)return;const o=t.querySelectorAll('div[role="menuitem"]');if(!o)return;const r=await chrome.runtime.sendMessage({type:"checkHasSubscription"}),n=[{text:"Export",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" stroke="currentColor" fill="currentColor" stroke-width="2" stroke-linejoin="round" width="24" height="24" class="h-4 w-4 shrink-0" height="1em" width="1em"><path d="M568.1 303l-80-80c-9.375-9.375-24.56-9.375-33.94 0s-9.375 24.56 0 33.94L494.1 296H216C202.8 296 192 306.8 192 320s10.75 24 24 24h278.1l-39.03 39.03C450.3 387.7 448 393.8 448 400s2.344 12.28 7.031 16.97c9.375 9.375 24.56 9.375 33.94 0l80-80C578.3 327.6 578.3 312.4 568.1 303zM360 384c-13.25 0-24 10.74-24 24V448c0 8.836-7.164 16-16 16H64.02c-8.836 0-16-7.164-16-16L48 64.13c0-8.836 7.164-16 16-16h160L224 128c0 17.67 14.33 32 32 32h79.1v72c0 13.25 10.74 24 23.1 24S384 245.3 384 232V138.6c0-16.98-6.742-33.26-18.75-45.26l-74.63-74.64C278.6 6.742 262.3 0 245.4 0H63.1C28.65 0-.002 28.66 0 64l.0065 384c.002 35.34 28.65 64 64 64H320c35.2 0 64-28.8 64-64v-40C384 394.7 373.3 384 360 384z"/></svg>',dataTestId:"export-conversation-menu-item",click:s=>{openExportModal([s.convId],"selected")}},{text:"Move",icon:'<svg xmlns="http://www.w3.org/2000/svg" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round" width="24" height="24" class="h-4 w-4 shrink-0" stroke-width="2" viewBox="0 0 512 512"><path d="M448 96h-172.1L226.7 50.75C214.7 38.74 198.5 32 181.5 32H64C28.66 32 0 60.66 0 96v320c0 35.34 28.66 64 64 64h384c35.34 0 64-28.66 64-64V160C512 124.7 483.3 96 448 96zM464 416c0 8.824-7.18 16-16 16H64c-8.82 0-16-7.176-16-16V96c0-8.824 7.18-16 16-16h117.5c4.273 0 8.289 1.664 11.31 4.688L256 144h192c8.82 0 16 7.176 16 16V416zM336 264h-56V207.1C279.1 194.7 269.3 184 256 184S232 194.7 232 207.1V264H175.1C162.7 264 152 274.7 152 288c0 13.26 10.73 23.1 23.1 23.1h56v56C232 381.3 242.7 392 256 392c13.26 0 23.1-10.74 23.1-23.1V311.1h56C349.3 311.1 360 301.3 360 288S349.3 264 336 264z"/></svg>',dataTestId:"move-conversation-menu-item",click:s=>{openMoveConvToFolderModal([s.convId])}},{text:`Download images ${r?"":'<span class="text-white rounded-md bg-green-500 px-2 text-sm ms-auto">Pro</span>'}`,icon:'<svg stroke="currentColor" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="24" height="24" class="h-4 w-4 shrink-0"><path fill-rule="evenodd" clip-rule="evenodd" d="M7.70711 10.2929C7.31658 9.90237 6.68342 9.90237 6.29289 10.2929C5.90237 10.6834 5.90237 11.3166 6.29289 11.7071L11.2929 16.7071C11.6834 17.0976 12.3166 17.0976 12.7071 16.7071L17.7071 11.7071C18.0976 11.3166 18.0976 10.6834 17.7071 10.2929C17.3166 9.90237 16.6834 9.90237 16.2929 10.2929L13 13.5858L13 4C13 3.44771 12.5523 3 12 3C11.4477 3 11 3.44771 11 4L11 13.5858L7.70711 10.2929ZM5 19C4.44772 19 4 19.4477 4 20C4 20.5523 4.44772 21 5 21H19C19.5523 21 20 20.5523 20 20C20 19.4477 19.5523 19 19 19L5 19Z" fill="currentColor"></path></svg>',dataTestId:"download-images-menu-item",click:s=>{if(!s.hasSubscription){errorUpgradeConfirmation({title:"This is a Pro feature",message:"Downloading conversation images requires a Pro subscription. Upgrade to Pro to remove all limits."});return}downloadSelectedImages(s.menuButton,[],s.convId,!s.event.shiftKey)}},{text:`Reference this chat ${r?"":'<span class="text-white rounded-md bg-green-500 px-2 text-sm ms-auto">Pro</span>'}`,icon:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md"><path fill-rule="evenodd" clip-rule="evenodd" d="M18.0322 5.02393C17.7488 5.00078 17.3766 5 16.8 5H11.5002C11.3 6 11.0989 6.91141 10.8903 7.85409C10.7588 8.44955 10.6432 8.97304 10.3675 9.41399C10.1262 9.80009 9.80009 10.1262 9.41399 10.3675C8.97304 10.6432 8.44955 10.7588 7.85409 10.8903C7.81276 10.8994 7.77108 10.9086 7.72906 10.9179L5.21693 11.4762C5.1442 11.4924 5.07155 11.5001 5 11.5002V16.8C5 17.3766 5.00078 17.7488 5.02393 18.0322C5.04612 18.3038 5.0838 18.4045 5.109 18.454C5.20487 18.6422 5.35785 18.7951 5.54601 18.891C5.59546 18.9162 5.69617 18.9539 5.96784 18.9761C6.25118 18.9992 6.62345 19 7.2 19H10C10.5523 19 11 19.4477 11 20C11 20.5523 10.5523 21 10 21H7.16144C6.6343 21 6.17954 21 5.80497 20.9694C5.40963 20.9371 5.01641 20.8658 4.63803 20.673C4.07354 20.3854 3.6146 19.9265 3.32698 19.362C3.13419 18.9836 3.06287 18.5904 3.03057 18.195C2.99997 17.8205 2.99998 17.3657 3 16.8385L3 11C3 8.92477 4.02755 6.93324 5.4804 5.4804C6.93324 4.02755 8.92477 3 11 3L16.8385 3C17.3657 2.99998 17.8205 2.99997 18.195 3.03057C18.5904 3.06287 18.9836 3.13419 19.362 3.32698C19.9265 3.6146 20.3854 4.07354 20.673 4.63803C20.8658 5.01641 20.9371 5.40963 20.9694 5.80497C21 6.17954 21 6.6343 21 7.16144V10C21 10.5523 20.5523 11 20 11C19.4477 11 19 10.5523 19 10V7.2C19 6.62345 18.9992 6.25118 18.9761 5.96784C18.9539 5.69617 18.9162 5.59546 18.891 5.54601C18.7951 5.35785 18.6422 5.20487 18.454 5.109C18.4045 5.0838 18.3038 5.04612 18.0322 5.02393ZM5.28014 9.41336L7.2952 8.96556C8.08861 8.78925 8.24308 8.74089 8.35381 8.67166C8.48251 8.59121 8.59121 8.48251 8.67166 8.35381C8.74089 8.24308 8.78925 8.08861 8.96556 7.2952L9.41336 5.28014C8.51014 5.59289 7.63524 6.15398 6.89461 6.89461C6.15398 7.63524 5.59289 8.51014 5.28014 9.41336ZM17 15C17 14.4477 17.4477 14 18 14C18.5523 14 19 14.4477 19 15V17H21C21.5523 17 22 17.4477 22 18C22 18.5523 21.5523 19 21 19H19V21C19 21.5523 18.5523 22 18 22C17.4477 22 17 21.5523 17 21V19H15C14.4477 19 14 18.5523 14 18C14 17.4477 14.4477 17 15 17H17V15Z" fill="currentColor"></path></svg>',dataTestId:"reference-chat-menu-item",click:s=>{if(!s.hasSubscription){errorUpgradeConfirmation({title:"This is a Pro feature",message:"Referencing a conversation in another conversation requires a Pro subscription. Upgrade to Pro to remove all limits."});return}attachConversationToInput(s.convId)}}],i=o[0],a=o[o.length-1];n.forEach(s=>{const l=i.cloneNode(!0);l.setAttribute("data-testid",s.dataTestId),l.classList.add("hover:bg-token-surface-hover"),a.parentElement.insertBefore(l,a),l.innerHTML=`<div class="flex shrink-0 items-center justify-center group-disabled:opacity-50 group-data-disabled:opacity-50 icon">${s.icon}</div>${translate(s.text)}`,l.addEventListener("click",d=>{d.stopPropagation(),d.preventDefault(),s.click({menuButton:l,convId:e,hasSubscription:r,event:d})})})}function addProjectMenuEventListener(){document.body.addEventListener("click",e=>{const t=e.target.closest("button");if(!t)return;const o=t.closest('a[href*="/g/g-p-"]');if(!o||!o.closest("nav"))return;const r=getProjectIdFromUrl(o.href);addExtraProjectMenuItems(r)})}async function createFolderFromProject(e,t){await goToFolder([]);const o={name:e,color:generateRandomDarkColor()},r=await chrome.runtime.sendMessage({type:"addConversationFolders",detail:{folders:[o]}});if(r.error&&r.error.type==="limit"){errorUpgradeConfirmation(r.error);return}if(!r||r.length===0){toast("Failed to create folder from project conversations.","error");return}addNewConvFolderElementToSidebar(r[0]),await moveConvToFolder(t,r[0].id,r[0].name,r[0].color),toast(`Created folder "${e}" and moved ${t.length} conversations to it.`,"success")}async function addExtraProjectMenuItems(e){const t=document.body.querySelector('div[role="menu"]');if(!t)return;const o=t.querySelectorAll('div[role="menuitem"]');if(!o)return;const r=await chrome.runtime.sendMessage({type:"checkHasSubscription"}),n=[{text:"Create folder from project",icon:'<svg xmlns="http://www.w3.org/2000/svg" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round" width="20" height="20" class="icon-sm" stroke-width="2" viewBox="0 0 512 512"><path d="M448 96h-172.1L226.7 50.75C214.7 38.74 198.5 32 181.5 32H64C28.66 32 0 60.66 0 96v320c0 35.34 28.66 64 64 64h384c35.34 0 64-28.66 64-64V160C512 124.7 483.3 96 448 96zM464 416c0 8.824-7.18 16-16 16H64c-8.82 0-16-7.176-16-16V96c0-8.824 7.18-16 16-16h117.5c4.273 0 8.289 1.664 11.31 4.688L256 144h192c8.82 0 16 7.176 16 16V416zM336 264h-56V207.1C279.1 194.7 269.3 184 256 184S232 194.7 232 207.1V264H175.1C162.7 264 152 274.7 152 288c0 13.26 10.73 23.1 23.1 23.1h56v56C232 381.3 242.7 392 256 392c13.26 0 23.1-10.74 23.1-23.1V311.1h56C349.3 311.1 360 301.3 360 288S349.3 264 336 264z"></path></svg>',requirePro:!0,click:async s=>{if(closeRadix(s.event),!r){errorUpgradeConfirmation({title:"This is a Pro feature",message:"Creating a folder from your project conversations requires a Pro subscription. Upgrade to Pro to remove all limits."});return}if(!s.projectId)return;const l=await getProjectConversations(s.projectId);if(!l||l.length===0){toast("No conversations found in this project.","error");return}await chrome.runtime.sendMessage({type:"addConversations",detail:{conversations:l}});const d=l.map(u=>u.id),c=getProjectName(s.projectId);createFolderFromProject(c,d)}},{text:"Export Conversations",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" stroke="currentColor" fill="currentColor" stroke-width="2" stroke-linejoin="round" width="20" height="20" class="icon-sm"><path d="M568.1 303l-80-80c-9.375-9.375-24.56-9.375-33.94 0s-9.375 24.56 0 33.94L494.1 296H216C202.8 296 192 306.8 192 320s10.75 24 24 24h278.1l-39.03 39.03C450.3 387.7 448 393.8 448 400s2.344 12.28 7.031 16.97c9.375 9.375 24.56 9.375 33.94 0l80-80C578.3 327.6 578.3 312.4 568.1 303zM360 384c-13.25 0-24 10.74-24 24V448c0 8.836-7.164 16-16 16H64.02c-8.836 0-16-7.164-16-16L48 64.13c0-8.836 7.164-16 16-16h160L224 128c0 17.67 14.33 32 32 32h79.1v72c0 13.25 10.74 24 23.1 24S384 245.3 384 232V138.6c0-16.98-6.742-33.26-18.75-45.26l-74.63-74.64C278.6 6.742 262.3 0 245.4 0H63.1C28.65 0-.002 28.66 0 64l.0065 384c.002 35.34 28.65 64 64 64H320c35.2 0 64-28.8 64-64v-40C384 394.7 373.3 384 360 384z"/></svg>',requirePro:!0,click:async s=>{if(closeRadix(s.event),!r){errorUpgradeConfirmation({title:"This is a Pro feature",message:"Exporting project conversations requires a Pro subscription. Upgrade to Pro to remove all limits."});return}if(!s.projectId)return;const l=await getProjectConversations(s.projectId);if(!l||l.length===0){toast("No conversations found in this project.","error");return}await chrome.runtime.sendMessage({type:"addConversations",detail:{conversations:l}});const d=l.map(u=>u.id),c=getProjectName(s.projectId);openExportModal(d,"project",c)}}],i=o[0],a=o[o.length-1];n.forEach(s=>{const l=i.cloneNode(!0);l.classList.add("hover:bg-token-surface-hover"),l.removeAttribute("data-color"),a.parentElement.insertBefore(l,a),l.innerHTML=`<div class="flex min-w-0 grow items-center gap-2.5">${s.icon}${translate(s.text)}${!s.requirePro||r?"":'<span class="text-white rounded-md bg-green-500 px-2 text-sm ml-auto">Pro</span>'}</div>`,l.addEventListener("click",d=>{d.stopPropagation(),d.preventDefault(),s.click({menuButton:l,projectId:e,hasSubscription:r,event:d})})})}function initializeInput(){setTimeout(()=>{addInputCounter(),initializeHistory(),addPromptChainCounterElement()},100)}function initializeHistory(){const e=document.querySelector("#prompt-textarea");if(!e)return;const t=document.querySelector('form [class*="absolute space-y-2 z-20"]');t&&t.classList.add("invisible","select-none","hidden"),chrome.storage.local.get(["userInputValueHistory"],o=>{chrome.storage.local.set({userInputValueHistoryIndex:o.userInputValueHistory?.length||0,unsavedUserInput:"",textInputValue:e?.innerText?.trim()||""})})}async function addSubmitButtonEventListener(){document.body.addEventListener("click",async e=>{const t=getSubmitButton();if(!t||!isDescendant(t,e.target)||t.disabled)return;const o=document.querySelector("#prompt-rewrite-button");o&&(o.disabled=!0);const r=document.querySelector("#prompt-textarea");if(cachedSettings.autoSplit&&cachedSettings.autoSplitLimit&&r?.innerText?.length>cachedSettings.autoSplitLimit){e.preventDefault(),e.stopPropagation();const n=await generateSplitterChain(r.innerText);runPromptChain({steps:n,mode:"splitter"},0,!1,!0)}else r.innerHTML=convertToParagraphs(r)},{capture:!0})}function addStopButtonEventListener(){document.body.addEventListener("click",e=>{const t=document.querySelector('[data-testid*="stop-button"]');if(!t||!isDescendant(t,e.target))return;const o=new CustomEvent("stopConversationReceived",{});window.dispatchEvent(o)})}function addInputCounter(){const e=document.querySelector("#gptx-input-counter");e&&e.remove();const t=document.createElement("span");t.id="gptx-input-counter",t.classList="text-token-text-tertiary select-none absolute text-xs z-100",t.style="bottom: -20px; right: 20px;",t.innerText=`0 ${translate("chars")} \u2022 0 ${translate("words")}`;const o=document.querySelector("main form");o&&(o.classList.add("relative"),o.appendChild(t))}const debounceAddMemoryToggleButtonsToInput=debounce(async()=>{await addMemoryToggleButtonsToInput()},300);async function addMemoryToggleButtonsToInput(){if(document.querySelector("#memory-toggles-wrapper"))return;const e=document.querySelector("main form");if(!e)return;const t=e.querySelector('div[data-testid="composer-footer-actions"]');if(!t)return;t.classList.add("flex");const o=document.createElement("div");o.id="memory-toggles-wrapper",o.classList="ms-2 z-10 flex items-center gap-2 text-xs text-token-text-tertiary rounded-md p-1",t.appendChild(o),new MutationObserver(()=>{o&&t.lastChild!==o&&t.appendChild(o)}).observe(t,{childList:!0,subtree:!0});const{openAIUserSettings:r}=await chrome.storage.local.get(["openAIUserSettings"]),n=createSwitch("Memory","","",r?.settings?.sunshine,toggleMemorySwitch,[],!1,!1,!0);addTooltip(n,{value:"Let ChatGPT save and use memories when responding.",position:"top"}),o.appendChild(n);const i=createSwitch("Reference Chats","","",r?.settings?.moonshine,toggleChatReferenceSwitch,[],!1,!1,!0);if(addTooltip(i,{value:"Let ChatGPT reference all previous conversations when responding.",position:"top"}),o.appendChild(i),!r?.settings?.sunshine){const a=document.querySelector("#sp-switch-wrapper-reference-chats");a&&(a.style.opacity=0)}}async function toggleMemorySwitch(e,t){const o=document.querySelector("#sp-switch-wrapper-reference-chats");if(o&&(o.style.opacity=e?1:0),t.isTrusted&&(await updateAccountUserSetting("sunshine",e),!e)){const r=document.querySelector('main form input[id="switch-reference-chats"]');r&&(r.checked=!1,r.dispatchEvent(new Event("change",{bubbles:!0}))),await updateAccountUserSetting("moonshine",!1)}}async function toggleChatReferenceSwitch(e,t){if(t.isTrusted){if(e){const o=document.querySelector('main form input[id="switch-memory"]');o&&(o.checked=!0,o.dispatchEvent(new Event("change",{bubbles:!0}))),await updateAccountUserSetting("sunshine",!0)}await updateAccountUserSetting("moonshine",e)}}function setTextAreaElementValue(e){const t=document.querySelector("#prompt-textarea");t&&(t.innerText=e,t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0})),setSelectionAtEnd(t),updateInputCounter())}function updateInputCounter(){const e=document.querySelector("#prompt-textarea");if(!e)return;const t=e.innerText,o=document.querySelector("#gptx-input-counter");if(o){const r=getWordCount(t),n=getCharCount(t);o.innerText=`${Math.max(n,0)} ${translate("chars")} \u2022 ${Math.max(r,0)} ${translate("words")}`}}async function addPromptInputKeyDownEventListeners(e){const t=document.querySelector("#prompt-textarea");if(t)if(t.style.height="auto",document.activeElement.id==="prompt-textarea"){if(cachedSettings.submitPromptOnEnter||typeof cachedSettings.submitPromptOnEnter>"u"){if(e.key==="Enter"&&e.which===13&&!e.shiftKey){const o=document.querySelector("#quick-access-menu-wrapper");if(o&&o.style.display!=="none"){const r=o.querySelector('button[id^=quick-access-menu-item-]:not([style*="display: none"])');r&&r.click()}else{const r=document.querySelector("#prompt-rewrite-button");if(r&&(r.disabled=!0),cachedSettings.autoSplit&&cachedSettings.autoSplitLimit&&t?.innerText?.length>cachedSettings.autoSplitLimit){e.preventDefault(),e.stopPropagation();const n=await generateSplitterChain(t.innerText);runPromptChain({steps:n,mode:"splitter"},0,!1,!0)}else t.innerHTML=convertToParagraphs(t)}return}}else{if(e.key==="Enter"&&!(e.metaKey||isWindows()&&e.ctrlKey)&&e.which===13&&!e.shiftKey){e.preventDefault(),e.stopPropagation();const o=document.querySelector("#quick-access-menu-wrapper");if(o&&o.style.display!=="none"){const r=o.querySelector('button[id^=quick-access-menu-item-]:not([style*="display: none"])');r&&r.click()}else{const r=new KeyboardEvent("keydown",{key:"Enter",code:"Enter",keyCode:13,which:13,shiftKey:!0});t.dispatchEvent(r)}return}if(e.key==="Enter"&&(e.metaKey||isWindows()&&e.ctrlKey)&&e.which===13&&!e.shiftKey){if(e.preventDefault(),e.stopPropagation(),cachedSettings.autoSplit&&cachedSettings.autoSplitLimit&&t?.innerText?.length>cachedSettings.autoSplitLimit){const o=await generateSplitterChain(t.innerText);runPromptChain({steps:o,mode:"splitter"},0,!1,!0)}else{const o=document.querySelector("#prompt-rewrite-button");o&&(o.disabled=!0),t.innerHTML=convertToParagraphs(t);const r=getSubmitButton();r&&(r.click(),setTimeout(()=>{t.innerHTML=""},100))}return}}if(e.keyCode===32){const o=document.querySelector("#quick-access-menu-wrapper");if(o&&o.remove(),!t.innerText?.trim())return;const r=getSelectionPosition();if(!r?.parentElement)return;const n=r.parentElement.innerText.substring(0,r.start).split(" ").pop();n?.startsWith("/")&&n.length>1&&chrome.runtime.sendMessage({type:"getPromptByTitle",detail:{title:n.substring(1).toLowerCase()}},i=>{if(i&&i?.steps?.length>0){const a=previousCharPosition(r.parentElement,"/",r.start);r.start!==-1&&a!==-1&&!getStringBetween(r.parentElement,a,r.start).includes(" ")&&insertTextAtPosition(r.parentElement,i.steps[0],a,r.end)}});return}if(e.key==="Backspace"){const o=getSelectionPosition();if(!o?.parentElement)return;const r=-1,n=previousCharPosition(o.parentElement,"/",o.start),i=previousCharPosition(o.parentElement," ",o.start-1),a=Math.max(r,n),s=getCharAtPosition(o.parentElement,a),l=getCharAtPosition(o.parentElement,a-1),d=!l||l===" "||l===`
`||l==="."||l==="?"||l==="!"||a===-1;if(a>-1&&d&&a>-1&&o.start-1>a&&i<a)document.querySelector("#quick-access-menu-wrapper")||quickAccessMenu(s);else{const c=document.querySelector("#quick-access-menu-wrapper");c&&c.remove()}}if(e.key==="ArrowUp"&&!e.shiftKey){const o=document.querySelector("#quick-access-menu-wrapper");if(o&&o.style.display!=="none"){e.preventDefault();return}if(getSelectionOffsetRelativeToParent(t).start!==0)return;chrome.storage.local.get(["userInputValueHistoryIndex","userInputValueHistory"],r=>{if(cachedSettings&&!cachedSettings.promptHistoryUpDownKey)return;const n=r.userInputValueHistory||[];if(n.length===0)return;let i=r.userInputValueHistoryIndex||0;i=Math.max(i-1,0);const a=n[i];chrome.storage.local.set({userInputValueHistoryIndex:i},()=>{a&&setTextAreaElementValue(a.inputValue.replace(/\n{3,}/g,`

`))})});return}if(e.key==="ArrowDown"&&!e.shiftKey){const o=document.querySelector("#quick-access-menu-wrapper");if(o&&o.style.display!=="none"){e.preventDefault();return}if(getSelectionOffsetRelativeToParent(t).start!==t.innerText.length)return;chrome.storage.local.get(["userInputValueHistoryIndex","userInputValueHistory","unsavedUserInput"],r=>{if(cachedSettings&&!cachedSettings.promptHistoryUpDownKey)return;let n=r.userInputValueHistoryIndex||0;const i=r.userInputValueHistory||[];i.length!==0&&(n=Math.min(n+1,i.length),chrome.storage.local.set({userInputValueHistoryIndex:n},()=>{const a=i[n];if(a)setTextAreaElementValue(a.inputValue.replace(/\n{3,}/g,`

`));else if(i[i.length-1].inputValue!==""){const s=r.unsavedUserInput||"";t.innerText!==s&&setTextAreaElementValue(s.replace(/\n{3,}/g,`

`))}updateInputCounter()}))})}!e.shiftKey&&!e.altKey&&!e.ctrlKey&&!e.metaKey&&e.key!=="/"&&e.key!=="@"&&debounceUpdateQuickAccessMenuItems()}else{const o=document.querySelector("#quick-access-menu-wrapper");o&&o.style.display!=="none"&&(cachedSettings.submitPromptOnEnter||typeof cachedSettings.submitPromptOnEnter>"u"?e.key==="Enter"&&e.which===13&&!e.shiftKey&&(e.preventDefault(),e.stopPropagation(),document.activeElement.id.startsWith("quick-access-menu-item-")&&document.activeElement.click()):e.key==="Enter"&&(e.metaKey||isWindows()&&e.ctrlKey)&&e.which===13&&!e.shiftKey&&(e.preventDefault(),e.stopPropagation(),document.activeElement.id.startsWith("quick-access-menu-item-")&&document.activeElement.click()))}}function addPromptInputKeyUpEventListeners(e){const t=document.querySelector("#prompt-textarea");if(t&&(t.style.height="auto",document.activeElement.id==="prompt-textarea")){const o=t.innerText;updateInputCounter(),chrome.storage.local.set({textInputValue:o},()=>{chrome.storage.local.get(["userInputValueHistory"],r=>{(r.userInputValueHistory||[]).findIndex(n=>n.inputValue===o)===-1&&chrome.storage.local.set({unsavedUserInput:o})})})}}function addPromptInputBlurEventListener(){document.body.addEventListener("blur",e=>{e.target.id!=="prompt-textarea"||!document.querySelector("#prompt-textarea")||getSelectionPosition()},!0)}function addPromptInputPasteEventListener(){document.body.addEventListener("paste",()=>{if(document.activeElement.id!=="prompt-textarea")return;const e=document.querySelector("#prompt-textarea");if(!e)return;const t=getSelectionPosition();if(!t?.parentElement)return;const o=getCharAtPosition(t.parentElement,t.start+1);o&&o!==`
`||(e.parentElement.scrollTop=e.parentElement.scrollHeight)})}function addUserPromptToHistory(e){e&&(e=e.replace(/^## Instructions[\s\S]*?## End Instructions\n\n/m,""),chrome.storage.local.get(["userInputValueHistory","selectedModel"],t=>{const o=t.userInputValueHistory||[],r=o.findIndex(i=>i.inputValue.trim()===e.trim());r!==-1&&o.splice(r,1),o.push({id:self.crypto.randomUUID(),timestamp:Date.now(),inputValue:e.trim()});let n=o;if(o.length>200){const i=o.sort((s,l)=>s.timestamp-l.timestamp),a=i.length-200;i.splice(0,a),n=o.filter(s=>i.includes(s))}chrome.storage.local.set({userInputValueHistory:n},()=>{chrome.storage.local.set({userInputValueHistoryIndex:o.length})})}))}function convertToParagraphs(e){const{innerHTML:t,innerText:o}=e;if(!o)return t;let r=t.replace(/<br\s*\/?>/g,"</p><p>");return r=r.replace(/<br class="ProseMirror-trailingBreak">/g,""),r.startsWith("<p>")||(r=`<p>${r}`),r.endsWith("</p>")||(r+="</p>"),r}let cachedSelectionPosition=null;function getSelectionPosition(){const e=window.getSelection();if(!e.rangeCount)return cachedSelectionPosition;const t=e.getRangeAt(0);let o=t.startContainer;if(o.nodeType===Node.TEXT_NODE&&(o=o.parentElement),o&&o.tagName==="P"){let r=0,n=!1;o.childNodes.forEach(a=>{a===t.startContainer?(n=!0,a.nodeType===Node.TEXT_NODE?r+=t.startOffset:a.nodeName==="BR"&&(r+=1)):n||(a.nodeType===Node.TEXT_NODE?r+=a.textContent.length:a.nodeName==="BR"&&(r+=1))});const i=r+t.toString().length;return cachedSelectionPosition={start:r,end:i,parentElement:o},cachedSelectionPosition}return cachedSelectionPosition}function insertTextAtPosition(e,t,o,r){if(!e||typeof o!="number"||typeof r!="number"){console.error("Invalid parameters");return}const n=e.innerText,i=n.slice(0,o),a=n.slice(r);e.innerText=i+t+a;const s=document.createRange(),l=window.getSelection(),{lastChild:d}=e;d&&d.nodeType===Node.TEXT_NODE?s.setStart(d,d.length):d?s.setStart(d,d.childNodes.length):s.setStart(e,e.childNodes.length),s.collapse(!0),l.removeAllRanges(),l.addRange(s)}function getSelectionOffsetRelativeToParent(e){const t=window.getSelection();if(t.rangeCount===0)return{start:null,end:null};const o=t.getRangeAt(0);let r=o.commonAncestorContainer;for(;r&&r!==e;)r=r.parentNode;if(!r)return{start:null,end:null};const n=getOffsetWithBreaksAndTabs(o.startContainer,o.startOffset,e),i=getOffsetWithBreaksAndTabs(o.endContainer,o.endOffset,e),a=o.startContainer;return{start:n,end:i,node:a}}function getOffsetWithBreaksAndTabs(e,t,o){let r=0;for(;e&&e!==o;)e.previousSibling?(e=e.previousSibling,r+=countNodeLengthWithBreaksAndTabs(e)):e=e.parentNode;return r+t}function countNodeLengthWithBreaksAndTabs(e){if(e.nodeType===Node.TEXT_NODE)return e.textContent.replace(/\t/g," ").replace(/\n/g," ").length;if(e.nodeName==="BR")return 1;if(["P","DIV","BLOCKQUOTE"].includes(e.nodeName)){let t=0;return e.childNodes.forEach(o=>{t+=countNodeLengthWithBreaksAndTabs(o)}),t+1}if(e.childNodes){let t=0;return e.childNodes.forEach(o=>{t+=countNodeLengthWithBreaksAndTabs(o)}),t}return 0}function setSelectionAtEnd(e){if(!e||!e.hasChildNodes())return;const t=window.getSelection();t.removeAllRanges();const o=document.createRange();let{lastChild:r}=e;for(;r&&r.nodeType===Node.ELEMENT_NODE&&r.hasChildNodes();)r=r.lastChild;r.nodeType===Node.TEXT_NODE?(o.setStart(r,r.length),o.setEnd(r,r.length)):(o.setStart(r,0),o.setEnd(r,0)),t.addRange(o)}function setSelectionAtPosition(e,t){if(!e||!e.hasChildNodes())return;let o=0,r=!1;const n=window.getSelection();n.removeAllRanges();const i=document.createRange();function a(s){if(!r)if(s.nodeType===Node.TEXT_NODE){const l=s.textContent.length;if(o+l>=t){const d=t-o;i.setStart(s,d),i.setEnd(s,d),r=!0;return}o+=l}else s.nodeName==="BR"?(o+=1,o>=t&&(r=!0,i.setStartAfter(s),i.setEndAfter(s))):["P","DIV","BLOCKQUOTE"].includes(s.nodeName)?(s.childNodes.forEach(a),o+=1,o>=t&&!r&&(i.setStartAfter(s),i.setEndAfter(s),r=!0)):s.childNodes&&s.childNodes.forEach(a)}a(e),r?n.addRange(i):console.error("Position exceeds the content length.")}function previousCharPosition(e,t="/",o=0){if(!e||!e.hasChildNodes())return-1;let r=0,n=-1;function i(a){if(a.nodeType===Node.TEXT_NODE){const s=a.textContent;if(r+s.length>=o){const l=s.substring(0,o-r).lastIndexOf(t);l!==-1&&(n=r+l)}r+=s.length}else a.nodeName==="BR"?r+=1:a.nodeName==="P"||a.nodeName==="DIV"||a.nodeName==="BLOCKQUOTE"?(a.childNodes.forEach(i),r+=1):a.childNodes.forEach(i)}return i(e),n}function nextCharPosition(e,t=" ",o=0){if(!e||!e.hasChildNodes())return-1;let r=0,n=-1;function i(a){if(n===-1)if(a.nodeType===Node.TEXT_NODE){const s=a.textContent,l=s.length;if(r+l>o){const d=Math.max(0,o-r),c=s.indexOf(t,d);if(c!==-1){n=r+c;return}}r+=l}else if(a.nodeName==="BR"){if(r>=o&&t===`
`){n=r;return}r+=1}else["P","DIV","BLOCKQUOTE"].includes(a.nodeName)?(a.childNodes.forEach(i),r>=o&&t===`
`&&n===-1&&(n=r),r+=1):a.childNodes&&a.childNodes.forEach(i)}return i(e),n}function getCharAtPosition(e,t){if(!e||!e.hasChildNodes())return null;let o=0,r=null;function n(i){if(r===null)if(i.nodeType===Node.TEXT_NODE){const a=i.textContent,s=a.length;if(o+s>t){const l=t-o;r=a[l];return}o+=s}else if(i.nodeName==="BR"){if(o===t){r=`
`;return}o+=1}else if(["P","DIV","BLOCKQUOTE"].includes(i.nodeName)){if(i.childNodes.forEach(n),o===t&&r===null){r=`
`;return}o+=1}else i.childNodes&&i.childNodes.forEach(n)}return n(e),r}function getStringBetween(e,t,o){if(!e||!e.hasChildNodes())return"";let r=0,n="",i=!1;function a(s){if(!(r>=o))if(s.nodeType===Node.TEXT_NODE){const l=s.textContent,d=l.length;if(r+d>t&&r<o){const c=Math.max(0,t-r),u=Math.min(d,o-r);n+=l.substring(c,u),i=!0}r+=d}else s.nodeName==="BR"?(r>=t&&r<o&&(n+=`
`,i=!0),r+=1):["P","DIV","BLOCKQUOTE"].includes(s.nodeName)?(s.childNodes.forEach(a),r>=t&&r<o&&(n+=`
`,i=!0),r+=1):s.childNodes&&s.childNodes.forEach(a)}return a(e),n}function canAttacheFile(e){return document.querySelector("#prompt-textarea")?document.querySelector('main form input[type="file"]')?document.querySelector("main form").querySelectorAll('div[class*="fit"] div[class*="group relative inline-block"]').length>=10?(toast("You can only attach up to 10 files","error"),!1):getPlusButton()?.disabled?(toast("Attachments disabled for this model","error"),!1):!0:(toast("Attachments disabled for this model","error"),!1):(toast("Start a new conversation or go to an existing conversation","error"),!1)}function getMoreActionsButton(e=null){return(e||document).querySelector('div[id^="message-actions-"] button svg > use[href*="f6d0e2"]')?.closest("button")}function getThreadLeftButton(e=null){const t=e||document;return t.querySelector('svg > path[d="M14.7071 5.29289C15.0976 5.68342 15.0976 6.31658 14.7071 6.70711L9.41421 12L14.7071 17.2929C15.0976 17.6834 15.0976 18.3166 14.7071 18.7071C14.3166 19.0976 13.6834 19.0976 13.2929 18.7071L7.29289 12.7071C7.10536 12.5196 7 12.2652 7 12C7 11.7348 7.10536 11.4804 7.29289 11.2929L13.2929 5.29289C13.6834 4.90237 14.3166 4.90237 14.7071 5.29289Z"]')||t.querySelector('svg > use[href*="8ee2e9"]')}function getThreadRightButton(e=null){const t=e||document;return t.querySelector('svg > path[d="M9.29289 18.7071C8.90237 18.3166 8.90237 17.6834 9.29289 17.2929L14.5858 12L9.29289 6.70711C8.90237 6.31658 8.90237 5.68342 9.29289 5.29289C9.68342 4.90237 10.3166 4.90237 10.7071 5.29289L16.7071 11.2929C16.8946 11.4804 17 11.7348 17 12C17 12.2652 16.8946 12.5196 16.7071 12.7071L10.7071 18.7071C10.3166 19.0976 9.68342 19.0976 9.29289 18.7071Z"]')||t.querySelector('svg > use[href*="b140e7"]')}function getPlusButton(){return document.querySelector('main form button svg > path[d="M12 3C12.5523 3 13 3.44772 13 4L13 11H20C20.5523 11 21 11.4477 21 12C21 12.5523 20.5523 13 20 13L13 13L13 20C13 20.5523 12.5523 21 12 21C11.4477 21 11 20.5523 11 20L11 13L4 13C3.44772 13 3 12.5523 3 12C3 11.4477 3.44772 11 4 11L11 11L11 4C11 3.44772 11.4477 3 12 3Z"]')?.closest("button")||document.querySelector('main form button svg > use[href*="6be74c"]')?.closest("button")}function getSubmitButton(){return document.querySelector('main form button[id="composer-submit-button"][data-testid*="send-button"]')||document.querySelector('main form button svg > path[d="M8.99992 16V6.41407L5.70696 9.70704C5.31643 10.0976 4.68342 10.0976 4.29289 9.70704C3.90237 9.31652 3.90237 8.6835 4.29289 8.29298L9.29289 3.29298L9.36907 3.22462C9.76184 2.90427 10.3408 2.92686 10.707 3.29298L15.707 8.29298L15.7753 8.36915C16.0957 8.76192 16.0731 9.34092 15.707 9.70704C15.3408 10.0732 14.7618 10.0958 14.3691 9.7754L14.2929 9.70704L10.9999 6.41407V16C10.9999 16.5523 10.5522 17 9.99992 17C9.44764 17 8.99992 16.5523 8.99992 16Z"]')?.closest("button")||document.querySelector('main form button svg > use[href*="01bab7"]')?.closest("button")}function getDictateButton(){return document.querySelector('main form button svg > path[d="M15.7806 10.1963C16.1326 10.3011 16.3336 10.6714 16.2288 11.0234L16.1487 11.2725C15.3429 13.6262 13.2236 15.3697 10.6644 15.6299L10.6653 16.835H12.0833L12.2171 16.8486C12.5202 16.9106 12.7484 17.1786 12.7484 17.5C12.7484 17.8214 12.5202 18.0894 12.2171 18.1514L12.0833 18.165H7.91632C7.5492 18.1649 7.25128 17.8672 7.25128 17.5C7.25128 17.1328 7.5492 16.8351 7.91632 16.835H9.33527L9.33429 15.6299C6.775 15.3697 4.6558 13.6262 3.84992 11.2725L3.76984 11.0234L3.74445 10.8906C3.71751 10.5825 3.91011 10.2879 4.21808 10.1963C4.52615 10.1047 4.84769 10.2466 4.99347 10.5195L5.04523 10.6436L5.10871 10.8418C5.8047 12.8745 7.73211 14.335 9.99933 14.335C12.3396 14.3349 14.3179 12.7789 14.9534 10.6436L15.0052 10.5195C15.151 10.2466 15.4725 10.1046 15.7806 10.1963ZM12.2513 5.41699C12.2513 4.17354 11.2437 3.16521 10.0003 3.16504C8.75675 3.16504 7.74835 4.17343 7.74835 5.41699V9.16699C7.74853 10.4104 8.75685 11.418 10.0003 11.418C11.2436 11.4178 12.2511 10.4103 12.2513 9.16699V5.41699ZM13.5814 9.16699C13.5812 11.1448 11.9781 12.7479 10.0003 12.748C8.02232 12.748 6.41845 11.1449 6.41828 9.16699V5.41699C6.41828 3.43889 8.02221 1.83496 10.0003 1.83496C11.9783 1.83514 13.5814 3.439 13.5814 5.41699V9.16699Z')?.closest("button")||document.querySelector('main form button svg > use[href*="29f921"]')?.closest("button")}function getSpeechButton(){return document.querySelector('main form div[data-testid="composer-speech-button-container"]')||document.querySelector('main form button svg > path[d="M7.91667 3.33331C8.60702 3.33331 9.16667 3.89296 9.16667 4.58331V15.4166C9.16667 16.107 8.60702 16.6666 7.91667 16.6666C7.22631 16.6666 6.66667 16.107 6.66667 15.4166V4.58331C6.66667 3.89296 7.22631 3.33331 7.91667 3.33331ZM12.0833 5.83331C12.7737 5.83331 13.3333 6.39296 13.3333 7.08331V12.9166C13.3333 13.607 12.7737 14.1666 12.0833 14.1666C11.393 14.1666 10.8333 13.607 10.8333 12.9166V7.08331C10.8333 6.39296 11.393 5.83331 12.0833 5.83331ZM3.75 7.49998C4.44036 7.49998 5 8.05962 5 8.74998V11.25C5 11.9403 4.44036 12.5 3.75 12.5C3.05964 12.5 2.5 11.9403 2.5 11.25V8.74998C2.5 8.05962 3.05964 7.49998 3.75 7.49998ZM16.25 7.49998C16.9404 7.49998 17.5 8.05962 17.5 8.74998V11.25C17.5 11.9403 16.9404 12.5 16.25 12.5C15.5596 12.5 15 11.9403 15 11.25V8.74998C15 8.05962 15.5596 7.49998 16.25 7.49998Z"]')?.closest("button")||document.querySelector('main form button svg > use[href*="f8aa74"]')?.closest("button")||document.querySelector('main form button svg > use[href*="ac37b7"]')?.closest("button")}function canSubmit(){const e=getSubmitButton(),t=getSpeechButton();return!!(e||t&&!t.disabled)}async function attachImagesToInput(e){const t=document.querySelector('main form input[type="file"]'),o=new DataTransfer;for(const r of e){const n=await downloadFileFromUrl(r.imageUrl,r.imageId,!0),i=new File([n],`${r.imageId}.png`,{type:"image/png"});o.items.add(i)}t.files=o.files,t.dispatchEvent(new Event("change",{bubbles:!0}))}function attachImageBlobToInput(e,t="screenshot.png"){if(!canAttacheFile(t))return;const o=document.querySelector('main form input[type="file"]'),r=new File([e],t.toLowerCase(),{type:"image/png"}),n=new DataTransfer;n.items.add(r),o.files=n.files,o.dispatchEvent(new Event("change",{bubbles:!0}))}async function attachConversationToInput(e){const t=await getConversation(e),o=`${t.title.replace(/[^a-zA-Z0-9]/g,"_")}.txt`;if(!canAttacheFile(o))return;let r=t.current_node;const n=[];for(;r;){const{message:a,parent:s}=t.mapping[r];a&&n.push(a),r=s}const i=n.reverse().filter(a=>{const s=a?.author?.role,l=a?.content?.parts?.join(""),d=a?.content?.content_type;return l&&d!=="user_editable_context"&&(s==="user"||s==="assistant")}).map(a=>`>> ${a.author?.role.toUpperCase()}: ${replaceCitations((a.content?.parts||[])?.filter(s=>typeof s=="string")?.join(`
`).replace(/^## Instructions[\s\S]*?## End Instructions\n\n/m,""),a.metadata.citations,"text")}`)?.join(`

`);uploadTextToInput(i,o)}function uploadTextToInput(e,t="conversation.txt"){if(!canAttacheFile(t))return;const o=document.querySelector('main form input[type="file"]'),r=new Blob([e],{type:"text/plain"}),n=new File([r],t.toLowerCase(),{type:"text/plain"}),i=new DataTransfer;i.items.add(n),o.files=i.files,o.dispatchEvent(new Event("change",{bubbles:!0}))}async function checkProStatus(){const e=await chrome.runtime.sendMessage({type:"checkHasSubscription"});return e||errorUpgradeConfirmation({type:"Pro",title:"This is a Pro feature",message:"Sending text and screenshots to ChatGPT using the right click menu requires a Pro subscription. Upgrade to Pro to remove all limits."}),e}function addRighClickInsertEventListener(){chrome.runtime.onMessage.addListener(async(e,t,o)=>{if(e.action==="insertPrompt"){if(!await checkProStatus())return;const{pathname:r}=new URL(window.location.toString());e.newChat&&r!=="/"&&startNewChat(),setTimeout(()=>{if(!document.querySelector("#prompt-textarea"))return;const n=e.prompt;n.steps[0]=`${e.selectionText} 

${n.steps[0]}`,runPromptChain(n)},500)}else if(e.action==="insertScreenshot"){if(!await checkProStatus())return;const r=dataURItoBlob(e.screenshot);attachImageBlobToInput(r)}else if(e.action==="insertImage"){if(!await checkProStatus())return;const r=e.imageUrl.split("/").pop(),n=await downloadFileFromUrl(e.imageUrl,r,!0);attachImageBlobToInput(n)}})}const debounceAddPromptRewriteButtonToPromptInput=debounce(async()=>{await addPromptRewriteButtonToPromptInput()},300);async function addPromptRewriteButtonToPromptInput(){if(document.querySelector("form #prompt-rewrite-button"))return;const e=document.querySelector("main form");if(!e)return;const t=getSubmitButton(),o=getDictateButton();if(!t&&!o)return;const r=e.querySelector("#prompt-textarea");if(!r)return;["input","change","paste","cut","keydown","keyup"].forEach(a=>{r.addEventListener(a,()=>{const s=document.querySelector("form #prompt-rewrite-button");s&&(s.disabled=r.innerText.trim().length===0)})});const n=t?.closest("span")?.closest("div")||o?.closest("span")?.closest("div"),i=document.createElement("button");i.id="prompt-rewrite-button",i.classList="composer-btn",i.type="button",i.disabled=r.innerText.trim().length===0,i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="icon" fill="currentColor" width="20" height="20" viewBox="0 0 512 512"><path d="M327.5 85.19L384 64L405.2 7.491C406.9 2.985 411.2 0 416 0C420.8 0 425.1 2.985 426.8 7.491L448 64L504.5 85.19C509 86.88 512 91.19 512 96C512 100.8 509 105.1 504.5 106.8L448 128L426.8 184.5C425.1 189 420.8 192 416 192C411.2 192 406.9 189 405.2 184.5L384 128L327.5 106.8C322.1 105.1 320 100.8 320 96C320 91.19 322.1 86.88 327.5 85.19V85.19zM176 73.29C178.6 67.63 184.3 64 190.6 64C196.8 64 202.5 67.63 205.1 73.29L257.8 187.3L371.8 240C377.5 242.6 381.1 248.3 381.1 254.6C381.1 260.8 377.5 266.5 371.8 269.1L257.8 321.8L205.1 435.8C202.5 441.5 196.8 445.1 190.6 445.1C184.3 445.1 178.6 441.5 176 435.8L123.3 321.8L9.292 269.1C3.627 266.5 0 260.8 0 254.6C0 248.3 3.627 242.6 9.292 240L123.3 187.3L176 73.29zM166.9 207.5C162.1 217.8 153.8 226.1 143.5 230.9L92.32 254.6L143.5 278.2C153.8 282.1 162.1 291.3 166.9 301.6L190.6 352.8L214.2 301.6C218.1 291.3 227.3 282.1 237.6 278.2L288.8 254.6L237.6 230.9C227.3 226.1 218.1 217.8 214.2 207.5L190.6 156.3L166.9 207.5zM405.2 327.5C406.9 322.1 411.2 320 416 320C420.8 320 425.1 322.1 426.8 327.5L448 384L504.5 405.2C509 406.9 512 411.2 512 416C512 420.8 509 425.1 504.5 426.8L448 448L426.8 504.5C425.1 509 420.8 512 416 512C411.2 512 406.9 509 405.2 504.5L384 448L327.5 426.8C322.1 425.1 320 420.8 320 416C320 411.2 322.1 406.9 327.5 405.2L384 384L405.2 327.5z"/></svg>',addTooltip(i,{value:"Optimize Prompt",position:"bottom"}),i.addEventListener("click",async a=>{a.preventDefault(),a.stopPropagation();const s=document.querySelector("#prompt-textarea");s&&showRewritePromptSettings(i,s)}),n.insertBefore(i,n.firstChild)}function showRewritePromptSettings(e,t){const{right:o,top:r}=e.getBoundingClientRect(),n=o-200,i=r-230,a=document.querySelector("#prompt-rewrite-menu");if(a){a.remove();return}const{rewriteTone:s,rewriteLength:l,selectedRewriteContext:d}=cachedSettings,c=`<div id="prompt-rewrite-menu" dir="ltr" style="transform:translate3d(${n}px,${i}px,0);position:fixed;left:0;top:0;width:200px;min-height:200px;max-height:200px;z-index:10001;"><div class="w-full h-full rounded-2xl text-token-text-primary popover bg-token-main-surface-primary dark:bg-[#353535] shadow-long p-3" tabindex="-1" style="outline:0;">
  
  <div class="text-sm mb-1 text-token-text-tertiary">Instruction</div>
  <div id="open-rewrite-prompt-context-button" class="w-full flex items-center justify-between mb-3 p-2 border border-token-border-medium rounded-lg cursor-pointer hover:bg-token-main-surface-secondary">
    <div class>${capitalize(d)}</div>
    <div role="menuitem" class="flex rounded-xl p-1.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-secondary group" tabindex="-1">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-sm"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.2929 4.29291C15.0641 2.52167 17.9359 2.52167 19.7071 4.2929C21.4783 6.06414 21.4783 8.93588 19.7071 10.7071L18.7073 11.7069L11.1603 19.2539C10.7182 19.696 10.1489 19.989 9.53219 20.0918L4.1644 20.9864C3.84584 21.0395 3.52125 20.9355 3.29289 20.7071C3.06453 20.4788 2.96051 20.1542 3.0136 19.8356L3.90824 14.4678C4.01103 13.8511 4.30396 13.2818 4.7461 12.8397L13.2929 4.29291ZM13 7.41422L6.16031 14.2539C6.01293 14.4013 5.91529 14.591 5.88102 14.7966L5.21655 18.7835L9.20339 18.119C9.40898 18.0847 9.59872 17.9871 9.7461 17.8397L16.5858 11L13 7.41422ZM18 9.5858L14.4142 6.00001L14.7071 5.70712C15.6973 4.71693 17.3027 4.71693 18.2929 5.70712C19.2831 6.69731 19.2831 8.30272 18.2929 9.29291L18 9.5858Z" fill="currentColor"></path></svg>
    </div>
  </div>
  
  <div id="rewrite-tone-buttons" class="flex mb-2">
    <button role="menuitem" data-value="more-casual" class="flex-1 rounded-l-xl border border-token-border-medium px-2.5 py-1 text-xs cursor-pointer focus:ring-0 ${s==="more-casual"?"bg-token-main-surface-tertiary":"hover:bg-token-main-surface-secondary"} group" style="width:33.33%" tabindex="-1">Casual</button>
    <button role="menuitem" data-value="as-is" class="flex-1 border border-token-border-medium px-2.5 py-1 text-xs cursor-pointer focus:ring-0 ${s==="as-is"?"bg-token-main-surface-tertiary":"hover:bg-token-main-surface-secondary"} group" style="width:33.33%" tabindex="-1">As is</button>
    <button role="menuitem" data-value="more-formal" class="flex-1 rounded-r-xl border border-token-border-medium px-2.5 py-1 text-xs cursor-pointer focus:ring-0 ${s==="more-formal"?"bg-token-main-surface-tertiary":"hover:bg-token-main-surface-secondary"} group" style="width:33.33%" tabindex="-1">Formal</button> 
  </div>

  <div id="rewrite-length-buttons" class="flex mb-2">
    <button role="menuitem" data-value="shorter" class="flex-1 rounded-l-xl border border-token-border-medium px-2.5 py-1 text-xs cursor-pointer focus:ring-0 ${l==="shorter"?"bg-token-main-surface-tertiary":"hover:bg-token-main-surface-secondary"} group" style="width:33.33%" tabindex="-1">Shorter</button>
    <button role="menuitem" data-value="as-is" class=" flex-1 border border-token-border-medium px-2.5 py-1 text-xs cursor-pointer focus:ring-0 ${l==="as-is"?"bg-token-main-surface-tertiary":"hover:bg-token-main-surface-secondary"} group" style="width:33.33%" tabindex="-1">As is</button>
    <button role="menuitem" data-value="longer" class="flex-1 rounded-r-xl border border-token-border-medium px-2.5 py-1 text-xs cursor-pointer focus:ring-0 ${l==="longer"?"bg-token-main-surface-tertiary":"hover:bg-token-main-surface-secondary"} group" style="width:33.33%" tabindex="-1">Longer</button> 
  </div>


  <div role="menuitem" id="rewrite-prompt-button" class="flex gap-2 items-center justify-between border border-token-border-medium mt-5 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 group composer-submit-btn composer-submit-button-color" tabindex="-1">
    <span>Optimize prompt</span>
    <svg xmlns="http://www.w3.org/2000/svg" class="icon" fill="currentColor" width="20" height="20" viewBox="0 0 512 512"><path d="M327.5 85.19L384 64L405.2 7.491C406.9 2.985 411.2 0 416 0C420.8 0 425.1 2.985 426.8 7.491L448 64L504.5 85.19C509 86.88 512 91.19 512 96C512 100.8 509 105.1 504.5 106.8L448 128L426.8 184.5C425.1 189 420.8 192 416 192C411.2 192 406.9 189 405.2 184.5L384 128L327.5 106.8C322.1 105.1 320 100.8 320 96C320 91.19 322.1 86.88 327.5 85.19V85.19zM176 73.29C178.6 67.63 184.3 64 190.6 64C196.8 64 202.5 67.63 205.1 73.29L257.8 187.3L371.8 240C377.5 242.6 381.1 248.3 381.1 254.6C381.1 260.8 377.5 266.5 371.8 269.1L257.8 321.8L205.1 435.8C202.5 441.5 196.8 445.1 190.6 445.1C184.3 445.1 178.6 441.5 176 435.8L123.3 321.8L9.292 269.1C3.627 266.5 0 260.8 0 254.6C0 248.3 3.627 242.6 9.292 240L123.3 187.3L176 73.29zM166.9 207.5C162.1 217.8 153.8 226.1 143.5 230.9L92.32 254.6L143.5 278.2C153.8 282.1 162.1 291.3 166.9 301.6L190.6 352.8L214.2 301.6C218.1 291.3 227.3 282.1 237.6 278.2L288.8 254.6L237.6 230.9C227.3 226.1 218.1 217.8 214.2 207.5L190.6 156.3L166.9 207.5zM405.2 327.5C406.9 322.1 411.2 320 416 320C420.8 320 425.1 322.1 426.8 327.5L448 384L504.5 405.2C509 406.9 512 411.2 512 416C512 420.8 509 425.1 504.5 426.8L448 448L426.8 504.5C425.1 509 420.8 512 416 512C411.2 512 406.9 509 405.2 504.5L384 448L327.5 426.8C322.1 425.1 320 420.8 320 416C320 411.2 322.1 406.9 327.5 405.2L384 384L405.2 327.5z"/></svg>
  </div>

  </div></div>`;document.body.insertAdjacentHTML("beforeend",c),addPromptRewriteMenuEventListeners(e,t)}function addPromptRewriteMenuEventListeners(e,t){const o=document.querySelector("#prompt-rewrite-menu");if(!o)return;const r=o.querySelector("#open-rewrite-prompt-context-button");r&&r.addEventListener("click",()=>{openRewritePromptContextModal()});const n=o.querySelectorAll("#rewrite-tone-buttons button");n.forEach(s=>{s.addEventListener("click",l=>{l.stopPropagation();const d=s.getAttribute("data-value");cachedSettings.rewriteTone=d,chrome.storage.local.set({settings:cachedSettings}),n.forEach(c=>{c.classList.remove("bg-token-main-surface-tertiary"),c.classList.add("hover:bg-token-main-surface-secondary")}),s.classList.add("bg-token-main-surface-tertiary"),s.classList.remove("hover:bg-token-main-surface-secondary")})});const i=o.querySelectorAll("#rewrite-length-buttons button");i.forEach(s=>{s.addEventListener("click",l=>{l.stopPropagation();const d=s.getAttribute("data-value");cachedSettings.rewriteLength=d,chrome.storage.local.set({settings:cachedSettings}),i.forEach(c=>{c.classList.remove("bg-token-main-surface-tertiary"),c.classList.add("hover:bg-token-main-surface-secondary")}),s.classList.add("bg-token-main-surface-tertiary"),s.classList.remove("hover:bg-token-main-surface-secondary")})});const a=o.querySelector("#rewrite-prompt-button");a&&a.addEventListener("click",async s=>{s.preventDefault(),s.stopPropagation(),o.remove(),rewritePromptInInput(e,t)})}async function rewritePromptInInput(e,t){if(!t)return;const o=t.innerText.trim()||t.value.trim();if(!o)return;const r=await chrome.runtime.sendMessage({type:"checkHasSubscription"}),n=window.localStorage?JSON.parse(window.localStorage.getItem("sp/dailyRewriteUsage")||"{}"):{},i=new Date().toISOString().split("T")[0];if(!r&&(n[i]||0)>=2){errorUpgradeConfirmation({type:"limit",title:"You have reached the limit",message:"With Free account you can use Prompt Optimizer twice per day. Upgrade to Pro to remove all limits."});return}e.disabled=!0;const a=e.innerHTML;e.innerHTML='<svg x="0" y="0" viewbox="0 0 40 40" class="spinner icon"><circle fill="transparent" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-dasharray="125.6" cx="20" cy="20" r="18"></circle></svg>';const s=await rewritePromptContextBuilder();try{const l=await chrome.runtime.sendMessage({type:"rewritePrompt",detail:{context:s,prompt:o,tone:cachedSettings.rewriteTone||"as-is",length:cachedSettings.rewriteLength||"as-is"}});if(l?.ok){r||(n[i]?n[i]+=1:(Object.keys(n).forEach(c=>{delete n[c]}),n[i]=1),window.localStorage&&window.localStorage.setItem("sp/dailyRewriteUsage",JSON.stringify(n))),t.id==="prompt-textarea"?setTextAreaElementValue(l.text):(t.value=l.text,t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0})),t.focus());const d=new CustomEvent("inputValue",{detail:{value:l.text}});window.dispatchEvent(d),toast("Prompt optimized")}else toast(l?.error||"Failed to optimize prompt","error",1e4)}catch(l){toast("Failed to optimize prompt","error"),console.error("Failed to optimize prompt",l)}finally{e.disabled=o.length===0,e.innerHTML=a}}function openRewritePromptContextModal(){const e=rewritePromptContextModalContent(),t=rewritePromptContextModalActions();createModal("Set Prompt Optimizer Instruction","Provide additional instruction to help optimize your prompt. This instruction will be considered when optimizing but will not be included in the final prompt sent to ChatGPT.",e,t,!1,"small")}function rewritePromptContextModalContent(){const e=document.createElement("div");e.id="modal-content-context-preview",e.classList="w-full h-full flex justify-center items-center overflow-hidden pt-3 gap-2 bg-token-main-surface-primary";const t=document.createElement("div");t.classList="w-full rounded-md flex flex-col justify-center items-start relative",t.style="height: 100%;";const o=document.createElement("select");o.id="preset-context-select",o.classList="bg-token-main-surface-primary border border-token-border-medium text-token-text-primary p-2 ms-3 rounded-md text-sm",o.style.width="140px",Object.keys(PRESET_CONTEXTS).forEach(s=>{const l=document.createElement("option");l.value=s,l.textContent=capitalize(s),o.appendChild(l)});const r=document.createElement("option");r.value="custom",r.textContent="Custom ...",o.appendChild(r),o.value=cachedSettings.selectedRewriteContext||"clarity",o.addEventListener("change",s=>{const l=s.target;if(l){cachedSettings.selectedRewriteContext=l.value,chrome.storage.local.set({settings:cachedSettings});const d=document.getElementById("context-preview-text");d&&(d.value=l.value==="custom"?cachedSettings.customRewriteContext:PRESET_CONTEXTS[l.value]||"",d.disabled=l.value!=="custom",l.value==="custom"?(d.focus(),d.style="opacity:1;"):d.style="opacity:0.6;")}}),t.appendChild(o);const n=document.createElement("textarea");n.id="context-preview-text",n.classList="w-full h-full bg-token-main-surface-primary text-token-text-primary p-3 rounded-md placeholder:text-gray-500 text-lg resize-none border-none focus:ring-0 focus:outline-none",n.placeholder="Write your instructions to optimize prompt...";const{selectedRewriteContext:i,customRewriteContext:a}=cachedSettings;return n.value=i==="custom"?a:PRESET_CONTEXTS[i]||"",n.disabled=i!=="custom",n.style=i==="custom"?"opacity:1;":"opacity:0.6;",n.addEventListener("input",s=>{const l=s.target;l&&(cachedSettings.customRewriteContext=l.value,chrome.storage.local.set({settings:cachedSettings}))}),t.appendChild(n),e.appendChild(t),e}function rewritePromptContextModalActions(){return document.createElement("div")}const modelMap={"ChatGPT 5 Thinking":"gpt-5-thinking","ChatGPT 5 Thinking mini":"gpt-5-t-mini","ChatGPT 5":"gpt-5","ChatGPT 5 Instant":"gpt-5-instant","ChatGPT 5 Pro":"gpt-5-pro","ChatGPT 4o":"gpt-4o","ChatGPT 4.1":"gpt-4-1","ChatGPT o3":"o3","ChatGPT o4":"o4","ChatGPT o4-mini":"o4-mini"},PRESET_CONTEXTS={clarity:"Rewrite the prompt to preserve its intent while removing ambiguity and filler. Specify the task in one sentence, list clear constraints, define inputs/outputs, and note success criteria. Keep domain terms intact, preserve variable/placeholders exactly as written (e.g., ${var}, {{ handlebars }}, <tags>, code). Prefer concrete verbs and numbered steps. Avoid rhetorical questions and fluff. Do not add external facts or alter the user\u2019s goal.",precision:"Rewrite the prompt into a compact spec: Role \u2192 Task \u2192 Constraints \u2192 I/O format \u2192 Edge cases \u2192 Acceptance checks. Convert vague words (like \u201Csome\u201D, \u201Cquick\u201D, \u201Coptimize\u201D) into measurable targets or explicit assumptions. For code, keep language, library, and versions unchanged. For safety, forbid hallucinated data and require an \u201CUnknown if not provided\u201D stance. Avoid metaphors; prefer exactness.",creative:"Rewrite to preserve the original goal while boosting creative range and distinct options. Ask for 3\u20135 divergent approaches, each with a one-line rationale and a trade-off. Keep constraints intact. Encourage tasteful analogies/examples only if they clarify the idea. No new facts beyond what the user provided; label assumptions clearly. End with a brief recommendation on when to pick each option.",tutor:"Rewrite to produce a stepwise plan that teaches the concept as it solves it. Define prerequisites, outline steps with short explanations, and include a minimal example. Use plain language for tough parts; name common pitfalls and how to avoid them. Keep all original technical specs and variables exact. Do not expand scope beyond the request.",redteam:"Rewrite to make the prompt robust against failure: enumerate likely edge cases, specify fallback behaviors, and define validation checks for outputs. Require explicit handling for incomplete inputs and ask for clarifying questions only when critical. For code, lock API contracts and input schemas; for text, lock required sections and output format. No scope creep, no invented data."},TONE_RULES={"more-casual":"Adopt approachable, friendly language. Prefer contractions and short, direct sentences, but keep technical terms intact.","as-is":"Preserve the original tone; do not shift register.","more-formal":"Adopt precise, neutral, professional language. Avoid slang and contractions; maintain technical rigor."},LENGTH_RULES={shorter:"Condense aggressively without losing constraints or acceptance criteria. Remove filler and repetition.","as-is":"Keep the length approximately the same while improving clarity and structure.",longer:"Expand where necessary to add structure, steps, examples, and acceptance checks\u2014without adding new external facts."};async function rewritePromptContextBuilder(){const{rewriteTone:e,rewriteLength:t,selectedRewriteContext:o,customRewriteContext:r}=cachedSettings,n=TONE_RULES[e]||TONE_RULES["as-is"],i=LENGTH_RULES[t]||LENGTH_RULES["as-is"],a=o==="custom"?r:PRESET_CONTEXTS[o]||"",s=["Preserve the original task and domain details.","Do not invent facts, data, references, or APIs not present in the input.","Preserve variable names, placeholders, code blocks, and file paths exactly (e.g., ${var}, {{x}}, <tag>, backticked identifiers).","Keep the same programming language, libraries, and versions if the prompt involves code.","If any mandatory input is missing, request only the minimum critical clarifications as a short numbered list.","Prefer numbered lists and bullet points over prose where it adds clarity."].join(" "),l=modelMap[document.querySelector('header button[data-testid="model-switcher-dropdown-button"]')?.textContent?.trim()||document.querySelector("#selected-model-title")?.textContent?.trim()];return["You are a Prompt Optimizer. Your job is to rewrite the user's prompt to maximize clarity, answerability, and robustness while preserving the original intent.",l?`Optimize for model: ${l}. Avoid model-specific tooling unless explicitly mentioned in the source prompt.`:"",`Style/tone directive: ${n}`,`Length directive: ${i}`,`Preset rules: ${a}`,`Global invariants: ${s}`,"Output requirement: Return ONLY the rewritten prompt text\u2014no explanations, no headers, no JSON."].filter(Boolean).join(" ")}let gizmoPageNumber=1,gizmoCursor=null,noMoreGizmo=!1,gizmoSortBy=gizmoSortByList[0].code,selectedGizmoCategoryId="all";const gizmoCategories=[{id:"all",title:"All GPTs",description:"Full list of all GPTs in the store. With the ability to search and sort by most popular."},{id:"featured_store",title:"Top Picks",description:"Curated top picks from this week"},{id:"trending",title:"Trending",description:"Most popular GPTs by our community"},{id:"featured",title:"By ChatGPT",description:"GPTs created by the ChatGPT team"},{id:"pinned",title:"Pinned",description:"Pinned GPTs in your sidebar"},{id:"mine",title:"My GPTs",description:"My GPTs"},{id:"more_categories",title:". . .",description:"More Categories"}],gizmoMoreCategories=[{id:"dalle",title:"DALL\xB7E",description:"Transform your ideas into amazing images"},{id:"writing",title:"Writing",description:"Enhance your writing with tools for creation, editing, and style refinement"},{id:"productivity",title:"Productivity",description:"Increase your efficiency"},{id:"research",title:"Research",description:"Find, evaluate, interpret, and visualize information"},{id:"programming",title:"Programming",description:"Write code, debug, test, and learn"},{id:"education",title:"Education",description:"Explore new ideas, revisit existing skills"},{id:"lifestyle",title:"Lifestyle",description:"Get tips on travel, workouts, style, food, and more"}];function renderGizmoDiscoveryPage(e="all"){e||(e="all");const t=document.createElement("div");return t.appendChild(loadingSpinner("gizmo-discovery-loading")),chrome.runtime.sendMessage({type:"checkHasSubscription"},o=>{!o&&e==="all"&&(e="featured_store"),selectedGizmoCategoryId=e,chrome.storage.sync.get(["openai_id"]).then(r=>{const{openai_id:n}=r;t.classList="mx-auto w-full p-4 pt-0 h-full";const i=document.createElement("div");i.style="position: sticky; top: 0; z-index: 1000;",i.classList="pb-1 pt-4";const a=document.createElement("div");a.classList="flex justify-between items-start";const s=document.createElement("div");s.id="gizmo-discovery-tabs",s.classList="flex justify-start gap-2 mb-4",gizmoCategories.forEach(f=>{const v=document.createElement("button");v.id=`gizmo-discovery-${f.id}-tab`,v.classList=`btn relative ${f.id===e?"btn-primary":"btn-secondary"}`,v.title=f.description,v.style.fontSize="12px",v.innerHTML=f.title,v.addEventListener("click",x=>{if(x.preventDefault(),x.stopPropagation(),closeMenus(),f.id==="more_categories")showMoreCategories(n,o);else{const y=document.querySelector("#more-categories-menu");y&&y.remove(),selectedGizmoCategoryId=f.id,resetGizmoDiscoveryPage(f.id,o),fetchGizmos(f.id,n,o),setActiveTab(`gizmo-discovery-${f.id}-tab`)}}),s.appendChild(v)}),a.appendChild(s);const l=document.createElement("div");l.classList="flex justify-end items-start";const d=document.createElement("div");d.id="gizmo-sort-by-selector-wrapper",d.style="position:relative;width:155px;z-index:1000;margin-right:12px;",d.innerHTML=dropdown("GPTs-SortBy",gizmoSortByList,gizmoSortByList[0],"code","right","bg-token-main-surface-primary"),l.appendChild(d);const c=document.createElement("div");c.classList="flex justify-start items-center gap-2 mb-4 pe-3",c.style="width: 200px;",c.innerHTML='<input id="gizmo-search-input" class="form-input w-full rounded-md shadow-sm bg-token-main-surface-secondary" type="search" placeholder="Name, author, desc..." />',l.appendChild(c),a.appendChild(l),i.appendChild(a);const u=document.createElement("div");u.id="gizmo-category-description",u.classList="mb-2 text-sm text-token-text-tertiary md:text-base",u.innerText=gizmoCategories.find(f=>f.id===e).description,i.appendChild(u);const m=document.createElement("div");m.id="gizmo-search-term-pill",m.classList="hidden flex items-center justify-center bg-token-main-surface-secondary text-token-text-primary rounded-full p-1 px-2 me-2 border border-token-border-medium max-w-fit",m.innerHTML='<button id="gizmo-search-term-pill-clear-button" class="focus-visible:outline-0 hover:bg-token-main-surface-tertiary focus-visible:bg-token-main-surface-tertiary rounded-full mx-1"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="20" width="20" xmlns="http://www.w3.org/2000/svg"> <line x1="18" y1="6" x2="6" y2="18"></line> <line x1="6" y1="6" x2="18" y2="18"></line> </svg></button><span id="gizmo-search-term-pill-text" class="text-sm mx-1 text-danger"></span>',m.querySelector("#gizmo-search-term-pill-clear-button").addEventListener("click",()=>{const f=document.querySelector("#gizmo-search-input");f.value="",f.dispatchEvent(new Event("input"))}),i.appendChild(m),t.innerHTML="",t.appendChild(i);const g=document.createElement("div");g.id="gizmo-discovery-grid",g.style="position:relative;height:100%; overflow-y: auto;padding-bottom: 120px;",g.classList="grid grid-cols-1 gap-2 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",t.appendChild(g);const p=document.querySelector("#gizmo-discovery-loading");p&&p.remove(),resetGizmoDiscoveryPage(e,o),addDropdownEventListener("GPTs-SortBy",gizmoSortByList,"code",f=>toggleSortByDropdown(f,n,o)),fetchGizmos(e,n,o);const h=document.querySelector("#gizmo-search-input");h&&h.addEventListener("input",debounce(()=>{resetGizmoDiscoveryPage("all",o);const f=document.querySelector("#gizmo-search-term-pill"),v=document.querySelector("#gizmo-search-term-pill-text");h.value.trim()!==""?(v.innerText=h.value.trim(),f.classList.remove("hidden")):(v.innerText="",f.classList.add("hidden"));const x=document.querySelector("#gizmo-discovery-tabs button.btn-primary");x.id!=="gizmo-discovery-all-tab"&&(x.classList.replace("btn-primary","btn-secondary"),document.querySelector("#gizmo-discovery-all-tab").classList.replace("btn-secondary","btn-primary"));const y=h.value;fetchGizmos("all",n,o,!0,1,null,y)},500))})}),t}function gizmoManagerModalActions(){const e=document.createElement("div");e.classList="flex items-center justify-end w-full mt-2";const t=document.createElement("button");return t.classList="btn composer-submit-btn composer-submit-button-color",t.innerText=translate("plus Create a GPT"),t.addEventListener("click",()=>{closeModals(),window.history.pushState({},"",`https://${window.location.host}/gpts/editor`),window.dispatchEvent(new PopStateEvent("popstate",{state:{}}))}),e.appendChild(t),e}function showMoreCategories(e,t=!1){const o=document.querySelector("#gizmo-discovery-more_categories-tab");if(!o)return;const{x:r,y:n}=o.getBoundingClientRect(),i=document.querySelector("#more-categories-menu");i&&i.remove();const a=document.createElement("div");a.id="more-categories-menu",a.style=`position: fixed; left: 0px; top: 0px; transform: translate3d(${r+45}px, ${n-60}px, 0px); min-width: max-content; z-index: 100001;`,a.classList="bg-token-main-surface-secondary shadow-long rounded-2xl p-1",a.innerHTML="",gizmoMoreCategories.forEach(s=>{if(selectedGizmoCategoryId===s.id)return;const l=document.createElement("button");l.id=`gizmo-discovery-${s.id}-tab`,l.classList="block px-4 py-2 text-sm text-token-text-primary w-full text-start hover:bg-token-main-surface-tertiary rounded-xl",l.title=s.description,l.innerHTML=s.title,l.addEventListener("click",()=>{selectedGizmoCategoryId=s.id,resetGizmoDiscoveryPage(s.id,t),fetchGizmos(s.id,e,t),setActiveMoreCategoryTab(`gizmo-discovery-${s.id}-tab`),closeMoreCategoriesMenu()}),a.appendChild(l)}),document.body.appendChild(a)}function closeMoreCategoriesMenu(){const e=document.querySelector("#more-categories-menu");e&&e.remove()}function toggleSortByDropdown(e,t,o=!1){gizmoSortBy=e.code;const r=document.querySelector("#gizmo-search-input").value;fetchGizmos(selectedGizmoCategoryId,t,o,!0,1,null,r)}function resetGizmoDiscoveryPage(e,t=!1){const o=document.querySelector("#gizmo-search-input"),r=document.querySelector("#gizmo-sort-by-selector-wrapper");if(e==="all"||t&&!["pinned","recent","mine"].includes(e))r&&(r.style.display="block");else{o&&(o.value=""),r&&(r.style.display="none");const n=document.querySelector("#gizmo-search-term-pill"),i=document.querySelector("#gizmo-search-term-pill-text");i.innerText="",n.classList.add("hidden")}gizmoPageNumber=1,gizmoCursor=null,noMoreGizmo=!1}function setActiveTab(e){const t=document.querySelector("#gizmo-discovery-tabs");if(!t)return;t.querySelectorAll("button").forEach(i=>{i.id===e?i.classList.replace("btn-secondary","btn-primary"):i.classList.replace("btn-primary","btn-secondary")});const o=document.querySelector("#gizmo-discovery-more_categories-tab");if(!o)return;const r=o.previousElementSibling;if(!r)return;gizmoCategories.find(i=>i.id===r.id.replace("gizmo-discovery-","").replace("-tab",""))||r.remove();const n=document.querySelector("#gizmo-category-description");n&&(n.innerText=gizmoCategories.find(i=>i.id===e.replace("gizmo-discovery-","").replace("-tab","")).description)}function setActiveMoreCategoryTab(e){document.querySelector("#gizmo-discovery-tabs").querySelectorAll("button").forEach(a=>{a.classList.replace("btn-primary","btn-secondary")});const t=gizmoMoreCategories.find(a=>a.id===e.replace("gizmo-discovery-","").replace("-tab","")),o=document.createElement("button");o.id=`gizmo-discovery-${t.id}-tab`,o.classList="btn relative btn-primary",o.title=t.description,o.style.fontSize="12px",o.innerHTML=t.title;const r=document.querySelector("#gizmo-discovery-more_categories-tab");if(!r)return;const n=r.previousElementSibling;if(!n||(gizmoCategories.find(a=>a.id===n.id.replace("gizmo-discovery-","").replace("-tab",""))||n.remove(),!r))return;r.insertAdjacentElement("beforebegin",o);const i=document.querySelector("#gizmo-category-description");i&&(i.innerText=t.description)}function fetchGizmosFromSuperpower(e,t,o=!1,r=!0,n=null,i=null){const a={sortBy:gizmoSortBy,category:e};n&&(a.pageNumber=n),i&&(a.searchTerm=i),chrome.runtime.sendMessage({type:"getSuperpowerGizmos",detail:a},s=>{s.next?(gizmoPageNumber+=1,noMoreGizmo=!1):noMoreGizmo=!0,document.querySelector("#gizmo-discovery-tabs button.btn-primary")?.id===`gizmo-discovery-${e}-tab`&&renderGizmoGrid(s.results,e,t,o,r)})}function fetchGizmosFromChatGPT(e,t,o=!1,r=!0,n=null){const i=document.querySelector("#gizmo-discovery-grid");i&&getGizmoDiscovery(e,n).then(a=>{a.list.cursor?(noMoreGizmo=!1,gizmoCursor=a.list.cursor):noMoreGizmo=!0;const s=a.list.items.map(l=>l.resource.gizmo);selectedGizmoCategoryId===e&&renderGizmoGrid(s,e,t,o,r)},()=>{if(r)i.innerHTML='<div class="w-full h-full inset-0 flex items-center justify-center text-white">Something went wrong. Please try again!</div>';else{const a=document.querySelector("#load-more-button");a&&(a.innerHTML='<div class="w-full h-full inset-0 flex items-center justify-center text-white">Something went wrong. Please try again!</div>',a.style.pointerEvents="default")}})}function fetchGizmoPinned(e,t,o=!0){const r=document.querySelector("#gizmo-discovery-grid");r&&getGizmosBootstrap(!1).then(n=>{noMoreGizmo=!0;const i=n?.gizmos?.map(a=>a.resource.gizmo)||[];renderGizmoGrid(i,"pinned",e,t,o)},()=>{if(o)r.innerHTML='<div class="w-full h-full inset-0 flex items-center justify-center text-white">Something went wrong. Please try again!</div>';else{const n=document.querySelector("#load-more-button");n&&(n.innerHTML='<div class="w-full h-full inset-0 flex items-center justify-center text-white">Something went wrong. Please try again!</div>',n.style.pointerEvents="default")}})}function fetchGizmos(e,t,o=!1,r=!0,n=null,i=null,a=null){n||(gizmoPageNumber=1,noMoreGizmo=!1),i||(gizmoCursor=null,noMoreGizmo=!1);const s=document.querySelector("#gizmo-search-input");s&&(s.value=a||"");const l=document.querySelector("#gizmo-search-term-pill"),d=document.querySelector("#gizmo-search-term-pill-text");a&&a.trim()!==""?(d.innerText=a.trim(),l.classList.remove("hidden")):(d.innerText="",l.classList.add("hidden"));const c=document.querySelector("#gizmo-discovery-grid");if(c)if(r&&(c.innerHTML='<div id="gizmo-discovery-loading" class="w-full h-full inset-0 flex items-center justify-center text-white"><svg x="0" y="0" viewbox="0 0 40 40" class="spinner icon icon-xl"><circle fill="transparent" stroke="#ffffff50" stroke-width="2" stroke-linecap="round" stroke-dasharray="125.6" cx="20" cy="20" r="18"></circle></svg></div>'),o)["recent","mine"].includes(e)?fetchGizmosFromChatGPT(e,t,o,r,i):e==="pinned"?fetchGizmoPinned(t,o,r):fetchGizmosFromSuperpower(e,t,o,r,n,a);else if(e==="all"){c.innerHTML=`<div class="absolute z-10 w-full h-full inset-0 flex items-center flex-wrap justify-center text-token-text-primary m-auto mt-4 mb-4" style="max-width:400px; max-height:200px;"><div>Get access to the full list of more than 100,000 Custom GPTs with the ability to search and sort right from inside ChatGPT. <a href="https://www.youtube.com/watch?v=q1VUONah6fE&ab_channel=Superpower" target="_blank" class="underline text-gold" rel="noreferrer">Learn more</a></div> <button id="upgrade-to-pro-button-gpt-store" class="flex flex-wrap p-1 items-center rounded-md bg-gold hover:bg-gold-dark transition-colors duration-200 text-black cursor-pointer text-sm m-4 font-bold" style="width: 230px;"><div class="flex w-full"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" style="width:20px; height:20px; margin-right:6px;position:relative; top:10px;" stroke="purple" fill="purple"><path d="M240.5 224H352C365.3 224 377.3 232.3 381.1 244.7C386.6 257.2 383.1 271.3 373.1 280.1L117.1 504.1C105.8 513.9 89.27 514.7 77.19 505.9C65.1 497.1 60.7 481.1 66.59 467.4L143.5 288H31.1C18.67 288 6.733 279.7 2.044 267.3C-2.645 254.8 .8944 240.7 10.93 231.9L266.9 7.918C278.2-1.92 294.7-2.669 306.8 6.114C318.9 14.9 323.3 30.87 317.4 44.61L240.5 224z"></path></svg> Upgrade to Pro</div><div style="font-size:10px;font-weight:400;margin-left:28px;" class="flex w-full">GPT Store, Image Gallery, Voice & more</div></button></div>${blurredList()}`;const u=document.querySelector("#upgrade-to-pro-button-gpt-store");u&&u.addEventListener("click",()=>{openUpgradeModal(o)})}else e==="pinned"?fetchGizmoPinned(t,o,r):fetchGizmosFromChatGPT(e,t,o,r,i)}function renderGizmoGrid(e,t,o,r=!1,n=!0){const i=document.querySelector("#gizmo-discovery-grid");if(!i)return;if(n)i.innerHTML="";else{const c=document.querySelector("#load-more-button");c&&c.parentElement.remove()}if(n&&(!e||e.length===0)){i.innerHTML=`<div class="absolute w-full h-full inset-0 flex items-center justify-center text-token-text-primary text-center">${t==="mine"?"You have not created a GPT yet. <br/>Customize a version of ChatGPT for a specific purpose":"No GPT found."}</div>`;return}const a=document.querySelectorAll('[id^="gizmo-card-"]'),s=[];a.forEach(c=>{s.push(c.id.replace("gizmo-card-",""))});const l=e?.map(c=>c.id).filter(c=>!s.includes(c))||[];if(e?.forEach(c=>{if(s.includes(c.id))return;const u=c?.live_version===0,m=document.createElement("div");m.classList="flex flex-col w-full justify-start items-start gap-2 pe-3 pb-3 h-max",m.style="height: max-content;";const g=c.author.link_to?`<a class="break-all hover:text-green-500 hover:underline" href="${c.author.link_to}" target="_blank" class="underline">${c.author.display_name}</a>`:c.author.display_name,p=c?.vanity_metrics?.num_conversations_str||"",h=selectedGizmoCategoryId==="all"||r&&!["mine"].includes(selectedGizmoCategoryId)?c?.display?.categories?.map(f=>[...gizmoCategories,...gizmoMoreCategories].find(v=>v.id===f)).filter(f=>f&&f.id!==selectedGizmoCategoryId)||[]:[];m.innerHTML=`
      <div id="gizmo-card-${c.id}" class="relative flex flex-col w-full h-full justify-start items-start gap-2 p-4 cursor-pointer bg-token-main-surface-primary border border-token-border-medium hover:bg-token-main-surface-secondary hover:shadow-xl rounded-xl">
        <button id="gizmo-card-menu-${c.id}" class="absolute top-0 end-0 flex w-9 h-9 items-center justify-center rounded-lg text-token-text-tertiary transition hover:text-token-text-tertiary radix-state-open:text-token-text-tertiary hover:bg-token-sidebar-surface-tertiary" type="button" aria-haspopup="menu" aria-expanded="false" data-state="closed"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md relative"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 12C3 10.8954 3.89543 10 5 10C6.10457 10 7 10.8954 7 12C7 13.1046 6.10457 14 5 14C3.89543 14 3 13.1046 3 12ZM10 12C10 10.8954 10.8954 10 12 10C13.1046 10 14 10.8954 14 12C14 13.1046 13.1046 14 12 14C10.8954 14 10 13.1046 10 12ZM17 12C17 10.8954 17.8954 10 19 10C20.1046 10 21 10.8954 21 12C21 13.1046 20.1046 14 19 14C17.8954 14 17 13.1046 17 12Z" fill="currentColor"></path></svg></button>

        <div class="flex items-start">

          <div class="flex justify-center items-center w-24 h-24 rounded-md bg-gray-200" style="min-width:96px;">
          ${c.display.profile_picture_url?`<img src="${c.display.profile_picture_url}" class="w-24 h-24 rounded-md border border-gray-300" />`:'<div class="gizmo-shadow-stroke relative flex w-full h-full items-center justify-center rounded-md bg-white text-black"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="text-token-secondary h-full w-full" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg></div>'}
          </div>

          <div class="flex flex-col h-full justify-between">
            <div class="ms-2 flex w-full items-center gap-1 text-token-text-tertiary text-xs">${c.vanity_metrics.created_ago_str?`Created<br/>${c.vanity_metrics.created_ago_str}`:""}</div>

            <div class="ms-2 w-full flex items-center gap-1 text-token-text-tertiary">${c.author.user_id.split("__")?.[0]===o.split("__")?.[0]&&u?"Draft":p?`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-sm me-1"><path fill-rule="evenodd" clip-rule="evenodd" d="M8.52242 6.53608C9.7871 4.41979 12.1019 3 14.75 3C18.7541 3 22 6.24594 22 10.25C22 11.9007 21.4474 13.4239 20.5183 14.6425L21.348 15.97C21.5407 16.2783 21.5509 16.6668 21.3746 16.9848C21.1984 17.3027 20.8635 17.5 20.5 17.5H15.4559C14.1865 19.5963 11.883 21 9.25 21C9.18896 21 9.12807 20.9992 9.06735 20.9977C9.04504 20.9992 9.02258 21 9 21H3.5C3.13647 21 2.80158 20.8027 2.62536 20.4848C2.44913 20.1668 2.45933 19.7783 2.652 19.47L3.48171 18.1425C2.55263 16.9239 2 15.4007 2 13.75C2 9.99151 4.85982 6.90116 8.52242 6.53608ZM10.8938 6.68714C14.106 7.43177 16.5 10.3113 16.5 13.75C16.5 14.3527 16.4262 14.939 16.2871 15.5H18.6958L18.435 15.0828C18.1933 14.6961 18.2439 14.1949 18.5579 13.8643C19.4525 12.922 20 11.651 20 10.25C20 7.35051 17.6495 5 14.75 5C13.2265 5 11.8535 5.64888 10.8938 6.68714ZM8.89548 19C8.94178 18.9953 8.98875 18.9938 9.03611 18.9957C9.107 18.9986 9.17831 19 9.25 19C11.3195 19 13.1112 17.8027 13.9668 16.0586C14.3079 15.363 14.5 14.5804 14.5 13.75C14.5 10.8505 12.1495 8.5 9.25 8.5C9.21772 8.5 9.18553 8.50029 9.15341 8.50087C6.2987 8.55218 4 10.8828 4 13.75C4 15.151 4.54746 16.422 5.44215 17.3643C5.75613 17.6949 5.80666 18.1961 5.56498 18.5828L5.30425 19H8.89548Z" fill="currentColor"></path></svg><div title="Number of conversations" class="text-sm flex">${p}</div>`:""}</div>              
          </div>
        </div>
        
        <div class="text-lg"><div style="white-space: break-spaces; overflow-wrap: break-word;display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden;word-break:break-word;">${c.display.name||"Untitled"}</div></div>
        
        <div class="text-sm text-token-text-tertiary" style="min-height:80px; white-space: break-spaces; overflow-wrap: break-word;display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; overflow: hidden;word-break:break-word;">${c.display.description||"..."}</div>
        
        <div style="min-height:22px;" class="mt-1 flex items-center gap-1 text-token-text-tertiary">${h.slice(0,2).map(f=>`<div id="category-tag-${f.id}" style='font-size:11px;' class="border rounded-full border-token-border-medium hover:border-green-500 hover:cursor-pointer hover:text-green-500 px-2">${f.title}</div>`).join("")}</div>

        <div class="flex items-center gap-1 text-token-text-tertiary h-5"><div class="text-sm text-token-text-tertiary" style="white-space: break-spaces; overflow-wrap: break-word;display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden;">${c.author.display_name?`By ${g}`:""}</div></div>
        ${t==="mine"?`
        
          ${c.share_recipient==="private"?'<div style="position:absolute;bottom:20px;right:8px;" title="Private GPT - Only you can see this GPT"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" stroke="#ef4146cc" fill="#ef4146cc" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-3 w-3" height="1em" width="1em"><path d="M80 192V144C80 64.47 144.5 0 224 0C303.5 0 368 64.47 368 144V192H384C419.3 192 448 220.7 448 256V448C448 483.3 419.3 512 384 512H64C28.65 512 0 483.3 0 448V256C0 220.7 28.65 192 64 192H80zM144 192H304V144C304 99.82 268.2 64 224 64C179.8 64 144 99.82 144 144V192z"/></svg></div>':""}
          ${c.share_recipient==="link"?'<div style="position:absolute;bottom:16px;right:8px;" title="Anyone with the link can use this GPT"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" stroke="#e06c2b" fill="#e06c2b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4" height="1em" width="1em"><path d="M172.5 131.1C228.1 75.51 320.5 75.51 376.1 131.1C426.1 181.1 433.5 260.8 392.4 318.3L391.3 319.9C381 334.2 361 337.6 346.7 327.3C332.3 317 328.9 297 339.2 282.7L340.3 281.1C363.2 249 359.6 205.1 331.7 177.2C300.3 145.8 249.2 145.8 217.7 177.2L105.5 289.5C73.99 320.1 73.99 372 105.5 403.5C133.3 431.4 177.3 435 209.3 412.1L210.9 410.1C225.3 400.7 245.3 404 255.5 418.4C265.8 432.8 262.5 452.8 248.1 463.1L246.5 464.2C188.1 505.3 110.2 498.7 60.21 448.8C3.741 392.3 3.741 300.7 60.21 244.3L172.5 131.1zM467.5 380C411 436.5 319.5 436.5 263 380C213 330 206.5 251.2 247.6 193.7L248.7 192.1C258.1 177.8 278.1 174.4 293.3 184.7C307.7 194.1 311.1 214.1 300.8 229.3L299.7 230.9C276.8 262.1 280.4 306.9 308.3 334.8C339.7 366.2 390.8 366.2 422.3 334.8L534.5 222.5C566 191 566 139.1 534.5 108.5C506.7 80.63 462.7 76.99 430.7 99.9L429.1 101C414.7 111.3 394.7 107.1 384.5 93.58C374.2 79.2 377.5 59.21 391.9 48.94L393.5 47.82C451 6.731 529.8 13.25 579.8 63.24C636.3 119.7 636.3 211.3 579.8 267.7L467.5 380z"/></svg></div>':""}
          ${c.share_recipient==="marketplace"?'<div style="position:absolute;bottom:16px;right:8px;" title="Public GPT - Your GPT will appear in the GPT Store"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" stroke="#19c37d" fill="#19c37d" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4" height="1em" width="1em"><path d="M319.9 320c57.41 0 103.1-46.56 103.1-104c0-57.44-46.54-104-103.1-104c-57.41 0-103.1 46.56-103.1 104C215.9 273.4 262.5 320 319.9 320zM369.9 352H270.1C191.6 352 128 411.7 128 485.3C128 500.1 140.7 512 156.4 512h327.2C499.3 512 512 500.1 512 485.3C512 411.7 448.4 352 369.9 352zM512 160c44.18 0 80-35.82 80-80S556.2 0 512 0c-44.18 0-80 35.82-80 80S467.8 160 512 160zM183.9 216c0-5.449 .9824-10.63 1.609-15.91C174.6 194.1 162.6 192 149.9 192H88.08C39.44 192 0 233.8 0 285.3C0 295.6 7.887 304 17.62 304h199.5C196.7 280.2 183.9 249.7 183.9 216zM128 160c44.18 0 80-35.82 80-80S172.2 0 128 0C83.82 0 48 35.82 48 80S83.82 160 128 160zM551.9 192h-61.84c-12.8 0-24.88 3.037-35.86 8.24C454.8 205.5 455.8 210.6 455.8 216c0 33.71-12.78 64.21-33.16 88h199.7C632.1 304 640 295.6 640 285.3C640 233.8 600.6 192 551.9 192z"/></svg></div>':""}
        `:""}
      </div>
    `,i.appendChild(m)}),!noMoreGizmo){const c=document.createElement("div");c.classList="flex flex-col w-full justify-start items-start gap-2 pe-3 pb-3",c.style="height: 314px;",c.innerHTML='<div id="load-more-button" class="relative flex flex-col w-full h-full justify-center items-center gap-2 p-4 text-token-text-tertiary text-3xl font-bold cursor-pointer bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary hover:shadow-xl rounded-xl">Load more...</div>',i.appendChild(c)}i.querySelectorAll("div[id^=gizmo-card-]")?.forEach(c=>{const u=c.id.split("gizmo-card-")[1];if(!l?.includes(u))return;const m=e.find(h=>h.id===u),g=m.live_version===0,p=c.querySelector(`#gizmo-card-menu-${u}`);p&&p.addEventListener("click",async h=>{h.stopPropagation();const f=document.querySelector("#gizmo-card-menu");if(f)f.remove();else{const v=await gizmoCardMenu(m,o);c.insertAdjacentHTML("beforeend",v),gizmoCardMenuEventListener(u);const x=document.querySelector("#gizmo-card-menu");x&&(x.addEventListener("click",y=>{y.stopPropagation(),closeMenus()}),x.addEventListener("mouseleave",()=>{x.remove()}))}}),c.querySelectorAll("[id^=category-tag-]")?.forEach(h=>{h.addEventListener("click",f=>{f.preventDefault(),f.stopPropagation(),closeMenus();const v=h.id.replace("category-tag-","");selectedGizmoCategoryId=v,resetGizmoDiscoveryPage(v,r),fetchGizmos(v,o,r),gizmoCategories.find(x=>x.id===v)?setActiveTab(`gizmo-discovery-${v}-tab`):(setActiveTab("gizmo-discovery-more_categories-tab"),setActiveMoreCategoryTab(`gizmo-discovery-${v}-tab`))})}),c.addEventListener("click",h=>{h.target.tagName==="A"||h.target.tagName==="BUTTON"||h.target.id.startsWith("category-tag-")||(g?window.open(`https://${window.location.host}/gpts/editor/${u}`,"_blank"):getGizmoAbout(u).then(f=>{showGizmoAboutDialog(f,!0)}),chrome.runtime.sendMessage({type:"updateGizmoMetrics",detail:{gizmoId:m?.id,metricName:"num_users_interacted_with"}}))})});const d=document.querySelector("#load-more-button");d&&(d.addEventListener("click",()=>{if(d.innerHTML='<div class="w-full h-full inset-0 flex items-center justify-center text-white"><svg x="0" y="0" viewbox="0 0 40 40" class="spinner icon icon-xl"><circle fill="transparent" stroke="#ffffff50" stroke-width="2" stroke-linecap="round" stroke-dasharray="125.6" cx="20" cy="20" r="18"></circle></svg></div>',d.style.pointerEvents="none",!document.querySelector("#gizmo-discovery-tabs"))return;const c=document.querySelector("#gizmo-search-input")?.value;fetchGizmos(t,o,r,!1,gizmoPageNumber,gizmoCursor,c)}),new IntersectionObserver(c=>{c[0].isIntersecting&&d.click()},{threshold:.5}).observe(d))}function gizmoCardMenu(e,t){return getGizmosBootstrap(!1).then(o=>{const r=e.live_version===0,n=[...o.gizmos].find(i=>i?.resource?.gizmo?.id===e.id);return`<div id="gizmo-card-menu" class="absolute top-0 end-0 mt-2 me-2 w-40 rounded-2xl shadow-long p-1 ring-opacity-5 bg-token-main-surface-tertiary text-token-text-primary"> 
    
    ${e.author.user_id.split("__")?.[0]===t.split("__")?.[0]?`<a href="/gpts/editor/${e.id}" target="_self" class="block px-4 py-2 text-sm hover:bg-token-main-surface-secondary" role="menuitem">Edit</a><button id="delete-gizmo-button" class="rounded-xl block w-full flex items-start px-4 py-2 text-sm hover:bg-token-main-surface-secondary" role="menuitem">Delete</button>`:""} 
    
    ${r?"":`<button id="gizmo-card-${n?"hide-from":"add-to"}-sidebar" class="rounded-xl block w-full flex items-start px-4 py-2 text-sm hover:bg-token-main-surface-secondary" role="menuitem">${n?"Hide from sidebar":"Add to sidebar"}</button>`} 
    
    ${r?"":'<button id="gizmo-card-about" class="rounded-xl block w-full flex items-start px-4 py-2 text-sm hover:bg-token-main-surface-secondary" role="menuitem">About</button>'}
 
    </div>`})}function gizmoCardMenuEventListener(e){const t=document.querySelector("#gizmo-card-menu");if(t){const o=t.querySelector("#delete-gizmo-button");o&&o.addEventListener("click",()=>{showConfirmDialog("Delete GPT","Are you sure you want to delete this GPT? This cannot be undone.","Cancel","Delete GPT",null,()=>{deleteGizmo(e),toast("GPT deleted successfully!","success");const a=document.querySelector(`#gizmo-card-${e}`);a&&a.parentElement.remove();const s=document.querySelector("#gpt-list")?.querySelector(`a[href*="${e}"]`)?.parentElement;s&&s.remove()})});const r=t.querySelector("#gizmo-card-add-to-sidebar");r&&r.addEventListener("click",()=>{t.remove(),updateGizmoSidebar(e,"keep"),chrome.runtime.sendMessage({type:"updateGizmoMetrics",detail:{gizmoId:e,metricName:"num_pins",direction:"up"}})});const n=t.querySelector("#gizmo-card-hide-from-sidebar");n&&n.addEventListener("click",()=>{t.remove(),updateGizmoSidebar(e,"hide"),chrome.runtime.sendMessage({type:"updateGizmoMetrics",detail:{gizmoId:e,metricName:"num_pins",direction:"down"}})});const i=t.querySelector("#gizmo-card-about");i&&i.addEventListener("click",()=>{t.remove(),getGizmoAbout(e).then(a=>{showGizmoAboutDialog(a,!0)})})}}function blurredList(){return'<div style="position:absolute;display: flex;flex-flow: wrap;justify-content: start;align-items: stretch;filter: blur(12px); pointer-events: none;"><div class="flex flex-col w-full justify-start items-start gap-2 pe-3 pb-3" style="max-width: 25%;"> <div class="flex flex-col w-full h-full justify-start items-start gap-2 p-4 cursor-pointer bg-black/50 hover:bg-black hover:shadow-xl rounded-xl"> <div class="flex justify-center items-center w-24 h-24 rounded-md bg-gray-200"> <img src="https://files.oaiusercontent.com/file-SxYQO0Fq1ZkPagkFtg67DRVb?se=2123-10-12T23%3A57%3A32Z&amp;sp=r&amp;sv=2021-08-06&amp;sr=b&amp;rscc=max-age%3D31536000%2C%20immutable&amp;rscd=attachment%3B%20filename%3Dagent_3.webp&amp;sig=pLlQh8oUktqQzhM09SDDxn5aakqFuM2FAPptuA0mbqc%3D" class="w-24 h-24 rounded-md border border-gray-300"> </div> <div class="text-lg font-bold">DALL\xB7E</div> <div class="text-sm" style="min-height:80px; white-space: break-spaces; overflow-wrap: break-word;display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; overflow: hidden;word-break:break-word;">Let me turn your imagination into imagery</div> <div class="mt-1 flex items-center gap-1 text-token-text-tertiary"><div class="text-sm text-token-text-tertiary" style="white-space: break-spaces; overflow-wrap: break-word;display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden;word-break:break-word;">By ChatGPT</div></div> </div> </div><div class="flex flex-col w-full justify-start items-start gap-2 pe-3 pb-3" style="max-width: 25%;"> <div class="flex flex-col w-full h-full justify-start items-start gap-2 p-4 cursor-pointer bg-black/50 hover:bg-black hover:shadow-xl rounded-xl"> <div class="flex justify-center items-center w-24 h-24 rounded-md bg-gray-200"> <img src="https://files.oaiusercontent.com/file-id374Jq85g2WfDgpuOdAMTEk?se=2123-10-13T00%3A31%3A06Z&amp;sp=r&amp;sv=2021-08-06&amp;sr=b&amp;rscc=max-age%3D31536000%2C%20immutable&amp;rscd=attachment%3B%20filename%3Dagent_2.png&amp;sig=qFnFnFDVevdJL3xvtDE8vysDpTQmkSlF1zhYLAMiqmM%3D" class="w-24 h-24 rounded-md border border-gray-300"> </div> <div class="text-lg font-bold">Data Analysis</div> <div class="text-sm" style="min-height:80px; white-space: break-spaces; overflow-wrap: break-word;display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; overflow: hidden;word-break:break-word;">Drop in any files and I can help analyze and visualize your data</div> <div class="mt-1 flex items-center gap-1 text-token-text-tertiary"><div class="text-sm text-token-text-tertiary" style="white-space: break-spaces; overflow-wrap: break-word;display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden;word-break:break-word;">By ChatGPT</div></div> </div> </div><div class="flex flex-col w-full justify-start items-start gap-2 pe-3 pb-3" style="max-width: 25%;"> <div class="flex flex-col w-full h-full justify-start items-start gap-2 p-4 cursor-pointer bg-black/50 hover:bg-black hover:shadow-xl rounded-xl"> <div class="flex justify-center items-center w-24 h-24 rounded-md bg-gray-200"> <img src="https://files.oaiusercontent.com/file-i9IUxiJyRubSIOooY5XyfcmP?se=2123-10-13T01%3A11%3A31Z&amp;sp=r&amp;sv=2021-08-06&amp;sr=b&amp;rscc=max-age%3D31536000%2C%20immutable&amp;rscd=attachment%3B%20filename%3Dgpt-4.jpg&amp;sig=ZZP%2B7IWlgVpHrIdhD1C9wZqIvEPkTLfMIjx4PFezhfE%3D" class="w-24 h-24 rounded-md border border-gray-300"> </div> <div class="text-lg font-bold">ChatGPT Classic</div> <div class="text-sm" style="min-height:80px; white-space: break-spaces; overflow-wrap: break-word;display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; overflow: hidden;word-break:break-word;">The latest version of GPT-4 with no additional capabilities</div> <div class="mt-1 flex items-center gap-1 text-token-text-tertiary"><div class="text-sm text-token-text-tertiary" style="white-space: break-spaces; overflow-wrap: break-word;display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden;word-break:break-word;">By ChatGPT</div></div> </div> </div><div class="flex flex-col w-full justify-start items-start gap-2 pe-3 pb-3" style="max-width: 25%;"> <div class="flex flex-col w-full h-full justify-start items-start gap-2 p-4 cursor-pointer bg-black/50 hover:bg-black hover:shadow-xl rounded-xl"> <div class="flex justify-center items-center w-24 h-24 rounded-md bg-gray-200"> <img src="https://files.oaiusercontent.com/file-JxYoHzuJQ2TXHBYy6UGC4Xs8?se=2123-10-13T00%3A46%3A49Z&amp;sp=r&amp;sv=2021-08-06&amp;sr=b&amp;rscc=max-age%3D31536000%2C%20immutable&amp;rscd=attachment%3B%20filename%3Dc0bba883-a507-42dd-acfd-211509efd97c.png&amp;sig=jZeFDXgC4ZbNC8mVNuQK7zeKS7ssRCh5QTlqa81WJEM%3D" class="w-24 h-24 rounded-md border border-gray-300"> </div> <div class="text-lg font-bold">Game Time</div> <div class="text-sm" style="min-height:80px; white-space: break-spaces; overflow-wrap: break-word;display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; overflow: hidden;word-break:break-word;">I can quickly explain board games  or card games to players of any age. Let the games begin!</div> <div class="mt-1 flex items-center gap-1 text-token-text-tertiary"><div class="text-sm text-token-text-tertiary" style="white-space: break-spaces; overflow-wrap: break-word;display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden;word-break:break-word;">By ChatGPT</div></div> </div> </div><div class="flex flex-col w-full justify-start items-start gap-2 pe-3 pb-3" style="max-width: 25%;"> <div class="flex flex-col w-full h-full justify-start items-start gap-2 p-4 cursor-pointer bg-black/50 hover:bg-black hover:shadow-xl rounded-xl"> <div class="flex justify-center items-center w-24 h-24 rounded-md bg-gray-200"> <img src="https://files.oaiusercontent.com/file-MjvVb8L9Se5PdSC1gMLopCHh?se=2123-10-13T00%3A50%3A51Z&amp;sp=r&amp;sv=2021-08-06&amp;sr=b&amp;rscc=max-age%3D31536000%2C%20immutable&amp;rscd=attachment%3B%20filename%3Dnegotiator.png&amp;sig=GDq28k4lIHIZbvXfm9PjQerwO1kGUnkNn6a5aQD/7/M%3D" class="w-24 h-24 rounded-md border border-gray-300"> </div> <div class="text-lg font-bold">The Negotiator</div> <div class="text-sm" style="min-height:80px; white-space: break-spaces; overflow-wrap: break-word;display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; overflow: hidden;word-break:break-word;">I\u2019ll help you advocate for yourself  and get better outcomes. Become a great negotiator.</div> <div class="mt-1 flex items-center gap-1 text-token-text-tertiary"><div class="text-sm text-token-text-tertiary" style="white-space: break-spaces; overflow-wrap: break-word;display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden;word-break:break-word;">By ChatGPT</div></div> </div> </div><div class="flex flex-col w-full justify-start items-start gap-2 pe-3 pb-3" style="max-width: 25%;"> <div class="flex flex-col w-full h-full justify-start items-start gap-2 p-4 cursor-pointer bg-black/50 hover:bg-black hover:shadow-xl rounded-xl"> <div class="flex justify-center items-center w-24 h-24 rounded-md bg-gray-200"> <img src="https://files.oaiusercontent.com/file-KSheuuQR8UjcxzFjjSfjfEOP?se=2123-10-13T00%3A52%3A56Z&amp;sp=r&amp;sv=2021-08-06&amp;sr=b&amp;rscc=max-age%3D31536000%2C%20immutable&amp;rscd=attachment%3B%20filename%3Dcreative-writing.png&amp;sig=MA3AFe4yhExdlgBje00y4%2BCLHpBkJ%2BUQKkiwknp46as%3D" class="w-24 h-24 rounded-md border border-gray-300"> </div> <div class="text-lg font-bold">Creative Writing Coach</div> <div class="text-sm" style="min-height:80px; white-space: break-spaces; overflow-wrap: break-word;display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; overflow: hidden;word-break:break-word;">I\u2019m eager to read your work  and give you feedback to improve your skills.</div> <div class="mt-1 flex items-center gap-1 text-token-text-tertiary"><div class="text-sm text-token-text-tertiary" style="white-space: break-spaces; overflow-wrap: break-word;display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden;word-break:break-word;">By ChatGPT</div></div> </div> </div><div class="flex flex-col w-full justify-start items-start gap-2 pe-3 pb-3" style="max-width: 25%;"> <div class="flex flex-col w-full h-full justify-start items-start gap-2 p-4 cursor-pointer bg-black/50 hover:bg-black hover:shadow-xl rounded-xl"> <div class="flex justify-center items-center w-24 h-24 rounded-md bg-gray-200"> <img src="https://files.oaiusercontent.com/file-M12eDkWHmobmgj5mhcWkMMVI?se=2123-10-13T07%3A48%3A21Z&amp;sp=r&amp;sv=2021-08-06&amp;sr=b&amp;rscc=max-age%3D31536000%2C%20immutable&amp;rscd=attachment%3B%20filename%3D28de0bdd-4c74-45a4-8d52-0fac85aea31a.png&amp;sig=KdG%2BVt6/480jvqtjdwa4DulLX7BRqVN6FQfuuS9QaVI%3D" class="w-24 h-24 rounded-md border border-gray-300"> </div> <div class="text-lg font-bold">Cosmic Dream</div><div class="text-sm" style="min-height:80px; white-space: break-spaces; overflow-wrap: break-word;display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; overflow: hidden;word-break:break-word;">Visionary painter of digital wonder</div> <div class="mt-1 flex items-center gap-1 text-token-text-tertiary"><div class="text-sm text-token-text-tertiary" style="white-space: break-spaces; overflow-wrap: break-word;display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden;word-break:break-word;">By ChatGPT</div></div> </div> </div><div class="flex flex-col w-full justify-start items-start gap-2 pe-3 pb-3" style="max-width: 25%;"> <div class="flex flex-col w-full h-full justify-start items-start gap-2 p-4 cursor-pointer bg-black/50 hover:bg-black hover:shadow-xl rounded-xl"> <div class="flex justify-center items-center w-24 h-24 rounded-md bg-gray-200"> <img src="https://files.oaiusercontent.com/file-soqNFMszjoxK9d3BFD3rAGA5?se=2123-10-13T00%3A53%3A58Z&amp;sp=r&amp;sv=2021-08-06&amp;sr=b&amp;rscc=max-age%3D31536000%2C%20immutable&amp;rscd=attachment%3B%20filename%3DTechSupport.jpg&amp;sig=ztG5CVAIZeK5/C/wQkWdewTJVlXtRmmSRd5Z7XRsJ04%3D" class="w-24 h-24 rounded-md border border-gray-300"> </div> <div class="text-lg font-bold">Tech Support Advisor</div> <div class="text-sm" style="min-height:80px; white-space: break-spaces; overflow-wrap: break-word;display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; overflow: hidden;word-break:break-word;">From setting up a printer to troubleshooting a device, I\u2019m here to help you step-by-step.</div> <div class="mt-1 flex items-center gap-1 text-token-text-tertiary"><div class="text-sm text-token-text-tertiary" style="white-space: break-spaces; overflow-wrap: break-word;display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden;word-break:break-word;">By ChatGPT</div></div></div></div></div>'}function showGizmoAboutDialog(e,t=!1){const o=e.tools.map(m=>m.type).filter((m,g,p)=>p.indexOf(m)===g),r=e?.gizmo?.display?.name,n=e?.gizmo?.author?.display_name||"community builder",i=e&&e?.gizmo?.author?.link_to||"",a=i?`<a href="${i}" target="_blank" class="underline">${n}</a>`:n,s=e?.about_blocks?.find(m=>m.type==="rating"),l=e?.about_blocks?.find(m=>m.type==="category"),d=e?.about_blocks?.find(m=>m.type==="generic_title_subtitle"),c=e?.gizmo?.display?.prompt_starters.sort(()=>Math.random()-.5).slice(0,4),u=`<div id="gizmo-about-dialog" class="absolute inset-0" style="z-index:100001">
  <div data-state="open" class="fixed inset-0 bg-black/50 dark:bg-black/80" style="pointer-events: auto;">
    <div class="grid h-full w-full grid-cols-[10px_1fr_10px] grid-rows-[minmax(10px,_1fr)_auto_minmax(10px,_1fr)] overflow-y-auto md:grid-rows-[minmax(20px,_1fr)_auto_minmax(20px,_1fr)]" style="opacity: 1; transform: none;">
      <div role="dialog" id="gizmo-about-dialog-content" aria-describedby="radix-:r6c:" aria-labelledby="radix-:r6b:" data-state="open" class="popover relative start-1/2 ltr:-translate-x-1/2 rtl:translate-x-1/2 col-auto col-start-2 row-auto row-start-2 w-full rounded-xl bg-token-main-surface-primary text-start shadow-xl transition-all flex flex-col focus:outline-none max-w-md flex h-[calc(100vh-25rem)] min-h-[80vh] max-w-xl" tabindex="-1" style="pointer-events: auto;">
        <div class="flex-grow overflow-y-auto">
          <div class="relative flex h-full flex-col gap-2 overflow-hidden px-2 py-4">
            <div id="gizmo-about-dialog-inner-content" class="relative flex flex-grow flex-col gap-4 overflow-y-auto px-6 pb-20 pt-16">
              <div class="absolute top-0">
                <div class="fixed start-4 end-4 z-10 flex min-h-[64px] items-start justify-end gap-4 bg-gradient-to-b from-token-main-surface-primary to-transparent px-2">
                  <button id="gizmo-about-menu-button" type="button" aria-haspopup="menu" aria-expanded="false" data-state="closed" class="hidden text-token-text-primary border border-transparent inline-flex h-9 items-center justify-center gap-1 rounded-lg bg-white px-3 text-sm dark:transparent dark:bg-transparent leading-none outline-none cursor-pointer hover:bg-token-main-surface-secondary dark:hover:bg-token-main-surface-secondary focus-visible:border-green-500 dark:focus-visible:border-green-500 radix-state-active:text-token-text-tertiary radix-disabled:cursor-auto radix-disabled:bg-transparent radix-disabled:text-token-text-tertiary dark:radix-disabled:bg-transparent focus:border-0">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                      xmlns="http://www.w3.org/2000/svg" class="text-token-text-tertiary hover:text-token-text-tertiary">
                      <path fill-rule="evenodd" clip-rule="evenodd" d="M3 12C3 10.8954 3.89543 10 5 10C6.10457 10 7 10.8954 7 12C7 13.1046 6.10457 14 5 14C3.89543 14 3 13.1046 3 12ZM10 12C10 10.8954 10.8954 10 12 10C13.1046 10 14 10.8954 14 12C14 13.1046 13.1046 14 12 14C10.8954 14 10 13.1046 10 12ZM17 12C17 10.8954 17.8954 10 19 10C20.1046 10 21 10.8954 21 12C21 13.1046 20.1046 14 19 14C17.8954 14 17 13.1046 17 12Z" fill="currentColor"></path>
                    </svg>
                  </button>
                  <button id="gizmo-about-close-button" class="text-token-text-tertiary hover:text-token-text-tertiary">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                      xmlns="http://www.w3.org/2000/svg">
                      <path d="M6.34315 6.34338L17.6569 17.6571M17.6569 6.34338L6.34315 17.6571" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                    </svg>
                  </button>
                </div>
              </div>
              <div class="absolute bottom-[64px]">
                <div class="fixed start-4 end-4 z-10 flex min-h-[64px] items-end bg-gradient-to-t from-token-main-surface-primary to-transparent px-2">
                  ${t?`<div class="flex flex-grow flex-col items-center"><a target="_self" class="btn relative composer-submit-btn composer-submit-button-color h-12 w-full" as="link" to="/g/${e.gizmo.short_url}" href="/g/${e.gizmo.short_url}"><div class="flex w-full gap-2 items-center justify-center"><svg width="24" height="24" viewBox="0 0 24 25" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-lg"><g id="chat"><path id="vector" fill-rule="evenodd" clip-rule="evenodd" d="M12 4.5C7.58172 4.5 4 8.08172 4 12.5C4 14.6941 4.88193 16.6802 6.31295 18.1265C6.6343 18.4513 6.69466 18.9526 6.45959 19.3443L5.76619 20.5H12C16.4183 20.5 20 16.9183 20 12.5C20 8.08172 16.4183 4.5 12 4.5ZM2 12.5C2 6.97715 6.47715 2.5 12 2.5C17.5228 2.5 22 6.97715 22 12.5C22 18.0228 17.5228 22.5 12 22.5H4C3.63973 22.5 3.30731 22.3062 3.1298 21.9927C2.95229 21.6792 2.95715 21.2944 3.14251 20.9855L4.36137 18.9541C2.88894 17.2129 2 14.9595 2 12.5Z" fill="currentColor"></path></g></svg>Start Chat</div></a></div>`:""}
                </div>
              </div>
              <div class="flex h-full flex-col items-center justify-center text-token-text-primary !h-fit">
                <div class="relative">
                  <div class="mb-3 h-12 w-12 !h-20 !w-20">
                    <div class="gizmo-shadow-stroke overflow-hidden rounded-full">
                      <img src="${e.gizmo.display.profile_picture_url}" class="h-full w-full bg-token-main-surface-secondary" alt="GPT" width="80" height="80">
                      </div>
                    </div>
                  </div>
                  <div class="flex flex-col items-center gap-2">
                    <div class="text-center text-2xl font-medium">${r}</div>
                    <div class="flex items-center gap-1 text-token-text-tertiary">
                      <div class="mt-1 flex flex-row items-center space-x-1">
                        <div class="text-sm text-token-text-tertiary">By ${a}</div>
                        <div>
                          <div title="The builder of this GPT cannot view your conversations." class="my-2" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:r6f:" data-state="closed">
                            <div class="flex items-center gap-1 rounded-xl bg-token-main-surface-secondary px-2 py-1">
                              <svg width="24" height="24" viewBox="0 0 20 20" fill="red"
                                xmlns="http://www.w3.org/2000/svg" class="icon icon-xs text-token-text-tertiary">
                                <path id="vector" fill-rule="evenodd" clip-rule="evenodd" d="M0 10C0 4.47715 4.47715 0 10 0C15.5228 0 20 4.47715 20 10C20 15.5228 15.5228 20 10 20C4.47715 20 0 15.5228 0 10ZM9.98514 2.00291C9.99328 2.00046 9.99822 2.00006 9.99964 2C10.001 2.00006 10.0067 2.00046 10.0149 2.00291C10.0256 2.00615 10.047 2.01416 10.079 2.03356C10.2092 2.11248 10.4258 2.32444 10.675 2.77696C10.9161 3.21453 11.1479 3.8046 11.3486 4.53263C11.6852 5.75315 11.9156 7.29169 11.981 9H8.01901C8.08442 7.29169 8.3148 5.75315 8.65137 4.53263C8.85214 3.8046 9.08392 3.21453 9.32495 2.77696C9.57422 2.32444 9.79081 2.11248 9.92103 2.03356C9.95305 2.01416 9.97437 2.00615 9.98514 2.00291ZM6.01766 9C6.08396 7.13314 6.33431 5.41167 6.72334 4.00094C6.87366 3.45584 7.04762 2.94639 7.24523 2.48694C4.48462 3.49946 2.43722 5.9901 2.06189 9H6.01766ZM2.06189 11H6.01766C6.09487 13.1737 6.42177 15.1555 6.93 16.6802C7.02641 16.9694 7.13134 17.2483 7.24522 17.5131C4.48461 16.5005 2.43722 14.0099 2.06189 11ZM8.01901 11H11.981C11.9045 12.9972 11.6027 14.7574 11.1726 16.0477C10.9206 16.8038 10.6425 17.3436 10.3823 17.6737C10.2545 17.8359 10.1506 17.9225 10.0814 17.9649C10.0485 17.9852 10.0264 17.9935 10.0153 17.9969C10.0049 18.0001 9.99994 18 9.99994 18C9.99994 18 9.99479 18 9.98471 17.9969C9.97356 17.9935 9.95155 17.9852 9.91857 17.9649C9.84943 17.9225 9.74547 17.8359 9.61768 17.6737C9.35747 17.3436 9.0794 16.8038 8.82736 16.0477C8.39726 14.7574 8.09547 12.9972 8.01901 11ZM13.9823 11C13.9051 13.1737 13.5782 15.1555 13.07 16.6802C12.9736 16.9694 12.8687 17.2483 12.7548 17.5131C15.5154 16.5005 17.5628 14.0099 17.9381 11H13.9823ZM17.9381 9C17.5628 5.99009 15.5154 3.49946 12.7548 2.48694C12.9524 2.94639 13.1263 3.45584 13.2767 4.00094C13.6657 5.41167 13.916 7.13314 13.9823 9H17.9381Z" fill="currentColor"></path>
                              </svg>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="max-w-md text-center text-sm font-normal text-token-text-primary">${e.gizmo.display.description}</div>
                  </div>
                </div>
                <div class="flex justify-center">
                  ${s?`<div class="flex flex-col justify-center items-center gap-2 border-s border-token-border-medium first:border-0 w-48 mt-4 px-2">
                    <div class="flex flex-row items-center gap-1.5 pt-1 text-xl font-medium text-center leading-none">
                      <svg width="24" height="24" viewBox="0 0 39 39" fill="none"
                        xmlns="http://www.w3.org/2000/svg" class="icon icon-sm">
                        <path d="M15.6961 2.70609C17.4094 -0.33367 21.7868 -0.333671 23.5002 2.70609L27.237 9.33591C27.3648 9.56271 27.585 9.72268 27.8402 9.77418L35.3003 11.2794C38.7207 11.9695 40.0734 16.1327 37.7119 18.7015L32.5613 24.3042C32.3851 24.4958 32.301 24.7547 32.3309 25.0133L33.2046 32.5734C33.6053 36.0397 30.0639 38.6127 26.891 37.1605L19.971 33.9933C19.7342 33.885 19.4621 33.885 19.2253 33.9933L12.3052 37.1605C9.1324 38.6127 5.59103 36.0397 5.99163 32.5734L6.86537 25.0133C6.89526 24.7547 6.81116 24.4958 6.63496 24.3042L1.48438 18.7015C-0.877157 16.1327 0.475528 11.9695 3.89596 11.2794L11.356 9.77418C11.6113 9.72268 11.8314 9.56271 11.9593 9.33591L15.6961 2.70609Z" fill="currentColor"></path>
                      </svg>${s.avg}
                    </div>
                    <div class="text-xs text-token-text-tertiary">${s.count_str}</div>
                  </div>`:""}
                  ${l?`<div class="flex flex-col justify-center items-center gap-2 border-s border-token-border-medium first:border-0 w-48 mt-4 px-2">
                    <div class="flex flex-row items-center gap-1.5 pt-1 text-xl font-medium text-center leading-none">${l.category_ranking?`#${l.category_ranking}`:l.category_str}</div>
                    <div class="text-xs text-token-text-tertiary">${l.category_ranking?`in ${l.category_str} ${l.category_locale_str}`:"Category"}</div>
                  </div>`:""}
                  ${d?`<div class="flex flex-col justify-center items-center gap-2 border-s border-token-border-medium first:border-0 w-48 mt-4 px-2">
                    <div class="flex flex-row items-center gap-1.5 pt-1 text-xl font-medium text-center leading-none">${d.title}</div>
                    <div class="text-xs text-token-text-tertiary">${d.subtitle}</div>
                  </div>`:""}
                </div>
                <div class="flex flex-col">
                  <div class="font-bold mt-6">Conversation Starters</div>
                  <div class="mt-4 grid grid-cols-2 gap-x-1.5 gap-y-2">
                    ${c.map(m=>`<div class="flex" tabindex="0">
                      <a class="group border-token-border-medium bg-token-main-surface-primary hover:bg-token-main-surface-secondary relative ms-2 h-14 min-w-full grow rounded-xl border px-4 focus:outline-hidden" target="_self" href="/g/${e.gizmo.short_url}?p=${m}">
                        <div class="flex h-full items-center">
                          <div class="text-sm line-clamp-2 break-all">${m}</div>
                        </div>
                        <div class="border-token-border-medium bg-token-main-surface-primary group-hover:bg-token-main-surface-secondary absolute -start-2 -bottom-px h-3 w-4 border-b">
                          <div class="border-token-border-medium bg-token-main-surface-primary h-3 w-2 rounded-ee-full border-e border-b"></div>
                        </div>
                        <div class="absolute bottom-0 end-2 top-0 items-center hidden group-hover:flex">
                          <div class="flex h-8 w-8 items-center justify-center rounded-lg bg-token-main-surface-primary">
                            <svg width="24" height="24" viewBox="0 0 24 25" fill="none"
                              xmlns="http://www.w3.org/2000/svg" class="icon icon-md text-token-text-primary">
                              <g id="chat">
                                <path id="vector" fill-rule="evenodd" clip-rule="evenodd" d="M12 4.5C7.58172 4.5 4 8.08172 4 12.5C4 14.6941 4.88193 16.6802 6.31295 18.1265C6.6343 18.4513 6.69466 18.9526 6.45959 19.3443L5.76619 20.5H12C16.4183 20.5 20 16.9183 20 12.5C20 8.08172 16.4183 4.5 12 4.5ZM2 12.5C2 6.97715 6.47715 2.5 12 2.5C17.5228 2.5 22 6.97715 22 12.5C22 18.0228 17.5228 22.5 12 22.5H4C3.63973 22.5 3.30731 22.3062 3.1298 21.9927C2.95229 21.6792 2.95715 21.2944 3.14251 20.9855L4.36137 18.9541C2.88894 17.2129 2 14.9595 2 12.5Z" fill="currentColor"></path>
                              </g>
                            </svg>
                          </div>
                        </div>
                      </a>
                    </div>`).join("")}
                  </div>
                </div>
                <div class="flex flex-col">
                  <div class="font-bold mt-6 mb-2">Capabilities</div>
                  ${o.map(m=>`<div class="flex flex-row items-start gap-2 py-1 text-sm">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                      xmlns="http://www.w3.org/2000/svg" class="icon icon-sm mt-0.5 text-green-600">
                      <path fill-rule="evenodd" clip-rule="evenodd" d="M18.0633 5.67375C18.5196 5.98487 18.6374 6.607 18.3262 7.06331L10.8262 18.0633C10.6585 18.3093 10.3898 18.4678 10.0934 18.4956C9.79688 18.5234 9.50345 18.4176 9.29289 18.2071L4.79289 13.7071C4.40237 13.3166 4.40237 12.6834 4.79289 12.2929C5.18342 11.9023 5.81658 11.9023 6.20711 12.2929L9.85368 15.9394L16.6738 5.93664C16.9849 5.48033 17.607 5.36263 18.0633 5.67375Z" fill="currentColor"></path>
                    </svg>
                    <div>${toolPrettyName(m)}
                      ${m==="plugins_prototype"?'<div class="text-xs text-token-text-tertiary">Retrieves or takes actions outside of ChatGPT</div>':""}
                    </div>
                  </div>`).join("")}
                </div>
                <div class="flex flex-col">
                  <div class="mb-2">
                    <div class="font-bold mt-6">Ratings</div>
                  </div>
                ${e?.review_stats?.by_rating.length>0?`${e?.review_stats?.by_rating?.reverse()?.map((m,g)=>`
                  <div class="flex flex-row items-center gap-2 py-1 text-xl font-medium">
                    <div class="icon icon-lg relative">
                      <svg width="24" height="24" viewBox="0 0 39 39" fill="none"
                        xmlns="http://www.w3.org/2000/svg" class="icon icon-lg text-green-500">
                        <path d="M15.6961 2.70609C17.4094 -0.33367 21.7868 -0.333671 23.5002 2.70609L27.237 9.33591C27.3648 9.56271 27.585 9.72268 27.8402 9.77418L35.3003 11.2794C38.7207 11.9695 40.0734 16.1327 37.7119 18.7015L32.5613 24.3042C32.3851 24.4958 32.301 24.7547 32.3309 25.0133L33.2046 32.5734C33.6053 36.0397 30.0639 38.6127 26.891 37.1605L19.971 33.9933C19.7342 33.885 19.4621 33.885 19.2253 33.9933L12.3052 37.1605C9.1324 38.6127 5.59103 36.0397 5.99163 32.5734L6.86537 25.0133C6.89526 24.7547 6.81116 24.4958 6.63496 24.3042L1.48438 18.7015C-0.877157 16.1327 0.475528 11.9695 3.89596 11.2794L11.356 9.77418C11.6113 9.72268 11.8314 9.56271 11.9593 9.33591L15.6961 2.70609Z" fill="currentColor"></path>
                      </svg>
                      <div class="absolute inset-0 flex items-center justify-center text-[11px] text-white">${5-g}</div>
                    </div>
                    <div class="h-2.5 flex-grow overflow-hidden rounded-full bg-gray-100 dark:bg-gray-700">
                      <div class="h-full bg-green-500" style="width: ${m*100}%;"></div>
                    </div>
                  </div>`).join("")}
                `:'<div class="text-sm text-token-text-tertiary">Not enough ratings yet</div>'}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>`;document.body.insertAdjacentHTML("beforeend",u),document.querySelector("#gizmo-about-close-button").addEventListener("click",()=>{document.querySelector("#gizmo-about-dialog").remove()}),document.body.addEventListener("click",m=>{const g=document.querySelector("#gizmo-about-dialog-content");g&&!isDescendant(g,m.target)&&document.querySelector("#gizmo-about-dialog").remove()}),getGizmosByUser(e?.gizmo?.author?.user_id).then(m=>{const g=m.items;if(g.length===0)return;const p=`<div class="flex flex-col"><div class="mb-2"><div class="font-bold mt-6">More by ${e.gizmo.author.display_name}</div></div><div class="no-scrollbar group flex min-h-[104px] items-center space-x-2 overflow-x-auto overflow-y-hidden">
      ${g.map(h=>`
      <a href="/g/${h.gizmo.short_url}" class="h-fit min-w-fit-sp rounded-xl bg-token-main-surface-secondary px-1 py-4 md:px-3 md:py-4 lg:px-3"><div class="flex w-full flex-grow items-center gap-4 overflow-hidden"><div class="h-12 w-12 flex-shrink-0"><div class="gizmo-shadow-stroke overflow-hidden rounded-full"><img src="${h.gizmo.display.profile_picture_url}" class="h-full w-full bg-token-main-surface-secondary" alt="GPT" width="80" height="80"></div></div><div class="overflow-hidden text-ellipsis break-words"><span class="text-sm font-medium leading-tight line-clamp-2">${h.gizmo.display.name}</span><span class="text-xs line-clamp-3">${h.gizmo.display.description}</span><div class="mt-1 flex items-center gap-1 text-ellipsis whitespace-nowrap pe-1 text-xs text-token-text-tertiary"><div class="mt-1 flex flex-row items-center space-x-1"><div class="text-token-text-tertiary text-xs">By ${h.gizmo.author.display_name}</div></div><span class="text-[8px]">\u2022</span><svg width="24" height="24" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" class="h-3 w-3"><path id="vector" fill-rule="evenodd" clip-rule="evenodd" d="M9 2.33317C5.31811 2.33317 2.33334 5.31794 2.33334 8.99984C2.33334 10.8282 3.06828 12.4833 4.2608 13.6886C4.52859 13.9592 4.57889 14.377 4.383 14.7034L3.80516 15.6665H9C12.6819 15.6665 15.6667 12.6817 15.6667 8.99984C15.6667 5.31794 12.6819 2.33317 9 2.33317ZM0.666672 8.99984C0.666672 4.39746 4.39763 0.666504 9 0.666504C13.6024 0.666504 17.3333 4.39746 17.3333 8.99984C17.3333 13.6022 13.6024 17.3332 9 17.3332H2.33334C2.03311 17.3332 1.75609 17.1717 1.60817 16.9104C1.46025 16.6492 1.4643 16.3285 1.61876 16.0711L2.63448 14.3782C1.40745 12.9272 0.666672 11.0494 0.666672 8.99984Z" fill="currentColor"></path></svg>${h.gizmo.vanity_metrics.num_conversations_str}</div></div></div></a>`).join("")}  
    </div></div>`;document.querySelector("#gizmo-about-dialog-inner-content")?.insertAdjacentHTML("beforeend",p)})}function toolPrettyName(e){switch(e){case"browser":return"Browsing";case"python":return"Data Analysis";case"dalle":return"DALL\u2022E";case"plugins_prototype":return"Actions";default:return e}}function openUpgradeModal(e=!1){chrome.storage.local.set({lastSubscriptionCheck:null}),chrome.storage.local.get({STRIPE_PAYMENT_LINK_ID:"8wM5nW6oq7y287ufZ8",STRIPE_PORTAL_LINK_ID:"00g0237Sr78wcM03cc"},t=>{const o=e?"":'<span class="text-xs self-end pb-1">Limited time offer</span>',r=e?"":'USD <span class="line-through">$19.99</span> <span>$10/month <span class="text-xs">(billed yearly) - or - $15/mo (billed monthly)</span></span>';chrome.storage.sync.get(["email"],({email:n})=>{const i=`<div id="upgrade-to-pro-modal" class="absolute inset-0 h-full w-full bg-token-main-surface-primary shadow-xl bg-payment-modal" style="z-index:100000;"><div data-state="open" class="fixed inset-0" style="pointer-events:auto;"><div class="h-full w-full grid grid-cols-[10px_1fr_10px] grid-rows-[minmax(10px,1fr)_auto_minmax(10px,1fr)] md:grid-rows-[minmax(20px,1fr)_auto_minmax(20px,1fr)] overflow-y-auto"><div role="dialog" data-state="open" class="relative col-auto col-start-2 row-auto row-start-2 w-full rounded-xl text-start shadow-xl transition-all start-1/2 ltr:-translate-x-1/2 rtl:translate-x-1/2 focus-none !bg-transparent !shadow-none outline-none" tabindex="-1" style="pointer-events:auto; max-width:fit-content;"><div class=""><div class="focus-none flex h-full flex-col items-center justify-start outline-none"><div class="relative"><div id="upgrade-to-pro-modal-content" class="flex grow justify-center rounded-md flex-col items-start overflow-hidden border shadow-md dark:border-gray-600"><div class="flex w-full flex-row items-center justify-between border-b border-token-border-medium bg-token-main-surface-primary px-8 py-6"><span class="text-xl font-medium">${e?"Superpower ChatGPT Pro Plan":"Upgrade Superpower ChatGPT Plan"}</span><button id="upgrade-modal-close-button" class="text-token-text-primary opacity-50 transition hover:opacity-75"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button></div><div class="flex flex-col md:flex-row">${e?"":`
      <div class="text-sm relative flex-1 flex gap-5 flex-col border-t py-4 px-6 border-token-border-medium border-e last:border-e-0 border-t-0" style="max-width:550px;">
        <div class="relative flex flex-col">
          <div class="flex flex-col gap-1">
            <p class="flex items-center gap-2 text-xl font-medium">Free</p>
            <p class="text-base font-light text-token-text-tertiary">USD $0/month</p>
          </div>
        </div>
        <div class="relative flex flex-col">
          <button class="opacity-50 hover:bg-inherit cursor-not-allowed btn relative btn-disabled py-3 font-semibold bg-token-sidebar-surface-secondary" disabled="">
            <div class="flex w-full gap-2 items-center justify-center">Your current plan</div>
          </button>
        </div>
        <div class="flex flex-col flex-grow gap-2">
          <div class="relative flex flex-col">
            <p class="text-l font-medium">For people just getting started with Superpower ChatGPT</p>
          </div>
          <div class="relative">
            <div class="text-l flex justify-start gap-2">
              <div class=" flex-shrink-0">
                <svg
                  xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md">
                  <path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path>
                </svg>
              </div>
              <span>Create Folders and Subfolders and Search Conversations*</span>
            </div>
          </div>
          <div class="relative">
            <div class="text-l flex justify-start gap-2">
              <div class=" flex-shrink-0">
                <svg
                  xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md">
                  <path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path>
                </svg>
              </div>
              <span>Create Multiple Custom Instruction Profiles*</span>
            </div>
          </div>
          <div class="relative">
            <div class="text-l flex justify-start gap-2">
              <div class=" flex-shrink-0">
                <svg
                  xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md">
                  <path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path>
                </svg>
              </div>
              <span>Prompt Chains, Prompt Optimizer, Prompt Templates, and Favorite Prompts*</span>
            </div>
          </div>
          <div class="relative">
            <div class="text-l flex justify-start gap-2">
              <div class=" flex-shrink-0">
                <svg
                  xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md">
                  <path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path>
                </svg>
              </div>
              <span>Prompt History, Favorite Prompts, and Public Prompts</span>
            </div>
          </div>
          <div class="relative">
            <div class="text-l flex justify-start gap-2">
              <div class=" flex-shrink-0">
                <svg
                  xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md">
                  <path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path>
                </svg>
              </div>
              <span>Minimap to see an overview of the entire conversation withouth scrolling</span>
            </div>
          </div>
          <div class="relative">
            <div class="text-l flex justify-start gap-2">
              <div class=" flex-shrink-0">
                <svg
                  xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md">
                  <path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path>
                </svg>
              </div>
              <span>Hide/show Custom GPT list and sort alphabetically</span>
            </div>
          </div>
          <div class="relative">
            <div class="text-l flex justify-start gap-2">
              <div class=" flex-shrink-0">
                <svg
                  xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md">
                  <path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path>
                </svg>
              </div>
              <span>Override default model switcher to access all available models</span>
            </div>
          </div>
          <div class="relative">
            <div class="text-l flex justify-start gap-2">
              <div class=" flex-shrink-0">
                <svg
                  xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md">
                  <path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path>
                </svg>
              </div>
              <span>Pinned Messages for Easy Access*</span>
            </div>
          </div>
          <div class="relative">
            <div class="text-l flex justify-start gap-2">
              <div class=" flex-shrink-0">
                <svg
                  xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md">
                  <path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path>
                </svg>
              </div>
              <span>Export Chats in Multiple Formats(PDF, Text, Markdown, JSON)</span>
            </div>
          </div>
          <div class="relative">
            <div class="text-l flex justify-start gap-2">
              <div class=" flex-shrink-0">
                <svg
                  xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md">
                  <path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path>
                </svg>
              </div>
              <span>Word and Character counters</span>
            </div>
          </div>
          <div class="relative">
            <div class="text-l flex justify-start gap-2">
              <div class=" flex-shrink-0">
                <svg
                  xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md">
                  <path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path>
                </svg>
              </div>
              <span>Language, Tone, and Writing Style Selector</span>
            </div>
          </div>
          <div class="texs-xs text-token-text-tertiary">*Limits apply</div>
        </div>
      </div>`}
      
      <div class="text-sm relative flex-1 flex gap-5 flex-col border-t py-4 px-6 border-token-border-medium border-e last:border-e-0 border-t-0" style="max-width:550px;"><div class="relative flex flex-col"><div class="flex flex-col gap-1"><p class="flex items-center gap-2 text-xl font-medium"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" style="width:20px;height:20px;margin-right:6px" stroke="gold" fill="gold"><path d="M240.5 224H352C365.3 224 377.3 232.3 381.1 244.7C386.6 257.2 383.1 271.3 373.1 280.1L117.1 504.1C105.8 513.9 89.27 514.7 77.19 505.9C65.1 497.1 60.7 481.1 66.59 467.4L143.5 288H31.1C18.67 288 6.733 279.7 2.044 267.3C-2.645 254.8 .8944 240.7 10.93 231.9L266.9 7.918C278.2-1.92 294.7-2.669 306.8 6.114C318.9 14.9 323.3 30.87 317.4 44.61L240.5 224z"/></svg>Pro ${o}</p><p class="text-base font-light text-token-text-tertiary">${r}</p></div></div><div class="relative flex flex-col"><div class="relative w-full"><span class="" data-state="closed"><button id="upgrade-modal-confirm-button" class="btn relative composer-submit-btn composer-submit-button-color w-full py-3 py-3 font-semibold ${e?"opacity-50 hover:bg-inherit cursor-not-allowed btn-disabled bg-token-sidebar-surface-secondary":""}" data-testid="select-plan-button-plus-waitlist">${e?'<div class="flex w-full gap-2 items-center justify-center text-token-text-tertiary">Your current plan</div>':`<a class="flex w-full items-center justify-center" target="_self" href="https://buy.stripe.com/${t.STRIPE_PAYMENT_LINK_ID||"8wM5nW6oq7y287ufZ8"}?prefilled_email=${encodeURIComponent(n)}">Upgrade to Pro</a>`}</button></span></div></div><div class="flex flex-col flex-grow gap-2"><div class="relative flex flex-col">${e?"":'<p class="text-l font-medium">Everything in Free, and:</p>'}</div>

      <div class="relative"><div class="text-l flex justify-start gap-2"><div class=" flex-shrink-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md"><path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path></svg></div><span><b>Advanced Prompt Managment.</b> Manage all your prompts in one place with <b>NO LIMIT</b>. <a class="text-token-link" style="text-decoration:underline;" href="https://youtu.be/owStC5nLIF4" target="blank">Watch Demo \u279C</a></span></div></div>

      <div class="relative"><div class="text-l flex justify-start gap-2"><div class=" flex-shrink-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md"><path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path></svg></div><span><span style="background-color: rgb(239, 65, 70); color: white; padding: 2px 8px; border-radius: 8px; font-size: 0.7em; margin-right: 8px;">New</span><b>Prompt Optimizer.</b> Optimize your prompt with one click. </span></div></div>

      <div class="relative"><div class="text-l flex justify-start gap-2"><div class=" flex-shrink-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md"><path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path></svg></div><span><b>Image gallery.</b> Search, See Prompt and Download all Images in One Place. <a class="text-token-link" style="text-decoration:underline;" href="https://www.youtube.com/watch?v=oU6_wgJLYEM&ab_channel=Superpower" target="blank">Watch Demo \u279C</a></span></div></div>

      <div class="relative"><div class="text-l flex justify-start gap-2"><div class=" flex-shrink-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md"><path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path></svg></div><span><b>Notes.</b> Save notes for each conversation and automatically sync them across all your devices. <a class="text-token-link" style="text-decoration:underline;" href="https://www.youtube.com/watch?v=pYAzc8zCQM0" target="blank">Watch Demo \u279C</a></span></div></div>

      <div class="relative"><div class="text-l flex justify-start gap-2"><div class=" flex-shrink-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md"><path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path></svg></div><span><span style="background-color: rgb(239, 65, 70); color: white; padding: 2px 8px; border-radius: 8px; font-size: 0.7em; margin-right: 8px;">New</span><b>Reference chats.</b> Reference older conversations in a new conversation with one click. <a class="text-token-link" style="text-decoration:underline;" href="https://youtu.be/MmktqRvo3E8" target="blank">Watch Demo \u279C</a></span></div></div>

      <div class="relative"><div class="text-l flex justify-start gap-2"><div class=" flex-shrink-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md"><path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path></svg></div><span><span style="background-color: rgb(239, 65, 70); color: white; padding: 2px 8px; border-radius: 8px; font-size: 0.7em; margin-right: 8px;">New</span><b>Side-by-side Voice Mode.</b> Easily talk to ChatGPT and see the conversation at the same time. <a class="text-token-link" style="text-decoration:underline;" href="https://youtu.be/StONQDxnCM4" target="blank">Watch Demo \u279C</a></span></div></div>

      <div class="relative"><div class="text-l flex justify-start gap-2"><div class=" flex-shrink-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md"><path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path></svg></div><span><span style="background-color: rgb(239, 65, 70); color: white; padding: 2px 8px; border-radius: 8px; font-size: 0.7em; margin-right: 8px;">New</span><b>Download Audio.</b> Download ChatGPT responses in audio format. </span></div></div>
      
      <div class="relative"><div class="text-l flex justify-start gap-2"><div class=" flex-shrink-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md"><path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path></svg></div><span><b>Auto Folder.</b> Create folders for Custom GPT conversations automatically. <a class="text-token-link" style="text-decoration:underline;" href="https://youtu.be/f1B7Os_3Xg4" target="blank">Watch Demo \u279C</a></span></div></div>

      <div class="relative"><div class="text-l flex justify-start gap-2"><div class=" flex-shrink-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md"><path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path></svg></div><span><span style="background-color: rgb(239, 65, 70); color: white; padding: 2px 8px; border-radius: 8px; font-size: 0.7em; margin-right: 8px;">New</span><b>Auto delete and auto archive.</b> Automatically delete or archive older conversations after a certain number of days. <a class="text-token-link" style="text-decoration:underline;" href="https://youtu.be/mMhOtMZwyOw" target="blank">Watch Demo \u279C</a></span></div></div>

      <div class="relative"><div class="text-l flex justify-start gap-2"><div class=" flex-shrink-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md"><path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path></svg></div><span><span style="background-color: rgb(239, 65, 70); color: white; padding: 2px 8px; border-radius: 8px; font-size: 0.7em; margin-right: 8px;">New</span><b>Right click menu.</b> Send screenshots and run all your favorite prompts, on any website, from the right click menu. <a class="text-token-link" style="text-decoration:underline;" href="https://youtu.be/dvPyNrDtwLo" target="blank">Watch Demo \u279C</a></span></div></div>

      <div class="relative"><div class="text-l flex justify-start gap-2"><div class=" flex-shrink-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md"><path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path></svg></div><span><b>Enhanced GPT Store.</b> Access to full list of all GPTs in the store. With the ability to search and sort by most popular. <a class="text-token-link" style="text-decoration:underline;" href="https://www.youtube.com/watch?v=q1VUONah6fE&ab_channel=Superpower" target="blank">Watch Demo \u279C</a></span></div></div>

      <div class="relative"><div class="text-l flex justify-start gap-2"><div class=" flex-shrink-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md"><path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path></svg></div><span><b>Unlimited</b> Folders, Prompt Categories, Pinned Messages, Notes, and Custom Instruction Profiles</span></div></div>

      <div class="relative"><div class="text-l flex justify-start gap-2"><div class=" flex-shrink-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md"><path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path></svg></div><span><b>Priority Support</b> and a Private Channel for Pro Members on Discord</span></div></div>
            
      <div class="relative"><div class="text-l flex justify-start gap-2"><div class=" flex-shrink-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md"><path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path></svg></div><span>More coming ...</span></div></div>
      
      </div>${e?`<div class="relative flex flex-col text-xs text-token-text-tertiary"><div><a class="px-2 underline" href="https://billing.stripe.com/p/login/${t.STRIPE_PORTAL_LINK_ID||"00g0237Sr78wcM03cc"}?prefilled_email=${encodeURIComponent(n)}">Manage my subscription</a></div></div>`:""}</div></div>
      
      <div class="flex w-full items-center justify-center border-t border-token-border-medium bg-token-main-surface-primary px-8 py-6"><div class="text-sm text-token-text-primary sm:flex sm:items-center">Have any questions? <a target="_blank" class="mx-1 font-semibold underline" href="mailto:support@spchatgpt.com?subject=Superpower ChatGPT Pro Subscription">Email Us</a> (support@spchatgpt.com)${e?"":' or <a target="_blank" class="mx-1 font-semibold underline" href="https://calendly.com/ezii/20min">Book a call</a>'}</div></div></div></div></div></div></div></div></div></div>`;document.body.insertAdjacentHTML("beforeend",i),document.querySelector("#upgrade-modal-close-button").addEventListener("click",()=>{document.querySelector("#upgrade-to-pro-modal").remove()});const a=document.querySelector("#upgrade-to-pro-modal-content");document.querySelector("#upgrade-to-pro-modal").addEventListener("click",s=>{isDescendant(a,s.target)||document.querySelector("#upgrade-to-pro-modal").remove()})})})}function addUpgradeOverlay(e,t){if(e.querySelector("#upgrade-to-pro-overlay"))return;const o=document.createElement("div");o.id="upgrade-to-pro-overlay",o.classList="w-full absolute top-0 bg-black/50 dark:bg-black/80 rounded-bs-md flex justify-center items-center",o.style="top: 56px; height: calc(100% - 56px);",e.appendChild(o);const r=document.createElement("button");r.id="upgrade-to-pro-button",r.classList="flex flex-wrap p-1 items-center rounded-md bg-gold hover:bg-gold-dark transition-colors duration-200 text-black cursor-pointer text-sm font-bold",r.style="width: 230px;",r.innerHTML=`<div class="flex w-full"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" style="width:20px; height:20px; margin-right:6px;position:relative; top:10px;" stroke="purple" fill="purple"><path d="M240.5 224H352C365.3 224 377.3 232.3 381.1 244.7C386.6 257.2 383.1 271.3 373.1 280.1L117.1 504.1C105.8 513.9 89.27 514.7 77.19 505.9C65.1 497.1 60.7 481.1 66.59 467.4L143.5 288H31.1C18.67 288 6.733 279.7 2.044 267.3C-2.645 254.8 .8944 240.7 10.93 231.9L266.9 7.918C278.2-1.92 294.7-2.669 306.8 6.114C318.9 14.9 323.3 30.87 317.4 44.61L240.5 224z"/></svg> ${translate("Upgrade to Pro")}</div><div style="font-size:10px;font-weight:400;margin-left:28px;" class="flex w-full">GPT Store, Image Gallery, Voice & more</div>`,o.appendChild(r),r.addEventListener("click",()=>{openUpgradeModal(t)})}function errorUpgradeConfirmation(e){showConfirmDialog(`<div class="flex items-center">${translate(e.title)} <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="icon icon-sm ms-2" viewBox="0 0 512 512"><path d="M506.3 417l-213.3-364c-16.33-28-57.54-28-73.98 0l-213.2 364C-10.59 444.9 9.849 480 42.74 480h426.6C502.1 480 522.6 445 506.3 417zM232 168c0-13.25 10.75-24 24-24S280 154.8 280 168v128c0 13.25-10.75 24-23.1 24S232 309.3 232 296V168zM256 416c-17.36 0-31.44-14.08-31.44-31.44c0-17.36 14.07-31.44 31.44-31.44s31.44 14.08 31.44 31.44C287.4 401.9 273.4 416 256 416z"/></svg></div>`,e.message,translate("Maybe later"),translate("Upgrade to Pro"),null,()=>openUpgradeModal(),"green")}function managerUpgradeButton(e,t="",o="lg"){const r=document.createElement("div");return r.classList="group relative flex flex-col w-full justify-start items-start cursor-pointer",o==="lg"?r.innerHTML=`<div id="upgrade-to-pro-button-${e}" class="relative flex flex-col flex-wrap w-full h-full justify-center items-center gap-2 p-1 text-black cursor-pointer bg-gold hover:bg-gold-dark hover:shadow-xl rounded-xl" style="aspect-ratio:1;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" style="width:42px; height:42px;" stroke="purple" fill="purple"><path d="M240.5 224H352C365.3 224 377.3 232.3 381.1 244.7C386.6 257.2 383.1 271.3 373.1 280.1L117.1 504.1C105.8 513.9 89.27 514.7 77.19 505.9C65.1 497.1 60.7 481.1 66.59 467.4L143.5 288H31.1C18.67 288 6.733 279.7 2.044 267.3C-2.645 254.8 .8944 240.7 10.93 231.9L266.9 7.918C278.2-1.92 294.7-2.669 306.8 6.114C318.9 14.9 323.3 30.87 317.4 44.61L240.5 224z"></path></svg><div class="w-full text-sm font-bold flex justify-center">Upgrade to Pro</div><div class="text-xs w-full flex justify-center">${t}</div></div>`:r.innerHTML=`<div id="upgrade-to-pro-button-${e}" class="relative flex w-full h-full justify-center items-center gap-2 p-1 text-black cursor-pointer bg-gold hover:bg-gold-dark hover:shadow-xl rounded-xl"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" style="width:28px; height:28px;" stroke="purple" fill="purple"><path d="M240.5 224H352C365.3 224 377.3 232.3 381.1 244.7C386.6 257.2 383.1 271.3 373.1 280.1L117.1 504.1C105.8 513.9 89.27 514.7 77.19 505.9C65.1 497.1 60.7 481.1 66.59 467.4L143.5 288H31.1C18.67 288 6.733 279.7 2.044 267.3C-2.645 254.8 .8944 240.7 10.93 231.9L266.9 7.918C278.2-1.92 294.7-2.669 306.8 6.114C318.9 14.9 323.3 30.87 317.4 44.61L240.5 224z"></path></svg><div class="w-full flex flex-col flex-wrap text-sm font-bold flex justify-center"><span>Upgrade to Pro</span><div class="text-xs w-full font-normal flex justify-start">${t}</div></div></div>`,r.addEventListener("click",()=>{openUpgradeModal(!1)}),r}function showDeal(e,t){chrome.storage.local.get(["dontShowDeal","lastDealTimestamp","installDate"],({dontShowDeal:o,lastDealTimestamp:r,installDate:n})=>{if(o){showRandomReminder(t);return}if(n&&Date.now()-n<1e3*60*60*1)return;const i=Math.floor((Date.now()-n)/(1e3*60*60*24));if(i%30>e.cycleInterval){showRandomReminder(t);return}if(r&&Date.now()-r<1e3*60*60*8){showRandomReminder(t);return}const a=e.cycleInterval-i%30;if(a<0){showRandomReminder(t);return}const s=new Date(Date.now()+1e3*60*60*24*a).toLocaleDateString("en-US",{month:"short",day:"numeric"}),l=a>6?`<span>Offer ends ${s}</span>`:a>3?`<span style="color:#e06c2b;">Only ${a} days left before deal ends</span>`:`<span style="color:#ef4146;">Last chance! Offer ends ${a>0?`in ${a} day${a>1?"s":""}`:"today"}.</span>`;showConfirmDialog(`<div class="flex">${e.icon?e.icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon icon-xl me-2" fill="#19c37d"><path d="M160 192C160 174.3 174.3 160 192 160C209.7 160 224 174.3 224 192C224 209.7 209.7 224 192 224C174.3 224 160 209.7 160 192zM352 320C352 337.7 337.7 352 320 352C302.3 352 288 337.7 288 320C288 302.3 302.3 288 320 288C337.7 288 352 302.3 352 320zM208.1 336.1C199.6 346.3 184.4 346.3 175 336.1C165.7 327.6 165.7 312.4 175 303L303 175C312.4 165.7 327.6 165.7 336.1 175C346.3 184.4 346.3 199.6 336.1 208.1L208.1 336.1zM344.1 43.41C377 39.1 411.6 49.59 437 74.98C462.4 100.4 472.9 134.1 468.6 167.9C494.1 188.2 512 220.1 512 256C512 291.9 494.1 323.8 468.6 344.1C472.9 377 462.4 411.6 437 437C411.6 462.4 377 472.9 344.1 468.6C323.8 494.1 291.9 512 256 512C220.1 512 188.2 494.1 167.9 468.6C134.1 472.9 100.4 462.4 74.98 437C49.6 411.6 39.1 377 43.41 344.1C17.04 323.8 0 291.9 0 256C0 220.1 17.04 188.2 43.42 167.9C39.1 134.1 49.6 100.4 74.98 74.98C100.4 49.6 134.1 39.1 167.9 43.41C188.2 17.04 220.1 0 256 0C291.9 0 323.8 17.04 344.1 43.41L344.1 43.41zM190.1 99.07L172 93.25C150.4 86.6 125.1 91.87 108.9 108.9C91.87 125.1 86.6 150.4 93.25 172L99.07 190.1L81.55 200.3C61.54 210.9 48 231.9 48 256C48 280.1 61.54 301.1 81.55 311.7L99.07 321L93.25 339.1C86.6 361.6 91.87 386 108.9 403.1C125.1 420.1 150.4 425.4 172 418.7L190.1 412.9L200.3 430.5C210.9 450.5 231.9 464 256 464C280.1 464 301.1 450.5 311.7 430.5L321 412.9L339.1 418.8C361.6 425.4 386 420.1 403.1 403.1C420.1 386 425.4 361.6 418.7 339.1L412.9 321L430.5 311.7C450.5 301.1 464 280.1 464 256C464 231.9 450.5 210.9 430.5 200.3L412.9 190.1L418.7 172C425.4 150.4 420.1 125.1 403.1 108.9C386 91.87 361.6 86.6 339.1 93.25L321 99.07L311.7 81.55C301.1 61.54 280.1 48 256 48C231.9 48 210.9 61.54 200.3 81.55L190.1 99.07z"/></svg>'} ${e.title}${e.title?":":""} ${e.amount} off Superpower ChatGPT Pro</div>`,`Enter code <u><b>${e.couponCode}</b></u> at checkout to get ${e.amount} off your Superpower ChatGPT Pro Subscription.`,"Remind me later","Claim Deal",()=>{chrome.storage.local.set({lastDealTimestamp:Date.now()})},()=>{chrome.storage.local.set({lastDealTimestamp:Date.now(),lastSubscriptionCheck:null}),chrome.storage.local.get({STRIPE_PAYMENT_LINK_ID:"8wM5nW6oq7y287ufZ8",STRIPE_PORTAL_LINK_ID:"00g0237Sr78wcM03cc"},d=>{chrome.storage.sync.get(["email"],({email:c})=>{window.open(`https://buy.stripe.com/${d.STRIPE_PAYMENT_LINK_ID||"8wM5nW6oq7y287ufZ8"}?prefilled_email=${encodeURIComponent(c)}`,"_blank")})})},"green",!1,d=>{chrome.storage.local.set({dontShowDeal:d,lastDealTimestamp:Date.now()})},"Don't show me deals again",l)})}const santa='<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" id="Layer_1" x="0" y="0" style="enable-background:new 0 0 864 864" version="1.1" viewBox="0 0 864 864"><style>.st0{fill:#fff}</style><path d="M820.1 563.1c10.9-10.9 14.3-25.4 10.7-40.4-2.2-9.3-6.2-18.1-11.6-26-.2-.3-.4-.6-.6-.8-2.8-4.1-6-7.8-9.6-11.3-2.5-2.4-6.9-7.5-10.5-8 .7.1 1.5.2 2.2.4 2.6.4 6.1 1.6 8.8 1.1 3.1-.6 3.8-3.2 2.9-5.5-.9-13.2-17.1-25.9-26.8-32.9-6-4.3-18-10-28.2-10.6.6-.4 1.3-.8 1.9-1.3 1.6-1.1 1.6-3 .1-4.2-12.6-9.9-29.7-12.8-45.2-8.8-8.4 2.2-17.8 6.7-24.9 13.2l-.1-.1c1.2-1.6-.4-4.5-2.7-4-19.2 4.1-37.7 24.6-41 44-7.7-4.1-12.7-11.2-16.9-20-1.5-9.6-2-19.3-2.3-27.7-1-24.6.6-49.1-1.3-73.7-2.9-39.1-10-82.2-28.1-118-9-31-32.4-57.7-58-76.4-31.9-23.4-70.4-35.7-109-42-40.7-6.6-83.4-9.2-123.6 1.2-36.8 9.5-70.8 28.2-99.9 52.6-16.6 13.9-31.5 29.6-45 46.4-7 8.7-13.7 17.7-19.9 27-3.1 4.6-6.3 9.3-9.1 14.1-2.7 4.8-4.2 10-6.5 15-15.2-3.7-32.3 1.8-44.2 12.4-5.8 5.1-11 11.2-14.3 18.3-3.7 7.8-4.3 14.4-2 22.9 1.2 4.3 3.2 8.4 6.3 11.5-1.8 3.1-2.4 6.9-1.6 10.4-6.7 2.5-13.5 5-18.1 10.9-6.5 8.2-8.5 19.6-6.9 29.9 2.4 15.5 14.2 26.1 28.8 30.6 1.5.5 3.1.9 4.5 1.6 1.4.7 2.6 1.8 3.8 2.8 5.3 4.6 10.7 9.2 16.8 12.8 7.7 4.5 16.2 6.4 25.1 5.8 6.6-.5 13.2-2.2 19.2-5.2 1.6-.8 16.2-12.2 15.5-12.5 1.2.5 2.5.9 3.8 1.2 6.7 1.3 15.5-2.4 18.5-8.8 6.9 4.6 15.5 4 23.3 1.2 12.1-4.4 25.7-12.2 33.9-23.3 2.5 2.7 7.1 4.3 10.7 4.3 7.2 0 14.6-4.6 17.1-11.4 2 1.9 4.2 3.7 6.4 5.3 8.6 6 18.8 9.4 29.2 9.9 9.1.4 18.3-1.2 26.9-4.2 4.5-1.6 8.9-3.6 13-6.1 2.7-1.6 6.9-6.5 10.2-5.1 1.2.5 2.2 1.5 3.2 2.4 6.3 5.7 14.4 10.2 22.7 12.1 8.9 2 18 .6 26.5-2.2 4.3-1.4 6.9-2.9 11.4-1.8 3.9.9 8.1 2.5 11.4 4.9 2.8 2.1 4.6 5.2 7.3 7.4 3.3 2.7 8.3 5.4 12.3 7 10.6 4.3 23.7 5.7 34.3.5 8.6 8.7 19.7 14.8 31.7 17.4 4.4 28.9 17.8 53.5 36.4 75.9 8.9 10.7 18.8 20.8 30.6 28.1 12.5 7.7 25.3 10.6 39.7 12.4.3 0 .6.1.7.3.1.1.1.3.1.4 1.4 10.8 3.4 21.6 6.9 31.9 4.7 13.7 12.8 26.3 23.7 35.8 22.4 19.6 54.9 25.4 82.7 15.1.6-.2 1.1-.6 1.4-1.1 5.8 1.1 11.8.8 17.7-1.3 15.1-5.4 31.7-16.1 38.4-31.1v-.1c3-4.8-4.6-10.6-12.1-14 1-.1 1.9-.2 2.9-.3 14.5-2 28.4-8.2 38.4-18.2z"/><path d="M523.8 420.4c-8 2.8-16.4 2.1-23.5-2.6-4.2-2.8-7.3-6.5-8.9-11.4-.7-2-.9-3.7-1.7-5.4-.1-2.1-2.2-4.1-4.4-2.6-7.5 5-14.9 9-24.3 8.7-4.5-.2-22.8-4.4-25.1-11.6 2.9-.5 5.6-1.8 7.8-4 2.8-2.7-1.1-6.6-4.1-4.3-9 6.7-26.7-1.4-27.4-12.7 0-.5-.9-.8-1-.2-.8 3.8-.1 7.4 1.7 10.5-10.8 3.4-21.8 7.7-33.2 5.2-9.4-2.1-17-7.8-23-15-2.6-3.1 0-5.8 1.7-8.6.5-.9 1-2.1.4-2.9h-1.1c-.2 0-2.5 4.1-2.9 4.6-1.7 2-3.8 3.5-5.8 5.2-4.8 4.2-10.3 7.6-16.2 10.2-11.6 5.2-25.1 7.7-37.7 5.1-7.7-1.6-14.8-5-21.1-9.7-3.3-2.5-6.3-5.3-9.2-8.2-2.6-2.5-5.5-5.3-8.5-7.3-.2 1.8.8 3.4 1.8 5 1.9 2.9 4 5.4 3.4 9-.6 4.1-5.3 8.1-9 9.2-2.5.7-8.4.6-11.4-1.7 2.1-3.5 3.7-7.4 4.4-11.5.6-3.3-4.1-4.9-5.2-1.6-4.3 13-13.7 21.4-25.7 27.4-11.6 5.8-41 9.8-39.8-11.3 0-.8-1.2-1-1.4-.2-2.2 6.7-1.1 13.3 3.1 18.5-3.8 3.7-6.8 7.4-13 6.5-5.3-.7-10.2-5.7-12.4-10.4-.3-.6-1-.2-1.1.3-.6 4.6.9 8.8 3.7 11.9-10.1 9-22 15.6-36.1 14.3-12.8-1.2-23.6-7.8-31.4-17.6 2.7-.8 5.4-1.9 8.1-3.5 3.6-2.1 1.3-7.1-2.6-6.5-8.6 1.3-17.2 5.2-25.2-.3-6.7-4.6-10.4-12.5-11.3-20.3-1.5-12.5 4.4-30.3 16.9-35.1.9 2.4 2.3 4.7 4.6 6.6 1.1.9 2.7-.1 2.1-1.5-4.9-10-2.3-19.3 8.2-23.5 2.9-1.2.9-5.7-2-5-3.5.9-6.5 2.8-8.8 5.4-2.8-6.7-5.4-13.9-4.4-21.2 1.4-10.2 9.2-18.8 16.9-25 8.1-6.6 18.2-10.3 28.7-9.5 7.3.6 21.3 3.7 24.4 11.4 1.9 4.6 2.1 8.4 6 12 .8.7 1.9-.1 1.4-1.1-6.1-13.4 11.5-28.9 22.7-32 13.1-3.6 20.6 3.8 30.1 10.9 1.7 1.3 4.4-.7 3.8-2.8-1-3.3-2.8-6-5-8.3 11.5-17.1 40-15.1 56-5.8-.8 3.2-.9 6.4.2 9.3.4 1.1 1.8 1.4 2.5.4 2.2-3.2 2.5-6.8 3.9-10.3 2-4.9 5-9.5 8.7-13.4 7.2-7.5 16.9-11.9 27.1-13.6 18.4-2.9 44.1 3 49.6 23.5 0 .1.1.2.1.3-1.4 1.6-2.1 3.4-1.3 5.6 0 .1.1.2.2.2 3.7.1 7.1-3.4 10.7-4.2 6.2-1.5 11.1 1.8 15.2 6 2.4 2.4 6.4-.5 4.8-3.5-2.2-4.1-6.1-7.1-10.5-8.5 11.9-12.7 31.7-16.8 48.5-12.9 17.9 4.1 28 16.1 34.5 32.3-2.3.7-4.6 2-6.6 3.9-1.4 1.3.2 3.3 1.6 3 6-.7 10.9-2.3 16.9.1 5.4 2.2 8.7 6.3 11.2 11.4 1.4 2.9 6.5 1 5.4-2.1-.8-2.2-2-4.4-3.6-6.4l.3-.3c7.1-10 23-11.5 34.1-8.3 11.4 3.4 19.5 12.3 21.7 23.9 0 .2.1.4.2.5-1.8 1.2-3.2 3-3.8 5.5-.1.2.1.4.3.4 2.8-.5 5.4-2 8.2-2.6 4.7-1 9.4.3 13.3 3 7 4.9 9.5 12.8 5.6 20.6-1.1 2.1 1.6 4.8 3.5 2.8 2.7-2.7 4-6 4.3-9.3 8.5-.5 16.2.7 22.1 8 1.6 2 3 4.3 4 6.7 0 .1 0 .3.1.4 2.5 5.9 2.2 11.4-1.9 16.4-.1.1-.2.3-.2.4-2.9.7-2.7 5.1.6 5.5 18.2 2 25.9 16.7 21.1 33.8-3.7 13.2-13.7 19.3-25.2 24.7-.8-1.9-1.9-3.8-3.3-5.6-.9-1.2-2.7.3-2.1 1.5 7.9 16.1-4.1 32.8-20.2 36.1-12.5 2.6-29.7-4.4-31.2-16.9.4-.8.3-1.8-.1-2.7.2-2.5.9-5.2 2.5-8.1.4-.8-.6-1.8-1.3-1.1-2.4 2.5-3.8 5.1-4.7 7.9z" class="st0"/><path d="M598.3 533.5c9.4-1 18.3-7.2 24-14.7.1-.1-.1-.2-.1-.2-9.4 6.6-22.4 14.5-34.1 9.2-2.7-1.2-5.1-3-7.4-4.8-10-8-19.1-16.2-27.4-26.1-9.6-11.4-17.5-23.7-23.2-37.3 5.7 4.9 12.9 7.7 20.5 6 .2 0 .2-.3 0-.4-9.4-3.7-17.9-7.7-24.1-15.2-.2-.6-.4-1.2-.6-1.9-1-3.2-1.8-6.8-1.6-10.2 0-.3.1-.6.2-.9.6-.8 1.9 0 2.5.8 3.1 3.9 6.2 7.9 11.1 9.2 5.7 1.6 11.6 2.5 17.5 1.8 9.7-1.1 19.1-6.4 24.9-14.3 2.6-3.6 4.9-8.3 5.2-12.9.2-3.4.6-7.8 4.1-9.6 2.9-1.5 6.3-1.3 9.4-3.1 5.2-3.1 9-8 11.6-13.4 5.2-11 6-25.1.7-36.2-3.1-6.4-8.4-11.5-15.4-13.4 5.8-7.3-.3-22.7-5-28.7-3.3-4.1-8.1-4.9-9.9-10.3-1.2-3.7-2.3-11-1.6-14.7 2.3-12.3 2.1-25.9-.7-38.4-1-11.3-5.2-22.2-13.4-29.6-.3-.2-.7 0-.6.3 1.9 7.4 8.3 17.6 6.1 25.3-.1.3-.2.6-.4.8-.4.5-1.1.5-1.7.3-.6-.2-1-.7-1.4-1.2-3.1-3.7-4.5-9.7-6.8-14.1-2.5-4.9-5.2-9.6-8.2-14.2-5.9-9-12.9-17.3-20.9-24.5-.3-.3-.9.1-.6.5 1.3 1.9 2.6 3.8 3.8 5.7 8.7 15.5 17.3 31 22.5 48.1 1.6 5.2 2.7 10.3 1.5 15.7-.1.6-.3 1.2-.7 1.6-.5.5-1.4.6-2.1.4-.7-.2-1.3-.7-1.9-1.1-6.8-5.3-12.1-12-18.9-17.3-6.6-5.2-13.7-9.8-21.2-13.7-.9-.5-1.9-1-2.9-.7 0 .9.9 1.6 1.7 2.1 6.4 4.6 11 10.7 16.6 16 7.4 8 15.5 17.5 17.5 28.5.3 1.6.3 3.6-1 4.6-.4.3-.9.5-1.4.6-4.4 1-7.4-2.1-9.1-5.6-1.8-3.6-3.7-7-6.5-10-5.6-6-13.3-9.9-21.4-11.3-11-1.9-30.3-.2-35.3 12-4.5-3.9-10.2-6.6-15.8-6.7-2.4-19.4-21.3-34.5-39.6-38.1-16.9-3.4-44.6.1-51.8 18.8-1.7-.3-3.4-.3-5.2-.1-1.5.2-3.6.8-5.6 1.7-7-21.3-32.6-28.7-53.1-26.4-11.9 1.3-23.4 6.1-32 14.5-3.4 3.3-7.4 8.3-10 13.6-10.8-7-24.5-8.5-36.9-6-9.5 1.9-20.2 6.2-23.3 15.6-9.4-7.4-24.7-8.1-34.9-3.2-7.2 3.5-16 11.2-19.6 19.6-3.7-3.7-7.8-6.4-12.1-8.3.3-.6.6-1.5 1.1-2.4 5.6-9.3 10.3-19.5 17.5-27.5 7.4-8.3 18.3-13.7 28-19 19.7-10.8 40.6-18.2 62.2-24.5.1 0 0-.1 0-.1-23.2 3.7-45.9 12-66.9 22.6-5.5 2.8-11.2 5.8-16.5 9.4l1.5-2.1c11.2-15.3 23.8-29.7 37.5-42.9 13.7-13.1 28.6-25.6 45.4-34.5 18.9-10 39.8-17.9 61.1-19.2 15.7-1 30.9 1 46 5.2 1.1.3 1.6-1.3.5-1.7-15.3-5.4-31.7-8-47.9-7.6-7 .2-14 1.1-20.8 2.7 3.4-1.4 6.8-2.7 10.3-3.9 37.3-12.9 75.8-13.6 114.8-9.5 39.6 4.1 79.7 13.4 114.3 33.8 34.1 20.1 58.5 49.2 72.6 86 .2.4.4.8.7 1.1 5.5 17.2 11.4 34.2 15.5 51.8 6.1 25.7 9.5 52 10.3 78.4.3 9.7.1 19.4.1 29.1-.1 9.4-.9 19.4.4 28.7 1.9 13.2-4.3 26.8-15.3 34.2-.1 0 0 .2.1.2 6.9-2.5 13.1-7.9 16.8-14.5 1.7 13.9 4.4 27.5 13.8 38.5 3.1 3.6 6.9 6.7 11.4 8.1-.2-1.4-1.3-2.4-2.3-3.5-3.5-3.5-5.9-8-8.1-12.4-.5-.9-.9-1.9-.5-2.8.9-2.4 3.4 1.1 4.3 1.7 2.3 1.6 5.1 2.6 7.8 3.3 5.3 1.5 11 1.8 16.4 2.7 20.8 3.3 11.7 32.8 1.8 42.6-10.4 10.3-26.5 16-40.8 17.6-9.8 1.1-18.7-.6-27.1-4.1z" style="fill:#be1622"/><path d="M814.8 501.4c-3.5-5.5-7.6-10.5-12-15.4-2.2-2.5-4.6-5-6.9-7.4-.9-.9-5.1-6.5-6.1-6.5 2.5-.2 5.1-.2 7.6.1 2 .3 4.2.7 6.1-.1.3-.1.6-.3.7-.6.1-.2 0-.5-.1-.7-3.8-10.6-14.6-19.7-23.4-26-5.8-4.1-12.2-7.3-19.2-9-1.4-.3-17.4-1-13.1-5.1.4-.4 5.4-5.1 5.7-5-12-7.3-26-9.4-39.8-5.3-6.6 2-12.4 5.7-17.7 9.9-4.1 3.2-9.7 10.3-15 11.2-.4.1-1 0-1.2-.3-.1-.2-.1-.4-.1-.6.3-3.4 1.1-6.8 2.7-9.7-9.6 4.9-17.4 11.1-23.6 20.6-2.9 4.5-5.1 9.3-7.4 14.2-.4.9-.9 2.6-1.8 4 2.4.8 5 1.3 7.9 1.6 10.5.9 18.3 3.1 22.6 13.7 8.1 19.9-7.2 40.1-23.8 49.6-9.1 5.2-19.1 8.7-29.3 10 1.2 2.7.9 5.8 1.1 8.8.5 6.9 1.5 13.8 3.6 20.4 4 12.8 11.2 24.6 21 33.8 9.9 9.4 22.5 15.6 35.9 18.4 6.6 1.4 13.4 1.9 20.2 1.6 3.2-.1 9.6.3 12-2 .1-.1.3-.3.3-.5s-.2-.5-.3-.6c-3-3.1-7-5.1-9.2-8.9.2-.9 1.5-.8 2.4-.5 9.2 3.4 18.2 7.1 28.2 7.3 4.2.1 8.1-1.1 11.9-2.8 12.7-5.5 23-13.3 31.2-24.2-.1-.6.1-1.3.7-1.7 1.9-1.5-16.1-13.5-17.3-14.2-.5-.3-1.1-.9-.8-1.4 6.5 1.3 13-1.7 19.1-3.4 6.2-1.8 12.3-3.8 17.9-7.1.5-.3 1-.7 1.6-1 7.5-7.4 14.3-16.2 16.9-26.3 3.5-13-2.2-27.9-9.2-38.9zm-26 41.8c-1.9 4.2-4.4 7.6-7.7 10.6 5.6 3.6-.5 11.6-5 14.6-7.1 4.9-15.2 8.4-23.2 11.5-4 1.6-8.3 3.8-12.7 4.6 1.4 1.2 2.5 2.6 3.1 4.4.2.6-.1 1.2-.5 1.7-5.2 5.4-16 6.9-23.2 7.2-8.2.4-15.7-1.4-23.1-4.4.1 1.4-.2 2.8-1.6 3.8-2.7 2.1-6.3.4-8.9-.9-3.3-1.6-6.4-4.2-9.2-6.6-1.6-1.4-3.1-2.8-4.6-4.2-2.9-2.8-5.6-5.8-7.9-9.1-1-1.4-2-2.9-2.9-4.5-.4-.7-2.6-3.9-2-4.5.3-.3.8-.2 1.1.1 4.1 4.6 8.3 9.4 12.8 13.7 4.8 4.5 10.1 8.6 16.1 11.4.6.3 1.4.6 1.9.2.4-.3.5-.7.6-1.2.2-1 .2-2 .1-3 0-.3 0-.7.3-.8.1 0 .2 0 .3.1 3.9 1.5 7.6 3.4 11.6 4.5 4.1 1.1 8.4 1.7 12.6 1.7 4.2 0 8.4-.4 12.5-1.4 2.9-.7 15-3.6 5.1-8.1-1.5-.7-1.5-3.2.5-3.2 7.9.4 17.7-5 24.8-8.2 2.8-1.2 5.5-2.6 8.2-4 1.4-.8 18-11.3 9.4-13.4-1.6-.4-1.4-2.4-.3-3.2 4.1-3 6.8-6.5 9.3-10.8.7-1.1 3.1-.1 2.5 1.4z" class="st0"/></svg>';function imageGalleryMenu(){return`<div id="image-gallery-menu-wrapper" class="me-2" style="min-width:48px;z-index:100;margin-left:56px;"><button id="image-gallery-menu-button" class="${imageGalleryCurrentTab==="public"?"invisible":""} relative w-full flex items-center justify-center cursor-pointer rounded-md border bg-token-main-surface-primary border-token-border-medium p-2 text-center focus:border-green-600 focus:outline-none  sm:text-sm" type="button">
  <span class="flex items-center justify-center w-full truncate font-semibold text-token-text-primary">
<svg xmlns="http://www.w3.org/2000/svg" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4" height="1em" viewBox="0 0 448 512"><path d="M0 88C0 74.75 10.75 64 24 64H424C437.3 64 448 74.75 448 88C448 101.3 437.3 112 424 112H24C10.75 112 0 101.3 0 88zM0 248C0 234.7 10.75 224 24 224H424C437.3 224 448 234.7 448 248C448 261.3 437.3 272 424 272H24C10.75 272 0 261.3 0 248zM424 432H24C10.75 432 0 421.3 0 408C0 394.7 10.75 384 24 384H424C437.3 384 448 394.7 448 408C448 421.3 437.3 432 424 432z"/></svg></span>
</button>
  </div>`}function imageGalleryMenuOptions(){return`<ul id="image-gallery-menu-options" style="max-height:400px;width:300px;" class="block transition-all absolute z-10 end-4 mt-1 overflow-auto rounded-2xl text-base focus:outline-none bg-token-main-surface-secondary shadow-long p-1 sm:text-sm -translate-x-1/4" role="menu" aria-orientation="vertical" tabindex="-1">
  ${imageGalleryCurrentTab!=="public"?`

  <li class="relative cursor-pointer select-none rounded-xl py-2 ps-3 pe-9 hover:bg-token-main-surface-tertiary" id="image-gallery-menu-option-download" role="option" tabindex="-1">
  <div class="flex items-center text-token-text-primary">
  <svg stroke="currentColor" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md me-2"><path fill-rule="evenodd" clip-rule="evenodd" d="M7.70711 10.2929C7.31658 9.90237 6.68342 9.90237 6.29289 10.2929C5.90237 10.6834 5.90237 11.3166 6.29289 11.7071L11.2929 16.7071C11.6834 17.0976 12.3166 17.0976 12.7071 16.7071L17.7071 11.7071C18.0976 11.3166 18.0976 10.6834 17.7071 10.2929C17.3166 9.90237 16.6834 9.90237 16.2929 10.2929L13 13.5858L13 4C13 3.44771 12.5523 3 12 3C11.4477 3 11 3.44771 11 4L11 13.5858L7.70711 10.2929ZM5 19C4.44772 19 4 19.4477 4 20C4 20.5523 4.44772 21 5 21H19C19.5523 21 20 20.5523 20 20C20 19.4477 19.5523 19 19 19L5 19Z" fill="currentColor"></path></svg>
    <span class="font-semibold flex h-6 items-center gap-1 truncate text-token-text-primary">${translate(`Download ${selectedImageGalleryImageIds.length>0?"selected":"all"} images`)}</span>
  </div>
  </li>

  <li class="relative cursor-pointer select-none rounded-xl py-2 ps-3 pe-9 hover:bg-token-main-surface-tertiary" id="image-gallery-menu-option-date-range-download" role="option" tabindex="-1">
  <div class="flex items-center text-token-text-primary">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="currentColor" class="icon icon-md me-2"><path d="M96 288C96 270.3 110.3 256 128 256C145.7 256 160 270.3 160 288C160 305.7 145.7 320 128 320C110.3 320 96 305.7 96 288zM320 352C337.7 352 352 366.3 352 384C352 401.7 337.7 416 320 416C302.3 416 288 401.7 288 384C288 366.3 302.3 352 320 352zM192 288C192 274.7 202.7 264 216 264H328C341.3 264 352 274.7 352 288C352 301.3 341.3 312 328 312H216C202.7 312 192 301.3 192 288zM232 360C245.3 360 256 370.7 256 384C256 397.3 245.3 408 232 408H120C106.7 408 96 397.3 96 384C96 370.7 106.7 360 120 360H232zM152 64H296V24C296 10.75 306.7 0 320 0C333.3 0 344 10.75 344 24V64H384C419.3 64 448 92.65 448 128V448C448 483.3 419.3 512 384 512H64C28.65 512 0 483.3 0 448V128C0 92.65 28.65 64 64 64H104V24C104 10.75 114.7 0 128 0C141.3 0 152 10.75 152 24V64zM48 448C48 456.8 55.16 464 64 464H384C392.8 464 400 456.8 400 448V192H48V448z"/></svg>
    <span class="font-semibold flex h-6 items-center gap-1 truncate text-token-text-primary">${translate("Download images by date range")}</span>
  </div>
  </li>

  ${imageGalleryCurrentTab==="dalle"?`
  <li class="relative cursor-pointer select-none rounded-xl py-2 ps-3 pe-9  hover:bg-token-main-surface-tertiary" id="image-gallery-menu-option-public" role="option" tabindex="-1">
  <div class="flex items-center text-token-text-primary">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" stroke="currentColor" fill="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-md me-2" height="1em" width="1em"><path d="M319.9 320c57.41 0 103.1-46.56 103.1-104c0-57.44-46.54-104-103.1-104c-57.41 0-103.1 46.56-103.1 104C215.9 273.4 262.5 320 319.9 320zM369.9 352H270.1C191.6 352 128 411.7 128 485.3C128 500.1 140.7 512 156.4 512h327.2C499.3 512 512 500.1 512 485.3C512 411.7 448.4 352 369.9 352zM512 160c44.18 0 80-35.82 80-80S556.2 0 512 0c-44.18 0-80 35.82-80 80S467.8 160 512 160zM183.9 216c0-5.449 .9824-10.63 1.609-15.91C174.6 194.1 162.6 192 149.9 192H88.08C39.44 192 0 233.8 0 285.3C0 295.6 7.887 304 17.62 304h199.5C196.7 280.2 183.9 249.7 183.9 216zM128 160c44.18 0 80-35.82 80-80S172.2 0 128 0C83.82 0 48 35.82 48 80S83.82 160 128 160zM551.9 192h-61.84c-12.8 0-24.88 3.037-35.86 8.24C454.8 205.5 455.8 210.6 455.8 216c0 33.71-12.78 64.21-33.16 88h199.7C632.1 304 640 295.6 640 285.3C640 233.8 600.6 192 551.9 192z"/></svg>
    <span class="font-semibold flex h-6 items-center gap-1 truncate text-token-text-primary">${translate(`Make ${selectedImageGalleryImageIds.length>0?"selected":"all"} images public`)}</span>
  </div>
  </li>
  `:""}

  <li class="relative text-red-500 cursor-pointer rounded-xl select-none py-2 ps-3 pe-9  hover:bg-token-main-surface-tertiary" id="image-gallery-menu-option-delete" role="option" tabindex="-1">
  <div class="flex items-center">
    <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="icon icon-md me-2" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
    <span class="font-semibold flex h-6 items-center gap-1 truncate text-red-500">${translate(`Delete ${selectedImageGalleryImageIds.length>0?"selected":"all"} images`)}</span>
    </div>
  </li>
    `:""}
  </ul>`}function addImageGalleryMenuEventListener(e=null){chrome.runtime.sendMessage({type:"checkHasSubscription"},t=>{const o=document.querySelector("#image-gallery-menu-button");document.body.addEventListener("click",r=>{const n=document.querySelector("#image-gallery-menu-options");n&&!isDescendant(n,r.target)&&n.remove()}),document.querySelectorAll("[id^=image-gallery-menu-option-]").forEach(r=>{r.addEventListener("click",async n=>{document.querySelector("#image-gallery-menu-options").classList.replace("block","hidden");const i=r.id.split("image-gallery-menu-option-")[1];if(!t){openUpgradeModal();return}i==="download"&&await downloadSelectedImages(o,selectedImageGalleryImageIds,null,!n.shiftKey),i==="date-range-download"&&showDateSelectorDialog("Download Images","Select date range","Cancel","Download",null,async(a,s)=>{const l=o.cloneNode(!0);o.disabled=!0,o.innerHTML='<svg x="0" y="0" viewbox="0 0 40 40" class="spinner icon icon-xl" style="height:24px;"><circle fill="transparent" stroke="#ffffff50" stroke-width="2" stroke-linecap="round" stroke-dasharray="125.6" cx="20" cy="20" r="18"></circle></svg>',o.disabled=!0,await chrome.runtime.sendMessage({type:"getGalleryImagesByDateRange",detail:{category:imageGalleryCurrentTab,startDate:a,endDate:s}},async d=>{zipImages(d,o,l,!n.shiftKey)})},"green",!0),i==="public"&&makeGalleryImagesPublic(),i==="delete"&&deleteGalleryimages()})})})}function makeGalleryImagesPublic(){showConfirmDialog("Share Images",`Are you sure you want to make ${selectedImageGalleryImageIds.length>0?"selected":"all"} images public?`,"Cancel","Confirm",null,async()=>{await chrome.runtime.sendMessage({type:"shareGalleryImages",detail:{imageIds:selectedImageGalleryImageIds,category:imageGalleryCurrentTab}},async e=>{if(e?.success){if(selectedImageGalleryImageIds.length===0){toast("All images are now public");return}toast("Selected images are now public")}})},"green")}function deleteGalleryimages(){showConfirmDialog("Delete Images",`Are you sure you want to delete ${selectedImageGalleryImageIds.length>0?"selected":"all"} images?`,"Cancel","Confirm",null,async()=>{await chrome.runtime.sendMessage({type:"deleteGalleryImages",detail:{imageIds:selectedImageGalleryImageIds,category:imageGalleryCurrentTab}},async e=>{if(e?.success){if(selectedImageGalleryImageIds.length===0){const o=document.querySelector("#gallery-image-list");o&&(o.innerHTML=""),resetSidebar(),toast("All images are deleted");return}allImageNodes=allImageNodes.filter(o=>!selectedImageGalleryImageIds.includes(o.image_id)),selectedImageGalleryImageIds.forEach(o=>{const r=document.querySelector(`#gallery-image-card-${o}`);r&&r.parentElement?.remove()}),toast("Selected images are deleted");const t=document.querySelector('img[id^="gallery-image-card-"]');t&&t.click(),resetGallerySelection()}})},"red")}async function downloadSelectedImages(e=null,t=[],o=null,r=!0){let n;e&&(n=e.cloneNode(!0),e.disabled=!0,e.innerHTML='<svg x="0" y="0" viewbox="0 0 40 40" class="spinner icon icon-xl" style="height:24px;"><circle fill="transparent" stroke="#ffffff50" stroke-width="2" stroke-linecap="round" stroke-dasharray="125.6" cx="20" cy="20" r="18"></circle></svg>'),await chrome.runtime.sendMessage({type:"getSelectedGalleryImages",detail:{category:imageGalleryCurrentTab,imageIds:t,conversationId:o}},async i=>{zipImages(i,e,n,r)})}async function zipImages(e,t=null,o=null,r=!0){if(e.length===0){toast("No images to download"),resetMenuButton(t,o);return}t&&(t.style.width="100px");const n=new JSZip,i=n.folder("Superpower-ChatGPT-Gallery");for(let a=0;a<e.length;a+=1){t&&(t.innerHTML=`${a+1}/${e.length}`);const s=e[a],l=new Date(formatTime(s.created_at)),d=`${l.getFullYear()}-${l.getMonth()+1}-${l.getDate()}__${l.getHours()}-${l.getMinutes()}-${l.getSeconds()}`,c=s?.title?.replaceAll(" ","_")?.replaceAll("/","-")?.replaceAll("\\","-").replaceAll(".","_")||"",u=decodeURIComponent(s.image||s.download_url),m=r?"webp":isWindows()?"jpg":"png",g=`${s.conversation_id}/${d}__${s.image_id}${c?`__${c}`:""}.${m}`,p=await chrome.runtime.sendMessage({type:"downloadImage",detail:{url:u}}),h=dataURItoBlob(p);i.file(g,h,{binary:!0});const f=`${s.conversation_id}/${d}__${s.image_id}${c?`__${c}`:""}.txt`,v=`Conversation URL:
${`https://chatgpt.com/c/${s.conversation_id||""}`}

Title:
${c||""}

Prompt:
${s.prompt||""}`;i.file(f,v,{binary:!1})}t&&(t.innerHTML="Zipping..."),n.generateAsync({type:"blob",compression:"DEFLATE"}).then(a=>{saveAs(a,`${new Date().toISOString().slice(0,10)}-superpower-chatgpt-gallery.zip`),resetMenuButton(t,o)})}function resetMenuButton(e=null,t=null){e&&t&&(e.disabled=!1,e.style.width=t.style.width,e.innerHTML=t.innerHTML)}let selectedGalleryImage=null,allImageNodes=[],selectedImageGalleryImageIds=[],selectedImagePickerImageIds=[],imageGalleryCurrentTab="dalle",showAll=!1;function createImageGallery(){selectedGalleryImage=null;const e=document.createElement("div");return e.id="image-gallery",e.dataset.state="open",e.classList="h-full w-full flex items-center justify-center backdrop-blur-xl",e.style="pointer-events: auto;",e.innerHTML=`
<div role="dialog" data-state="open" class="relative flex h-full w-full justify-stretch divide-x divide-white/10 focus:outline-none" tabindex="-1" style="pointer-events: auto;">
  <div id="image-gallery-image-wrapper" class="flex flex-1 transition-[flex-basis]">
    <div class="flex flex-1 flex-col p-2">
      <div id="gallery-header" class="px-0 pb-4">
        <div class="flex items-center justify-between text-token-text-primary">
          <div class="flex items-center">
            <input type="search" id="gallery-search" tabindex="0" placeholder="${translate("Search gallery")}" class="w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm bg-token-main-surface-secondary me-2">
            <a href="https://www.youtube.com/watch?v=oU6_wgJLYEM" target="_blank" rel="noreferrer">
              <svg
                xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md ps-0.5 text-token-text-tertiary h-6 w-6">
                <path fill="currentColor" d="M13 12a1 1 0 1 0-2 0v4a1 1 0 1 0 2 0zM12 9.5A1.25 1.25 0 1 0 12 7a1.25 1.25 0 0 0 0 2.5"></path>
                <path fill="currentColor" fill-rule="evenodd" d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2M4 12a8 8 0 1 1 16 0 8 8 0 0 1-16 0" clip-rule="evenodd"></path>
              </svg>
            </a>
          </div>
          <div id="gallery-tabs-wrapper" role="radiogroup" aria-required="false" dir="ltr" class="flex w-full overflow-hidden rounded-xl bg-token-main-surface-tertiary p-1.5 dark:bg-token-main-surface-tertiary w-max gap-2 flex-shrink-0 self-center" tabindex="0" style="outline: none;">
            <button id="gallery-tab-dalle" type="button" role="radio" data-state="${imageGalleryCurrentTab==="dalle"?"checked":"unchecked"}" value="dalle" class="text-md w-1/3 flex-grow rounded-lg border-token-border-medium p-1.5 font-medium text-token-text-tertiary transition hover:text-token-text-primary radix-state-checked:border radix-state-checked:bg-token-main-surface-primary radix-state-checked:text-token-text-primary radix-state-checked:shadow-[0_0_2px_rgba(0,0,0,.03)] radix-state-checked:dark:bg-token-main-surface-secondary md:w-1/3" tabindex="0" data-radix-collection-item="">Images</button>
            <button id="gallery-tab-chart" type="button" role="radio" data-state="${imageGalleryCurrentTab==="chart"?"checked":"unchecked"}" value="chart" class="text-md w-1/3 flex-grow rounded-lg border-token-border-medium p-1.5 font-medium text-token-text-tertiary transition hover:text-token-text-primary radix-state-checked:border radix-state-checked:bg-token-main-surface-primary radix-state-checked:text-token-text-primary radix-state-checked:shadow-[0_0_2px_rgba(0,0,0,.03)] radix-state-checked:dark:bg-token-main-surface-secondary md:w-1/3" tabindex="-1" data-radix-collection-item="">Charts</button>
            <button id="gallery-tab-upload" type="button" role="radio" data-state="${imageGalleryCurrentTab==="upload"?"checked":"unchecked"}" value="upload" class="text-md w-1/3 flex-grow rounded-lg border-token-border-medium p-1.5 font-medium text-token-text-tertiary transition hover:text-token-text-primary radix-state-checked:border radix-state-checked:bg-token-main-surface-primary radix-state-checked:text-token-text-primary radix-state-checked:shadow-[0_0_2px_rgba(0,0,0,.03)] radix-state-checked:dark:bg-token-main-surface-secondary md:w-1/3" tabindex="-1" data-radix-collection-item="">Uploads</button>
            <button id="gallery-tab-public" type="button" role="radio" data-state="${imageGalleryCurrentTab==="public"?"checked":"unchecked"}" value="public" class="text-md w-1/3 flex-grow rounded-lg border-token-border-medium p-1.5 font-medium text-token-text-tertiary transition hover:text-token-text-primary radix-state-checked:border radix-state-checked:bg-token-main-surface-primary radix-state-checked:text-token-text-primary radix-state-checked:shadow-[0_0_2px_rgba(0,0,0,.03)] radix-state-checked:dark:bg-token-main-surface-secondary md:w-1/3" tabindex="-1" data-radix-collection-item="">Public</button>
          </div>
          <div class="flex relative">${imageGalleryMenu()}</div>
        </div>
        <div id="gallery-selection-bar" class="hidden flex items-center justify-end py-3 w-full z-10">
          <button id="gallery-selection-cancel-button" class="flex items-center justify-center h-8 rounded-lg px-2 text-token-text-primary focus-visible:outline-0 hover:bg-token-main-surface-tertiary focus-visible:bg-token-main-surface-tertiary me-auto border border-token-border-medium">${translate("Cancel")}</button>
          <span id="gallery-selection-count" class="text-token-text-tertiary text-xs me-4">0 selected</span>
          <button id="gallery-selection-delete-button" class="flex items-center justify-center h-8 rounded-lg px-2 text-token-text-primary focus-visible:outline-0 hover:bg-token-main-surface-tertiary focus-visible:bg-token-main-surface-tertiary me-2 border border-token-border-medium">${translate("Delete")}</button>
          <button id="gallery-selection-make-public-button" class="flex items-center justify-center h-8 rounded-lg px-2 text-token-text-primary focus-visible:outline-0 hover:bg-token-main-surface-tertiary focus-visible:bg-token-main-surface-tertiary me-2 border border-token-border-medium">${translate("Make public")}</button>
          <button id="gallery-selection-download-button" class="flex items-center justify-center h-8 rounded-lg px-2 text-token-text-primary focus-visible:outline-0 hover:bg-token-main-surface-tertiary focus-visible:bg-token-main-surface-tertiary me-2 border border-token-border-medium ">${translate("Download")}</button>
        </div>
        <div id="gallery-search-term-pill" class="hidden flex items-center justify-center bg-token-main-surface-secondary text-token-text-primary rounded-full p-1 px-2 me-2 mt-2 border border-token-border-medium max-w-fit">
          <button id="gallery-search-term-pill-clear-button" class="focus-visible:outline-0 hover:bg-token-main-surface-tertiary focus-visible:bg-token-main-surface-tertiary rounded-full mx-1">
            <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="20" width="20" xmlns="http://www.w3.org/2000/svg"> <line x1="18" y1="6" x2="6" y2="18"></line> <line x1="6" y1="6" x2="18" y2="18"></line> </svg>
          </button>
          <span id="gallery-search-term-pill-text" class="text-sm mx-1 text-danger"></span>
        </div>
      </div>
      <div id="gallery-image-list" class="grid grid-cols-1 gap-0.25 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 overflow-y-auto"></div>
    </div>
  </div>
  <div id="image-gallery-sidebar" class="flex overflow-y-auto items-start justify-start overflow-hidden bg-token-sidebar-surface-secondary text-token-text-primary transition-[flex-basis] duration-500">
    <div class="w-[25vw]">
      <div class="flex flex-col w-full justify-start items-start gap-2 p-4" draggable="false">
        <img id="gallery-selected-image" style="aspect-ratio:1;background-color: #111;" src="${chrome.runtime.getURL("images/loading.gif")}" class="row-span-4 mx-auto h-full rounded-md object-scale-down">
        <div id="gallery-selected-image-timestamp" class="w-full text-xs text-token-text-tertiary">${selectedGalleryImage?.created_at?formatDate(new Date(selectedGalleryImage?.created_at)):"..."}</div>
      </div>
      <div class="flex flex-col items-start gap-3 p-4">
        <span id="gallery-selected-image-title-wrapper" class="w-full flex flex-col items-start gap-3 ${selectedGalleryImage?.title?"":"hidden"}">
          <div class="text-md text-token-text-primary" id="gallery-selected-image-title-title">Title</div>
          <div id="gallery-selected-image-title" class="w-full text-sm !whitespace-pre-wrap text-token-text-tertiary">${selectedGalleryImage?.title}</div>
        </span>

        <div class="flex flex-row space-between w-full items-center">
          <div class="text-md text-token-text-primary" id="gallery-selected-image-prompt-title">${imageGalleryCurrentTab==="chart"?"Code":"Prompt"}</div>
          
          <button id="gallery-selected-image-prompt-copy-button" class="ms-auto btn btn-small text-sm relative btn-secondary">
            <div class="flex w-full gap-2 items-center justify-center">
              <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5" height="1em" width="1em"
                xmlns="http://www.w3.org/2000/svg">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg>${translate("Copy")}
            </div>
          </button>
        </div>
        <div id="gallery-selected-image-prompt" class="w-full text-sm !whitespace-pre-wrap text-token-text-tertiary">${imageGalleryCurrentTab==="chart"?codeWrapper(selectedGalleryImage?.prompt)||"...":selectedGalleryImage?.prompt||"..."}</div>
        <div>
          <div class="flex flex-wrap my-1 text-xs items-center ${selectedGalleryImage?.gen_id&&["dalle","chart"].includes(imageGalleryCurrentTab)?"visible":"invisible"}">Gen ID:&nbsp;
            <div class="text-token-text-tertiary flex items-center cursor-pointer" id="gallery-selected-image-gen-id-copy-button">
              <span id="gallery-selected-image-gen-id">${selectedGalleryImage?.gen_id}</span>
              <button class="flex ms-1 gap-2 items-center rounded-md p-1 text-xs text-token-text-primary hover:text-token-text-primary">
                <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="icon icon-sm" height="1em" width="1em"
                  xmlns="http://www.w3.org/2000/svg">
                  <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
                  <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
                </svg>
              </button>
            </div>
          </div>

        </div>
        <button id="gallery-preview-conversation-button" data-conversation-id="${selectedGalleryImage?.conversation_id}" class="${imageGalleryCurrentTab!=="public"?"visible":"invisible"} btn relative gap-2 composer-submit-btn composer-submit-button-color">
          <svg
            xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" fill="currentColor" class="icon icon-md">
            <path d="M160 256C160 185.3 217.3 128 288 128C358.7 128 416 185.3 416 256C416 326.7 358.7 384 288 384C217.3 384 160 326.7 160 256zM288 336C332.2 336 368 300.2 368 256C368 211.8 332.2 176 288 176C287.3 176 286.7 176 285.1 176C287.3 181.1 288 186.5 288 192C288 227.3 259.3 256 224 256C218.5 256 213.1 255.3 208 253.1C208 254.7 208 255.3 208 255.1C208 300.2 243.8 336 288 336L288 336zM95.42 112.6C142.5 68.84 207.2 32 288 32C368.8 32 433.5 68.84 480.6 112.6C527.4 156 558.7 207.1 573.5 243.7C576.8 251.6 576.8 260.4 573.5 268.3C558.7 304 527.4 355.1 480.6 399.4C433.5 443.2 368.8 480 288 480C207.2 480 142.5 443.2 95.42 399.4C48.62 355.1 17.34 304 2.461 268.3C-.8205 260.4-.8205 251.6 2.461 243.7C17.34 207.1 48.62 156 95.42 112.6V112.6zM288 80C222.8 80 169.2 109.6 128.1 147.7C89.6 183.5 63.02 225.1 49.44 256C63.02 286 89.6 328.5 128.1 364.3C169.2 402.4 222.8 432 288 432C353.2 432 406.8 402.4 447.9 364.3C486.4 328.5 512.1 286 526.6 256C512.1 225.1 486.4 183.5 447.9 147.7C406.8 109.6 353.2 80 288 80V80z"/>
          </svg>${translate("Preview conversation")}
        </button>
        <div id="more-by" class="invisible cursor-pointer no-underline hover:underline" style="color:#3c80f5;">More images by this user</div>
      </div>
    </div>
  </div>
</div>`,e}function resetGallerySelection(){selectedImageGalleryImageIds=[],document.querySelectorAll('[id^="gallery-image-card-"]').forEach(o=>{o.classList.remove("opacity-50")}),document.querySelectorAll('[id^="image-gallery-checkbox"]').forEach(o=>{o.checked=!1,o.classList.add("invisible")});const e=document.querySelector('div[id="gallery-selection-bar"]');e&&e.classList.add("hidden");const t=document.querySelector('span[id="gallery-selection-count"]');t&&(t.innerText="0 selected")}function loadImageList(e=1,t=""){t=t||document.querySelector("#by-user-id")?.innerText||"";const o=document.querySelector("#gallery-search").value.toLowerCase(),r=document.querySelector("#gallery-image-list");e===1&&(r.innerHTML=`<div class="group relative flex flex-col w-full justify-start items-start gap-2 p-2 cursor-pointer"><div id="load-more-images-button" class="relative flex flex-col w-full h-full justify-center items-center gap-2 text-token-text-primary text-2xl font-bold cursor-pointer hover:shadow-xl rounded-xl"><img style="object-fit:none;aspect-ratio:1;background-color: #111;" src="${chrome.runtime.getURL("images/loading.gif")}" class="row-span-4 mx-auto h-full rounded-md object-scale-down"></div></div>`),chrome.runtime.sendMessage({type:"checkHasSubscription"},n=>{if(o&&!n){openUpgradeModal();return}e===1&&(selectedImageGalleryImageIds=[],selectedGalleryImage=null),chrome.runtime.sendMessage({type:"getGalleryImages",detail:{showAll,pageNumber:e,byUserId:t,category:imageGalleryCurrentTab==="public"?"dalle":imageGalleryCurrentTab,searchTerm:o,isPublic:imageGalleryCurrentTab==="public"}},i=>{if(e===1&&i.error){r.innerHTML=`<div class="flex flex-col w-full justify-start items-start p-2"><div class="relative flex flex-col w-full h-full justify-center items-center gap-2 p-4 text-token-text-primary text-2xl font-bold cursor-pointer bg-token-main-surface-secondary hover:shadow-xl rounded-xl text-center">${i.error}</div></div>`;return}if(e===1&&(allImageNodes.length=0),allImageNodes.push(...i?.results||[]),e===1&&i?.results?.length>0&&(selectedGalleryImage=i?.results?.[0]),!r)return;if(imageGalleryCurrentTab==="public"&&n)document.querySelector("#public-images-tip")||r.insertAdjacentHTML("beforebegin",'<div id="public-images-tip" class="flex flex-col w-full justify-start items-start"><div class="relative flex flex-col w-full h-full justify-center items-center gap-2 p-4 text-token-text-primary text-sm cursor-pointer bg-token-main-surface-secondary hover:shadow-xl rounded-xl text-center">To see public images, first you need to share some of your images. The more images you share, the more public images you will see.<br/>To share, go to the Images tab, select the images you would like to share, then select Make Public from the menu.</div></div>');else if(document.querySelector("#public-images-tip")?.remove(),allImageNodes.length===0){r.innerHTML=`<div class="flex flex-col w-full justify-start items-start p-2"><div class="relative flex flex-col w-full h-full justify-center items-center gap-2 p-4 text-token-text-primary text-2xl font-bold cursor-pointer bg-token-main-surface-secondary hover:shadow-xl rounded-xl text-center">${translate("No images found")}!</div></div> ${n?"":`<div class="group relative flex flex-col w-full justify-start items-start gap-2 p-2 cursor-pointer"><div id="upgrade-to-pro-button-gallery" class="relative flex flex-col flex-wrap w-full h-full justify-center items-center gap-2 p-1 text-black cursor-pointer bg-gold hover:bg-gold-dark hover:shadow-xl rounded-xl"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" style="width:42px; height:42px;" stroke="purple" fill="purple"><path d="M240.5 224H352C365.3 224 377.3 232.3 381.1 244.7C386.6 257.2 383.1 271.3 373.1 280.1L117.1 504.1C105.8 513.9 89.27 514.7 77.19 505.9C65.1 497.1 60.7 481.1 66.59 467.4L143.5 288H31.1C18.67 288 6.733 279.7 2.044 267.3C-2.645 254.8 .8944 240.7 10.93 231.9L266.9 7.918C278.2-1.92 294.7-2.669 306.8 6.114C318.9 14.9 323.3 30.87 317.4 44.61L240.5 224z"></path></svg><div class="w-full text-sm font-bold flex justify-center">${translate("Upgrade to Pro")}</div><div class="text-xs w-full flex justify-center">to see public images</div></div></div>`}`,addSubscriptionModalEventListeners();const s=document.querySelector("#gallery-selected-image");s.src=chrome.runtime.getURL(`images/placeholder-${imageGalleryCurrentTab}-image.png`);return}const a=`${[...i?.results||[]].map(s=>`<div class="group relative flex flex-col w-full justify-start items-start gap-2 p-2 cursor-pointer" style="font-size:12px;" draggable="false"><img id="gallery-image-card-${s.image_id}" src="${s.image||s.download_url}" alt="${s.prompt?.replace(/[^a-zA-Z0-9 ]/gi,"")||"Generated by ChatGPT"}" style="aspect-ratio:1;" class="bg-token-main-surface-tertiary w-full row-span-4 mx-auto h-full rounded-md object-scale-down ${selectedGalleryImage?.image_id===s?.image_id?"ring-2":""} ${isDarkMode()?"ring-white ring-offset-black":"ring-black ring-offset-white"} ring-offset-4">
      
        <div class="invisible absolute start-3 top-3 group-hover:visible"><button id="image-download-button-${s.image_id}" class="flex h-6 w-6 items-center justify-center rounded bg-black/50"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-sm text-token-text-primary"><path fill-rule="evenodd" clip-rule="evenodd" d="M7.70711 10.2929C7.31658 9.90237 6.68342 9.90237 6.29289 10.2929C5.90237 10.6834 5.90237 11.3166 6.29289 11.7071L11.2929 16.7071C11.6834 17.0976 12.3166 17.0976 12.7071 16.7071L17.7071 11.7071C18.0976 11.3166 18.0976 10.6834 17.7071 10.2929C17.3166 9.90237 16.6834 9.90237 16.2929 10.2929L13 13.5858L13 4C13 3.44771 12.5523 3 12 3C11.4477 3 11 3.44771 11 4L11 13.5858L7.70711 10.2929ZM5 19C4.44772 19 4 19.4477 4 20C4 20.5523 4.44772 21 5 21H19C19.5523 21 20 20.5523 20 20C20 19.4477 19.5523 19 19 19L5 19Z" fill="currentColor"></path></svg></button></div> 
        
        ${imageGalleryCurrentTab==="dalle"&&s.image_id.startsWith("file_000")?`<div class="invisible absolute start-3 bottom-3 group-hover:visible"><button id="image-share-button-${s.image_id}" class="flex h-6 w-6 items-center justify-center rounded bg-black/50"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-label="" class="icon icon-sm"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.2929 3.29289C11.6834 2.90237 12.3166 2.90237 12.7071 3.29289L16.7071 7.29289C17.0976 7.68342 17.0976 8.31658 16.7071 8.70711C16.3166 9.09763 15.6834 9.09763 15.2929 8.70711L13 6.41421V15C13 15.5523 12.5523 16 12 16C11.4477 16 11 15.5523 11 15V6.41421L8.70711 8.70711C8.31658 9.09763 7.68342 9.09763 7.29289 8.70711C6.90237 8.31658 6.90237 7.68342 7.29289 7.29289L11.2929 3.29289ZM4 14C4.55228 14 5 14.4477 5 15V18C5 18.5523 5.44772 19 6 19H18C18.5523 19 19 18.5523 19 18V15C19 14.4477 19.4477 14 20 14C20.5523 14 21 14.4477 21 15V18C21 19.6569 19.6569 21 18 21H6C4.34315 21 3 19.6569 3 18V15C3 14.4477 3.44772 14 4 14Z" fill="currentColor"></path></svg></button></div>`:""}
        
        <input type="checkbox" id="image-gallery-checkbox-${s.image_id}" class="${selectedImageGalleryImageIds.length===0?"invisible":""} absolute end-3 top-3 ${imageGalleryCurrentTab!=="public"?"group-hover:visible":""}" style="z-index: 11; cursor: pointer; border-radius: 2px;">
    
      </div>`).join("")}${i?.next&&n?'<div class="group relative flex flex-col w-full justify-start items-start gap-2 p-2 cursor-pointer"><div id="load-more-images-button" class="relative flex flex-col w-full h-full justify-center items-center gap-2 text-token-text-primary text-2xl font-bold cursor-pointer bg-token-main-surface-secondary hover:shadow-xl rounded-xl">Load more...</div></div>':n?"":`<div class="group relative flex flex-col w-full justify-start items-start gap-2 p-2 cursor-pointer"><div id="upgrade-to-pro-button-gallery" class="relative flex flex-col flex-wrap w-full h-full justify-center items-center gap-2 p-1 text-black cursor-pointer bg-gold hover:bg-gold-dark hover:shadow-xl rounded-xl"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" style="width:42px; height:42px;" stroke="purple" fill="purple"><path d="M240.5 224H352C365.3 224 377.3 232.3 381.1 244.7C386.6 257.2 383.1 271.3 373.1 280.1L117.1 504.1C105.8 513.9 89.27 514.7 77.19 505.9C65.1 497.1 60.7 481.1 66.59 467.4L143.5 288H31.1C18.67 288 6.733 279.7 2.044 267.3C-2.645 254.8 .8944 240.7 10.93 231.9L266.9 7.918C278.2-1.92 294.7-2.669 306.8 6.114C318.9 14.9 323.3 30.87 317.4 44.61L240.5 224z"></path></svg><div class="w-full text-sm font-bold flex justify-center">${translate("Upgrade to Pro")}</div><div class="text-xs w-full flex justify-center">to see ${imageGalleryCurrentTab==="public"?"more":"all"} images</div></div></div>`}`;e===1?r.innerHTML=a||"":(document.querySelector("#load-more-images-button")?.parentElement?.remove(),r.insertAdjacentHTML("beforeend",a||"")),addGalleryImageCardEventListeners(i?.results),addLoadMoreImagesEventListener(e),addSubscriptionModalEventListeners(),e===1&&document.querySelector(`#gallery-image-card-${allImageNodes[0]?.image_id}`)?.click(),loadMissingImages(i?.results)})})}function loadMissingImages(e){e?.forEach(async t=>{if(t.image)return;const o=[],r=await getDownloadUrlFromFileId(t.conversation_id,t.image_id,!1);if(r?.download_url){o.push({fileId:t.image_id,fileName:r.file_name,downloadUrl:r.download_url});const n=document.querySelector(`#gallery-image-card-${t.image_id}`)||document.querySelector(`#image-picker-image-card-${t.image_id}`);n&&(n.src=r.download_url)}downloadAndUploadImages(o)})}function addLoadMoreImagesEventListener(e){const t=document.querySelector("#load-more-images-button");t?.addEventListener("click",()=>{t.innerHTML=`<img style="object-fit:none;aspect-ratio:1;background-color: #111;" src="${chrome.runtime.getURL("images/loading.gif")}" class="row-span-4 mx-auto h-full rounded-md object-scale-down">`,loadImageList(e+1)});const o=new IntersectionObserver(r=>{r.forEach(n=>{n.isIntersecting&&t?.click()})},{threshold:.5});t&&o.observe(t)}function addImageGalleryEventListeners(){const e=document.querySelector("#gallery-search");e?.addEventListener("input",debounce(()=>{const c=document.querySelector("#gallery-search-term-pill"),u=document.querySelector("#gallery-search-term-pill-text");e.value.trim()!==""?(u.innerText=e.value.trim(),c.classList.remove("hidden")):(u.innerText="",c.classList.add("hidden")),resetSidebar(),loadImageList()})),document.querySelector("#gallery-search-term-pill-clear-button")?.addEventListener("click",()=>{const c=document.querySelector("#gallery-search-term-pill"),u=document.querySelector("#gallery-search-term-pill-text");e.value="",u.innerText="",c.classList.add("hidden"),resetSidebar(),loadImageList()});const t=document.querySelector("#gallery-tab-dalle"),o=document.querySelector("#gallery-tab-chart"),r=document.querySelector("#gallery-tab-upload"),n=document.querySelector("#gallery-tab-public");t?.addEventListener("click",()=>{if(showAll=!1,imageGalleryCurrentTab==="dalle")return;t.dataset.state="checked",o.dataset.state="unchecked",r.dataset.state="unchecked",n.dataset.state="unchecked",imageGalleryCurrentTab="dalle",document.querySelector("#gallery-search").value="";const c=document.querySelector("#gallery-search-term-pill"),u=document.querySelector("#gallery-search-term-pill-text");u.innerText="",c.classList.add("hidden"),resetSidebar(),resetGallerySelection(),removeUserFilter(),loadImageList()}),o?.addEventListener("click",()=>{if(showAll=!1,imageGalleryCurrentTab==="chart")return;t.dataset.state="unchecked",o.dataset.state="checked",r.dataset.state="unchecked",n.dataset.state="unchecked",imageGalleryCurrentTab="chart",document.querySelector("#gallery-search").value="";const c=document.querySelector("#gallery-search-term-pill"),u=document.querySelector("#gallery-search-term-pill-text");u.innerText="",c.classList.add("hidden"),resetSidebar(),resetGallerySelection(),removeUserFilter(),loadImageList()}),r?.addEventListener("click",()=>{if(showAll=!1,imageGalleryCurrentTab==="upload")return;t.dataset.state="unchecked",o.dataset.state="unchecked",r.dataset.state="checked",n.dataset.state="unchecked",imageGalleryCurrentTab="upload",document.querySelector("#gallery-search").value="";const c=document.querySelector("#gallery-search-term-pill"),u=document.querySelector("#gallery-search-term-pill-text");u.innerText="",c.classList.add("hidden"),resetSidebar(),resetGallerySelection(),removeUserFilter(),loadImageList()}),n?.addEventListener("click",c=>{if(showAll=!1,c.shiftKey&&(showAll=!0),imageGalleryCurrentTab==="public")return;t.dataset.state="unchecked",o.dataset.state="unchecked",r.dataset.state="unchecked",n.dataset.state="checked",imageGalleryCurrentTab="public",document.querySelector("#gallery-search").value="";const u=document.querySelector("#gallery-search-term-pill"),m=document.querySelector("#gallery-search-term-pill-text");m.innerText="",u.classList.add("hidden"),resetSidebar(),resetGallerySelection(),removeUserFilter(),loadImageList()}),document.querySelector("#gallery-selection-cancel-button")?.addEventListener("click",()=>{resetGallerySelection()}),document.querySelector("#gallery-selection-delete-button")?.addEventListener("click",()=>{deleteGalleryimages()}),document.querySelector("#gallery-selection-make-public-button")?.addEventListener("click",()=>{makeGalleryImagesPublic()});const i=document.querySelector("#gallery-selection-download-button");i?.addEventListener("click",async c=>{await downloadSelectedImages(i,selectedImageGalleryImageIds,null,!c.shiftKey)});const a=document.querySelector("#gallery-selected-image-prompt-copy-button");a?.addEventListener("click",c=>{if(c.shiftKey){if(imageGalleryCurrentTab!=="public"||!selectedGalleryImage?.created_by?.id)return;addUserFilter(selectedGalleryImage?.created_by),loadImageList(1,selectedGalleryImage?.created_by?.id);return}a.innerHTML=`<div class="flex w-full gap-2 items-center justify-center"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>${translate("Copied")}!</div>`,a.classList="opacity-50 hover:bg-inherit cursor-not-allowed btn btn-small text-sm relative btn-secondary block ms-auto",setTimeout(()=>{a.innerHTML=`<div class="flex w-full gap-2 items-center justify-center"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>${translate("Copy")}</div>`,a.classList="btn btn-small text-sm relative btn-secondary block ms-auto"},2e3);const u=document.querySelector("#gallery-selected-image-prompt");navigator.clipboard.writeText(u.textContent)});const s=document.querySelector("#gallery-selected-image-gen-id-copy-button");s?.addEventListener("click",()=>{navigator.clipboard.writeText(s.innerText),toast("Copied Gen ID to clipboard")});const l=document.querySelector("#gallery-preview-conversation-button");l.addEventListener("click",()=>{const{conversationId:c}=l.dataset;showConversationPreviewWrapper(c,null,!1,!0)}),document.querySelector("#more-by").addEventListener("click",()=>{selectedGalleryImage?.created_by?.id&&(addUserFilter(selectedGalleryImage?.created_by),loadImageList(1,selectedGalleryImage?.created_by?.id))});const d=document.querySelector("#image-gallery-menu-wrapper");document.querySelector("#image-gallery-menu-button")?.addEventListener("click",c=>{c.stopPropagation(),c.preventDefault(),closeMenus();const u=document.querySelector("#image-gallery-menu-options");if(u)u.remove();else{const m=imageGalleryMenuOptions();d.insertAdjacentHTML("beforeend",m),addImageGalleryMenuEventListener()}})}function addGalleryImageCardEventListeners(e){const t=[...document.querySelectorAll('[id^="image-download-button-"]')].slice(-24),o=e?.map(r=>r.image_id);t.forEach(r=>{addTooltip(r,{value:"Download",position:"top"});const n=r.id.split("image-download-button-")[1];n&&o?.includes(n)&&r?.addEventListener("click",i=>{const a=document.querySelector(`#gallery-image-card-${n}`),s=i.shiftKey?isWindows()?"jpg":"png":"webp",l=`${n}.${s}`;a.src&&downloadFileFromUrl(a.src,l)})}),[...document.querySelectorAll('[id^="image-share-button-"]')].slice(-24).forEach(r=>{addTooltip(r,{value:"Share",position:"top"});const n=r.id.split("image-share-button-")[1];n&&o?.includes(n)&&r?.addEventListener("click",()=>{const i=e.find(a=>a.image_id===n);i&&createShareImageModal(i)})}),document.querySelectorAll('[id^="image-gallery-checkbox"]').forEach(r=>{r.addEventListener("click",n=>{const i=r.id.split("image-gallery-checkbox-")[1];if(i&&o&&o?.includes(i))if(r.checked&&!selectedImageGalleryImageIds.includes(i)){if(selectedImageGalleryImageIds.length===0){document.querySelectorAll('[id^="image-gallery-checkbox"]').forEach(l=>{l.classList.remove("invisible")});const s=document.querySelector('div[id="gallery-selection-bar"]');s&&s.classList.remove("hidden")}if(n.shiftKey){if(selectedImageGalleryImageIds.length===0)return;const s=document.querySelectorAll('[id^="gallery-image-card-"]'),l=allImageNodes.findIndex(m=>m.image_id===selectedImageGalleryImageIds[selectedImageGalleryImageIds.length-1]),d=allImageNodes.findIndex(m=>m.image_id===i),c=Math.min(l,d),u=Math.max(l,d);for(let m=c;m<=u;m+=1){const g=s[m];if(!g)return;g.classList.add("opacity-50");const p=g.id.split("gallery-image-card-")[1];if(!p)return;const h=document.querySelector(`#image-gallery-checkbox-${p}`);h&&(h.checked=!0,selectedImageGalleryImageIds.includes(p)||selectedImageGalleryImageIds.push(p))}}else if(!selectedImageGalleryImageIds.includes(i)){const s=document.querySelector(`#gallery-image-card-${i}`);if(!s)return;s.classList.add("opacity-50"),selectedImageGalleryImageIds.push(i)}const a=document.querySelector('span[id="gallery-selection-count"]');a&&(a.innerText=`${selectedImageGalleryImageIds.length} selected`)}else{selectedImageGalleryImageIds=selectedImageGalleryImageIds.filter(l=>l!==i);const a=document.querySelector('span[id="gallery-selection-count"]');a&&(a.innerText=`${selectedImageGalleryImageIds.length} selected`);const s=document.querySelector(`#gallery-image-card-${i}`);s&&s.classList.remove("opacity-50"),selectedImageGalleryImageIds.length===0&&resetGallerySelection()}})}),document.querySelectorAll('[id^="gallery-image-card-"]').forEach(r=>{const n=r.id.split("gallery-image-card-")[1];n&&o&&o?.includes(n)&&r.addEventListener("click",()=>{selectedGalleryImage=e.find(h=>h.image_id===r.id.split("gallery-image-card-")[1]),document.querySelectorAll('[id^="gallery-image-card-"]').forEach(h=>{h.classList.remove("ring-2")}),r.classList.add("ring-2");const i=document.querySelector("#gallery-selected-image");i.src=r.src,i.style.aspectRatio=Math.min(1,(selectedGalleryImage?.width||1)/(selectedGalleryImage?.height||1));const a=document.querySelector("#gallery-selected-image-timestamp");a.textContent=formatDate(new Date(selectedGalleryImage.created_at));const s=document.querySelector("#gallery-selected-image-title-wrapper"),l=document.querySelector("#gallery-selected-image-title");l.textContent=selectedGalleryImage.title,selectedGalleryImage.title?s.classList.remove("hidden"):s.classList.add("hidden");const d=document.querySelector("#gallery-selected-image-prompt-title");d.textContent=selectedGalleryImage.category==="chart"?"Code":"Prompt";const c=document.querySelector("#gallery-selected-image-prompt");c.innerHTML=imageGalleryCurrentTab==="chart"?codeWrapper(selectedGalleryImage.prompt):selectedGalleryImage.prompt;const u=document.querySelector("#gallery-selected-image-prompt-copy-button");imageGalleryCurrentTab==="upload"?u.classList.add("hidden"):u.classList.remove("hidden");const m=document.querySelector("#gallery-search").value;m&&highlightSearch([c],m);const g=document.querySelector("#gallery-selected-image-gen-id"),p=document.querySelector("#gallery-preview-conversation-button");p.dataset.conversationId=selectedGalleryImage?.conversation_id||"",["upload","public"].includes(imageGalleryCurrentTab)?g.parentElement.parentElement.classList.add("invisible"):(g.textContent=selectedGalleryImage.gen_id,g.parentElement.parentElement.classList=`flex flex-wrap my-1 text-xs items-center  ${selectedGalleryImage.gen_id?"visible":"invisible"}`),["public"].includes(imageGalleryCurrentTab)?p.classList.add("invisible"):p.classList.remove("invisible")})})}function addUserFilter(e){removeUserFilter();const t=document.querySelector("#gallery-header"),o=document.createElement("div");o.id="gallery-filter",o.classList="flex items-center justify-between py-2 text-token-text-primary",o.innerHTML=`<div class="flex items-center gap-2 py-1 px-3 border border-token-border-medium rounded-full"><div class="text-xs">Images by user id: <span id="by-user-id">${e?.id}</span></div><button id="remove-filter-button" class="transition text-token-text-tertiary hover:text-token-text-primary" aria-label="remove filter" type="button"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="icon icon-md" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button></div>`,t.insertAdjacentElement("afterend",o),document.querySelector("#remove-filter-button")?.addEventListener("click",()=>{removeUserFilter(),loadImageList()})}const removeUserFilter=()=>{document.querySelectorAll("#gallery-filter").forEach(e=>e.remove())};function resetSidebar(){const e=document.querySelector("#gallery-selected-image");e.src=chrome.runtime.getURL("images/loading.gif"),e.style.aspectRatio=1;const t=document.querySelector("#gallery-selected-image-timestamp");t.textContent="...";const o=document.querySelector("#gallery-selected-image-prompt-title");o.textContent=imageGalleryCurrentTab==="chart"?"Code":"Prompt";const r=document.querySelector("#gallery-selected-image-prompt");r.innerHTML="...";const n=document.querySelector("#gallery-selected-image-gen-id"),i=document.querySelector("#gallery-preview-conversation-button"),a=document.querySelector("#image-gallery-menu-button");imageGalleryCurrentTab==="public"?(a?.classList?.add("invisible"),n.parentElement.parentElement.classList.add("invisible"),i.classList.add("invisible")):imageGalleryCurrentTab==="upload"?(a?.classList?.remove("invisible"),n.parentElement.parentElement.classList.add("invisible"),i.classList.remove("invisible")):(a?.classList?.remove("invisible"),n.parentElement.parentElement.classList.remove("invisible"),n.textContent="",i.classList.remove("invisible"))}function codeWrapper(e){if(!e)return"";const{language:t}=hljs.highlightAuto(e);return`<div class="overflow-y-auto" style="background: #333; padding: 8px; border-radius: 8px;"><code hljs language-${t} id="message-plugin-request-html-36053455-5209-4236-901d-a179d861f092" class="!whitespace-pre-wrap" style="font-size:12px;">${e}</code></div>`}function addSubscriptionModalEventListeners(){document.querySelector("#upgrade-to-pro-button-gallery")?.addEventListener("click",()=>{openUpgradeModal(!1)})}function showImagePicker(){selectedImagePickerImageIds=[];const e=`<div data-state="open" class="fixed inset-0 bg-black/50" style="pointer-events: auto;">
    <div class="h-full w-full grid grid-cols-[10px_1fr_10px] grid-rows-[minmax(10px,1fr)_auto_minmax(10px,1fr)] md:grid-rows-[minmax(20px,1fr)_auto_minmax(20px,1fr)] overflow-y-auto">
      <div id="image-picker-dialog-content" role="dialog" data-state="open" class="relative col-auto col-start-2 row-auto row-start-2 w-full rounded-xl text-start shadow-xl transition-all start-1/2 ltr:-translate-x-1/2 rtl:translate-x-1/2 bg-token-main-surface-secondary max-w-xl border-token-border-medium border" tabindex="-1" style="pointer-events: auto; width: 700px; max-width: 90vw;height: 500px; max-height: 90vh;">
        <div class="px-4 pb-4 pt-5 flex items-center justify-between border-b border-token-border-medium">
          <div class="flex">
            <div class="flex items-center">
              <div class="flex grow flex-col gap-1">
                <h2 as="h3" class="text-lg font-medium leading-6 text-token-text-primary">${translate("Select images")}</h2>
              </div>
            </div>
          </div>
        </div>
        <div class="p-4 flex flex-col overflow-hidden" style="height: calc(100% - 60px);">
          <div id="image-picker-image-list" class="grid grid-cols-5 content-start w-full h-full auto-rows-min text-xs text-token-text-primary overflow-y-auto rounded-md">
            ${Array.from({length:20}).map(n=>'<div class="relative flex flex-col justify-start items-start gap-2 p-2 cursor-pointer" draggable="false"><div style="aspect-ratio:1;" class="bg-token-main-surface-primary w-full row-span-4 mx-auto h-full rounded-md object-scale-down"></div></div>').join("")}
          </div>
          <div class="mt-5 flex justify-between">
            <div style="display: flex; justify-content: flex-start; align-items: center;">
              <span id="image-picker-selection-count" class="text-sm text-token-text-tertiary">0 selected</span>
            </div>
            <div class="flex flex-row-reverse gap-3 ms-auto">
              <button disabled id="confirm-button" class="btn relative btn-success text-white" as="button">
                <div class="flex w-full gap-2 items-center justify-center">${translate("Attach")}</div>
              </button>
              <button id="cancel-button" class="btn relative btn-secondary" as="button">
                <div class="flex w-full gap-2 items-center justify-center">${translate("Cancel")}</div>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  `,t=document.createElement("div");t.id="image-picker-dialog",t.classList="absolute inset-0",t.style="z-index: 100101;",t.innerHTML=e,document.body.appendChild(t);const o=document.querySelector("#image-picker-dialog #confirm-button"),r=document.querySelector("#image-picker-dialog #cancel-button");o.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation(),closeMenus();const i=Array.from(document.querySelectorAll('[id^="image-picker-checkbox"]:checked')).map(a=>({imageId:a.id.split("image-picker-checkbox-")[1],imageUrl:document.querySelector(`#image-picker-image-card-${a.id.split("image-picker-checkbox-")[1]}`)?.src}));if(i.length===0){toast("No images selected","error");return}attachImagesToInput(i),t.remove()}),r.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation(),closeMenus(),t.remove()}),t.addEventListener("click",n=>{if(document.querySelector("#image-picker-dialog #confirm-button").querySelector("#progress-spinner"))return;const i=document.querySelector("#image-picker-dialog-content");isDescendant(i,n.target)||t.remove()}),getImagesForPage(1)}async function getImagesForPage(e){const t=document.querySelector("#image-picker-image-list"),o=await chrome.runtime.sendMessage({type:"getGalleryImages",detail:{pageNumber:e,category:"all",searchTerm:""}});if(!o||!o.results||o.results.length===0)return;const r=o?.next,n=`${o.results.map(i=>`<div class="group relative flex flex-col justify-start items-start gap-2 p-2 cursor-pointer" draggable="false"><img id="image-picker-image-card-${i.image_id}" src="${i.image||i.download_url}" alt="${i.prompt?.replace(/[^a-zA-Z0-9 ]/gi,"")||"Generated by ChatGPT"}" style="aspect-ratio:1;" class="bg-token-main-surface-primary border border-token-border-medium w-full row-span-4 mx-auto h-full rounded-md object-scale-down">
    <input type="checkbox" id="image-picker-checkbox-${i.image_id}" class="${selectedImagePickerImageIds.length===0?"invisible":""} absolute end-3 top-3 group-hover:visible" style="z-index: 11; cursor: pointer; border-radius: 2px;">
  </div>`).join("")}`;e===1?t.innerHTML=n:(document.querySelector("#load-more-images-button")?.parentElement?.remove(),t.insertAdjacentHTML("beforeend",n)),r&&t.insertAdjacentHTML("beforeend",'<div class="flex flex-col w-full justify-start items-start gap-2 p-2 w-full" style="aspect-ratio:1;"><div id="load-more-images-button" class="relative flex flex-col w-full h-full justify-center items-center text-token-text-primary text-2xl font-bold cursor-pointer bg-token-main-surface-secondary hover:shadow-xl rounded-xl">Load more...</div></div>'),loadMissingImages(o?.results),addImagePickerEventListeners(o.results,e)}function addImagePickerEventListeners(e,t){const o=e?.map(i=>i.image_id);document.querySelectorAll('[id^="image-picker-image-card"]').forEach(i=>{const a=i.id.split("image-picker-image-card-")[1];a&&o?.includes(a)&&i.addEventListener("click",()=>{const s=document.querySelector(`#image-picker-checkbox-${a}`);s&&s.click()})}),document.querySelectorAll('[id^="image-picker-checkbox"]').forEach(i=>{i.addEventListener("click",a=>{if(a.stopPropagation(),selectedImagePickerImageIds.length>=10&&i.checked){a.preventDefault(),toast("Maximum 10 images can be selected","error");return}const s=i.id.split("image-picker-checkbox-")[1];if(s&&o&&o?.includes(s))if(i.checked&&!selectedImagePickerImageIds.includes(s)){const l=document.querySelector("#image-picker-dialog #confirm-button");if(l.disabled=!1,selectedImagePickerImageIds.length===0&&document.querySelectorAll('[id^="image-picker-checkbox"]').forEach(c=>{c.classList.remove("invisible")}),!selectedImagePickerImageIds.includes(s)){const c=document.querySelector(`#image-picker-image-card-${s}`);if(!c)return;c.classList.add("opacity-50"),selectedImagePickerImageIds.push(s)}const d=document.querySelector('span[id="image-picker-selection-count"]');d&&(d.innerText=`${selectedImagePickerImageIds.length} selected`)}else{selectedImagePickerImageIds=selectedImagePickerImageIds.filter(c=>c!==s);const l=document.querySelector('span[id="image-picker-selection-count"]');l&&(l.innerText=`${selectedImagePickerImageIds.length} selected`);const d=document.querySelector(`#image-picker-image-card-${s}`);d&&d.classList.remove("opacity-50"),selectedImagePickerImageIds.length===0&&resetImagePickerSelection()}})});const r=document.querySelector("#load-more-images-button");r?.addEventListener("click",()=>{r.innerHTML=`<img style="object-fit:none;aspect-ratio:1;background-color: #111;" src="${chrome.runtime.getURL("images/loading.gif")}" class="row-span-4 mx-auto h-full rounded-md object-scale-down">`,getImagesForPage(t+1)});const n=new IntersectionObserver(i=>{i.forEach(a=>{a.isIntersecting&&r?.click()})},{threshold:.5});r&&n.observe(r)}function resetImagePickerSelection(){const e=document.querySelector("#image-picker-dialog #confirm-button");e.disabled=!0,document.querySelectorAll('[id^="image-picker-image-card-"]').forEach(o=>{o.classList.remove("opacity-50")}),document.querySelectorAll('[id^="image-picker-checkbox"]').forEach(o=>{o.checked=!1,o.classList.add("invisible")});const t=document.querySelector('span[id="image-picker-selection-count"]');t&&(t.innerText="0 selected")}function createShareImageModal(e){const t=`<div id="share-image-modal" class="absolute inset-0 max-w-[664px] px-4">
    <div id="share-image-modal-content" class="fixed inset-0" data-state="open" style="pointer-events: auto; backdrop-filter: blur(4px); background-color: rgba(0, 0, 0, 0.8); z-index: 100000;">
      <div class="z-50 h-full w-full overflow-y-auto grid grid-cols-[10px_1fr_10px] grid-rows-[minmax(10px,1fr)_auto_minmax(10px,1fr)] md:grid-rows-[minmax(20px,1fr)_auto_minmax(20px,1fr)]" style="opacity: 1; transform: none;">
        <div id="share-image-modal-dialog" role="dialog" aria-describedby="" aria-labelledby="radix-\xABr46\xBB" data-state="open" class="popover bg-token-sidebar-surface relative start-1/2 col-auto col-start-2 row-auto row-start-2 h-full w-full gap-4 p-4 text-start ltr:-translate-x-1/2 rtl:translate-x-1/2 dark:bg-[#171717] rounded-[36px] shadow-[0_32px_48px_rgba(0,0,0,0.175),_0_0_1px_rgba(0,0,0,0.2)] dark:shadow-[0_32px_48px_rgba(0,0,0,0.175),_0_0_1px_rgba(255,255,255,0.4)] flex flex-col pb-4 focus:outline-hidden max-w-[640px]" aria-description="Share sheet" tabindex="-1" style="pointer-events: auto;">
          <div class="px-4 pb-2 sm:p-6 flex items-center justify-between border-b border-black/10 dark:border-white/10">
            <div class="flex max-w-full">
              <div class="flex max-w-full min-w-0 items-center">
                <div class="flex max-w-full min-w-0 grow flex-col gap-1">
                  <h2 id="share-image-title" class="text-token-text-primary text-3xl leading-6 font-semibold tracking-tight max-sm:text-xl">${e.title}</h2>
                </div>
              </div>
            </div>
            <div class="flex items-center gap-5">
              <button id="share-image-close-button" data-testid="close-button" class="hover:bg-token-main-surface-secondary focus-visible:ring-token-text-quaternary dark:hover:bg-token-main-surface-tertiary flex h-8 w-8 items-center justify-center rounded-full focus-visible:ring-2 focus-visible:ring-offset-1 focus-visible:ring-offset-transparent focus-visible:outline-hidden bg-transparent sm:mt-0" aria-label="Close" type="button">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                  xmlns="http://www.w3.org/2000/svg" class="icon icon-md">
                  <path fill-rule="evenodd" clip-rule="evenodd" d="M5.63603 5.63604C6.02656 5.24552 6.65972 5.24552 7.05025 5.63604L12 10.5858L16.9497 5.63604C17.3403 5.24552 17.9734 5.24552 18.364 5.63604C18.7545 6.02657 18.7545 6.65973 18.364 7.05025L13.4142 12L18.364 16.9497C18.7545 17.3403 18.7545 17.9734 18.364 18.364C17.9734 18.7545 17.3403 18.7545 16.9497 18.364L12 13.4142L7.05025 18.364C6.65972 18.7545 6.02656 18.7545 5.63603 18.364C5.24551 17.9734 5.24551 17.3403 5.63603 16.9497L10.5858 12L5.63603 7.05025C5.24551 6.65973 5.24551 6.02657 5.63603 5.63604Z" fill="currentColor"></path>
                </svg>
              </button>
            </div>
          </div>
          <div>
            <div class="max-xs:max-h-[260px] flex h-[30vh] max-h-[550px] max-w-full justify-center rounded-xl max-sm:max-h-[300px]">
              <img class="rounded-xl" alt="${e.title}" src="${e.image||e.download_url}">
            </div>
            <div class="mt-12 flex flex-wrap justify-center space-y-4 space-x-12 max-sm:mt-6 max-sm:space-x-6">
              <button id="share-image-copy-link" class="relative flex flex-col gap-y-4 disabled:opacity-50 max-sm:gap-y-2">
                <div class="shadow-token-border-default flex h-16 w-16 items-center justify-center rounded-full shadow-md max-sm:h-12 max-sm:w-12">
                  <div class="pointer-events-none flex h-8 w-8 items-center justify-center max-sm:h-6 max-sm:w-6">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                      xmlns="http://www.w3.org/2000/svg">
                      <path fill-rule="evenodd" clip-rule="evenodd" d="M18.2929 5.70711C16.4743 3.88849 13.5257 3.88849 11.7071 5.7071L10.7071 6.70711C10.3166 7.09763 9.68341 7.09763 9.29289 6.70711C8.90236 6.31658 8.90236 5.68342 9.29289 5.29289L10.2929 4.29289C12.8926 1.69323 17.1074 1.69323 19.7071 4.29289C22.3068 6.89256 22.3068 11.1074 19.7071 13.7071L18.7071 14.7071C18.3166 15.0976 17.6834 15.0976 17.2929 14.7071C16.9024 14.3166 16.9024 13.6834 17.2929 13.2929L18.2929 12.2929C20.1115 10.4743 20.1115 7.52572 18.2929 5.70711ZM15.7071 8.29289C16.0976 8.68342 16.0976 9.31658 15.7071 9.70711L9.7071 15.7071C9.31658 16.0976 8.68341 16.0976 8.29289 15.7071C7.90236 15.3166 7.90236 14.6834 8.29289 14.2929L14.2929 8.29289C14.6834 7.90237 15.3166 7.90237 15.7071 8.29289ZM6.7071 9.29289C7.09763 9.68342 7.09763 10.3166 6.7071 10.7071L5.7071 11.7071C3.88849 13.5257 3.88849 16.4743 5.7071 18.2929C7.52572 20.1115 10.4743 20.1115 12.2929 18.2929L13.2929 17.2929C13.6834 16.9024 14.3166 16.9024 14.7071 17.2929C15.0976 17.6834 15.0976 18.3166 14.7071 18.7071L13.7071 19.7071C11.1074 22.3068 6.89255 22.3068 4.29289 19.7071C1.69322 17.1074 1.69322 12.8926 4.29289 10.2929L5.29289 9.29289C5.68341 8.90237 6.31658 8.90237 6.7071 9.29289Z" fill="currentColor"></path>
                    </svg>
                  </div>
                </div>
                <div class="w-full text-center text-xs">Copy link</div>
              </button>
              <button id="share-image-twitter" class="relative flex flex-col gap-y-4 disabled:opacity-50 max-sm:gap-y-2">
                <div class="shadow-token-border-default flex h-16 w-16 items-center justify-center rounded-full shadow-md max-sm:h-12 max-sm:w-12">
                  <div class="pointer-events-none flex h-8 w-8 items-center justify-center max-sm:h-6 max-sm:w-6">
                    <div>
                      <svg width="40" height="40" viewBox="0 0 40 40" fill="none"
                        xmlns="http://www.w3.org/2000/svg">
                        <rect width="40" height="40" rx="20"></rect>
                        <path d="M23.989 13.377H26.2902L21.2641 19.1201L27.1768 26.9363H22.5483L18.9206 22.197L14.7745 26.9363H12.4701L17.8449 20.7922L12.1768 13.377H16.9225L20.1983 17.7088L23.989 13.377ZM23.1807 25.5608H24.4551L16.2283 14.6807H14.8593L23.1807 25.5608Z" fill="var(--text-primary)"></path>
                      </svg>
                    </div>
                  </div>
                </div>
                <div class="w-full text-center text-xs">X</div>
              </button>
              <button id="share-image-linkedin" class="relative flex flex-col gap-y-4 disabled:opacity-50 max-sm:gap-y-2">
                <div class="shadow-token-border-default flex h-16 w-16 items-center justify-center rounded-full shadow-md max-sm:h-12 max-sm:w-12">
                  <div class="pointer-events-none flex h-8 w-8 items-center justify-center max-sm:h-6 max-sm:w-6">
                    <div>
                      <svg width="40" height="40" viewBox="0 0 40 40" fill="none"
                        xmlns="http://www.w3.org/2000/svg">
                        <rect width="40" height="40" rx="20"></rect>
                        <path d="M27.65 11H12.35C11.992 11 11.6486 11.1422 11.3954 11.3954C11.1422 11.6486 11 11.992 11 12.35V27.65C11 28.008 11.1422 28.3514 11.3954 28.6046C11.6486 28.8578 11.992 29 12.35 29H27.65C28.008 29 28.3514 28.8578 28.6046 28.6046C28.8578 28.3514 29 28.008 29 27.65V12.35C29 11.992 28.8578 11.6486 28.6046 11.3954C28.3514 11.1422 28.008 11 27.65 11ZM16.4 26.3H13.7V18.2H16.4V26.3ZM15.05 16.625C14.7406 16.6162 14.4406 16.5163 14.1876 16.338C13.9346 16.1596 13.7397 15.9107 13.6274 15.6222C13.515 15.3337 13.4902 15.0186 13.5559 14.7161C13.6217 14.4136 13.7751 14.1372 13.9971 13.9214C14.2191 13.7056 14.4997 13.56 14.8039 13.5028C15.1081 13.4456 15.4225 13.4793 15.7077 13.5997C15.9928 13.7201 16.2362 13.9219 16.4074 14.1798C16.5785 14.4378 16.6699 14.7404 16.67 15.05C16.6629 15.4733 16.4885 15.8766 16.1849 16.1717C15.8814 16.4669 15.4733 16.6298 15.05 16.625ZM26.3 26.3H23.6V22.034C23.6 20.756 23.06 20.297 22.358 20.297C22.1522 20.3107 21.9511 20.3649 21.7663 20.4566C21.5815 20.5482 21.4166 20.6755 21.2811 20.831C21.1457 20.9866 21.0422 21.1674 20.9768 21.363C20.9114 21.5586 20.8853 21.7652 20.9 21.971C20.8955 22.0129 20.8955 22.0551 20.9 22.097V26.3H18.2V18.2H20.81V19.37C21.0733 18.9695 21.435 18.6433 21.8605 18.4227C22.286 18.2021 22.761 18.0944 23.24 18.11C24.635 18.11 26.264 18.884 26.264 21.404L26.3 26.3Z" fill="var(--text-primary)"></path>
                      </svg>
                    </div>
                  </div>
                </div>
                <div class="w-full text-center text-xs">LinkedIn</div>
              </button>
              <button id="share-image-reddit" class="relative flex flex-col gap-y-4 disabled:opacity-50 max-sm:gap-y-2">
                <div class="shadow-token-border-default flex h-16 w-16 items-center justify-center rounded-full shadow-md max-sm:h-12 max-sm:w-12">
                  <div class="pointer-events-none flex h-8 w-8 items-center justify-center max-sm:h-6 max-sm:w-6">
                    <div>
                      <svg width="40" height="40" viewBox="0 0 40 40" fill="none"
                        xmlns="http://www.w3.org/2000/svg">
                        <rect width="40" height="40" rx="20"></rect>
                        <path d="M24.5703 15.1641C23.5859 15.1641 22.7617 14.4805 22.543 13.5625C21.3477 13.7305 20.4258 14.7617 20.4258 16V16.0078C22.2773 16.0781 23.9648 16.5977 25.3047 17.4258C25.7969 17.0469 26.4141 16.8203 27.082 16.8203C28.6953 16.8203 30 18.125 30 19.7383C30 20.9023 29.3203 21.9062 28.332 22.375C28.2383 25.7656 24.543 28.4922 20.0039 28.4922C15.4648 28.4922 11.7773 25.7695 11.6797 22.3828C10.6875 21.918 10 20.9102 10 19.7383C10 18.125 11.3047 16.8203 12.918 16.8203C13.5898 16.8203 14.207 17.0469 14.7031 17.4297C16.0312 16.6055 17.7031 16.0859 19.5352 16.0078V15.9961C19.5352 14.2656 20.8516 12.8359 22.5352 12.6562C22.7266 11.7109 23.5625 11 24.5703 11C25.7188 11 26.6523 11.9336 26.6523 13.082C26.6523 14.2305 25.7188 15.1641 24.5703 15.1641ZM16.1523 19.7227C15.3359 19.7227 14.6328 20.5352 14.582 21.5938C14.5312 22.6523 15.25 23.082 16.0664 23.082C16.8828 23.082 17.4961 22.6992 17.543 21.6406C17.5898 20.582 16.9688 19.7227 16.1484 19.7227H16.1523ZM25.4297 21.5898C25.3828 20.5312 24.6797 19.7188 23.8594 19.7188C23.0391 19.7188 22.418 20.5781 22.4648 21.6367C22.5117 22.6953 23.125 23.0781 23.9414 23.0781C24.7578 23.0781 25.4766 22.6484 25.4258 21.5898H25.4297ZM23.082 24.3555C23.1406 24.2148 23.043 24.0547 22.8906 24.0391C21.9922 23.9492 21.0195 23.8984 20.0078 23.8984C18.9961 23.8984 18.0234 23.9492 17.125 24.0391C16.9727 24.0547 16.875 24.2148 16.9336 24.3555C17.4375 25.5586 18.625 26.4023 20.0078 26.4023C21.3906 26.4023 22.5781 25.5586 23.082 24.3555Z" fill="var(--text-primary)"></path>
                      </svg>
                    </div>
                  </div>
                </div>
                <div class="w-full text-center text-xs">Reddit</div>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>`;document.body.insertAdjacentHTML("beforeend",t),addShareModalEventListeners(e)}function addShareModalEventListeners(e){const t=document.querySelector("#share-image-modal-content"),o=document.querySelector("#share-image-modal-dialog");t.addEventListener("click",d=>{isDescendant(o,d.target)||document.querySelector("#share-image-modal").remove()});const r=document.querySelector("#share-image-close-button"),n=document.querySelector("#share-image-copy-link"),i=document.querySelector("#share-image-twitter"),a=document.querySelector("#share-image-linkedin"),s=document.querySelector("#share-image-reddit"),l=async()=>{const d={share_id:e.image_id,attachments_to_create:[{conversation_id:e.conversation_id,file_id:e.image_id,height:e.height,width:e.width,kind:"image_share"}],post_text:e.title};return(await sharePost(d))?.post?.permalink||(toast("Failed to copy link","error"),null)};r.addEventListener("click",()=>{const d=document.querySelector("#share-image-modal");d&&d.remove()}),n.addEventListener("click",async()=>{const d=await l();d&&(await navigator.clipboard.writeText(d),toast("Link copied to clipboard","success"))}),i.addEventListener("click",async()=>{const d=await l();d&&window.open(`https://twitter.com/intent/tweet?url=${d}&text=${e.title}`,"_blank")}),a.addEventListener("click",async()=>{const d=await l();d&&window.open(`https://www.linkedin.com/shareArticle?mini=true&url=${d}&text=${e.title}`,"_blank")}),s.addEventListener("click",async()=>{const d=await l();d&&window.open(`https://www.reddit.com/submit?url=${d}&title=${e.title}`,"_blank")})}function rowAssistant(e,t,o,r,n,i,a=!1,s=!1){const{customConversationWidth:l,conversationWidth:d,showMessageTimestamp:c,showWordCount:u}=cachedSettings,{pinned:m,message:g}=t[t.length-1],{id:p,metadata:h}=g;let f=g.create_time;f||(f=new Date().toISOString());const v=h.model_slug,x=new Date(formatTime(f)).toLocaleString(),y=n?.find($=>$.slug===v)?.title,b=i&&i?.resource?.gizmo?.id===t[0]?.message?.metadata?.gizmo_id?i?.resource?.gizmo?.display?.profile_picture_url:"https://upload.wikimedia.org/wikipedia/commons/c/ca/1x1.png",w=i&&i?.resource?.gizmo?.id===t[0]?.message?.metadata?.gizmo_id?i?.resource?.gizmo?.display?.name:"&nbsp;";let k="",S=0,M=0;for(let $=0;$<t.length;$+=1){const q=t[$],E=q.message?.role||q.message?.author?.role,C=q.message?.recipient;if(E==="assistant"){if(q.message?.content?.content_type==="model_editable_context")continue;if(C==="all"){const{renderedNode:L,wordCount:_,charCount:T}=assistantRenderer(q,s);k+=L,S+=_,M+=T}else k+=pluginDropdownRenderer(q,a,!1)}else if(C==="all"){const L="invoked_plugin"in q.message.metadata||q.message.author.name==="python",_=q.message.author.name==="a8km123",T=q?.message?.content?.text?.includes("<<ImageDisplayed>>");if(L)if(T)k+=pythonImageSkeleton(q);else{const z=document.createElement("div");z.innerHTML=k,[...z.querySelectorAll("[id^=message-plugin-content-]")].pop()?.insertAdjacentHTML("beforeend",pluginContentRenderer(q)),k=z.innerHTML}else _&&(k+=strawberryDropdownRenderer(q))}else if(C==="assistant"){const L=q,_=e.mapping[L.children[o-1]];k+=actionConfirmationRenderer(L,_,w)}}return`<article id="message-wrapper-${p}" data-role="assistant"
  class="group w-full p-5 pb-0 text-token-text-primary ${m?"border-l-pinned bg-pinned dark:bg-pinned border-b scroll-margin-top-60":"bg-token-main-surface-primary"}">
  <div class="relative text-base gap-4 m-auto md:max-w-2xl lg:max-w-2xl xl:max-w-3xl flex" style="${l?`max-width:${d}%`:""}">
    <div class="flex-shrink-0 flex flex-col relative items-end">
    ${i||t[0]?.message?.metadata?.gizmo_id?`<div class="gizmo-shadow-stroke relative flex h-8 w-8"><img id="gizmo-avatar" data-gizmoid="${t[0]?.message?.metadata?.gizmo_id||i?.resource?.gizmo?.id}" src="${b}" class="h-full w-full bg-token-main-surface-tertiary rounded-full" alt="GPT" width="80" height="80">
        </div>`:`<div class="gizmo-bot-avatar flex h-8 w-8 items-center justify-center overflow-hidden rounded-full"><div style="width:24px;height:24px;" title="${y}"
        class="relative p-1 rounded-sm flex items-center justify-center bg-token-main-surface-primary text-token-text-primary h-8 w-8"><svg width="41" height="41" viewBox="0 0 41 41" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md" role="img"><text x="-9999" y="-9999">ChatGPT</text><path d="M37.5324 16.8707C37.9808 15.5241 38.1363 14.0974 37.9886 12.6859C37.8409 11.2744 37.3934 9.91076 36.676 8.68622C35.6126 6.83404 33.9882 5.3676 32.0373 4.4985C30.0864 3.62941 27.9098 3.40259 25.8215 3.85078C24.8796 2.7893 23.7219 1.94125 22.4257 1.36341C21.1295 0.785575 19.7249 0.491269 18.3058 0.500197C16.1708 0.495044 14.0893 1.16803 12.3614 2.42214C10.6335 3.67624 9.34853 5.44666 8.6917 7.47815C7.30085 7.76286 5.98686 8.3414 4.8377 9.17505C3.68854 10.0087 2.73073 11.0782 2.02839 12.312C0.956464 14.1591 0.498905 16.2988 0.721698 18.4228C0.944492 20.5467 1.83612 22.5449 3.268 24.1293C2.81966 25.4759 2.66413 26.9026 2.81182 28.3141C2.95951 29.7256 3.40701 31.0892 4.12437 32.3138C5.18791 34.1659 6.8123 35.6322 8.76321 36.5013C10.7141 37.3704 12.8907 37.5973 14.9789 37.1492C15.9208 38.2107 17.0786 39.0587 18.3747 39.6366C19.6709 40.2144 21.0755 40.5087 22.4946 40.4998C24.6307 40.5054 26.7133 39.8321 28.4418 38.5772C30.1704 37.3223 31.4556 35.5506 32.1119 33.5179C33.5027 33.2332 34.8167 32.6547 35.9659 31.821C37.115 30.9874 38.0728 29.9178 38.7752 28.684C39.8458 26.8371 40.3023 24.6979 40.0789 22.5748C39.8556 20.4517 38.9639 18.4544 37.5324 16.8707ZM22.4978 37.8849C20.7443 37.8874 19.0459 37.2733 17.6994 36.1501C17.7601 36.117 17.8666 36.0586 17.936 36.0161L25.9004 31.4156C26.1003 31.3019 26.2663 31.137 26.3813 30.9378C26.4964 30.7386 26.5563 30.5124 26.5549 30.2825V19.0542L29.9213 20.998C29.9389 21.0068 29.9541 21.0198 29.9656 21.0359C29.977 21.052 29.9842 21.0707 29.9867 21.0902V30.3889C29.9842 32.375 29.1946 34.2791 27.7909 35.6841C26.3872 37.0892 24.4838 37.8806 22.4978 37.8849ZM6.39227 31.0064C5.51397 29.4888 5.19742 27.7107 5.49804 25.9832C5.55718 26.0187 5.66048 26.0818 5.73461 26.1244L13.699 30.7248C13.8975 30.8408 14.1233 30.902 14.3532 30.902C14.583 30.902 14.8088 30.8408 15.0073 30.7248L24.731 25.1103V28.9979C24.7321 29.0177 24.7283 29.0376 24.7199 29.0556C24.7115 29.0736 24.6988 29.0893 24.6829 29.1012L16.6317 33.7497C14.9096 34.7416 12.8643 35.0097 10.9447 34.4954C9.02506 33.9811 7.38785 32.7263 6.39227 31.0064ZM4.29707 13.6194C5.17156 12.0998 6.55279 10.9364 8.19885 10.3327C8.19885 10.4013 8.19491 10.5228 8.19491 10.6071V19.808C8.19351 20.0378 8.25334 20.2638 8.36823 20.4629C8.48312 20.6619 8.64893 20.8267 8.84863 20.9404L18.5723 26.5542L15.206 28.4979C15.1894 28.5089 15.1703 28.5155 15.1505 28.5173C15.1307 28.5191 15.1107 28.516 15.0924 28.5082L7.04046 23.8557C5.32135 22.8601 4.06716 21.2235 3.55289 19.3046C3.03862 17.3858 3.30624 15.3413 4.29707 13.6194ZM31.955 20.0556L22.2312 14.4411L25.5976 12.4981C25.6142 12.4872 25.6333 12.4805 25.6531 12.4787C25.6729 12.4769 25.6928 12.4801 25.7111 12.4879L33.7631 17.1364C34.9967 17.849 36.0017 18.8982 36.6606 20.1613C37.3194 21.4244 37.6047 22.849 37.4832 24.2684C37.3617 25.6878 36.8382 27.0432 35.9743 28.1759C35.1103 29.3086 33.9415 30.1717 32.6047 30.6641C32.6047 30.5947 32.6047 30.4733 32.6047 30.3889V21.188C32.6066 20.9586 32.5474 20.7328 32.4332 20.5338C32.319 20.3348 32.154 20.1698 31.955 20.0556ZM35.3055 15.0128C35.2464 14.9765 35.1431 14.9142 35.069 14.8717L27.1045 10.2712C26.906 10.1554 26.6803 10.0943 26.4504 10.0943C26.2206 10.0943 25.9948 10.1554 25.7963 10.2712L16.0726 15.8858V11.9982C16.0715 11.9783 16.0753 11.9585 16.0837 11.9405C16.0921 11.9225 16.1048 11.9068 16.1207 11.8949L24.1719 7.25025C25.4053 6.53903 26.8158 6.19376 28.2383 6.25482C29.6608 6.31589 31.0364 6.78077 32.2044 7.59508C33.3723 8.40939 34.2842 9.53945 34.8334 10.8531C35.3826 12.1667 35.5464 13.6095 35.3055 15.0128ZM14.2424 21.9419L10.8752 19.9981C10.8576 19.9893 10.8423 19.9763 10.8309 19.9602C10.8195 19.9441 10.8122 19.9254 10.8098 19.9058V10.6071C10.8107 9.18295 11.2173 7.78848 11.9819 6.58696C12.7466 5.38544 13.8377 4.42659 15.1275 3.82264C16.4173 3.21869 17.8524 2.99464 19.2649 3.1767C20.6775 3.35876 22.0089 3.93941 23.1034 4.85067C23.0427 4.88379 22.937 4.94215 22.8668 4.98473L14.9024 9.58517C14.7025 9.69878 14.5366 9.86356 14.4215 10.0626C14.3065 10.2616 14.2466 10.4877 14.2479 10.7175L14.2424 21.9419ZM16.071 17.9991L20.4018 15.4978L24.7325 17.9975V22.9985L20.4018 25.4983L16.071 22.9985V17.9991Z" fill="currentColor"></path></svg></div></div>`}
      
    </div>
    <div class="relative flex flex-col agent-turn" style="width:calc(100% - 80px);">
      <div class="flex flex-grow flex-col gap-1 max-w-full">
        ${k}
        <div id="message-action-wrapper-${p}" class="flex justify-between empty:hidden lg:block">
        <div class="text-token-text-secondary flex self-end mt-2 visible gap-1">

        <div id="thread-buttons-wrapper-${p}" class="text-xs flex items-center justify-center gap-1 self-center ${r===1?"hidden":""}"><button id="thread-prev-button-${p}" class="flex h-[30px] w-[30px] items-center justify-center rounded-md hover:bg-token-main-surface-secondary disabled:opacity-50 disabled:hover:bg-transparent" rounded-lg hover:bg-token-main-surface-secondary ${o===1?"disabled":""}><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md-heavy"><path fill-rule="evenodd" clip-rule="evenodd" d="M14.7071 5.29289C15.0976 5.68342 15.0976 6.31658 14.7071 6.70711L9.41421 12L14.7071 17.2929C15.0976 17.6834 15.0976 18.3166 14.7071 18.7071C14.3166 19.0976 13.6834 19.0976 13.2929 18.7071L7.29289 12.7071C7.10536 12.5196 7 12.2652 7 12C7 11.7348 7.10536 11.4804 7.29289 11.2929L13.2929 5.29289C13.6834 4.90237 14.3166 4.90237 14.7071 5.29289Z" fill="currentColor"></path></svg></button><span id="thread-count-wrapper-${p}" class="flex-grow flex-shrink-0">${o} / ${r}</span><button id="thread-next-button-${p}" class="flex h-[30px] w-[30px] items-center justify-center rounded-md hover:bg-token-main-surface-secondary disabled:opacity-50 disabled:hover:bg-transparent" ${o===r?"disabled":""}><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md-heavy"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.29289 18.7071C8.90237 18.3166 8.90237 17.6834 9.29289 17.2929L14.5858 12L9.29289 6.70711C8.90237 6.31658 8.90237 5.68342 9.29289 5.29289C9.68342 4.90237 10.3166 4.90237 10.7071 5.29289L16.7071 11.2929C16.8946 11.4804 17 11.7348 17 12C17 12.2652 16.8946 12.5196 16.7071 12.7071L10.7071 18.7071C10.3166 19.0976 9.68342 19.0976 9.29289 18.7071Z" fill="currentColor"></path></svg></button></div>

        <!--button id="copy-message-button-${p}" class="p-1 rounded-md text-token-text-tertiary hover:text-token-text-primary rounded-lg hover:bg-token-main-surface-secondary invisible group-hover:visible group-[.final-completion]:visibl"><div class="flex items-center gap-1.5 text-xs"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="icon icon-md-heavy"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg></div></button-->
        </div></div>

        <div id="message-info-wrapper-${p}"
          style="display: flex; justify-content: space-between; align-items: center; font-size: 0.7em; width: 100%; max-height: 40px;">
          ${u?`<div id="message-counter-${p}" class="text-token-text-tertiary select-none">${M} chars \u2022 ${S} words</div>`:""}
          ${c?`<div class="text-token-text-tertiary select-none" style="position: absolute; bottom: 4px; right: 0px;">${x}</div>`:""}
          </div>
        </div>
      </div>
    </div>
  </div>
</article>`}function pythonImageSkeleton(e){const t=e?.message?.id;return`${(e?.message?.metadata?.aggregate_result?.messages?.filter(o=>o?.message_type==="image")).map(o=>`<img style="border-radius:8px; aspect-ratio: ${o.width}/${o.height};" id="python-image-displayed-${t}" data-file-id="${o.image_url.split("://").pop()}" src="https://upload.wikimedia.org/wikipedia/commons/c/ca/1x1.png" class="my-1" alt="Output image">`).join("")}`}async function renderAllPluginVisualizations(e,t=!1){const o=document.querySelectorAll('[id^="message-plugin-visualization-"]');if(o.length===0)return;const r=Array.from(o)?.map(async n=>{if(n.innerHTML!=="")return;const i=n.id.split("message-plugin-visualization-").pop(),a=e.mapping[i];if(!a)return;const s=a.children[a.children.length-1],l=e.mapping[s];if(await pluginVisualizationRenderer(e,l),t){const d=document.querySelector("#conversation-inner-div");d.style="scroll-behavior: auto;",d.scrollTop=d.scrollHeight,d.style="scroll-behavior: smooth;"}});await Promise.all(r)}async function renderAllPythonImages(e){const t=document.querySelectorAll('[id^="python-image-displayed-"]');if(t.length===0)return;const o=[],r=Array.from(t)?.map(async n=>{const i=e.mapping[n.id.split("python-image-displayed-").pop()],{fileId:a}=n.dataset,s=await getDownloadUrlFromFileId(e.conversation_id,a);n.src=s.download_url;const l={image_id:a,width:n.style.aspectRatio.split("/")[0].trim(),height:n.style.aspectRatio.split("/")[1].trim(),download_url:s.download_url,prompt:i.message?.metadata?.aggregate_result?.code,is_public:!1,category:"chart",conversation_id:e.conversation_id,created_at:s.creation_time?new Date(s.creation_time):new Date(formatTime(i?.message?.create_time))};o.push(l)});await Promise.all(r)}function addFinalCompletionClassToLastMessageWrapper(){document.querySelectorAll('[id^="message-wrapper-"]').forEach(e=>{e.classList.remove("final-completion")}),[...document.querySelectorAll('[id^="message-wrapper-"]')].pop()?.classList.add("final-completion")}function isImageGeneratorTool(e){return e==="dalle.text2im"||e==="t2uay3k.sj1i4kz"}function hiddenPluginDropdownRenderer(e,t){const o=e?.message?.recipient,r=isImageGeneratorTool(o)?"Creating Images":"Browsing...",n=e?.message?.id,i=document.querySelector("[id^=hidden-plugin-]");return o==="browser"&&i?"":`<div class="flex flex-col items-start gap-2" id="hidden-plugin-${n}"><div class="max-w-full ${t?"":"hidden"}"><div class="flex items-center justify-between"><div class="min-w-0"><div class="flex items-center gap-2.5 py-2"><div class="flex h-4 w-4 shrink-0 items-center justify-center"><svg x="0" y="0" viewbox="0 0 40 40" class="spinner icon icon-xl text-brand-purple"><circle fill="transparent" class="stroke-brand-purple/25 dark:stroke-brand-purple/50" stroke-width="2" stroke-linecap="round" stroke-dasharray="125.6" cx="20" cy="20" r="18"></circle></svg></div><div class="flex min-w-0 flex-1 flex-col items-start leading-[18px]"> <div class="max-w-full truncate text-token-text-secondary">${r}</div></div></div></div></div></div></div>${isImageGeneratorTool(o)?`<div id="message-dalle-content-${n}" class="grid gap-4 grid-cols-2 transition-opacity duration-300 opacity-100"></div>`:""}`}function dalleImageSkeleton(e,t){const{width:o,height:r}=t[0];return`${t.map((n,i)=>`<div class="flex"><div type="button" class="w-full cursor-pointer" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:r1t:" data-state="closed" aria-label="Show Image"><div class="relative overflow-hidden rounded-2xl group ${o===r?"max-w-[400px]":""}" style="aspect-ratio: ${o}/${r};"><div style="width:${o}px; height:${r}px;" class="pointer-events-none absolute inset-0 bg-gray-100 animate-pulse w-full" style="animation-delay: 0ms;"></div><div class="relative h-full"><img id="dalle-image-${e}-${i}" alt="Generated by DALL\xB7E" loading="lazy" width="${o}" height="${r}" decoding="async" data-nimg="1" class="w-full transition-opacity duration-300 opacity-100" src="https://upload.wikimedia.org/wikipedia/commons/c/ca/1x1.png" style="color: transparent;"><div class="pointer-events-none absolute inset-0 rounded-2xl shadow-[inset_0_0_0.5px_rgba(0,0,0,0.5)]"></div>
  
  <div id="dalle-image-info-${e}-${i}" title="Click to copy Gen ID, Shift+Click to copy Seed" class="invisible absolute bg-gray-600 px-2 py-1 rounded text-xs group-hover:visible" style="left:12px; bottom:12px;"><div class="flex">Gen ID:&nbsp;<div class="font-bold" id="dalle-image-gen-id-${e}-${i}"></div></div><div class="flex">Seed:&nbsp;<div class="font-bold" id="dalle-image-seed-${e}-${i}"></div></div></div>
  
  <div id="dalle-image-download-button-${e}-${i}" class="invisible absolute group-hover:visible" style="left:12px; top:12px;"><button class="flex h-8 w-8 items-center justify-center rounded bg-black/50"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-sm text-white"><path fill-rule="evenodd" clip-rule="evenodd" d="M7.70711 10.2929C7.31658 9.90237 6.68342 9.90237 6.29289 10.2929C5.90237 10.6834 5.90237 11.3166 6.29289 11.7071L11.2929 16.7071C11.6834 17.0976 12.3166 17.0976 12.7071 16.7071L17.7071 11.7071C18.0976 11.3166 18.0976 10.6834 17.7071 10.2929C17.3166 9.90237 16.6834 9.90237 16.2929 10.2929L13 13.5858L13 4C13 3.44771 12.5523 3 12 3C11.4477 3 11 3.44771 11 4L11 13.5858L7.70711 10.2929ZM5 19C4.44772 19 4 19.4477 4 20C4 20.5523 4.44772 21 5 21H19C19.5523 21 20 20.5523 20 20C20 19.4477 19.5523 19 19 19L5 19Z" fill="currentColor"></path></svg></button></div>

  <div id="dalle-image-enlarge-button-${e}-${i}" class="pointer-events-none invisible absolute end-3 top-3 text-white"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" width="24" height="24"><path fill-rule="evenodd" clip-rule="evenodd" d="M13 4C13 3.44772 13.4477 3 14 3H20C20.5523 3 21 3.44772 21 4V10C21 10.5523 20.5523 11 20 11C19.4477 11 19 10.5523 19 10V6.41421L15.2071 10.2071C14.8166 10.5976 14.1834 10.5976 13.7929 10.2071C13.4024 9.81658 13.4024 9.18342 13.7929 8.79289L17.5858 5H14C13.4477 5 13 4.55228 13 4ZM4 13C4.55228 13 5 13.4477 5 14V17.5858L8.79289 13.7929C9.18342 13.4024 9.81658 13.4024 10.2071 13.7929C10.5976 14.1834 10.5976 14.8166 10.2071 15.2071L6.41421 19H10C10.5523 19 11 19.4477 11 20C11 20.5523 10.5523 21 10 21H4C3.44772 21 3 20.5523 3 20V14C3 13.4477 3.44772 13 4 13Z" fill="currentColor"></path></svg></div>

  </div></div></div></div>`).join("")}`}async function renderAllDalleImages(e){const t=[...document.querySelectorAll('[id^="message-dalle-content-"]')].filter(n=>n.innerHTML==="").map(n=>n.id.split("message-dalle-content-")[1]);if(t.length===0)return;const o=[],r=t?.map(async n=>{const i=Object.values(e.mapping).find(a=>a?.parent===n);if(i){const a=await dalleImageRenderer(i,e.conversation_id);o.push(...a)}});await Promise.all(r)}async function dalleImageRenderer(e,t,o=!1){const{content:r}=e.message;if(r.content_type!=="multimodal_text")return[];let n=e?.parent;n||(n=[...document.querySelectorAll('[id^="message-dalle-content-"]')].pop()?.id.split("message-dalle-content-")[1]);const i=r?.parts,a=document.querySelector(`#message-dalle-content-${n}`);if(a&&(i?.length<=1&&a.classList?.replace("grid-cols-2","grid-cols-1"),a.innerHTML===""&&(a.innerHTML=dalleImageSkeleton(n,i))),!i||i.length===0)return[];const s=[],l=i?.map(async(d,c)=>{const u=d.asset_pointer?.split("://")[1],{width:m,height:g}=d,p=await getDownloadUrlFromFileId(t,u);[...document.querySelectorAll('[id^="hidden-plugin-"]')].map(f=>f.firstChild).forEach(f=>{f.classList?.remove("conic"),f.classList?.add("hidden")});const h=document.querySelector(`img#dalle-image-${n}-${c}`);if(h){h.setAttribute("width",m),h.setAttribute("height",g),h.alt=d?.metadata?.dalle?.prompt?.replace(/[^a-zA-Z0-9 ]/gi,"")||"Generated by DALL\xB7E",h.dataset.fileId=u,h.dataset.genId=d?.metadata?.dalle?.gen_id,h.src=p.download_url;const f=h.parentElement.querySelector(`#dalle-image-gen-id-${n}-${c}`),v=h.parentElement.querySelector(`#dalle-image-seed-${n}-${c}`);f&&(f.innerText=d?.metadata?.dalle?.gen_id),v&&(v.innerText=d?.metadata?.dalle?.seed),loadUserSelectedImages(u,p.download_url),dalleImageEventListener(i,h,n,c),o&&document.querySelector("#dalle-editor-center-image")&&h.click();const x=!d?.metadata||!d?.metadata?.dalle,y={image_id:u,width:m,height:g,download_url:p.download_url,prompt:d?.metadata?.dalle?.prompt,gen_id:d?.metadata?.dalle?.gen_id,seed:d?.metadata?.dalle?.seed,is_public:!1,category:x?"upload":"dalle",conversation_id:t,created_at:p.creation_time?new Date(p.creation_time):new Date(formatTime(e?.message?.create_time))};s.push(y)}});return await Promise.all(l),s}function loadUserSelectedImages(e,t){document.querySelectorAll(`img[id^=reply-to-image-][data-file-id="${e}"]`).forEach(o=>{o.src=t})}function actionConfirmationRenderer(e,t,o){const{id:r,recipient:n,metadata:i}=e.message,a=i?.jit_plugin_data?.from_server?.body?.domain;if(t)return actionResponseRenderer(t,a);if((e.message?.role||e.message?.author?.role)!=="tool"||n!=="assistant")return"";const s=i?.jit_plugin_data?.from_server?.type;if(s==="confirm_action")return`<div id="tool-action-request-wrapper-${r}" data-domain=${a}>${actionDisclaimerRenderer(o,a)}<div class="mb-2 flex gap-2"><button id="tool-action-request-allow-${r}" class="btn relative btn-primary btn-small"><div class="flex w-full gap-2 items-center justify-center">Allow</div></button><button id="tool-action-request-always-allow-${r}" class="btn relative btn-secondary btn-small"><div class="flex w-full gap-2 items-center justify-center">Always Allow</div></button><button id="tool-action-request-deny-${r}" class="btn relative btn-secondary btn-small"><div class="flex w-full gap-2 items-center justify-center">Decline</div></button></div></div>`;if(s==="oauth_required"){const l=i?.jit_plugin_data?.from_server?.body?.actions?.find(u=>u.type==="oauth_redirect")?.oauth_redirect,d=l?.gizmo_id,c=l?.gizmo_action_id;return`<div id="tool-action-request-wrapper-${r}">${actionDisclaimerRenderer(o,a)}<div class="mb-2 flex gap-2"><button id="tool-action-request-oauth-${r}" data-domain=${a} data-gizmoId="${d}" data-actionId="${c}" class="btn btn-primary relative h-8"><div class="flex w-full gap-2 items-center justify-center">Sign in with ${a}</div></button></div></div>`}return""}function actionResponseRenderer(e,t){const{recipient:o,metadata:r}=e.message,n=e.message?.role||e.message?.author?.role;if(n==="user")return"";if(n!=="tool"&&o!=="all")return actionStoppedRenderer(t);const i=r?.jit_plugin_data?.from_client?.type,a=r?.jit_plugin_data?.from_server?.type;return i==="allow"||i==="always_allow"?actionAllowedRenderer(t):i==="deny"||a==="denied_by_user"?actionDeniedRenderer():""}function actionDisclaimerRenderer(e,t){return`<div class="my-2.5 flex items-center gap-2.5"><div class="relative h-5 w-full leading-5 -mt-[0.75px] text-token-text-secondary"><div class="absolute start-0 top-0 line-clamp-1" style="opacity: 1; transform: none;"><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:rij:" data-state="closed"><div class="inline-flex items-center gap-1">${e||"This GPT"} wants to talk to ${t}</div></button></div></div></div>`}function actionAllowedRenderer(e){return`<div class="my-2.5 flex items-center gap-2.5"><div class="relative h-5 w-full leading-5 -mt-[0.75px] text-token-text-secondary"><div class="absolute start-0 top-0 line-clamp-1" style="opacity: 1; transform: none;"><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:rkd:" data-state="closed"><div class="inline-flex items-center gap-1">Talked to ${e}</div></button></div></div></div>`}function actionDeniedRenderer(){return'<div class="my-2.5 flex items-center gap-2.5"><div class="relative h-5 w-full leading-5 -mt-[0.75px] text-token-text-tertiary"><div class="absolute start-0 top-0 line-clamp-1" style="opacity: 1; transform: none;">You declined this action</div></div></div>'}function actionStoppedRenderer(e){return`<div class="my-2.5 flex items-center gap-2.5"><div class="relative h-5 w-full leading-5 -mt-[0.75px] text-token-text-tertiary"><div class="absolute start-0 top-0 line-clamp-1" style="opacity: 1; transform: none;">Stopped talking to ${e}</div></div></div>`}function dalleImageEventListener(e,t,o,r){t.addEventListener("click",i=>{i.stopPropagation(),closeMenus();const a=document.querySelector("#dalle-editor-edit-mode-cancel-button");a&&a.click();const s=document.querySelector("#dalle-editor");if(!s)openDalleEditor(e,t,o,r),t.parentElement.insertAdjacentHTML("beforeend",'<div id="dalle-dark-image-overlay" class="pointer-events-none absolute inset-0 shadow-[inset_0_0_0_1px_rgba(0,0,0,0.1)] dark:shadow-[inset_0_0_0_1px_rgba(255,255,255,0.1)] bg-black/50 group-hover:bg-black/70"></div>');else{const l=document.querySelector("#dalle-editor-info-menu");l&&l.remove();const d=document.querySelector("#dalle-dark-image-overlay");d&&d.remove(),t.parentElement.insertAdjacentHTML("beforeend",'<div id="dalle-dark-image-overlay" class="pointer-events-none absolute inset-0 shadow-[inset_0_0_0_1px_rgba(0,0,0,0.1)] dark:shadow-[inset_0_0_0_1px_rgba(255,255,255,0.1)] bg-black/50 group-hover:bg-black/70"></div>');const c=s.querySelector("#dalle-editor-center-image");c&&(c.src=t.src,c.alt=t.alt,c.width=t.naturalWidth,c.height=t.naturalHeight,c.dataset.fileId=t.dataset.fileId,c.dataset.genId=t.dataset.genId);const u=s.querySelector("#dalle-editor-navigation");if(u.dataset.messageId=o,e.length===1)u.classList.replace("visible","invisible");else{u.classList.replace("invisible","visible");const m=s.querySelector("#dalle-editor-nav-cur-index"),g=s.querySelector("#dalle-editor-nav-total");m.innerText=r+1,g.innerText=e.length;const p=s.querySelector("#dalle-editor-prev-image"),h=s.querySelector("#dalle-editor-next-image");r===0?p.disabled=!0:p.disabled=!1,r===e.length-1?h.disabled=!0:h.disabled=!1}}});const n=t.parentElement.querySelector(`#dalle-image-download-button-${o}-${r}`);n&&n.addEventListener("click",i=>{i.stopPropagation(),closeMenus();const a=`DALL\xB7E ${formatDateDalle()} - ${t.alt}.webp`;downloadFileFromUrl(t.src,a)}),t.parentElement.querySelector(`#dalle-image-info-${o}-${r}`)&&t.parentElement.addEventListener("click",i=>{if(i.stopPropagation(),closeMenus(),i.shiftKey){const a=t.parentElement.querySelector(`#dalle-image-seed-${o}-${r}`);a&&(navigator.clipboard.writeText(a.innerText),toast("Copied Seed to clipboard"))}else{const a=t.parentElement.querySelector(`#dalle-image-gen-id-${o}-${r}`);a&&(navigator.clipboard.writeText(a.innerText),toast("Copied Gen ID to clipboard"))}})}function pluginDropdownRenderer(e,t,o=!1){const r=e?.message?.recipient;if(isImageGeneratorTool(r)||r==="browser")return hiddenPluginDropdownRenderer(e,t);const n=e?.message?.recipient?.split(".")[0]?.replace(/([A-Z])/g," $1")?.replace(/^./,a=>a.toUpperCase()),i=e?.message?.id;return`<div class="flex flex-col items-start"><div id="message-plugin-dropdown-${i}" class="flex items-center text-xs rounded p-3 text-token-text-secondary ${t?"bg-green-100":"bg-token-main-surface-secondary"}"><div><div class="flex items-center gap-3"><div id="message-plugin-name-${i}">${n.toLowerCase()==="bio"?"Memory updated":`Used <b>${n}`}</b>${t?"...":""}</div></div></div>${t?`<svg id="message-plugin-loading-${i}" stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="animate-spin text-center shrink-0 ms-1" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><line x1="12" y1="2" x2="12" y2="6"></line><line x1="12" y1="18" x2="12" y2="22"></line><line x1="4.93" y1="4.93" x2="7.76" y2="7.76"></line><line x1="16.24" y1="16.24" x2="19.07" y2="19.07"></line><line x1="2" y1="12" x2="6" y2="12"></line><line x1="18" y1="12" x2="22" y2="12"></line><line x1="4.93" y1="19.07" x2="7.76" y2="16.24"></line><line x1="16.24" y1="7.76" x2="19.07" y2="4.93"></line></svg>`:""}<div id="message-plugin-toggle-${i}" class="ms-12 flex items-center gap-2" role="button"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="icon icon-sm" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><polyline points="${o?"18 15 12 9 6 15":"6 9 12 15 18 9"}"></polyline></svg></div></div><div id="message-plugin-content-${i}" class="${o?"":"hidden"} my-3 flex w-full flex-col gap-3">${pluginContentRenderer(e)}</div><div id="message-plugin-visualization-${i}" class="hidden my-3 flex w-full flex-col gap-3"></div></div>`}function strawberryDropdownRenderer(e){const t=e?.message?.id,{initial_text:o,finished_text:r}=e.message.metadata,n=e.message.status==="finished_successfully",i=n?r:o,a=e?.message?.content?.parts[0]||"";return`<div id="strawberry-response-${t}">
            <div id="strawberry-dropdown-wrapper-${t}" class="first:mt-0 my-1.5 relative h-8 text-token-text-secondary ${a?"hover:text-token-text-primary":""}">
              <div class="group absolute start-0 top-0 me-1.5 h-8 overflow-hidden mt-1">
                <button class="${a?"":"cursor-default"} ${n?"":"loading-shimmer"}" style="opacity: 1;">
                  <div class="flex items-center justify-start gap-1">
                    <span id="strawberry-dropdown-preview-text-${t}" >${i}</span>
                    <svg id="strawberry-dropdown-toggle-${t}" width="24" height="24" viewBox="0 0 24 24" fill="none"
                      xmlns="http://www.w3.org/2000/svg" class="icon icon-md ${a?"":"hidden"}">
                      <path fill-rule="evenodd" clip-rule="evenodd" d="M5.29289 9.29289C5.68342 8.90237 6.31658 8.90237 6.70711 9.29289L12 14.5858L17.2929 9.29289C17.6834 8.90237 18.3166 8.90237 18.7071 9.29289C19.0976 9.68342 19.0976 10.3166 18.7071 10.7071L12.7071 16.7071C12.5196 16.8946 12.2652 17 12 17C11.7348 17 11.4804 16.8946 11.2929 16.7071L5.29289 10.7071C4.90237 10.3166 4.90237 9.68342 5.29289 9.29289Z" fill="currentColor"></path>
                    </svg>
                  </div>
                </button>
              </div>
            </div>
            <div id="strawberry-content-${t}" class="overflow-hidden hidden" style="opacity: 1; height: auto; transform: none;">
              ${strawberryContentRenderer(e)}
            </div>
          </div>`}function strawberryContentRenderer(e){const t=e?.message?.id,o=/\*\*(.*?)\*\*\n\n([\s\S]*?)(?=\*\*|$)/g,r=e?.message?.content?.parts[0]||"",n=[];let i=1,a=o.exec(r);for(;a!==null;){const c=a[1].trim(),u=a[2].trim();n.push({id:i,title:c,description:u}),i+=1,a=o.exec(r)}const s=document.querySelector(`#strawberry-dropdown-wrapper-${t}`);if(n.length>0){s&&(s.classList.add("hover:text-token-text-primary"),s.querySelector("button").classList.add("cursor-pointer","loading-shimmer"),s.addEventListener("click",()=>{const u=document.querySelector(`#strawberry-content-${t}`),m=document.querySelector(`#strawberry-dropdown-toggle-${t}`);u&&(u.classList.toggle("hidden"),u.classList.contains("hidden")?m.classList.remove("rotate-180"):m.classList.add("rotate-180"))}));const c=document.querySelector(`#strawberry-dropdown-toggle-${t}`);c&&c.classList.remove("hidden")}const l=document.querySelector(`#strawberry-dropdown-preview-text-${t}`),d=e.message.metadata.finished_text;if(e.message.status==="finished_successfully")s?.querySelector("button")?.classList?.remove("loading-shimmer"),l&&d&&(l.innerText=d);else{const c=n[n.length-1]?.title;l&&(l.innerText=c)}return`<div class="my-4 border-s-2 ps-4">
            <div class="not-prose leading-6 markdown prose w-full break-words dark:prose-invert dark">
              ${n.map(c=>`
                ${c.title?`<p class="text-base has-[strong]:mb-1 has-[strong]:mt-3 [&amp;:not(:has(strong))]:mb-3">
                  <strong class="font-semibold text-token-text-primary">${c.title}</strong>
                </p>`:""}
                ${c.description?`<p class="text-base has-[strong]:mb-1 has-[strong]:mt-3 [&amp;:not(:has(strong))]:mb-3">${c.description}</p>`:""}
              `).join("")}
            </div>
          </div>`}function pluginContentRenderer(e){const t=e?.message?.id;if(!t)return"";const{content:o,recipient:r,author:n,metadata:i}=e.message,a=n?.name;if(isImageGeneratorTool(a)||isImageGeneratorTool(r)||a==="browser")return"";const s=e.message?.role||e.message?.author?.role,{content_type:l}=o,d=s==="assistant"?r?.split(".")[0]?.replace(/([A-Z])/g," $1")?.replace(/^./,f=>f.toUpperCase()):n?.name?.split(".")[0]?.replace(/([A-Z])/g," $1")?.replace(/^./,f=>f.toUpperCase()),c=l==="text"?(o?.parts||[])?.filter(f=>typeof f=="string")?.join(`
`):o?.text;if(!c)return"";const{language:u,value:m}=hljs.highlightAuto(c);let g=m||"";try{g=JSON.stringify(JSON.parse(c),0,2)}catch{g=m||c||""}let p="",h="";if(l==="execution_output"&&s==="tool"&&i?.aggregate_result?.final_expression_output){const{language:f,value:v}=hljs.highlightAuto(i?.aggregate_result?.final_expression_output);p=f,h=v}return`<div class="dark bg-black rounded-md w-full text-xs text-token-text-secondary"><pre><div class="flex items-center relative text-token-text-secondary bg-token-main-surface-secondary px-4 py-2 text-xs font-sans justify-between rounded-t-md select-none"><span><span class="uppercase">${l==="text"?s==="assistant"?`Request to ${d}`:`Response from ${d}`:s==="assistant"?`Request to ${r}`:"STDOUT/STDERR"}</span></span>${l==="code"?'<button id="copy-code" data-initialized="false" class="flex ms-auto gap-2 text-token-text-secondary hover:text-token-text-primary"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg>Copy code</button>':d==="Bio"?'<button id="manage-memories" data-initialized="false" class="flex ms-auto gap-2 text-token-text-secondary hover:text-token-text-primary">Manage memories</button>':""}</div><div class="p-4 overflow-y-auto"><code hljs language-${u}" id="message-plugin-${s==="assistant"?"request":"response"}-html-${t}" class="!whitespace-pre-wrap">${g}</code></div>${h&&h!==g?`<div class="w-full px-4 py-2 text-token-text-secondary border border-gray-800">Execution Results</div><div class="p-4 overflow-y-auto"><code hljs language-${p}" id="message-plugin-result-html-${t}" class="!whitespace-pre-wrap">${h}</code></div>`:""}</pre></div>`}async function pluginVisualizationRenderer(e,t){const o=t?.message?.id;if(!o)return"";const{content:r,recipient:n,author:i,metadata:a}=t.message,s=i?.name;if(isImageGeneratorTool(s)||isImageGeneratorTool(n)||s==="browser")return"";const l=t.message?.role||t.message?.author?.role,{content_type:d}=r;if(d==="execution_output"&&l==="tool"&&a?.ada_visualizations?.length>0){const c=a?.ada_visualizations,u=Array.from(c)?.map(async m=>{const{title:g,file_id:p}=m,h=await getDownloadUrlFromFileId(e.conversation_id,p),f=h.download_url,v=await fetch(f,{method:"GET",headers:{origin:"https://chatgpt.com"}}).then(x=>x.text());if(v){const x=a?.parent_id,y=document.querySelector(`#message-plugin-visualization-${x}`);if(!y)return;y.id=`message-plugin-visualization-${o}`,y.classList.remove("hidden"),y.appendChild(csvToTable(g,v,h.download_url))}});await Promise.all(u)}return""}function csvToTable(e,t,o){function r(h){const f=[],v=/(?:"([^"]*(?:""[^"]*)*)"|([^",]+)|,)(?=\s*,|\s*$)/g;return h.trim().split(`
`).forEach(x=>{const y=[];let b=v.exec(x);for(;b;)y.push(b[1]?b[1].replace(/""/g,'"'):b[2]?b[2]:""),b=v.exec(x);f.push(y)}),f}const n=r(t),i=document.createElement("div");i.classList="relative overflow-auto w-full rounded-2xl bg-token-main-surface-secondary border border-token-border-medium",i.style.maxHeight="420px";const a=document.createElement("div");a.classList="flex items-center justify-between gap-2 bg-token-main-surface-primary px-4 py-3 border-b border-token-border-medium sticky top-0 start-0 z-30";const s=document.createElement("div");s.classList="flex-grow items-center truncate font-semibold capitalize bg-token-main-surface-primary",s.textContent=e,a.appendChild(s);const l=document.createElement("div");l.classList="flex items-center gap-3",a.appendChild(l);const d=document.createElement("button");d.classList="flex items-center text-xs",d.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="icon icon-md text-token-text-tertiary hover:text-token-text-primary"><path fill="currentColor" d="M7.707 10.293a1 1 0 1 0-1.414 1.414l5 5a1 1 0 0 0 1.414 0l5-5a1 1 0 0 0-1.414-1.414L13 13.586V4a1 1 0 1 0-2 0v9.586zM5 19a1 1 0 1 0 0 2h14a1 1 0 1 0 0-2z"></path></svg>',d.addEventListener("click",()=>{downloadFileFromUrl(o,`${e}.csv`)}),l.appendChild(d),i.appendChild(a);const c=document.createElement("table");c.classList="w-full table";const u=document.createElement("thead"),m=document.createElement("tr");m.classList="sticky z-20",m.style.top="49px",m.style.boxShadow="inset 0px -1px 0 #424242",["",...n[0],""].forEach((h,f)=>{const v=document.createElement("th");v.classList="text-sm text-start text-token-text-primary font-bold bg-token-main-surface-secondary p-2 border-e border-token-border-medium sticky",f===0&&(v.classList.add("sticky","border-s","z-10","start-0"),v.style.boxShadow="inset -1px 0px 0 #424242",v.style.borderLeft="1px"),f>0&&f<n[0].length?v.style.minWidth="150px":v.style.minWidth="40px",v.textContent=h,m.appendChild(v)}),u.appendChild(m),c.appendChild(u);const g=Array.from({length:n[0].length},()=>""),p=document.createElement("tbody");return[...n,g].slice(1).forEach((h,f)=>{const v=document.createElement("tr");[f+1,...h,""].forEach((x,y)=>{const b=document.createElement("td");b.classList="relative text-sm text-token-text-secondary border border-token-border-medium bg-token-main-surface-primary p-2",y===0&&(b.classList.add("text-center","font-bold","text-token-text-primary","bg-token-main-surface-secondary","sticky","z-10","start-0"),b.style.boxShadow="inset -1px 0px 0 #424242",b.style.borderLeft="1px"),f===n.length-1&&(b.style.height="40px"),b.textContent=f===n.length-1?"":x,v.appendChild(b)}),p.appendChild(v)}),c.appendChild(p),i.appendChild(c),i}function assistantRenderer(e,t=!1){const{id:o}=e.message,{assistantMessageHTML:r,wordCount:n,charCount:i}=assistantContentGenerator(e,!0);return r?{renderedNode:`<div dir="auto" class="min-h-[20px] overflow-x-auto flex flex-col items-start whitespace-pre-wrap gap-4 break-words">
  <div id="message-text-${o}" data-message-id="${o}" class="${t?"result-streaming":""} markdown prose w-full flex flex-col break-words dark:prose-invert">
    ${r}
    </div>
  </div>`,wordCount:n,charCount:i}:{renderedNode:"",wordCount:0,charCount:0}}function replaceCitations(e,t,o="html"){if(t?.length>0){const r=[...t].reverse();for(let n=0;n<r.length;n+=1){const i=r[n].metadata,a=i?.extra?.cited_message_idx,s=i?.extra?.evidence_text;if(i){let l="";if(i?.type==="webpage"){const{url:d,title:c}=i;if(!d||!c||d.startsWith("file://"))continue;const u=new URL(d)?.origin;if(!u)continue;const m=citationAttributions?.find(g=>g.url===u);o==="html"?m?l=`<span id="citation"><span class="text-token-text-secondary"> (</span>[${m.attribution}](${d} "${c}")<span class="text-token-text-secondary">)</span></span>`:l=`<span id="citation">[<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19 15" fill="none" class="-mt-0.5 ms-0.5 inline-block text-link-base hover:text-link-hover" width="19" height="15"><path d="M4.42 0.75H2.8625H2.75C1.64543 0.75 0.75 1.64543 0.75 2.75V11.65C0.75 12.7546 1.64543 13.65 2.75 13.65H2.8625C2.8625 13.65 2.8625 13.65 2.8625 13.65C2.8625 13.65 4.00751 13.65 4.42 13.65M13.98 13.65H15.5375H15.65C16.7546 13.65 17.65 12.7546 17.65 11.65V2.75C17.65 1.64543 16.7546 0.75 15.65 0.75H15.5375H13.98" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M6.16045 7.41534C5.32257 7.228 4.69638 6.47988 4.69638 5.58551C4.69638 4.54998 5.53584 3.71051 6.57136 3.71051C7.60689 3.71051 8.44635 4.54998 8.44635 5.58551C8.44635 5.8965 8.37064 6.1898 8.23664 6.448C8.22998 6.48984 8.21889 6.53136 8.20311 6.57208L6.77017 10.2702C6.63182 10.6272 6.18568 10.7873 5.7737 10.6276C5.36172 10.468 5.13991 10.0491 5.27826 9.69206L6.16045 7.41534ZM11.4177 7.41534C10.5798 7.228 9.95362 6.47988 9.95362 5.58551C9.95362 4.54998 10.7931 3.71051 11.8286 3.71051C12.8641 3.71051 13.7036 4.54998 13.7036 5.58551C13.7036 5.8965 13.6279 6.1898 13.4939 6.448C13.4872 6.48984 13.4761 6.53136 13.4604 6.57208L12.0274 10.2702C11.8891 10.6272 11.4429 10.7873 11.0309 10.6276C10.619 10.468 10.3971 10.0491 10.5355 9.69206L11.4177 7.41534Z" fill="currentColor"></path></svg>](${d} "${c}")</span>`:o==="markdown"?l=` [${c}](${d})`:o==="text"&&(l=` ${c} (${d})`)}e=e?.replace(new RegExp(`\u3010${a}.*?${s}\u3011`,"g"),l)}}}return e}function assistantContentGenerator(e,t=!1){const{message:o}=e;if(o?.status&&(o?.status==="finished_partial_completion"||o?.metadata?.finish_details?.type==="max_tokens")){const a=[...document.querySelectorAll('[id^="message-continue-button-"]')].pop();a&&a.classList.add("group-[.final-completion]:visible")}let r=(o?.content?.parts||[])?.filter(a=>typeof a=="string")?.join(`
`);const{citations:n}=o.metadata;r=replaceCitations(r,n,"html"),r=r?.replace(/\\{1}\[/g,`
\\[`);const i=markdown("assistant").use(markdownitSup).use(texmath,{engine:katex,delimiters:["dollars","brackets"],katexOptions:{macros:{"\\RR":"\\mathbb{R}"}}}).render(r);if(t){const a=document.createElement("div");a.innerHTML=i;const s=a.innerText.split(/\s+/).filter(d=>d!=="").length,l=a.innerText.replace(/\n/g,"").length;return{assistantMessageHTML:i,wordCount:s,charCount:l}}return{assistantMessageHTML:i}}function rowUser(e,t,o,r,n,i){const{customConversationWidth:a,conversationWidth:s}=cachedSettings,{pinned:l,message:d}=t,{id:c,content:u,metadata:m}=d,g=(u?.parts||[]).filter($=>typeof $=="string").join(`
`),p=m?.attachments||[],h=m?.targeted_reply,f=m?.dalle?.from_client?.operation?.original_file_id;p?.forEach($=>{const q=$.id;getDownloadUrlFromFileId(e.conversation_id,q).then(E=>{const C=document.querySelector(`#asset-${q}`);C&&(getFileType($.name)==="Image"?C.src=E.download_url:C.style.backgroundImage=`url(${E.download_url})`)})});const v=g.replace(/^## Instructions[\s\S]*?## End Instructions\n\n/m,""),x=sanitizeHtml(v),y=g.match(/\(languageCode: (.*)\)/)?.[1],b=g.match(/\(toneCode: (.*)\)/)?.[1],w=g.match(/\(writingStyleCode: (.*)\)/)?.[1],k=languageList.find($=>$.code===y)?.name,S=toneList.find($=>$.code===b)?.name,M=writingStyleList.find($=>$.code===w)?.name;return`<article id="message-wrapper-${c}" data-role="user"
  class="group w-full p-5 pb-0 text-token-text-primary ${l?"border-l-pinned bg-pinned dark:bg-pinned border-b scroll-margin-top-60":"bg-token-main-surface-primary"}">
  <div class="relative text-base gap-4 m-auto md:max-w-2xl lg:max-w-2xl xl:max-w-3xl flex justify-end" style="${a?`max-width:${s}%`:""}">
    <div class="relative flex flex-col w-full max-w-[90%]">
      <div id="user-message-text-wrapper-${c}" class="flex flex-grow flex-col gap-1">
        ${h?`<div id="message-reply-to-preview-${c}" class="flex text-sm text-token-text-tertiary mb-1 mt-1 items-start gap-1.5 font-normal self-end"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md shrink-0 juice:mt-1"><path fill="currentColor" fill-rule="evenodd" d="M5 6a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1h9.586l-2.293-2.293a1 1 0 0 1 1.414-1.414l4 4a1 1 0 0 1 0 1.414l-4 4a1 1 0 0 1-1.414-1.414L16.586 14H7a3 3 0 0 1-3-3V7a1 1 0 0 1 1-1" clip-rule="evenodd"></path></svg><p class="line-clamp-3">${h}</p></div>`:""}
        ${f?`<div class="mt-2 flex items-center gap-1 text-token-text-tertiary"><svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md shrink-0"><path d="M4 5.25V7.75C4 8.85457 4.89543 9.75 6 9.75H14M14 9.75L11 12.75M14 9.75L11 6.75" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg><img id="reply-to-image-${f}" data-file-id="${f}" src="https://upload.wikimedia.org/wikipedia/commons/c/ca/1x1.png" alt="Edited image" class="h-7 w-auto rounded opacity-50"><span class="ms-1 text-sm font-medium">Selection</span></div>`:""}
        <div id="message-text-${c}" data-message-id="${c}" dir="auto" class="min-h-[20px] flex flex-col items-start gap-4 whitespace-pre-wrap rounded-3xl bg-[#f4f4f4] px-5 py-2.5 dark:bg-token-main-surface-secondary self-end" style="overflow-wrap:anywhere;align-self:ed;">${assetElements(p)}${x}</div>
        
        <div id="message-edit-wrapper-${c}" class="flex empty:hidden mt-1 justify-end gap-3 lg:flex"><div class="text-token-text-secondary flex self-end justify-start mt-2 mt-0 visible gap-1">

        <div id="thread-buttons-wrapper-${c}" class="text-xs flex items-center justify-center gap-1 self-center ${r===1?"hidden":""}"><button id="thread-prev-button-${c}" class="flex h-[30px] w-[30px] items-center justify-center rounded-md hover:bg-token-main-surface-secondary disabled:opacity-50 disabled:hover:bg-transparent" ${o===1?"disabled":""}><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md-heavy"><path fill-rule="evenodd" clip-rule="evenodd" d="M14.7071 5.29289C15.0976 5.68342 15.0976 6.31658 14.7071 6.70711L9.41421 12L14.7071 17.2929C15.0976 17.6834 15.0976 18.3166 14.7071 18.7071C14.3166 19.0976 13.6834 19.0976 13.2929 18.7071L7.29289 12.7071C7.10536 12.5196 7 12.2652 7 12C7 11.7348 7.10536 11.4804 7.29289 11.2929L13.2929 5.29289C13.6834 4.90237 14.3166 4.90237 14.7071 5.29289Z" fill="currentColor"></path></svg></button><span id="thread-count-wrapper-${c}" class="flex-grow flex-shrink-0">${o} / ${r}</span><button id="thread-next-button-${c}" ${o===r?"disabled":""} class="flex h-[30px] w-[30px] items-center justify-center rounded-md hover:bg-token-main-surface-secondary disabled:opacity-50 disabled:hover:bg-transparent"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md-heavy"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.29289 18.7071C8.90237 18.3166 8.90237 17.6834 9.29289 17.2929L14.5858 12L9.29289 6.70711C8.90237 6.31658 8.90237 5.68342 9.29289 5.29289C9.68342 4.90237 10.3166 4.90237 10.7071 5.29289L16.7071 11.2929C16.8946 11.4804 17 11.7348 17 12C17 12.2652 16.8946 12.5196 16.7071 12.7071L10.7071 18.7071C10.3166 19.0976 9.68342 19.0976 9.29289 18.7071Z" fill="currentColor"></path></svg></button></div>

        </div></div>
      </div>
    </div>
    <div class="absolute start-0 flex" style="bottom:-10px;">
      ${k?`<div id="language-code-${c}" title="You changed the response language here. This prompt includes a hidden language instructions" class="h-6 p-2 me-1 flex items-center justify-center rounded-md border text-xs text-token-text-tertiary border-token-border-medium bg-token-main-surface-secondary">Language: &nbsp<b>${k}</b></div>`:""}
      ${S?`<div id="tone-code-${c}" title="You changed the response tone here. This prompt includes a hidden tone instructions" class="h-6 p-2 me-1 flex items-center justify-center rounded-md border text-xs text-token-text-tertiary border-token-border-medium bg-token-main-surface-secondary">Tone: &nbsp<b>${S}</b></div>`:""}
      ${M?`<div id="writing-style-code-${c}" title="You changed the response writing style here. This prompt includes a hidden writing style instructions" class="h-6 p-2 me-1 flex items-center justify-center rounded-md border text-xs text-token-text-tertiary border-token-border-medium bg-token-main-surface-secondary">Writing Style: &nbsp<b>${M}</b></div>`:""}
    </div>
  </div>
</article>
`}function assetElements(e){if(e?.length===0)return"";const t=e.filter(r=>getFileType(r.name)!=="Image"),o=e.filter(r=>getFileType(r.name)==="Image");return`${t.length>0?`<div class="flex gap-2 flex-wrap">
  ${t.map(r=>assetElement(t,o,r)).join("")}
  </div>`:""}${o.length>0?`<div class="${o.length===1?"grid":"grid grid-cols-2 gap-3 sm:grid-cols-3 lg:grid-cols-4"}">
  ${o.map(r=>assetElement(t,o,r)).join("")}
  </div>`:""}`}function assetElement(e,t,o){return getFileType(o.name)==="Image"?`<div class="relative mt-1 flex h-auto w-full max-w-lg items-center justify-center overflow-hidden bg-token-main-surface-tertiary text-token-text-primary ${t.length===1?"":"aspect-square"}"><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:r7p:" data-state="closed"><img id="asset-${o.id}" alt="Uploaded image" loading="lazy" width="${o.width}" height="${o.height}" decoding="async" data-nimg="1" class="max-w-full transition-opacity duration-300 opacity-100" src="" style="color: transparent;"></button></div>`:`<div class="group relative inline-block text-sm text-token-text-primary"><div class="relative overflow-hidden bg-token-main-surface-tertiary rounded-xl"><div class="p-2 w-80"><div class="flex flex-row items-center gap-2"><div class="relative h-10 w-10 shrink-0 overflow-hidden rounded-md">${getThumbnail(getFileType(o.name),o.id)}</div><div class="overflow-hidden"><div class="truncate font-medium">${o.name}</div><div class="truncate text-token-text-tertiary">${getFileType(o.name)}</div></div></div></div></div></div>`}function getThumbnail(e,t=""){switch(e){case"Image":return`<button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:r58:" data-state="closed" class="h-full w-full"><span  id="asset-${t}" class="flex items-center h-full w-full justify-center bg-gray-500 dark:bg-gray-700 bg-cover bg-center text-white" style="background-image: url(&quot;&quot;);"></span></button>`;case"Spreadsheet":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" fill="none" class="h-10 w-10 flex-shrink-0" width="36" height="36"><rect width="36" height="36" rx="6" fill="#10A37F"></rect><path d="M15.5 10.5H12.1667C11.2462 10.5 10.5 11.2462 10.5 12.1667V13.5V18M15.5 10.5H23.8333C24.7538 10.5 25.5 11.2462 25.5 12.1667V13.5V18M15.5 10.5V25.5M15.5 25.5H18H23.8333C24.7538 25.5 25.5 24.7538 25.5 23.8333V18M15.5 25.5H12.1667C11.2462 25.5 10.5 24.7538 10.5 23.8333V18M10.5 18H25.5" stroke="white" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"></path></svg>';case"PDF":case"Document":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" fill="none" class="h-10 w-10 flex-shrink-0" width="36" height="36"><rect width="36" height="36" rx="6" fill="#FF5588"></rect><path d="M19.6663 9.66663H12.9997C12.5576 9.66663 12.1337 9.84222 11.8212 10.1548C11.5086 10.4673 11.333 10.8913 11.333 11.3333V24.6666C11.333 25.1087 11.5086 25.5326 11.8212 25.8451C12.1337 26.1577 12.5576 26.3333 12.9997 26.3333H22.9997C23.4417 26.3333 23.8656 26.1577 24.1782 25.8451C24.4907 25.5326 24.6663 25.1087 24.6663 24.6666V14.6666L19.6663 9.66663Z" stroke="white" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"></path><path d="M19.667 9.66663V14.6666H24.667" stroke="white" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"></path><path d="M21.3337 18.8334H14.667" stroke="white" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"></path><path d="M21.3337 22.1666H14.667" stroke="white" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"></path><path d="M16.3337 15.5H15.5003H14.667" stroke="white" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"></path></svg>';case"File":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" fill="none" class="h-10 w-10 flex-shrink-0" width="36" height="36"><rect width="36" height="36" rx="6" fill="#0000FF"></rect><path d="M18.833 9.66663H12.9997C12.5576 9.66663 12.1337 9.84222 11.8212 10.1548C11.5086 10.4673 11.333 10.8913 11.333 11.3333V24.6666C11.333 25.1087 11.5086 25.5326 11.8212 25.8451C12.1337 26.1577 12.5576 26.3333 12.9997 26.3333H22.9997C23.4417 26.3333 23.8656 26.1577 24.1782 25.8451C24.4907 25.5326 24.6663 25.1087 24.6663 24.6666V15.5L18.833 9.66663Z" stroke="white" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"></path><path d="M18.833 9.66663V15.5H24.6663" stroke="white" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"></path></svg>';case"JavaScript":case"Python":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" fill="none" class="h-10 w-10 flex-shrink-0" width="36" height="36"><rect width="36" height="36" rx="6" fill="#FF6E3C"></rect><path d="M21.333 23L26.333 18L21.333 13" stroke="white" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"></path><path d="M14.667 13L9.66699 18L14.667 23" stroke="white" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"></path></svg>';default:return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" fill="none" class="h-10 w-10 flex-shrink-0" width="36" height="36"><rect width="36" height="36" rx="6" fill="#0000FF"></rect><path d="M18.833 9.66663H12.9997C12.5576 9.66663 12.1337 9.84222 11.8212 10.1548C11.5086 10.4673 11.333 10.8913 11.333 11.3333V24.6666C11.333 25.1087 11.5086 25.5326 11.8212 25.8451C12.1337 26.1577 12.5576 26.3333 12.9997 26.3333H22.9997C23.4417 26.3333 23.8656 26.1577 24.1782 25.8451C24.4907 25.5326 24.6663 25.1087 24.6663 24.6666V15.5L18.833 9.66663Z" stroke="white" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"></path><path d="M18.833 9.66663V15.5H24.6663" stroke="white" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"></path></svg>'}}function addQuickAccessMenuEventListener(){document.addEventListener("selectionchange",e=>{if(e.stopPropagation(),document.activeElement.id!=="prompt-textarea")return;const t=document.querySelector("#quick-access-menu-wrapper"),o=getSelectionPosition();if(!o?.parentElement)return;const r=-1,n=previousCharPosition(o.parentElement,"/",o.start),i=previousCharPosition(o.parentElement," ",o.start);if(o.start===0||r===-1&&n===-1){t&&t.remove();return}const a=Math.max(r,n),s=getCharAtPosition(o.parentElement,a),l=getCharAtPosition(o.parentElement,a-1);(!l||l===" "||l===`
`||l==="."||l==="?"||l==="!"||a===-1)&&!t&&a!==-1&&o.start>a&&i<a?quickAccessMenu(s):t&&(a===-1||i>a)&&t.remove()}),document.body.addEventListener("click",e=>{const t=document.querySelector("#quick-access-menu-wrapper"),o=document.querySelector("#prompt-textarea");t&&!o?.contains(e.target)&&!t.contains(e.target)&&t.remove()}),document.body.addEventListener("keydown",e=>{const t=document.querySelector("#quick-access-menu-wrapper");if(!t)return;const o=t.querySelector("#quick-access-menu-content");if(e.key==="ArrowUp"){const r=o.querySelectorAll('button[id^=quick-access-menu-item-]:not([style*="display: none"])');if(r.length>0)if(!t.contains(document.activeElement))e.preventDefault(),t.focus(),r[r.length-1].focus(),r[0]?.querySelector("span#item-arrow")?.classList?.add("invisible"),r[r.length-1]?.querySelector("span#item-arrow")?.classList?.remove("invisible");else{const n=Array.from(r).indexOf(document.activeElement);r[n]?.querySelector("span#item-arrow")?.classList?.add("invisible"),n===0?(setTimeout(()=>{o.scrollTop=o.scrollHeight},100),r[r.length-1].focus({preventScroll:!0}),r[r.length-1]?.querySelector("span#item-arrow")?.classList?.remove("invisible")):n>0&&(r[n-1].focus(),r[n-1]?.querySelector("span#item-arrow")?.classList?.remove("invisible"))}return}if(e.key==="ArrowDown"){const r=o.querySelectorAll('button[id^=quick-access-menu-item-]:not([style*="display: none"])');if(r.length>0)if(!t.contains(document.activeElement))e.preventDefault(),t.focus(),r[0].focus(),r[0]?.querySelector("span#item-arrow")?.classList?.remove("invisible");else{const n=Array.from(r).indexOf(document.activeElement);r[n]?.querySelector("span#item-arrow")?.classList?.add("invisible"),n===r.length-1?(setTimeout(()=>{o.scrollTop=0},100),r[0].focus({preventScroll:!0}),r[0]?.querySelector("span#item-arrow")?.classList?.remove("invisible")):n<r.length-1&&(r[n+1].focus(),r[n+1]?.querySelector("span#item-arrow")?.classList?.remove("invisible"))}return}if(e.key==="Backspace"){document.activeElement.id!=="prompt-textarea"&&e.preventDefault();const r=o.querySelectorAll('button[id^=quick-access-menu-item-]:not([style*="display: none"])'),n=Array.from(r).indexOf(document.activeElement);r[n]?.querySelector("span#item-arrow")?.classList?.add("invisible"),r[0]?.querySelector("span#item-arrow")?.classList?.remove("invisible"),document.querySelector("#prompt-textarea").focus();return}if(e.key!=="Enter"){const r=document.querySelector("#prompt-textarea");r&&r.focus()}})}const debounceUpdateQuickAccessMenuItems=debounce(()=>{updateQuickAccessMenuItems()},300);function updateQuickAccessMenuItems(){const e=document.querySelector("#quick-access-menu-wrapper");if(!e)return;const t=document.querySelector("#prompt-textarea"),o=document.querySelector("#quick-access-menu-content");if(!t||!o)return;if(t.innerText.length===0){e.remove();return}const r=getSelectionPosition();if(!r?.parentElement)return;const n=t.innerText,i=-1,a=previousCharPosition(r.parentElement,"/",r.start);if(r.start===0||i===-1&&a===-1){e.remove();return}let s=nextCharPosition(r.parentElement," ",r.start),l=nextCharPosition(r.parentElement,`
`,r.start);s===-1&&(s=n.length),l===-1&&(l=n.length);const d=Math.min(s,l),c=Math.max(i,a),u=getCharAtPosition(r.parentElement,c),m=getStringBetween(r.parentElement,c+1,d);u==="@"?loadCustomGPTs(m):u==="/"&&loadPrompts(1,m)}function quickAccessMenu(e){const t=document.querySelector("#quick-access-menu-wrapper");if(t){t.remove();return}const o=document.createElement("div");o.id="quick-access-menu-wrapper",o.classList="absolute flex flex-col gap-2 rounded-2xl popover bg-token-main-surface-primary shadow-long  px-1",o.style="height: 300px; top:-304px; left:0; width:100%; z-index: 10000;";const r=document.createElement("div");r.classList="flex justify-between items-center py-2 px-3 border-b border-token-border-medium";const n=document.createElement("h3");n.classList="text-lg font-bold",r.appendChild(n);const i=document.createElement("button");i.classList="btn flex justify-center gap-2 composer-submit-btn composer-submit-button-color border",i.type="button",r.appendChild(i),o.appendChild(r);const a=document.querySelector("main form");if(a&&(a.classList.add("relative"),a.appendChild(o),i.focus(),e==="/")){n.textContent=`${translate("All Prompts")} (${e})`,i.id="see-all-custom-prompts",i.textContent=translate("plus Add New Prompt"),i.addEventListener("click",()=>{o.remove(),openPromptEditorModal({title:"",steps:[""]})});const s=document.createElement("div");s.id="quick-access-menu-content",s.classList="flex flex-col",s.style="overflow-y: auto;height: 100%; width: 100%;padding:3px;gap:2px;",s.innerHTML="",s.appendChild(loadingSpinner("quick-access-menu-content")),o.appendChild(s),updateQuickAccessMenuItems()}}function focusOnFirstItem(){const e=document.querySelector("#quick-access-menu-wrapper");if(!e)return;const t=e.querySelector("#quick-access-menu-content");if(!t)return;const o=t.querySelectorAll('button[id^=quick-access-menu-item-]:not([style*="display: none"])');o.length>0&&(t.contains(document.activeElement)||(e.focus(),o[0].focus(),o[0]?.querySelector("span#item-arrow")?.classList?.remove("invisible")))}function loadCustomGPTs(e=""){const t=document.querySelector("#quick-access-menu-content");t.innerHTML="",getGizmoDiscovery("recent",null,24,"global",!1).then(o=>{getGizmosPinned(!1).then(r=>{const n=o.list.items.map(i=>({...i.resource.gizmo,isRecent:!0}));r.forEach(i=>{const a=i?.gizmo?.id;n.find(s=>s.id===a)||n.push(i.gizmo)});for(let i=0;i<n.length;i+=1){const a=n[i];if(e&&!`${a.display.name} ${a?.display?.description}`.toLowerCase().includes(e.toLowerCase()))continue;const s=document.createElement("button");s.type="button",s.id=`quick-access-menu-item-${i}`,s.classList="btn w-full text-start focus-visible:outline-0 focus-visible:bg-token-main-surface-secondary hover:bg-token-main-surface-secondary flex justify-between items-center rounded-lg";const l=a?.display?.profile_picture_url?`<img src="${a?.display?.profile_picture_url}" class="h-full w-full bg-token-main-surface-secondary dark:bg-token-main-surface-tertiary" alt="GPT" width="80" height="80" />`:'<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="text-token-text-tertiary h-full w-full" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>';s.innerHTML=`<div class="w-full" tabindex="0"> <div class="group flex h-10 items-center gap-2 rounded-lg px-2 font-medium text-sm text-token-text-primary" > <div class="h-7 w-7 flex-shrink-0"> <div class="gizmo-shadow-stroke overflow-hidden rounded-full"> ${l}</div></div><div class="flex h-fit grow flex-row justify-between space-x-2 overflow-hidden text-ellipsis whitespace-nowrap"> <div class="flex flex-row space-x-2"> <span class="shrink-0 truncate">${a?.display?.name}</span ><span class="flex-grow truncate text-sm font-light text-token-text-tertiary max-w-sm">${a?.display?.description}</span > </div> <span class="shrink-0 self-center flex items-center"><span id="item-arrow" class="flex items-center justify-between text-xl me-2 rounded-md px-2 bg-token-main-surface-secondary ${i===0?"":"invisible"}"><span class="text-sm me-2">Enter</span> \u279C</span>${a?.isRecent?'<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="icon icon-sm" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg" > <circle cx="12" cy="12" r="10"></circle> <polyline points="12 6 12 12 16 14"></polyline></svg>':'<svg class="icon icon-sm" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"> <path fill-rule="evenodd" clip-rule="evenodd" d="M17.4845 2.8798C16.1773 1.57258 14.0107 1.74534 12.9272 3.24318L9.79772 7.56923C9.60945 7.82948 9.30775 7.9836 8.98654 7.9836H6.44673C3.74061 7.9836 2.27414 11.6759 4.16948 13.5713L6.59116 15.993L2.29324 20.2909C1.90225 20.6819 1.90225 21.3158 2.29324 21.7068C2.68422 22.0977 3.31812 22.0977 3.70911 21.7068L8.00703 17.4088L10.4287 19.8305C12.3241 21.7259 16.0164 20.2594 16.0164 17.5533V15.0135C16.0164 14.6923 16.1705 14.3906 16.4308 14.2023L20.7568 11.0728C22.2547 9.98926 22.4274 7.8227 21.1202 6.51549L17.4845 2.8798ZM11.8446 18.4147C12.4994 19.0694 14.0141 18.4928 14.0141 17.5533V15.0135C14.0141 14.0499 14.4764 13.1447 15.2572 12.58L19.5832 9.45047C20.0825 9.08928 20.1401 8.3671 19.7043 7.93136L16.0686 4.29567C15.6329 3.85993 14.9107 3.91751 14.5495 4.4168L11.4201 8.74285C10.8553 9.52359 9.95016 9.98594 8.98654 9.98594H6.44673C5.5072 9.98594 4.93059 11.5006 5.58535 12.1554L11.8446 18.4147Z" fill="currentColor"></path></svg>'}</span></div></div></div>`,t.appendChild(s),s.addEventListener("click",()=>{const d=document.querySelector("#prompt-textarea");if(!d)return;document.querySelector("#quick-access-menu-wrapper").remove();const c=d.innerText,u=getSelectionOffsetRelativeToParent(d).start,m=c.lastIndexOf("@",u),g=c.substring(0,m)+c.substring(u);setTextAreaElementValue(g);const p=document.querySelector("#reply-to-preview-wrapper"),h=document.querySelector("#image-edit-selection-preview"),f=document.querySelector("#tagged-gizmo-wrapper");f&&f.remove();const v=`<div id="tagged-gizmo-wrapper" data-gizmoid="${a.id}" class="flex w-full flex-row items-center rounded-b-lg ${p||h?"":"rounded-t-[20px]"} bg-token-main-surface-primary py-2.5 ps-3 pe-1.5 py-1 border border-token-border-medium"><div class="group flex flex-1 items-center gap-2 rounded-lg font-medium"><div class="h-6 w-6 flex-shrink-0"><div class="gizmo-shadow-stroke overflow-hidden rounded-full"><img src="${a?.display?.profile_picture_url}" class="h-full w-full bg-token-main-surface-secondary dark:bg-token-main-surface-tertiary" alt="GPT" width="80" height="80"></div></div><div class="space-x-2 overflow-hidden text-ellipsis text-sm font-light text-token-text-tertiary">Talking to <span class="font-medium text-token-text-tertiary">${a?.display?.name}</span></div></div><button id="tagged-gizmo-close-button" class="shrink-0"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-token-text-tertiary"><path d="M6.34315 6.34338L17.6569 17.6571M17.6569 6.34338L6.34315 17.6571" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div>`;p?(p.classList.remove("rounded-b-lg"),p.insertAdjacentHTML("afterend",v)):h?(h.classList.remove("rounded-b-lg"),h.insertAdjacentHTML("afterend",v)):d.parentElement.insertAdjacentHTML("afterbegin",v),d.focus();const x=document.querySelector("#tagged-gizmo-close-button");x&&x.addEventListener("click",y=>{y.preventDefault(),y.stopPropagation(),closeMenus();const b=document.querySelector("#tagged-gizmo-wrapper");b&&b.remove();const w=document.querySelector("#reply-to-preview-wrapper");w&&w.classList.add("rounded-b-lg");const k=document.querySelector("#image-edit-selection-preview");k&&k.classList.add("rounded-b-lg")})})}if(t.querySelectorAll("button[id^=quick-access-menu-item-]").length===0){const i=document.createElement("div");i.classList="text-center text-token-text-tertiary",i.textContent="No GPT found",t.appendChild(i)}})})}function loadPrompts(e=1,t=""){const o=document.querySelector("#quick-access-menu-content");if(o){if(e===1)o.innerHTML="",o.appendChild(loadingSpinner("quick-access-menu-content"));else{const r=document.querySelector("#load-more-prompts-button");r&&r.remove()}chrome.runtime.sendMessage({type:"getPrompts",detail:{pageNumber:e,searchTerm:t,isPublic:!1,orderBy:"alphabetical",deepSearch:!1}},r=>{if(!r)return;if(r.error){const s=document.querySelector("#loading-spinner-quick-access-menu-content");s&&s.remove();const l=document.createElement("div");l.classList="text-center text-token-text-tertiary",l.textContent="Error loading prompts",o.appendChild(l);return}const n=r?.results;if(!n)return;const i=document.querySelector("#loading-spinner-quick-access-menu-content");if(i&&i.remove(),n.length===0&&e===1){if(document.querySelector("#no-results-element"))return;const s=document.createElement("div");s.id="no-results-element",s.classList="text-center text-token-text-tertiary",s.textContent="No prompts found",o.appendChild(s);return}const a=n.sort((s,l)=>s.title.localeCompare(l.title));for(let s=0;s<a.length;s+=1){const l=n[s],d=document.createElement("button");d.type="button",d.title=`${l.title}

${sanitizeHtml(l?.steps?.map((c,u)=>`step ${u+1}:
${formatAttachmentsForPromptStep(c)}`).join(`
`))}`,d.id=`quick-access-menu-item-${s}`,d.classList="btn w-full text-start focus-visible:outline-0 focus-visible:bg-token-main-surface-secondary hover:bg-token-main-surface-secondary flex justify-between items-center rounded-lg py-1",d.innerHTML=`<span style="width:80%;"><span style="font-weight:bold; font-size:14px; margin-right:16px;white-space: nowrap; overflow: hidden; text-overflow: ellipsis;display:block;width:100%;">${l.title} <span class="font-normal text-xs text-token-text-tertiary">(${l.steps.length} ${l.steps.length>1?"steps":"step"})</span></span><span style="font-size:12px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;display:block;width:100%;color:#888;">${translate("Step")} 1: ${sanitizeHtml(formatAttachmentsForPromptStep(l.steps[0]))}</span></span><span id="item-arrow" class="flex items-center justify-between text-xl me-2 rounded-md px-2 bg-token-sidebar-surface-secondary ${e===1&&s===0?"":"invisible"}"><span class="text-sm me-2">Enter</span> \u279C</span>`,d.addEventListener("click",async c=>{if(c.shiftKey&&l.steps.length===1){if(!await canRunPrompts(l))return;await insertPromptIntoTextArea(l)}else runPromptChain(l,0,!1)}),o.appendChild(d)}if(focusOnFirstItem(),r.next){const s=document.createElement("button");s.id="load-more-prompts-button",s.classList="p-2 cursor-pointer flex items-center justify-center h-auto relative",s.appendChild(loadingSpinner("load-more-prompts-button")),o.appendChild(s);const l=new IntersectionObserver(d=>{d.forEach(c=>{c.isIntersecting&&loadPrompts(e+1,t)})},{threshold:0});s&&l.observe(s)}})}}async function insertPromptIntoTextArea(e,t=0){const{steps:o}=e;await attachFilesFromPromptToInput(o[t]);let r=removeAttachmentsFromPromptStep(o[t]);const n=extractInstructionsFromSmartStep(r);n&&(r=await generateNextPrompt(n));const i=document.querySelector("#prompt-textarea");if(i){if(i.innerText&&e.mode!=="splitter"){const a=getSelectionPosition();if(!a?.parentElement)return;const s=previousCharPosition(a.parentElement,"/",a.start);a.start!==-1&&s!==-1&&!getStringBetween(a.parentElement,s,a.start).includes(" ")?insertTextAtPosition(a.parentElement,r,s,a.end):insertTextAtPosition(a.parentElement,r,a.start,a.end)}else i.innerHTML="<p></p>",insertTextAtPosition(i.firstChild,r,0,1e6);updateInputCounter()}}function startNewChat(e=!1,t=null){if(t){if(e&&isOnNewGizmoPage(t)){refreshPage();return}const n=document.querySelector(`nav a[href^="/g/${t}"]`);if(n){n.click();return}window.history.pushState({},"",`/g/${t}`),window.dispatchEvent(new PopStateEvent("popstate",{state:{}}));return}if(e&&isOnNewChatPage()){refreshPage();return}let o=document.querySelector('nav a[href="/"]');const r=window.location.pathname;if(o&&r!=="/"){o.click();return}o=document.querySelector('nav button[data-testid="create-new-chat-button"]'),o&&o.click()}function isOnNewGizmoPage(e){return window.location.pathname.startsWith(`/g/${e}`)&&!window.location.pathname.includes("/c/")}function isOnNewChatPage(e=!0){return e?window.location.pathname==="/"||window.location.pathname.startsWith("/g/g-")&&!window.location.pathname.includes("/c/"):window.location.pathname==="/"}function refreshPage(){window.location.reload()}let runningPromptChain,runningPromptChainStepIndex=0,lastPromptChainId,templateWordsMap={};async function openPromptEditorModal(e){let t=e;e.is_favorite&&e.id&&(t=await chrome.runtime.sendMessage({type:"getPrompt",detail:{promptId:e.id}}));const{id:o,title:r,instruction:n="",steps:i,language:a="en",tags:s=[],folder:l,steps_delay:d,is_mine:c,is_public:u,is_favorite:m=!1}=t,g=o===void 0,p=document.createElement("div");p.style="position:fixed;top:0px;left:0px;width:100%;height:100%;;display:flex;align-items:center;justify-content:center;z-index:10000;overflow-y: auto; max-height: 100vh;",p.classList="bg-black/50 dark:bg-black/80",p.id="prompt-editor-modal",p.addEventListener("click",I=>{if(I.target.id==="prompt-editor-modal"){const G=document.querySelector('[data-expandtype="collapse"]');if(G){G.parentElement.click();return}const R=document.querySelector("#selected-prompt-editor-category-title")?.textContent||"",Z=document.querySelector("#prompt-editor-name-input").value,te=document.querySelector("#prompt-editor-delay-input").value,oe=Array.from(document.querySelectorAll('#tag-selector-container > div[data-selected="true"]')).map(re=>re.textContent.toLocaleLowerCase()).sort().join(""),ie=document.querySelector("#prompt-editor-instruction-textarea").value,le=Array.from(document.querySelectorAll('[id^="prompt-editor-input-"]')).map((re,ue)=>`${re.value}${convertPillsToAttachmentString(ue)}`),pe=document.querySelector("#public-prompt-checkbox").checked,ce=document.querySelector("#favorite-prompt-checkbox").checked,de=g&&(r===""&&Z!==""||i.join("")===""&&le.join("")!==""),W=!g&&(R!==l?.name||Z!==r||te!==d.toString()||oe!==s.map(re=>re.name).sort().join("")||ie!==(n||"")||le.join("")!==i.join("")||pe!==u||ce!==m);if(de||W){showConfirmDialog("Discard changes","You have unsaved changes. Are you sure you want to discard them?","Keep editing","Discard changes",null,()=>{p.remove()},"red");return}p.remove()}});const h=document.createElement("div");h.style="max-width:100%;width:840px;height:90vh;max-height:90vh;",h.classList="bg-token-main-surface-primary rounded-xl flex flex-col items-start justify-start border border-token-border-medium relative py-4 shadow-md",h.id="prompt-editor-modal-content",h.dataset.id=o;const f=document.createElement("div");f.classList="flex items-center justify-between w-full font-bold mb-9 px-4 text-token-text-primary text-lg",f.innerHTML=`<span class="flex items-center">${translate(g?"Create a new prompt":"Edit prompt")} <a href="https://www.youtube.com/watch?v=ha2AiwOglt4&ab_channel=Superpower" target="_blank" rel="noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md ps-0.5 text-token-text-tertiary h-5 w-5 ms-2"><path fill="currentColor" d="M13 12a1 1 0 1 0-2 0v4a1 1 0 1 0 2 0zM12 9.5A1.25 1.25 0 1 0 12 7a1.25 1.25 0 0 0 0 2.5"></path><path fill="currentColor" fill-rule="evenodd" d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2M4 12a8 8 0 1 1 16 0 8 8 0 0 1-16 0" clip-rule="evenodd"></path></svg></a> </span> <button class="btn composer-submit-btn composer-submit-button-color flex justify-center gap-2 border" id="see-all-prompt-chains">${translate("See all prompts")}</button>`,h.appendChild(f);const v=document.createElement("div");v.style="display:flex;align-items:center;justify-content:space-between;width:100%;margin-bottom:8px;position:relative;padding: 0 16px 16px 16px;",h.appendChild(v);const x=document.createElement("div");x.style="position:relative;min-width:170px;width:170px;z-index:1000;",v.appendChild(x);const y=document.createElement("div");y.style="position:relative;min-width:170px;width:170px;z-index:1000;",v.appendChild(y);let{selectedPromptEditorLanguage:b}=cachedSettings;chrome.runtime.sendMessage({type:"getAllPromptFolders",forceRefresh:!0,detail:{sortBy:"alphabetical"}},I=>{I.length===0&&!t.title&&addFolderConfirmDialog();const G=l&&typeof l.id=="number"?I.find(R=>R.id.toString()===l.id.toString()):I[0];chrome.storage.local.set({settings:{...cachedSettings,selectedPromptEditorCategory:G}}),x.innerHTML=dropdown("Prompt-Editor-Category",I,G,"id","left"),addDropdownEventListener("Prompt-Editor-Category",I,"id")}),a&&(b=languageList.find(I=>I.code===a));const w=[{code:"select",name:"Select"},...languageList.slice(1)];y.innerHTML=dropdown("Prompt-Editor-Language",w,b,"code","right");const k=document.createElement("div");k.style="display:flex;align-items:center;justify-content:space-between;width:100%;margin-bottom:8px;position:relative;padding: 0 16px 16px 16px;",h.appendChild(k);const S=document.createElement("div");S.style="width:100%;margin-right: 16px;";const M=document.createElement("label");M.classList="w-full text-sm text-token-text-tertiary",M.textContent=translate("Prompt Name"),S.appendChild(M);const $=document.createElement("input");$.id="prompt-editor-name-input",$.className="w-full text-sm text-token-text-primary border border-token-border-medium rounded-md bg-token-main-surface-secondary px-2 py-1 text-sm h-10",$.placeholder="Test Prompt",$.value=r,$.addEventListener("input",()=>{$.style.border="1px solid #565869"}),S.appendChild($),k.appendChild(S);const q=document.createElement("div");q.style="min-width: 200px;";const E=document.createElement("label");E.classList="flex w-full text-sm text-token-text-tertiary",E.textContent=translate("Delay between steps"),E.appendChild(createInfoIcon("The delay (in milliseconds) after last step response is received and before sending the next step. This can help prevent rate limiting.","top","margin-left: 0")),q.appendChild(E);const C=document.createElement("input");C.id="prompt-editor-delay-input",C.className="w-full text-sm text-token-text-primary border border-token-border-medium rounded-md bg-token-main-surface-secondary px-2 py-1 text-sm h-10",C.placeholder="2000",C.value=d||"2000",C.addEventListener("input",()=>{C.style.border="1px solid #565869"}),q.appendChild(C),k.appendChild(q);const L=document.createElement("span");L.style="right: 24px; z-index: 999; bottom: 24px;",L.classList="text-sm text-token-text-tertiary absolute ",L.textContent="ms",k.appendChild(L);const _=document.createElement("div");_.classList="flex items-center justify-start w-full px-4",h.appendChild(_);const T=document.createElement("button");T.id="tag-selector-button",T.classList="btn flex justify-center gap-2 btn-secondary me-2",T.innerHTML=`<span id="tag-selector-button-text">${translate("Show tags")}</span><span id="tag-selector-button-count">(${s.length})</span>`,T.addEventListener("click",()=>{const I=document.querySelector("#instruction-selector-button");if(I.textContent=translate("Show instructions"),document.querySelector("#instruction-section")?.classList.add("hidden"),T.querySelector("#tag-selector-button-text").textContent===translate("Hide tags")){T.querySelector("#tag-selector-button-text").textContent=translate("Show tags"),document.querySelector("#tag-selector-section")?.classList.add("hidden");return}T.querySelector("#tag-selector-button-text").textContent=translate("Hide tags"),document.querySelector("#tag-selector-section")?.classList.remove("hidden")}),_.appendChild(T);const z=document.createElement("button");z.id="instruction-selector-button",z.classList="btn flex justify-center gap-2 btn-secondary me-2",z.textContent=translate("Show instructions"),z.addEventListener("click",()=>{const I=document.querySelector("#tag-selector-button");if(I.querySelector("#tag-selector-button-text").textContent=translate("Show tags"),document.querySelector("#tag-selector-section")?.classList.add("hidden"),z.textContent===translate("Hide instructions")){z.textContent=translate("Show instructions"),document.querySelector("#instruction-section")?.classList.add("hidden");return}z.textContent=translate("Hide instructions"),document.querySelector("#instruction-section")?.classList.remove("hidden")}),_.appendChild(z);const B=document.createElement("div");B.classList="w-full ps-8 pe-4 pt-2",B.appendChild(createTagSelector(s)),h.appendChild(B);const F=document.createElement("div");F.id="instruction-section",F.classList="hidden w-full ps-8 pe-4 pt-2";const N=document.createElement("textarea");N.id="prompt-editor-instruction-textarea",N.classList="w-full h-full bg-token-main-surface-secondary text-token-text-primary border border-token-border-medium rounded-xl px-2 py-1 text-sm placeholder:text-gray-500",N.placeholder="Add instructions on how to use this prompt, what are the expected variable and responses, etc. This instruction is only for your reference when using the prompt and will not be sent to the AI model.",N.style="height: 100px;",N.value=n,N.addEventListener("input",()=>{}),F.appendChild(N),h.appendChild(F);const O=document.createElement("div");O.style="display:flex; align-items:end; justify-content:between;width:100%;padding: 16px;";const H=document.createElement("label");H.classList="w-full text-sm text-token-text-tertiary",H.textContent=translate("Steps"),O.appendChild(H);const P=document.createElement("div");if(P.id="prompt-editor-steps-wrapper",P.style="width:100%;height:100%;display:flex;flex-direction:column;align-items:start;justify-content:start;overflow: auto;padding: 0 16px;scroll-behavior: smooth;",g){const I=document.createElement("button");I.classList="btn flex justify-center gap-2 btn-secondary",I.textContent=translate("Auto generate steps from current conversation"),O.appendChild(I),chrome.runtime.sendMessage({type:"checkHasSubscription"},G=>{I.addEventListener("click",()=>{const R=document.querySelectorAll('main article div[data-message-author-role="user"]'),Z=[];if(R.forEach(oe=>{const ie=oe.querySelector("div.whitespace-pre-wrap");ie&&Z.push(ie.innerText)}),Z.length===0){toast("Open an existin conversation, then try again!","error");return}if(!G&&Z.length>=2){errorUpgradeConfirmation({type:"limit",title:"You have reached the limit",message:"Prompts with free account cannot have more than 2 steps. Upgrade to Pro to remove all limits."});return}P.innerHTML="";const te=t;te.steps=Z,Z.forEach((oe,ie)=>{const le=createPromptEditorStep(te,ie);P.appendChild(le)})})})}h.appendChild(O),i.forEach((I,G)=>{const R=createPromptEditorStep(t,G);P.appendChild(R)}),Sortable.create(P,{handle:"#prompt-editor-drag-handle",multiDrag:!0,direction:"vertical",selectedClass:"multi-drag-selected"}),h.appendChild(P);const j=document.createElement("div");j.classList="flex items-end justify-between w-full mt-auto px-4 flex-wrap",h.appendChild(j);const D=document.createElement("div");D.classList="flex items-center justify-end mt-3 w-full",j.appendChild(D);const K=document.createElement("div");K.classList="flex items-center justify-end me-6";const U=document.createElement("label");U.htmlFor="favorite-prompt-checkbox",U.textContent=translate("Favorite"),U.classList="text-token-text-tertiary",K.appendChild(U);const Y=document.createElement("input");Y.type="checkbox",Y.id="favorite-prompt-checkbox",Y.classList="ms-2",Y.checked=m,K.appendChild(Y),D.appendChild(K);const X=document.createElement("div");X.classList="flex items-center justify-end";const Q=document.createElement("label");Q.htmlFor="public-prompt-checkbox",Q.textContent=translate("public"),Q.classList="text-token-text-tertiary",X.appendChild(Q);const V=document.createElement("input");V.type="checkbox",V.id="public-prompt-checkbox",V.classList="ms-2",V.checked=u,X.appendChild(V),D.appendChild(X);const A=document.createElement("div");A.classList="flex items-center justify-start flex-wrap",j.appendChild(A);const ee=document.createElement("button");ee.classList="btn composer-submit-btn composer-submit-button-color flex justify-center gap-2 border",ee.style="margin-top:16px;",ee.id="prompt-editor-add-step-button",ee.textContent=translate("plus Add New Step"),A.appendChild(ee);const ne=document.createElement("button");ne.classList="btn flex justify-center gap-2 btn-success border",ne.style="margin-top:16px; margin-left:8px;",ne.id="prompt-editor-add-step-button",ne.textContent=translate("plus Add Smart Step"),A.appendChild(ne),chrome.runtime.sendMessage({type:"checkHasSubscription"},I=>{ee.addEventListener("click",()=>{const G=document.querySelectorAll('[id^="prompt-editor-input-"]');if(!I&&G.length>=2){errorUpgradeConfirmation({type:"limit",title:"You have reached the limit",message:"Prompts with free account cannot have more than 2 steps. Upgrade to Pro to remove all limits."});return}const R=createPromptEditorStep(t,G.length);document.querySelector("#prompt-editor-steps-wrapper").appendChild(R),R.scrollIntoView({behavior:"smooth",block:"end"}),setTimeout(()=>{R.querySelector("textarea").focus()},500)}),ne.addEventListener("click",()=>{const G=document.querySelectorAll('[id^="prompt-editor-input-"]');if(!I){errorUpgradeConfirmation({type:"limit",title:"This is a Pro feature",message:"Adding Smart Steps to prompt chain requires a Pro subscription. Upgrade to Pro to remove all limits."});return}const R=createPromptEditorStep(t,G.length,!0);document.querySelector("#prompt-editor-steps-wrapper").appendChild(R),R.scrollIntoView({behavior:"smooth",block:"end"}),setTimeout(()=>{R.querySelector("textarea").focus()},500)})});const ae=document.createElement("div");ae.classList="flex items-center justify-end flex-wrap",j.appendChild(ae);const se=document.createElement("button");se.classList="btn flex justify-center gap-2 btn-secondary border me-2",se.style="margin-top:16px;margin-left:8px;",se.textContent=translate("Cancel"),se.id="prompt-editor-cancel-button",se.addEventListener("click",()=>{p.remove()}),ae.appendChild(se);const J=document.createElement("button");J.classList="btn composer-submit-btn composer-submit-button-color flex justify-center gap-2 border",J.style="margin-top:16px;margin-left:8px;",J.id="prompt-editor-submit-button",J.textContent=translate(g?"Save to my Prompts":"Update Prompt"),J.addEventListener("click",()=>{if(J.disabled=!0,!document.querySelector("#selected-prompt-editor-category-title")){J.disabled=!1,addFolderConfirmDialog();return}const I=document.querySelector("#prompt-editor-name-input"),G=I.value;if(!G){J.disabled=!1,I.focus(),I.style.border="1px solid #ff4a4a",toast("Please enter a prompt name","error");return}if(G.length>200){J.disabled=!1,I.focus(),I.style.border="1px solid #ff4a4a",toast("Prompt name cannot exceed 200 characters","error");return}const R=document.querySelector("#prompt-editor-delay-input"),Z=parseInt(R.value,10);if(!Z){J.disabled=!1,R.focus(),R.style.border="1px solid #ff4a4a",toast("Please enter a valid delay in milliseconds","error");return}const te=[];if(document.querySelectorAll("[id^=prompt-editor-input-]").forEach((W,re)=>{const ue=convertPillsToAttachmentString(re),ge=W.dataset.smartstep==="true"&&W.value.trim()?`{{sp_instruction:${W.value}}}${ue}`:`${W.value}${ue}`;ge&&te.push(ge)}),te.length===0){J.disabled=!1,toast("Please add at least one step to the prompt chain","error");return}const oe=document.querySelector("#public-prompt-checkbox").checked,ie=document.querySelector("#favorite-prompt-checkbox").checked,le=document.querySelectorAll('#tag-selector-container > div[data-selected="true"]'),pe=document.querySelector("#prompt-editor-instruction-textarea").value,{selectedPromptEditorCategory:ce}=cachedSettings,de={title:G,instruction:pe,steps:te,steps_delay:Z,is_public:oe,is_favorite:ie,folder:ce.id,language:cachedSettings.selectedPromptEditorLanguage.code,tags:Array.from(le).map(W=>W.id.split("tag-")[1])};g||(de.id=o),g&&updatePromptFolderCount(ce.id,[o||""]),chrome.runtime.sendMessage({type:g?"addPrompts":"updatePrompt",detail:{prompts:[de],promptData:de}},W=>{if(W.error&&W.error.type==="limit"){J.disabled=!1,errorUpgradeConfirmation(W.error);return}const re=g?W[0]:W;typeof m<"u"&&initializeContinueButton(!0),p.remove(),document.querySelector("#modal-manager")&&managerModalCurrentTab==="prompts"&&addOrReplacePromptCard(re),toast(`Prompt is ${g?"added to your prompts":"updated"}!`)})}),ae.appendChild(J),p.appendChild(h),document.body.appendChild(p),addPromptEditorEventListener(),addDropdownEventListener("Prompt-Editor-Language",w,"code");const he=document.querySelector("#prompt-editor-steps-wrapper");new MutationObserver(()=>{const I=he.childNodes;I.forEach((G,R)=>{const Z=R+1,te=I.length,oe=G.querySelector("#prompt-chain-step-count");oe&&(oe.innerHTML=`${Z} / ${te}`)})}).observe(he,{childList:!0})}function addPromptEditorEventListener(){document.querySelector("#see-all-prompt-chains").addEventListener("click",()=>{document.querySelector("#prompt-editor-modal").remove(),(!document.querySelector("#modal-manager")||managerModalCurrentTab!=="prompts")&&createManager("prompts")})}function addFolderConfirmDialog(){showConfirmDialog("You don't have any prompt categories","To create prompts, you need to have at least one category.","Cancel","Create New Prompt Category ",()=>{document.querySelector("#prompt-editor-modal").remove()},()=>{document.querySelector("#prompt-editor-modal").remove(),(!document.querySelector("#modal-manager")||managerModalCurrentTab!=="prompts")&&createManager("prompts"),setTimeout(()=>{document.querySelector("#add-prompt-folder-button")?.click()},500)},"green")}function getFilesFromPromptStep(e){const t=/\{sp_attachments:\s*\[([^\]]*)\]\}/,o=e.match(t);return o&&o[1]?o[1].split(",").map(r=>r.trim()):[]}async function attachFilesFromPromptToInput(e){const t=getFilesFromPromptStep(e);if(t.length===0)return;const o=document.querySelector('main form input[type="file"]');if(!o)return;const r=new DataTransfer;for(const n of t){const i=n.split("__"),a=i[0],s=i.slice(1).join("__")||"attachment",l=await chrome.runtime.sendMessage({type:"getPromptAttachment",detail:{fileId:a}});if(!l||!l.file)continue;const d=await downloadFileFromUrl(l.file,l.file_id,!0),c=new File([d],s||"attachment",{type:d.type});r.items.add(c)}o.files=r.files,o.dispatchEvent(new Event("change",{bubbles:!0}))}function createAttachmentPill(e,t=null,o=null){const r=document.createElement("div");r.classList="flex items-center justify-between bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary text-token-text-primary border border-token-border-medium rounded-lg px-3 py-1 text-sm me-2 mb-1 max-w-full relative",r.style="height:32px;min-width:fit-content;overflow:hidden;",r.title=e,t?r.dataset.fileId=t:r.id=`prompt-attachment-loading-pill-${o}`;const n=document.createElement("div");n.classList="flex items-center justify-start overflow-hidden",r.appendChild(n);const i=document.createElement("span");i.classList="me-1",i.innerHTML='<svg viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="icon" height="20" width="20"><path d="M4.33496 12.5V7.5C4.33496 7.13273 4.63273 6.83496 5 6.83496C5.36727 6.83496 5.66504 7.13273 5.66504 7.5V12.5C5.66504 14.8942 7.60585 16.835 10 16.835C12.3942 16.835 14.335 14.8942 14.335 12.5V5.83301C14.3348 4.35959 13.1404 3.16522 11.667 3.16504C10.1934 3.16504 8.99822 4.35948 8.99805 5.83301V12.5C8.99805 13.0532 9.44679 13.502 10 13.502C10.5532 13.502 11.002 13.0532 11.002 12.5V7.5C11.002 7.13273 11.2997 6.83496 11.667 6.83496C12.0341 6.83514 12.332 7.13284 12.332 7.5V12.5C12.332 13.7877 11.2877 14.832 10 14.832C8.71226 14.832 7.66797 13.7877 7.66797 12.5V5.83301C7.66814 3.62494 9.45888 1.83496 11.667 1.83496C13.875 1.83514 15.6649 3.62505 15.665 5.83301V12.5C15.665 15.6287 13.1287 18.165 10 18.165C6.87131 18.165 4.33496 15.6287 4.33496 12.5Z"></path></svg>',n.appendChild(i);const a=document.createElement("span");if(a.classList="me-2",a.style="overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:150px;",a.textContent=e,n.appendChild(a),t){const s=document.createElement("button");s.classList="flex items-center justify-center text-token-text-tertiary hover:text-token-text-primary",s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-sm"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>',s.addEventListener("click",()=>{r.remove()}),r.appendChild(s)}else{const s=document.createElement("button");s.classList="flex items-center justify-center text-token-text-tertiary hover:text-token-text-primary relative px-3",s.style="transform: scale(0.75);",s.appendChild(loadingSpinner("prompt-attachment-pill")),r.appendChild(s)}return r}function convertPillsToAttachmentString(e){const t=document.querySelector(`#attachment-pills-wrapper-${e}`);if(!t)return"";const o=t.querySelectorAll("div[data-file-id]");if(o.length===0)return"";const r=[];return o.forEach(n=>{r.push(`${n.dataset.fileId}__${n.textContent.trim()}`)}),`{sp_attachments: [${r.join(", ")}]}`}function removeAttachmentsFromPromptStep(e){const t=/\{sp_attachments:\s*\[([^\]]*)\]\}/;return e.replace(t,"")}function formatAttachmentsForPromptStep(e){if(!e||e.trim()==="")return e;const t=/\{sp_attachments:\s*\[([^\]]*)\]\}/,o=e.match(t);if(o&&o[1]){const r=`Attachments:
- ${o[1].split(",").map(n=>n.trim()).map(n=>n.split("__").slice(1).join("__")||"attachment").join(`
- `)}`;return e.replace(t,r)}return e}function extractInstructionsFromSmartStep(e){return e.match(/\{\{sp_instruction:(?<instruction>(?:[^{}]|\{\{[^{}]*\}\})*)\}\}/)?.groups?.instruction||""}function cleanupStepText(e){let t=e;t=removeAttachmentsFromPromptStep(t);const o=extractInstructionsFromSmartStep(t);return o&&(t=o),t=t.trim(),t}function createPromptEditorStep(e,t,o=!1){const r=e.steps[t]||"",n=extractInstructionsFromSmartStep(r),i=o||!!n,a=getFilesFromPromptStep(r),s=!e.id,l=document.createElement("div");l.style="align-self:stretch;overflow:auto;min-height:200px;z-index:999;",l.classList="w-full flex items-center justify-between mb-4 rounded-xl relative h-full border border-token-border-medium",i&&(l.style.border="solid 2px #19c37d60",l.dataset.smartstep="true");const d=document.createElement("div");d.style="width:70px;",d.classList="flex flex-col items-center justify-between h-full";const c=document.createElement("button");if(c.id=`rewrite-prompt-step-button-${t}`,c.disabled=r.trim()==="",c.style.opacity=r.trim()===""?"0.5":"1",c.classList=`relative w-full flex items-center justify-center bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary text-token-text-primary border-b border-token-border-medium ${r.trim()===""?"cursor-not-allowed":""}`,c.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="icon" fill="currentColor" width="20" height="20" viewBox="0 0 512 512"><path d="M327.5 85.19L384 64L405.2 7.491C406.9 2.985 411.2 0 416 0C420.8 0 425.1 2.985 426.8 7.491L448 64L504.5 85.19C509 86.88 512 91.19 512 96C512 100.8 509 105.1 504.5 106.8L448 128L426.8 184.5C425.1 189 420.8 192 416 192C411.2 192 406.9 189 405.2 184.5L384 128L327.5 106.8C322.1 105.1 320 100.8 320 96C320 91.19 322.1 86.88 327.5 85.19V85.19zM176 73.29C178.6 67.63 184.3 64 190.6 64C196.8 64 202.5 67.63 205.1 73.29L257.8 187.3L371.8 240C377.5 242.6 381.1 248.3 381.1 254.6C381.1 260.8 377.5 266.5 371.8 269.1L257.8 321.8L205.1 435.8C202.5 441.5 196.8 445.1 190.6 445.1C184.3 445.1 178.6 441.5 176 435.8L123.3 321.8L9.292 269.1C3.627 266.5 0 260.8 0 254.6C0 248.3 3.627 242.6 9.292 240L123.3 187.3L176 73.29zM166.9 207.5C162.1 217.8 153.8 226.1 143.5 230.9L92.32 254.6L143.5 278.2C153.8 282.1 162.1 291.3 166.9 301.6L190.6 352.8L214.2 301.6C218.1 291.3 227.3 282.1 237.6 278.2L288.8 254.6L237.6 230.9C227.3 226.1 218.1 217.8 214.2 207.5L190.6 156.3L166.9 207.5zM405.2 327.5C406.9 322.1 411.2 320 416 320C420.8 320 425.1 322.1 426.8 327.5L448 384L504.5 405.2C509 406.9 512 411.2 512 416C512 420.8 509 425.1 504.5 426.8L448 448L426.8 504.5C425.1 509 420.8 512 416 512C411.2 512 406.9 509 405.2 504.5L384 448L327.5 426.8C322.1 425.1 320 420.8 320 416C320 411.2 322.1 406.9 327.5 405.2L384 384L405.2 327.5z"/></svg>',addTooltip(c,{value:"Optimize prompt",position:"right"}),d.appendChild(c),c.addEventListener("click",async b=>{b.preventDefault(),b.stopPropagation();const w=document.querySelector(`#prompt-editor-input-${t}`);w&&showRewritePromptSettings(c,w)}),e.is_public||!s){const b=document.createElement("button");b.classList="relative w-full flex items-center justify-center bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary text-token-text-primary border-b border-token-border-medium",b.innerHTML='<svg id="run-from-here-icon" stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>',addTooltip(b,{value:"Run from this step",position:"right"}),d.appendChild(b),b.addEventListener("click",w=>{w.stopPropagation(),closeMenus(),document.querySelector("#prompt-editor-submit-button")?.click(),document.querySelector("#modal-close-button-manager")?.click();const k={id:document.querySelector("#prompt-editor-modal-content").dataset.id,title:document.querySelector("#prompt-editor-name-input").value,steps:Array.from(document.querySelectorAll('[id^="prompt-editor-input-"]')).map(S=>S.value).filter(S=>S),steps_delay:parseInt(document.querySelector("#prompt-editor-delay-input").value,10),is_public:document.querySelector("#public-prompt-checkbox").checked,is_favorite:document.querySelector("#favorite-prompt-checkbox").checked};runPromptChain(k,t,!1)})}if(e.is_mine||s){const b=document.createElement("button");b.classList="relative w-full flex items-center justify-center bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary text-token-text-primary border-b border-token-border-medium",b.innerHTML='<svg viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="icon" height="20" width="20"><path d="M4.33496 12.5V7.5C4.33496 7.13273 4.63273 6.83496 5 6.83496C5.36727 6.83496 5.66504 7.13273 5.66504 7.5V12.5C5.66504 14.8942 7.60585 16.835 10 16.835C12.3942 16.835 14.335 14.8942 14.335 12.5V5.83301C14.3348 4.35959 13.1404 3.16522 11.667 3.16504C10.1934 3.16504 8.99822 4.35948 8.99805 5.83301V12.5C8.99805 13.0532 9.44679 13.502 10 13.502C10.5532 13.502 11.002 13.0532 11.002 12.5V7.5C11.002 7.13273 11.2997 6.83496 11.667 6.83496C12.0341 6.83514 12.332 7.13284 12.332 7.5V12.5C12.332 13.7877 11.2877 14.832 10 14.832C8.71226 14.832 7.66797 13.7877 7.66797 12.5V5.83301C7.66814 3.62494 9.45888 1.83496 11.667 1.83496C13.875 1.83514 15.6649 3.62505 15.665 5.83301V12.5C15.665 15.6287 13.1287 18.165 10 18.165C6.87131 18.165 4.33496 15.6287 4.33496 12.5Z"></path></svg>',addTooltip(b,{value:"Attach files",position:"right"}),b.addEventListener("click",w=>{w.stopPropagation(),closeMenus();const k=document.createElement("input");k.type="file",k.multiple=!0,k.click(),k.addEventListener("change",()=>{if(k.files.length===0)return;const S=document.querySelector(`#attachment-pills-wrapper-${t}`);if(S){if(S.querySelectorAll("div[data-file-id]").length+k.files.length>10){toast("You can upload a maximum of 10 files for each step","error");return}Array.from(k.files).forEach((M,$)=>{if(M.size>500*1024*1024){toast(`File ${M.name} is too large. Maximum file size is 500MB`,"error");return}const q=createAttachmentPill(M.name,null,$);S.appendChild(q),q.scrollIntoView({behavior:"smooth",block:"end"});const E=new FileReader;E.onload=async()=>{const C={base64:E.result.split(",")[1],type:M.type,name:M.name};chrome.runtime.sendMessage({type:"addPromptAttachment",detail:{promptId:e.id,attachment:C}},L=>{if(L.error){toast(L.error.message,"error");return}const _=document.querySelector(`#prompt-attachment-loading-pill-${$}`);if(_&&_.remove(),S){const T=createAttachmentPill(M.name,L.file_id);S.appendChild(T),T.scrollIntoView({behavior:"smooth",block:"end"})}})},E.readAsDataURL(M)}),k.remove()}})}),d.appendChild(b)}const u=document.createElement("div");u.classList="relative w-full flex items-center justify-center bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary text-token-text-primary rounded-bs-xl",u.id="prompt-editor-drag-handle",u.innerHTML='<svg stroke="currentColor" fill="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4" height="1em" width="2em" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M32 288c-17.7 0-32 14.3-32 32s14.3 32 32 32l384 0c17.7 0 32-14.3 32-32s-14.3-32-32-32L32 288zm0-128c-17.7 0-32 14.3-32 32s14.3 32 32 32l384 0c17.7 0 32-14.3 32-32s-14.3-32-32-32L32 160z"/></svg>',addTooltip(u,{value:"Drag to reorder",position:"right"});const m=document.createElement("button");m.classList="relative w-full flex items-center justify-center bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary text-token-text-primary border-b border-token-border-medium",m.innerHTML='<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>',addTooltip(m,{value:"Delete step",position:"right"}),m.addEventListener("click",b=>{b.stopPropagation(),closeMenus(),m.title==="Confirm delete"?l.remove():(m.title="Confirm delete",m.style.backgroundColor="#864e6140",m.style.color="#ff4a4a",m.innerHTML='<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><polyline points="20 6 9 17 4 12"></polyline></svg>',setTimeout(()=>{m.title="Delete",m.style.backgroundColor="#2d2d3a",m.style.color="#eee",m.innerHTML='<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>'},3e3))}),d.appendChild(m),d.appendChild(u),l.appendChild(d);const g=`${100/d.childNodes.length}%`;d.childNodes.forEach(b=>{b.style.height=g});const p=document.createElement("textarea");p.placeholder=i?`Enter instructions for the AI to intelligently generate the best prompt for this step based on the last response. Example:
"Extract the "title" from the previous response and use the below template to create a catchy blog post:

Template:
"Write a blog post titled '{{title}}'"`:`Enter prompt text. Use {{variable name}} to ask user for text input.
Special variable names:
{{files}}: to ask user to upload file.
{{clipboard}}: to automatically paste user's clipboard content.`,p.id=`prompt-editor-input-${t}`,p.classList="w-full h-full bg-token-main-surface-secondary text-token-text-primary border border-token-border-medium border-t-0 border-b-0 border-e-0 px-2 py-1 pb-8 text-sm placeholder:text-gray-500",p.style="resize: none;top:0;left:0;overflow:auto;",i&&(p.style.fontStyle="italic",p.style.backgroundColor="#19c37d20",p.style.backdropFilter="blur(100000px)",p.dataset.smartstep="true"),p.dir="auto",p.value=cleanupStepText(r),["input","change","paste","cut","keydown","keyup"].forEach(b=>{p.addEventListener(b,()=>{const w=document.querySelector(`#rewrite-prompt-step-button-${t}`);if(w){const k=p.value.trim();w.disabled=k.length===0,w.style.opacity=k.length===0?"0.5":"1",k.length===0?w.classList.add("cursor-not-allowed"):w.classList.remove("cursor-not-allowed")}})}),l.appendChild(p);const h=document.createElement("div");if(h.id=`attachment-pills-wrapper-${t}`,h.classList="absolute bottom-0 flex items-center justify-start pe-8",h.style="left:72px;width:calc(100% - 120px);height:40px;overflow:auto;z-index:999;",a.length>0)for(const b of a){const w=b.split("__"),k=w[0],S=w.slice(1).join("__")||"attachment",M=createAttachmentPill(S||"attachment",k);h.appendChild(M)}l.appendChild(h);const f=document.createElement("div");f.id="prompt-chain-step-expand",f.title="Expand",f.dataset.expanded="false",f.classList="absolute cursor-pointer text-token-text-primary p-1 rounded-full bg-token-main-surface-primary opacity-60 hover:opacity-100",f.style="top:6px;right:6px;",f.innerHTML='<svg data-expandtype="expand" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="icon icon-sm" viewBox="0 0 512 512"><path d="M183 295l-81.38 81.38l-47.03-47.03c-6.127-6.117-14.29-9.367-22.63-9.367c-4.117 0-8.279 .8086-12.25 2.43c-11.97 4.953-19.75 16.63-19.75 29.56v135.1C.0013 501.3 10.75 512 24 512h136c12.94 0 24.63-7.797 29.56-19.75c4.969-11.97 2.219-25.72-6.938-34.87l-47.03-47.03l81.38-81.38c9.375-9.375 9.375-24.56 0-33.94S192.4 285.7 183 295zM487.1 0h-136c-12.94 0-24.63 7.797-29.56 19.75c-4.969 11.97-2.219 25.72 6.938 34.87l47.04 47.03l-81.38 81.38c-9.375 9.375-9.375 24.56 0 33.94s24.56 9.375 33.94 0l81.38-81.38l47.03 47.03c6.127 6.117 14.3 9.35 22.63 9.35c4.117 0 8.275-.7918 12.24-2.413C504.2 184.6 512 172.9 512 159.1V23.1C512 10.75 501.3 0 487.1 0z"></path></svg>',f.addEventListener("click",()=>{f.dataset.expanded=f.dataset.expanded==="true"?"false":"true";const b=l.querySelector("textarea");if(f.dataset.expanded==="false"){f.innerHTML='<svg data-expandtype="expand" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="icon icon-sm" viewBox="0 0 512 512"><path d="M183 295l-81.38 81.38l-47.03-47.03c-6.127-6.117-14.29-9.367-22.63-9.367c-4.117 0-8.279 .8086-12.25 2.43c-11.97 4.953-19.75 16.63-19.75 29.56v135.1C.0013 501.3 10.75 512 24 512h136c12.94 0 24.63-7.797 29.56-19.75c4.969-11.97 2.219-25.72-6.938-34.87l-47.03-47.03l81.38-81.38c9.375-9.375 9.375-24.56 0-33.94S192.4 285.7 183 295zM487.1 0h-136c-12.94 0-24.63 7.797-29.56 19.75c-4.969 11.97-2.219 25.72 6.938 34.87l47.04 47.03l-81.38 81.38c-9.375 9.375-9.375 24.56 0 33.94s24.56 9.375 33.94 0l81.38-81.38l47.03 47.03c6.127 6.117 14.3 9.35 22.63 9.35c4.117 0 8.275-.7918 12.24-2.413C504.2 184.6 512 172.9 512 159.1V23.1C512 10.75 501.3 0 487.1 0z"></path></svg>',b.parentElement.style.position="relative",b.parentElement.style.zIndex="999",b.style.position="unset",b.style.padding="4px 8px 32px 8px",b.classList.remove("rounded-xl");const w=l.querySelector("#prompt-chain-step-next-button");w&&w.classList.add("hidden");const k=l.querySelector("#prompt-chain-step-previous-button");k&&k.classList.add("hidden");const S=l.querySelector(`#attachment-pills-wrapper-${t}`);S&&(S.style.left="72px",S.style.width="calc(100% - 120px)")}else{f.innerHTML='<svg data-expandtype="collapse" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="icon icon-sm" viewBox="0 0 512 512"><path d="M215.1 272h-136c-12.94 0-24.63 7.797-29.56 19.75C45.47 303.7 48.22 317.5 57.37 326.6l30.06 30.06l-78.06 78.07c-12.5 12.5-12.5 32.75-.0012 45.25l22.62 22.62c12.5 12.5 32.76 12.5 45.26 .0013l78.06-78.07l30.06 30.06c6.125 6.125 14.31 9.367 22.63 9.367c4.125 0 8.279-.7891 12.25-2.43c11.97-4.953 19.75-16.62 19.75-29.56V296C239.1 282.7 229.3 272 215.1 272zM296 240h136c12.94 0 24.63-7.797 29.56-19.75c4.969-11.97 2.219-25.72-6.938-34.87l-30.06-30.06l78.06-78.07c12.5-12.5 12.5-32.76 .0002-45.26l-22.62-22.62c-12.5-12.5-32.76-12.5-45.26-.0003l-78.06 78.07l-30.06-30.06c-9.156-9.141-22.87-11.84-34.87-6.937c-11.97 4.953-19.75 16.62-19.75 29.56v135.1C272 229.3 282.7 240 296 240z"/></svg>',b.parentElement.style.position="unset",b.parentElement.style.zIndex="1001",b.style.position="absolute",b.style.padding="20px 8px 48px 8px",b.classList.add("rounded-xl"),b.focus();const w=l.querySelector("#prompt-chain-step-next-button");w&&w.classList.remove("hidden");const k=l.querySelector("#prompt-chain-step-previous-button");k&&k.classList.remove("hidden");const S=l.querySelector(`#attachment-pills-wrapper-${t}`);S&&(S.style.left="8px",S.style.width="calc(100% - 70px)")}}),l.appendChild(f);const v=document.createElement("div");v.id="prompt-chain-step-count",v.style="bottom:4px;right:10px;",v.classList="text-token-text-tertiary absolute text-xs",v.innerHTML=`${t+1} / ${Math.max(e.steps.length,1)}`,l.appendChild(v);const x=document.createElement("button");x.id="prompt-chain-step-next-button",x.classList="absolute top-1/2 transform -translate-y-1/2 p-2 rounded-full bg-token-main-surface-secondary text-token-text-primary focus-visible:outline-0 hover:bg-token-sidebar-surface-secondary focus-visible:bg-token-sidebar-surface-secondary border border-token-border-medium hidden",x.style="right: -20px;",x.innerHTML='<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md-heavy"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.29289 18.7071C8.90237 18.3166 8.90237 17.6834 9.29289 17.2929L14.5858 12L9.29289 6.70711C8.90237 6.31658 8.90237 5.68342 9.29289 5.29289C9.68342 4.90237 10.3166 4.90237 10.7071 5.29289L16.7071 11.2929C16.8946 11.4804 17 11.7348 17 12C17 12.2652 16.8946 12.5196 16.7071 12.7071L10.7071 18.7071C10.3166 19.0976 9.68342 19.0976 9.29289 18.7071Z" fill="currentColor"></path></svg>',l.appendChild(x),x.addEventListener("click",()=>{f.click();const b=t+1,w=document.querySelector(`#prompt-editor-input-${b}`);w&&w.parentElement.querySelector("#prompt-chain-step-expand").click()});const y=document.createElement("button");return y.id="prompt-chain-step-previous-button",y.classList="absolute top-1/2 transform -translate-y-1/2 p-2 rounded-full bg-token-main-surface-secondary text-token-text-primary focus-visible:outline-0 hover:bg-token-sidebar-surface-secondary focus-visible:bg-token-sidebar-surface-secondary border border-token-border-medium hidden",y.style="left: -20px;",y.innerHTML='<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md-heavy"><path fill-rule="evenodd" clip-rule="evenodd" d="M14.7071 5.29289C15.0976 5.68342 15.0976 6.31658 14.7071 6.70711L9.41421 12L14.7071 17.2929C15.0976 17.6834 15.0976 18.3166 14.7071 18.7071C14.3166 19.0976 13.6834 19.0976 13.2929 18.7071L7.29289 12.7071C7.10536 12.5196 7 12.2652 7 12C7 11.7348 7.10536 11.4804 7.29289 11.2929L13.2929 5.29289C13.6834 4.90237 14.3166 4.90237 14.7071 5.29289Z" fill="currentColor"></path></svg>',l.appendChild(y),y.addEventListener("click",()=>{f.click();const b=t-1,w=document.querySelector(`#prompt-editor-input-${b}`);w&&w.parentElement.querySelector("#prompt-chain-step-expand").click()}),l}function createTagSelector(e=[],t=!1){const o=document.createElement("div");o.id="tag-selector-section",o.classList=`flex flex-col w-full items-start justify-start ${t?"":"hidden"}`;const r=document.createElement("div");r.classList="text-token-text-tertiary text-sm my-2",r.id="tag-selector-title",r.textContent=translate("Select up to 3"),o.appendChild(r);const n=document.createElement("div");return chrome.runtime.sendMessage({type:"getPromptTags"},i=>{i.sort((a,s)=>a.name.localeCompare(s.name));for(let a=0;a<i.length;a+=1){const s=e.map(d=>d.id.toString()).includes(i[a].id.toString());n.classList="flex flex-wrap w-full items-center justify-start mt-2",n.id="tag-selector-container";const l=document.createElement("div");l.id=`tag-${i[a].id.toString().replace(/ /g,"-")}`,l.classList=`text-xs ${s?`${isDarkMode()?"text-black bg-white":"text-white bg-black"}`:"text-token-text-tertiary bg-transparent hover:bg-token-main-surface-secondary"} border border-token-border-medium rounded-md px-2 py-1 cursor-pointer me-2 mb-2 capitalize`,l.dataset.selected=s,l.textContent=i[a].name,l.title=i[a].name,l.addEventListener("click",()=>{if(r.classList.replace("text-red-500","text-token-text-tertiary"),document.querySelectorAll('#tag-selector-container > div[data-selected="true"]').length>=3&&l.dataset.selected==="false"){toast("You can only select up to 3 tags");return}l.dataset.selected==="false"?(l.classList.replace("text-token-text-tertiary",`${isDarkMode()?"text-black":"text-white"}`),l.classList.replace("bg-transparent",`${isDarkMode()?"bg-white":"bg-black"}`),l.classList.remove("hover:bg-token-main-surface-secondary"),l.dataset.selected=!0):(l.classList.replace(`${isDarkMode()?"text-black":"text-white"}`,"text-token-text-tertiary"),l.classList.replace(`${isDarkMode()?"bg-white":"bg-black"}`,"bg-transparent"),l.classList.add("hover:bg-token-main-surface-secondary"),l.dataset.selected=!1),document.querySelector("#prompt-editor-modal #tag-selector-button-count").textContent=`(${document.querySelectorAll('#tag-selector-container > div[data-selected="true"]').length})`}),n.appendChild(l)}}),o.appendChild(n),o}function resetPromptChain(){const e=document.querySelector("#running-prompt-chain-step-count");e&&(e.remove(),(runningPromptChain||runningPromptChainStepIndex>0)&&setTimeout(()=>{document.title=getConversationName()},500)),runningPromptChain=void 0,runningPromptChainStepIndex=0,templateWordsMap={},hideGeneratingPromptText(),showRerunLastPromptChain()}async function showRerunLastPromptChain(){const e=document.querySelector("#rerun-prompt-chain-wrapper");if(e&&e.remove(),!cachedSettings.showRerunLastPromptChainButton||!lastPromptChainId||runningPromptChain)return;const t=await chrome.runtime.sendMessage({type:"getPrompt",detail:{promptId:lastPromptChainId}});if(!t||!t.steps||t.steps.length===0)return;const o=document.querySelector("main form");if(!o)return;const r=document.createElement("div");r.id="rerun-prompt-chain-wrapper",r.classList="w-30 gap-2 flex items-center bg-token-main-surface-secondary text-token-text-primary rounded-full px-1 py-1 mb-2 hover:bg-token-main-surface-tertiary border border-token-border-medium mx-auto absolute z-20",r.style="top:-40px;left:50%;transform:translateX(-50%);",o.appendChild(r);const n=document.createElement("div");n.classList="cursor-pointer text-token-text-tertiary hover:text-token-text-primary",n.id="rerun-prompt-chain-button",n.innerHTML='<svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="icon icon-sm"><path d="M3.502 16.6663V13.3333C3.502 12.9661 3.79977 12.6683 4.16704 12.6683H7.50004L7.63383 12.682C7.93691 12.7439 8.16508 13.0119 8.16508 13.3333C8.16508 13.6547 7.93691 13.9227 7.63383 13.9847L7.50004 13.9984H5.47465C6.58682 15.2249 8.21842 16.0013 10 16.0013C13.06 16.0012 15.5859 13.711 15.9551 10.7513L15.9854 10.6195C16.0845 10.3266 16.3785 10.1334 16.6973 10.1732C17.0617 10.2186 17.3198 10.551 17.2745 10.9154L17.2247 11.2523C16.6301 14.7051 13.6224 17.3313 10 17.3314C8.01103 17.3314 6.17188 16.5383 4.83208 15.2474V16.6663C4.83208 17.0335 4.53411 17.3311 4.16704 17.3314C3.79977 17.3314 3.502 17.0336 3.502 16.6663ZM4.04497 9.24935C3.99936 9.61353 3.66701 9.87178 3.30278 9.8265C2.93833 9.78105 2.67921 9.44876 2.72465 9.08431L4.04497 9.24935ZM10 2.66829C11.9939 2.66833 13.8372 3.46551 15.1778 4.76204V3.33333C15.1778 2.96616 15.4757 2.66844 15.8428 2.66829C16.2101 2.66829 16.5079 2.96606 16.5079 3.33333V6.66634C16.5079 7.03361 16.2101 7.33138 15.8428 7.33138H12.5098C12.1425 7.33138 11.8448 7.03361 11.8448 6.66634C11.8449 6.29922 12.1426 6.0013 12.5098 6.0013H14.5254C13.4133 4.77488 11.7816 3.99841 10 3.99837C6.93998 3.99837 4.41406 6.28947 4.04497 9.24935L3.38481 9.16634L2.72465 9.08431C3.17574 5.46702 6.26076 2.66829 10 2.66829Z"></path></svg>',addTooltip(n,{value:"Rerun last prompt chain",position:"top"}),r.appendChild(n),n.addEventListener("click",async()=>{const l=await chrome.runtime.sendMessage({type:"getPrompt",detail:{promptId:lastPromptChainId}});r.remove(),lastPromptChainId=null,runPromptChain(l,0,!1)});const i=document.createElement("div");i.classList="cursor-pointer text-token-text-tertiary hover:text-token-text-primary",i.id="edit-prompt-chain-button",i.innerHTML='<svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-sm"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.2929 4.29291C15.0641 2.52167 17.9359 2.52167 19.7071 4.2929C21.4783 6.06414 21.4783 8.93588 19.7071 10.7071L18.7073 11.7069L11.1603 19.2539C10.7182 19.696 10.1489 19.989 9.53219 20.0918L4.1644 20.9864C3.84584 21.0395 3.52125 20.9355 3.29289 20.7071C3.06453 20.4788 2.96051 20.1542 3.0136 19.8356L3.90824 14.4678C4.01103 13.8511 4.30396 13.2818 4.7461 12.8397L13.2929 4.29291ZM13 7.41422L6.16031 14.2539C6.01293 14.4013 5.91529 14.591 5.88102 14.7966L5.21655 18.7835L9.20339 18.119C9.40898 18.0847 9.59872 17.9871 9.7461 17.8397L16.5858 11L13 7.41422ZM18 9.5858L14.4142 6.00001L14.7071 5.70712C15.6973 4.71693 17.3027 4.71693 18.2929 5.70712C19.2831 6.69731 19.2831 8.30272 18.2929 9.29291L18 9.5858Z" fill="currentColor"></path></svg>',addTooltip(i,{value:"Edit last prompt chain",position:"top"}),r.appendChild(i),i.addEventListener("click",async()=>{const l=await chrome.runtime.sendMessage({type:"getPrompt",detail:{promptId:lastPromptChainId}});openPromptEditorModal(l)});const a=document.createElement("div");a.classList="text-xs text-token-text-primary truncate mx-1",a.style="max-width:120px;",a.id="prompt-chain-name",a.textContent=t?.title||"Prompt Chain",a.title=t?.title||"Prompt Chain",r.appendChild(a);const s=document.createElement("div");s.classList="cursor-pointer text-token-text-tertiary hover:text-token-text-primary ps-2",s.id="close-rerun-prompt-chain-button",s.innerHTML='<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-sm"><path d="M11.4142 10L15.7071 5.70711C16.0976 5.31658 16.0976 4.68342 15.7071 4.29289C15.3166 3.90237 14.6834 3.90237 14.2929 4.29289L10 8.58579L5.70711 4.29289C5.31658 3.90237 4.68342 3.90237 4.29289 4.29289C3.90237 4.68342 3.90237 5.31658 4.29289 5.70711L8.58579 10L4.29289 14.2929C3.90237 14.6834 3.90237 15.3166 4.29289 15.7071C4.68342 16.0976 5.31658 16.0976 5.70711 15.7071L10 11.4142L14.2929 15.7071C14.6834 16.0976 15.3166 16.0976 15.7071 15.7071C16.0976 15.3166 16.0976 14.6834 15.7071 14.2929L11.4142 10Z" fill="currentColor"></path></svg>',addTooltip(s,{value:"Close",position:"top"}),r.appendChild(s),s.addEventListener("click",()=>{r.remove(),lastPromptChainId=null})}async function canRunPrompts(e){if(!await chrome.runtime.sendMessage({type:"checkHasSubscription"})){if(e?.steps?.length>2)return errorUpgradeConfirmation({type:"limit",title:"You have reached the limit",message:"Running prompts with more than 2 steps requires a Pro account. Upgrade to Pro to remove all limits."}),!1;if((await chrome.runtime.sendMessage({type:"getPromptsCount",forceRefresh:!0})).count>5)return errorUpgradeConfirmation({type:"limit",title:"You have reached the limit",message:"You have more than 5 prompts in your account. Remove some prompts or upgrade to Pro to remove all limits."}),!1}return!0}async function runPromptChain(e,t=0,o=!0){e?.mode!=="splitter"&&!await canRunPrompts(e)||initiateRunPrompChain(e,t,o)}async function initiateRunPrompChain(e,t,o=!0){if(lastPromptChainId=null,resetPromptChain(),o){startNewChat(),setTimeout(()=>{const l=document.querySelector("#prompt-textarea");l&&(l.innerHTML="<p></p>",runPromptChain(e,t,!1))},1e3);return}const r=document.querySelector("main form");if(!r)return;const n=document.querySelector("#prompt-textarea");if(!n)return;await insertPromptIntoTextArea(e,t),runningPromptChain=e,runningPromptChainStepIndex=t,lastPromptChainId=runningPromptChain.id;const i=document.querySelector("#running-prompt-chain-step-count");if(i&&i.remove(),runningPromptChain.steps.length>1){const l=createPromptChainStepCounter();document.title=`${runningPromptChainStepIndex+1} / ${runningPromptChain.steps.length}`,r.appendChild(l)}e.is_public&&t===0&&chrome.runtime.sendMessage({type:"incrementPromptUseCount",forceRefresh:!0,detail:{promptId:e.id}}),await promptTemplateHandler(e.steps[t]),n.innerHTML=convertToParagraphs(n);const a=Date.now(),s=setInterval(()=>{const l=getSubmitButton();if(l&&!l.disabled){clearInterval(s),l?.click(),updateInputCounter();return}Date.now()-a>3e4&&(clearInterval(s),toast("Failed to run the prompt chain. Please try again.","error"))},300)}function addPromptChainCounterElement(){const e=document.querySelector("main form");if(!e)return;let t=document.querySelector("#running-prompt-chain-step-count");t||(t=createPromptChainStepCounter(),e.appendChild(t))}function createPromptChainStepCounter(){const e=runningPromptChain?.mode==="splitter",t=document.createElement("div");t.id="running-prompt-chain-step-count",t.classList="cursor-pointer text-xs absolute text-token-text-tertiary flex items-center justify-center z-10";const o=getConversationIdFromUrl();return t.style="top:-30px;right:16px;",runningPromptChain&&runningPromptChain.steps.length>1&&(t.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" stroke="currentColor"  class='icon icon-xs me-1' viewBox="0 0 512 512"><path d="M328 160h-144C170.8 160 160 170.8 160 184v144C160 341.2 170.8 352 184 352h144c13.2 0 24-10.8 24-24v-144C352 170.8 341.2 160 328 160zM256 0C114.6 0 0 114.6 0 256s114.6 256 256 256s256-114.6 256-256S397.4 0 256 0zM256 464c-114.7 0-208-93.31-208-208S141.3 48 256 48s208 93.31 208 208S370.7 464 256 464z"/></svg> Running ${e?"splitter":"prompt chain"}: ${runningPromptChainStepIndex+1} / ${runningPromptChain?.steps?.length||"1"} <span class='animate-flicker inline-block ms-1 inli w-2 h-2 rounded-full bg-gold'></span>`),addTooltip(t,{value:"Stop",position:"left"}),t.addEventListener("click",()=>{stopAnimateFavicon(faviconTimeout),resetPromptChain();const r=getConversationName();addConversationToSidebarAndSync(r,o)}),t}async function insertNextChain(e,t){if(!e||!t)return;const o=e?.mode==="splitter",{steps:r}=e;runningPromptChain=e,runningPromptChainStepIndex=t;const n=document.querySelector("main form");if(!n)return;const i=document.querySelector("#prompt-textarea");if(!i)return;await attachFilesFromPromptToInput(r[t]);let a=removeAttachmentsFromPromptStep(r[t]);const s=extractInstructionsFromSmartStep(a);s&&(a=await generateNextPrompt(s)),setTextAreaElementValue(a);let l=document.querySelector("#running-prompt-chain-step-count");l||(l=createPromptChainStepCounter(),n.appendChild(l)),l.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" stroke="currentColor"  class='icon icon-xs me-1' viewBox="0 0 512 512"><path d="M328 160h-144C170.8 160 160 170.8 160 184v144C160 341.2 170.8 352 184 352h144c13.2 0 24-10.8 24-24v-144C352 170.8 341.2 160 328 160zM256 0C114.6 0 0 114.6 0 256s114.6 256 256 256s256-114.6 256-256S397.4 0 256 0zM256 464c-114.7 0-208-93.31-208-208S141.3 48 256 48s208 93.31 208 208S370.7 464 256 464z"/></svg> Running ${o?"splitter":"prompt chain"}: ${t+1} / ${r.length} <span class='animate-flicker inline-block ms-1 inli w-2 h-2 rounded-full bg-gold'></span>`,document.title=`${t+1} / ${r.length}`,await promptTemplateHandler(a),i.innerHTML=convertToParagraphs(i);const d=Date.now(),c=setInterval(()=>{const u=getSubmitButton();if(u&&!u.disabled){clearInterval(c),u?.click(),updateInputCounter();return}Date.now()-d>3e4&&(clearInterval(c),toast("Failed to run the prompt chain. Please try again.","error"))},300)}async function promptTemplateHandler(e){if(!cachedSettings.promptTemplate){window.localStorage.getItem("seenPromptTemplateToast")||(toast("Did you mean to use {{prompt templates}}? If yes, first turn it on in the Settings menu","success",6e3),window.localStorage.setItem("seenPromptTemplateToast","true"));return}if(e.includes("{{clipboard}}")){let o="";try{o=await navigator.clipboard.readText()}catch(r){console.error("Failed to read clipboard contents: ",r),toast("Failed to read clipboard contents. Please allow clipboard access and try again.","error",8e3)}e=e.replace(/{{clipboard}}/g,o),setTextAreaElementValue(e)}const t=e.match(/{{(?!files|file|clipboard)[^{}]+}}/g);if(t?.length>0){t.forEach((r,n)=>{t[n]=r.replace(/{{|}}/g,"")});const o=Object.keys(templateWordsMap);t.every(r=>o.includes(r))?(t.forEach(r=>{e=e.replace(`{{${r}}}`,templateWordsMap[r])}),setTextAreaElementValue(e)):e=await createTemplateWordsModal(t)}if(e.includes("{{files}}")||e.includes("{{file}}")){if(getPlusButton()){const o=document.querySelector('main form input[type="file"]');if(o)return new Promise(r=>{const n=()=>{const i=e.replace(/{{files}}/g,"").replace(/{{file}}/g,"");setTextAreaElementValue(i);const a=setInterval(()=>{const s=getSubmitButton();s&&!s.disabled&&(clearInterval(a),r())},200)};o.addEventListener("change",n,{once:!0}),setTimeout(()=>{o.click()},100)});console.error("File input element not found")}console.error("Upload file button not found")}}function showGeneratingPromptText(){const e=document.querySelector("#smart-prompt-loading-wrapper");if(e&&e.remove(),!runningPromptChain)return;const t=document.querySelector("main form");if(!t)return;const o=document.createElement("div");o.id="smart-prompt-loading-wrapper",o.classList="gap-2 flex items-center text-token-text-primary mx-auto absolute z-20",o.style="top:-30px;left:50%;transform:translateX(-50%);",t.appendChild(o);const r=document.createElement("div");r.classList="cursor-pointer text-token-text-tertiary hover:text-token-text-primary feather-wave",r.id="smart-prompt-loading",r.innerHTML='<svg width="20" height="20" viewBox="0 0 512 512" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="icon icon-sm"><path d="M467.1 44.85C438.3 15.97 401.7 0 361.7 0c-46.75 0-98.01 21.88-146.9 70.63L129.1 156.3c-74.99 75.12-72.23 196.4-56.24 248.9l-65.84 65.77c-9.374 9.374-9.374 24.6 0 33.98c9.374 9.374 24.6 9.374 33.98 0l65.64-65.62c17.37 5.25 42.36 9.138 70.86 9.138c57.12 0 127.1-15.56 178.1-65.56l85.75-85.75C531.1 206.6 529.6 107.5 467.1 44.85zM147.4 398.6l46.62-46.62h123.1c-44.5 41.87-106.7 48.5-140.5 48.5C166 400.5 156.1 399.6 147.4 398.6zM350.6 319.1H226l63.1-63.1h123.7c-2.25 2.375-3.1 4.875-6.375 7.25L350.6 319.1zM438.9 223.1h-116.9l22.5-22.5c9.374-9.374 9.374-24.62 0-33.1c-9.374-9.374-24.62-9.374-33.1 0l-196.1 196.1c-5.25-45.87-.25-124.2 49.5-174.1l85.74-85.74c36.1-36.1 75.99-56.62 112.9-56.62c26.62 0 51.37 10.75 71.49 30.87C472.2 117.1 473.1 171.1 438.9 223.1z"/></svg>',o.appendChild(r);const n=document.createElement("div");n.classList="cursor-pointer text-token-text-tertiary hover:text-token-text-primary text-xs ms-1",n.id="smart-prompt-loading-text",n.textContent="Generating next prompt...",o.appendChild(n)}function hideGeneratingPromptText(){const e=document.querySelector("#smart-prompt-loading-wrapper");e&&e.remove()}async function generateNextPrompt(e){if(!await chrome.runtime.sendMessage({type:"checkHasSubscription"}))return e;showGeneratingPromptText();const t=Array.from(document.querySelectorAll("main article")),o=t?.pop(),r=t?.pop()?.innerText?.trim().replace(/^You said:\s*/i,"")||"",n=o?o?.innerText?.trim():"",i=await chrome.runtime.sendMessage({type:"promptSameLanguage",detail:{prompt:[{role:"user",content:r},{role:"assistant",content:n},{role:"user",content:`${e}


  Response Rules:
  - Respond only with the next user prompt.
  - Do not include any explanations, notes, or additional information.
  - Ensure the prompt is concise, actionable, and goal-seeking.
  - Avoid using filler words or phrases.
  - Do not reference previous messages or context.
  - Focus solely on crafting the next user input based on the instruction provided.
  `}],createOptions:{systemPrompt:"Return only the user\u2019s next message\u2014concise, actionable, and goal-seeking."},promptOptions:{},forceRefresh:!1}});if(hideGeneratingPromptText(),chrome.runtime.lastError){console.error("Background error:",chrome.runtime.lastError.message);return}if(i?.ok)return(i.text||"").trim();console.error("Prompt failed:",i?.error,i?.meta)}function createKeyboardShortcutsModal(e){const t=keyboardShortcutsModalContent(e),o=keyboardShortcutsModalActions();createModal("Keyboard Shortcuts",'Some shortkeys only work when Auto-Sync is ON. Having issues? see our <a href="https://ezi.notion.site/Superpower-ChatGPT-FAQ-9d43a8a1c31745c893a4080029d2eb24" target="_blank" rel="noopener noreferrer" style="color:gold;">FAQ</a>',t,o,!1)}function buttonGenerator(e,t="md"){const o=navigator.platform.toUpperCase().indexOf("MAC")>=0,r={"\u2318":o?"CMD":"CTRL","\u2325":o?"OPTION":"ALT","\u21E7":"SHIFT"};return`<div class="flex flex-row gap-2">
  ${e.map(n=>(!o&&n.includes("\u2318")&&(n=n.replace("\u2318","CTRL")),!o&&n.includes("\u2325")&&(n=n.replace("\u2325","Alt")),!o&&n.includes("\u21E7")&&(n=n.replace("\u21E7","Shift")),!o&&n.includes("\u2325")&&(n=n.replace("\u2325","Alt")),n)).map(n=>`<div ${r[n]?`title="${r[n]}"`:""} class="${t==="xs"?"h-5 px-1 text-xs text-token-icon icon-secondary":"my-2 h-8 text-sm px-2 text-token-icon icon-primary"} flex items-center justify-center rounded-md border border-token-border-medium capitalize">${n}</div>`).join("")}
  </div>`}function keyboardShortcutsModalContent(){const e=document.createElement("div");e.id="modal-content-keyboard-shortcuts-list",e.style="overflow-y: hidden;position: relative;height:100%; width:100%",e.classList="markdown prose-invert";const t=document.createElement("img");t.src=chrome.runtime.getURL("icons/logo.png"),t.style="position: fixed; top: 50%; right: 50%; width: 400px; height: 400px; opacity: 0.07; transform: translate(50%, -50%);box-shadow:none !important;",e.appendChild(t);const o=document.createElement("div");o.style="display: flex; flex-direction: column; justify-content: start; align-items: start;overflow-y: auto; height: 100%; width: 100%; white-space: break-spaces; overflow-wrap: break-word;padding: 16px;position: relative;z-index:10;";const r='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="gold" d="M468.9 32.11c13.87 0 27.18 10.77 27.18 27.04v145.9c0 10.59-8.584 19.17-19.17 19.17h-145.7c-16.28 0-27.06-13.32-27.06-27.2c0-6.634 2.461-13.4 7.96-18.9l45.12-45.14c-28.22-23.14-63.85-36.64-101.3-36.64c-88.09 0-159.8 71.69-159.8 159.8S167.8 415.9 255.9 415.9c73.14 0 89.44-38.31 115.1-38.31c18.48 0 31.97 15.04 31.97 31.96c0 35.04-81.59 70.41-147 70.41c-123.4 0-223.9-100.5-223.9-223.9S132.6 32.44 256 32.44c54.6 0 106.2 20.39 146.4 55.26l47.6-47.63C455.5 34.57 462.3 32.11 468.9 32.11z"/></svg>';return o.innerHTML=`
  <table style="width:100%;">
    <tr>
      <th class="text-token-text-tertiary text-left">Shortcut</th>
      <th class="text-token-text-tertiary text-left">Action</th>
    </tr>
    <tr>
      <td>${buttonGenerator(["\u2318","\u21E7","K"])}</td>
      <td>Open Keyboard Shortcut Modal</td>
    </tr>
    <tr>
      <td>${buttonGenerator(["\u2318","\u21E7","."])}</td>
      <td>Open Settings</td>
    </tr>
    <tr>
      <td>${buttonGenerator(["\u2318","\u21E7","O"])}</td>
      <td>Open New Chat</td>
    </tr>
    <tr>
      <td>${buttonGenerator(["\u2318","\u21E7","X"])}</td>
      <td>Open Conversation Manager</td>
    </tr>
    <tr>
      <td>${buttonGenerator(["\u2318","\u21E7","P"])}</td>
      <td>Open Prompt Manager</td>
    </tr>
    <tr>
      <td>${buttonGenerator(["\u2318","\u21E7","Y"])}</td>
      <td>Open Gallery</td>
    </tr>
    <tr>
      <td>${buttonGenerator(["\u2318","\u21E7","F"])}</td>
      <td>Open Enhanced GPT Store</td>
    </tr>
    <tr>
      <td>${buttonGenerator(["\u2318","\u21E7","E"])}</td>
      <td>Open Note Manager</td>
    </tr>
    <tr>
      <td>${buttonGenerator(["\u2318","\u21E7","I"])}</td>
      <td>Open Custom Instruction Pofiles</td>
    </tr>
    <tr>
      <td>${buttonGenerator(["\u2318","\u21E7","M"])}</td>
      <td>Open Pinned Chats</td>
    </tr>

    <!--tr>
      <td>${buttonGenerator(["\u2318","\u21E7",","])}</td>
      <td>Open Analytics</td>
    </tr -->

    <tr>
      <td>${buttonGenerator(["\u2318","\u21E7","L"])}</td>
      <td>Open Newsletter Archive</td>
    </tr>
    <tr>
      <td>${buttonGenerator(["\u2318","\u21E7","S"])}</td>
      <td>Toggle Sidebar</td>
    </tr>
    <tr>
      <td>${buttonGenerator(["\u2318","\u21E7","\u232B"])}</td>
      <td>Delete Current Conversation</td>
    </tr>
    <tr>
      <td>${buttonGenerator(["\u2318","\u2325","]"])}</td>
      <td>Toggle sidebar folders</td>
    </tr>
    <tr>
      <td>${buttonGenerator(["\u2318","\u21E7","["])}</td>
      <td>Toggle sidebar notes</td>
    </tr>
    <tr>
      <td>${buttonGenerator(["\u2318","\u21E7","\u2325","M"])}</td>
      <td>Move Current Conversation to Folder</td>
    </tr>
    <tr>
      <td>${buttonGenerator(["\u2318","\u21E7","\u2325","E"])}</td>
      <td>Export Current Conversation</td>
    </tr>
    <tr>
      <td>${buttonGenerator(["\u2318","\u21E7","\u2325","R"])}</td>
      <td>Open a Random Conversation</td>
    </tr>
    <tr>
      <td>${buttonGenerator(["\u2318","\u21E7","\u2325","F"])}</td>
      <td>Toggle Current Conversation Favorite</td>
    </tr>

    <tr>
      <td>${buttonGenerator(["\u2318","\u21E7","C"])}</td>
      <td>Copy last response</td>
    </tr>
    <tr>
      <td>${buttonGenerator(["\u2318","\u21E7","\u2325","C"])}</td>
      <td>Copy last response (HTML)</td>
    </tr>
    <tr>
      <td>${buttonGenerator(["\u2318","P"])}</td>
      <td>Save current conversation as PDF</td>
    </tr>
    <tr>
      <td>${buttonGenerator(["\u2318","\u21E7","\u2325","D"])}</td>
      <td>Save last response as PDF</td>
    </tr>


    <tr>
      <td>${buttonGenerator(["Home"])}</td>
      <td>Scroll to top</td>
    </tr>
    <tr>
      <td>${buttonGenerator(["\u21E7","Home"])}</td>
      <td>Scroll up one message</td>
    </tr>
    <tr>
      <td>${buttonGenerator(["Esc"])}</td>
      <td>Close Modals/Stop Generating</td>
    </tr>
    <tr>
      <td>${buttonGenerator(["\u21E7","End"])}</td>
      <td>Scroll down one message</td> 
    </tr>
    <!-- tr>
      <td>${buttonGenerator(["\u2318","\u21E7",`<span class="text-sm flex items-center justify-center" style="min-width:100px;">Click on <span style="display:inline-block;margin-left:8px;"><img class="w-4 h-4" src="${chrome.runtime.getURL("icons/new-folder.png")}"></span></span>`])}</td>
      <td>Reset the order of chats from newest to oldest (removes all folders)</td>
    </tr>
    <tr>
      <td>${buttonGenerator(["\u2318","\u21E7",`<span class="text-sm flex items-center justify-center" style="min-width:100px;">Click on <span style="display: inline-block;width:12px;height:12px;margin-left:8px;">${r}</span></span>`])}</td>
      <td>Reset Auto Sync</td>
    </tr -->
  </table>
  `,e.appendChild(o),e}function keyboardShortcutsModalActions(){return settingsModalActions()}async function registerShortkeys(){document.addEventListener("keydown",async e=>{if((e.metaKey||isWindows()&&e.ctrlKey)&&e.shiftKey&&!e.altKey&&e.keyCode===190&&!e.repeat){document.querySelector("#modal-settings")||(e.preventDefault(),e.stopPropagation(),createSettingsModal());return}if((e.metaKey||isWindows()&&e.ctrlKey)&&e.shiftKey&&!e.altKey&&e.keyCode===76&&!e.repeat){e.preventDefault(),e.stopPropagation(),createManager("newsletters");return}if((e.metaKey||isWindows()&&e.ctrlKey)&&e.shiftKey&&!e.altKey&&e.keyCode===89&&!e.repeat){e.preventDefault(),e.stopPropagation(),createManager("gallery",!0);return}if((e.metaKey||isWindows()&&e.ctrlKey)&&e.shiftKey&&!e.altKey&&e.keyCode===75&&!e.repeat){e.preventDefault(),e.stopPropagation(),document.querySelector("#modal-keyboard-shortcuts")||createKeyboardShortcutsModal();return}if((e.metaKey||isWindows()&&e.ctrlKey)&&e.shiftKey&&!e.altKey&&e.keyCode===80&&!e.repeat){e.preventDefault(),e.stopPropagation(),createManager("prompts");return}if((e.metaKey||isWindows()&&e.ctrlKey)&&e.shiftKey&&!e.altKey&&e.keyCode===88&&!e.repeat){e.preventDefault(),e.stopPropagation(),createManager("conversations");return}if((e.metaKey||isWindows()&&e.ctrlKey)&&e.shiftKey&&!e.altKey&&e.keyCode===70&&!e.repeat){e.preventDefault(),e.stopPropagation(),createManager("gpts");return}if((e.metaKey||isWindows()&&e.ctrlKey)&&e.shiftKey&&!e.altKey&&e.keyCode===73&&!e.repeat){e.preventDefault(),e.stopPropagation(),createManager("custom-instruction-profiles");return}if((e.metaKey||isWindows()&&e.ctrlKey)&&e.shiftKey&&!e.altKey&&e.keyCode===77&&!e.repeat){e.preventDefault(),createManager("pinned-messages");return}if((e.metaKey||isWindows()&&e.ctrlKey)&&e.shiftKey&&!e.altKey&&e.keyCode===69&&!e.repeat){e.preventDefault(),e.stopPropagation(),createManager("notes");return}if((e.metaKey||isWindows()&&e.ctrlKey)&&e.shiftKey&&!e.altKey&&e.keyCode===8&&!e.repeat){e.preventDefault(),e.stopPropagation();const t=getConversationIdFromUrl();handleDeleteConversation(t);return}if((e.metaKey||isWindows()&&e.ctrlKey)&&!e.shiftKey&&e.altKey&&e.keyCode===221&&!e.repeat){e.preventDefault(),e.stopPropagation();const t=document.querySelector("#sidebar-folder-button");t&&t.click()}if((e.metaKey||isWindows()&&e.ctrlKey)&&!e.shiftKey&&e.altKey&&e.keyCode===219&&!e.repeat){e.preventDefault(),e.stopPropagation();const t=document.querySelector("#sidebar-note-button");t&&t.click()}if((e.metaKey||isWindows()&&e.ctrlKey)&&e.shiftKey&&e.altKey&&e.keyCode===77&&!e.repeat){e.preventDefault(),e.stopPropagation();const t=getConversationIdFromUrl();t&&openMoveConvToFolderModal([t]);return}if((e.metaKey||isWindows()&&e.ctrlKey)&&e.shiftKey&&e.altKey&&e.keyCode===69&&!e.repeat){e.preventDefault(),e.stopPropagation();const t=getConversationIdFromUrl();t&&openExportModal([t],"current");return}if((e.metaKey||isWindows()&&e.ctrlKey)&&e.shiftKey&&e.altKey&&e.keyCode===82&&!e.repeat){e.preventDefault(),e.stopPropagation(),openRandomConversation();return}if((e.metaKey||isWindows()&&e.ctrlKey)&&!e.shiftKey&&!e.altKey&&e.keyCode===80&&!e.repeat){e.preventDefault(),e.stopPropagation();const t=getConversationIdFromUrl();t&&saveConversationAsPDF(t);return}if((e.metaKey||isWindows()&&e.ctrlKey)&&e.shiftKey&&e.altKey&&e.keyCode===70&&!e.repeat){e.preventDefault(),e.stopPropagation();const t=getConversationIdFromUrl();if(t){const o=(await getConversationsByIds([t]))[0],r=await chrome.runtime.sendMessage({type:"toggleConversationFavorite",forceRefresh:!0,detail:{conversation:o}});r.is_favorite?toast("Conversation marked as favorite"):toast("Conversation removed from favorites"),getLastSelectedConversationFolder()?.id==="favorites"?r.is_favorite?addConversationToSidebarFolder({...o,is_favorite:r.is_favorite},"favorites"):document.querySelectorAll(`#conversation-card-${t}`).forEach(n=>{n.remove()}):replaceConversationInSidebarFolder({...o,is_favorite:r.is_favorite})}return}if((e.metaKey||isWindows()&&e.ctrlKey)&&e.shiftKey&&e.altKey&&e.keyCode===67&&!e.repeat){e.preventDefault(),e.stopPropagation();const t=getConversationIdFromUrl();if(t){const o=Array.from(document.querySelectorAll("div[data-message-id]")).pop();if(!o)return;const{messageId:r}=o.dataset;r&&handleCopyHtml(r,t)}return}if((e.metaKey||isWindows()&&e.ctrlKey)&&e.shiftKey&&e.altKey&&e.keyCode===68&&!e.repeat){e.preventDefault(),e.stopPropagation();const t=getConversationIdFromUrl();if(t){const o=Array.from(document.querySelectorAll("main article"));if(o.length===0)return;const r=o?.pop();if(!r)return;saveConversationAsPDF(t,r)}return}if(e.keyCode===27&&!e.repeat){stopAllAudios();const t=document.querySelectorAll("[id*=cancel-button]"),o=document.querySelectorAll("[id*=close-button]"),r=document.querySelector("#quick-access-menu-wrapper"),n=document.querySelector("#sidebar-bulk-action-reset-button");if(t.length>0&&isVisible(t[t.length-1]))t[t.length-1].click();else if(o.length>0&&isVisible(o[o.length-1]))o[o.length-1].click();else if(r)r.remove(),document.querySelector("#prompt-textarea").focus();else if(n)n.click();else{const i=document.querySelector('[data-testid*="stop-button"]');i&&(e.preventDefault(),i.click())}return}if(e.keyCode===36&&!e.repeat){const t=document.querySelector("#prompt-textarea");if(document.activeElement.tagName==="TEXTAREA"||document.activeElement.tagName==="INPUT"||t.contains(document.activeElement))return;if(e.preventDefault(),e.shiftKey){scrollUpOneArticle();return}document.querySelector("#scroll-up-button").click();return}if(e.keyCode===35&&!e.repeat){const t=document.querySelector("#prompt-textarea");if(document.activeElement.tagName==="TEXTAREA"||document.activeElement.tagName==="INPUT"||t.contains(document.activeElement))return;if(e.preventDefault(),e.shiftKey){scrollDownOneArticle();return}document.querySelector("#scroll-down-button").click();return}addPromptInputKeyDownEventListeners(e)},{capture:!0}),document.addEventListener("keyup",e=>{if(e.key==="ArrowLeft"){if(document.activeElement.tagName!=="TEXTAREA"&&document.activeElement.tagName!=="INPUT"){if(document.querySelector("#conversation-preview-wrapper")){const t=document.querySelector("#preview-conversation-previous-button");t&&t.click()}if(document.querySelector("#image-gallery-image-wrapper")){const t=document.querySelectorAll('[id^="gallery-image-card-"]');if(!t)return;const o=allImageNodes.findIndex(n=>n.image_id===selectedGalleryImage?.image_id);if(o===0)return;const r=t[o-1];r?.click(),r?.scrollIntoView({behavior:"smooth",block:"center"})}}return}if(e.key==="ArrowRight"&&document.activeElement.tagName!=="TEXTAREA"&&document.activeElement.tagName!=="INPUT"){if(document.querySelector("#conversation-preview-wrapper")){const t=document.querySelector("#preview-conversation-next-button");t&&t.click()}if(document.querySelector("#image-gallery-image-wrapper")){const t=document.querySelectorAll('[id^="gallery-image-card-"]');if(!t)return;const o=allImageNodes.findIndex(n=>n.image_id===selectedGalleryImage?.image_id);if(o===allImageNodes.length-1)return;const r=t[o+1];r?.click(),r?.scrollIntoView({behavior:"smooth",block:"center"})}}addPromptInputKeyUpEventListeners(e)},{capture:!0})}function overrideOriginalButtons(){document.body.addEventListener("click",e=>{const t=document.querySelector('div[role=menuitem] div svg > use[href*="25e330"]')?.closest("div[role=menuitem]");t&&t.contains(e.target)&&(e.preventDefault(),e.stopPropagation(),closeMenus(),closeRadix(e),document.querySelector("#modal-keyboard-shortcuts")||createKeyboardShortcutsModal());const o=document.querySelector('div[role=menuitem] div svg > use[href*="306b75"]')?.closest("div[role=menuitem]");document.querySelector('div[role=menuitem] div svg > use[href*="06188d"]')?.closest("div[role=menuitem]")&&o&&o.contains(e.target)&&(e.preventDefault(),e.stopPropagation(),closeMenus(),closeRadix(e),createManager("custom-instruction-profiles"))},{capture:!0})}function initializeKeyboardShortcuts(){registerShortkeys()}const sidebarNoteInputWrapperWidth=30;let sidebarNoteIsOpen=!1,noteListPageNumber=1,noteListSearchTerm="",lastSelectedNoteCardId=null;const chatNotePlaceholderText=`Add chat notes here...
- Each conversation has its own note
- Notes are synced across devices
- To see all notes and search them, click on "See All Notes" button`,globalNotePlaceholderText=`Add global notes here...
- Global notes are not tied to any conversation
- Notes are synced across devices
- To see all notes and search them, click on "See All Notes" button`;async function loadNote(){const e=window.localStorage.getItem("sp/sidebar-note-state")||"global",t=document.querySelector("#sidebar-note-button");t?.querySelector("#ping")&&t?.querySelector("#ping")?.remove();const o=document.querySelector("#sidebar-note-input");if(o||addSidebarNoteInput(),!o)return;const r=getConversationIdFromUrl();if(e==="chat"&&!r){o.value="",o.disabled=!0,addStartChatOverlayToNote();return}hideStartChatOverlayFromNote();let n=!0;sidebarNoteIsOpen&&setTimeout(()=>{n&&(o.value="",o.disabled=!0,addNoteLoadingOverlay())},500);const{openai_id:i}=await chrome.storage.sync.get(["openai_id"]);chrome.runtime.sendMessage({type:"getNote",detail:{conversationId:e==="chat"?r:i}},a=>{if(o.disabled=!1,n=!1,removeNoteLoadingOverlay(),a){const s=getConversationIdFromUrl();o||addSidebarNoteInput(),r===s&&(o.value=a.text||""),e==="chat"&&toggleNoteIndicator(r,a.text)}})}function hideStartChatOverlayFromNote(){const e=document.querySelector("#start-chat-overlay");e&&e.remove()}function addStartChatOverlayToNote(){const e=document.querySelector("#sidebar-note-input-wrapper");if(!e||e.querySelector("#start-chat-overlay"))return;const t=document.createElement("div");t.id="start-chat-overlay",t.classList="w-full absolute top-0 bg-black/50 dark:bg-black/80 rounded-bs-md flex justify-center items-center",t.style="top: 56px; height: calc(100% - 56px);",e.appendChild(t);const o=document.createElement("div");o.classList="flex flex-wrap p-3 items-center rounded-md bg-token-main-surface-primary text-token-text-primary text-sm",o.innerHTML="Start the chat to enable notes",t.appendChild(o)}function addNoteLoadingOverlay(){const e=document.querySelector("#sidebar-note-input-wrapper"),t=document.createElement("div");t.id="note-loading-wrapper",t.classList="w-full absolute top-0 bg-black/50 dark:bg-black/80 rounded-bs-md flex justify-center items-center",t.style="top: 56px; height: calc(100% - 56px);",t.innerHTML='<svg x="0" y="0" viewbox="0 0 40 40" class="spinner icon icon-xl"><circle fill="transparent" stroke="#ffffff50" stroke-width="2" stroke-linecap="round" stroke-dasharray="125.6" cx="20" cy="20" r="18"></circle></svg>',e.appendChild(t)}function removeNoteLoadingOverlay(){const e=document.querySelector("#note-loading-wrapper");e&&e.remove()}function toggleSidebarNote(){closeSidebarFolder();const e=document.querySelector("#sidebar-note-input-wrapper");if(!e){addSidebarNoteInput(),setTimeout(()=>{toggleSidebarNote()},1e3);return}const t=document.querySelector('div[class*="@container/main"]'),o=document.querySelector('header[id="page-header"]');if(!t||!o)return;const r=document.querySelector("#floating-button-wrapper"),n=document.querySelector("main");n&&(sidebarNoteIsOpen?(sidebarNoteIsOpen=!1,e.style.width="0",n.style.width="100%",o.style.width="100%",r&&(r.style.right="3rem")):(sidebarNoteIsOpen=!0,e.style.width="30%",n.style.width="70%",o.style.width="70%",r&&(r.style.right=`calc(1rem + ${t.offsetWidth*(30/100)}px)`)))}function closeSidebarNote(){const e=document.querySelector("#sidebar-note-input-wrapper");e&&(e.style.width="0"),sidebarNoteIsOpen=!1}function addSidebarNoteButton(){const e=document.querySelector("#sidebar-note-button");e&&e.remove();const{showSidebarNoteButton:t}=cachedSettings,o=document.createElement("button");o.id="sidebar-note-button",o.innerHTML=translate("Notes"),o.classList=`absolute flex items-center justify-center border border-token-border-medium text-token-text-tertiary hover:border-token-border-medium hover:text-token-text-primary text-xs font-sans cursor-pointer rounded-t-md z-10 bg-token-main-surface-primary hover:bg-token-main-surface-secondary opacity-85 hover:opacity-100 ${t?"":"hidden"}`,o.style="top: 12rem;right: -1rem;width: 4rem;height: 2rem;flex-wrap:wrap;transform: rotate(-90deg);",addTooltip(o,{value:()=>sidebarNoteIsOpen?"Close Notes":"Open Notes",position:"left"}),o.addEventListener("click",()=>{toggleSidebarNote(),o.querySelector("#ping")&&o.querySelector("#ping").remove()}),document.body.appendChild(o)}function resetNoteManagerParams(){noteListPageNumber=1,noteListSearchTerm="",lastSelectedNoteCardId=null}function noteListModalContent(){resetNoteManagerParams();const e=document.createElement("div");e.id="modal-content-note-list",e.style="display: flex; flex-direction: column; justify-content: start; align-items: start;overflow-y: hidden;height:100%;";const t=document.createElement("div");t.style="display: flex; flex-direction: row; justify-content: space-between; align-items: flex-start; width: 100%; z-index: 100; position: sticky; top: 0;",t.classList="bg-token-main-surface-primary p-2 border-b border-token-border-medium";const o=document.createElement("input");o.type="search",o.classList="text-token-text-primary bg-token-main-surface-secondary border border-token-border-medium text-sm rounded-md w-full h-full",o.placeholder=translate("Search notes"),o.id="note-manager-search-input",o.autocomplete="off";const r=debounce(c=>{const{value:u}=c.target;noteListSearchTerm=u,noteListPageNumber=1,fetchNotes(noteListPageNumber)});o.addEventListener("input",c=>{c.target.value.trim()!==""?r(c):(noteListSearchTerm="",noteListPageNumber=1,fetchNotes(noteListPageNumber));const u=document.querySelector("#note-manager-search-term-pill"),m=document.querySelector("#note-manager-search-term-pill-text");c.target.value.trim()!==""?(m.innerText=c.target.value.trim(),u.classList.remove("hidden")):(m.innerText="",u.classList.add("hidden"))}),t.appendChild(o);const{selectedNotesSortBy:n,selectedNotesView:i}=cachedSettings,a=document.createElement("div");a.style="position:relative;width:150px;z-index:1000;margin-left:8px;",a.innerHTML=dropdown("Notes-SortBy",notesSortByList,n,"code","right"),t.appendChild(a);const s=document.createElement("button");s.classList="h-full aspect-1 flex items-center justify-center rounded-lg px-2 ms-2 text-token-text-tertiary focus-visible:outline-0 bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary focus-visible:bg-token-main-surface-secondary",s.innerHTML=i==="list"?'<svg fill="currentColor" class="icon icon-md" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M320 192h96c17.6 0 32-14.4 32-32V64c0-17.6-14.4-32-32-32h-96c-17.6 0-32 14.4-32 32v96C288 177.6 302.4 192 320 192zM336 80h64v64h-64V80zM480 256h-160c-17.67 0-32 14.33-32 32v160c0 17.67 14.33 32 32 32h160c17.67 0 32-14.33 32-32V288C512 270.3 497.7 256 480 256zM464 432h-128v-128h128V432zM206.4 335.1L152 394.9V56.02C152 42.76 141.3 32 128 32S104 42.76 104 56.02v338.9l-54.37-58.95c-4.719-5.125-11.16-7.719-17.62-7.719c-5.812 0-11.66 2.094-16.28 6.375c-9.75 8.977-10.34 24.18-1.344 33.94l95.1 104.1c9.062 9.82 26.19 9.82 35.25 0l95.1-104.1c9-9.758 8.406-24.96-1.344-33.94C230.5 325.5 215.3 326.2 206.4 335.1z"/></svg>':'<svg fill="currentColor" class="icon icon-md" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M480 256h-160c-17.67 0-32 14.33-32 32v160c0 17.67 14.33 32 32 32h160c17.67 0 32-14.33 32-32V288C512 270.3 497.7 256 480 256zM464 432h-128v-128h128V432zM320 192h96c17.6 0 32-14.4 32-32V64c0-17.6-14.4-32-32-32h-96c-17.6 0-32 14.4-32 32v96C288 177.6 302.4 192 320 192zM336 80h64v64h-64V80zM145.6 39.37c-9.062-9.82-26.19-9.82-35.25 0L14.38 143.4c-9 9.758-8.406 24.96 1.344 33.94C20.35 181.7 26.19 183.8 32 183.8c6.469 0 12.91-2.594 17.62-7.719L104 117.1v338.9C104 469.2 114.8 480 128 480s24-10.76 24-24.02V117.1l54.37 58.95C215.3 185.8 230.5 186.5 240.3 177.4C250 168.4 250.6 153.2 241.6 143.4L145.6 39.37z"/></svg>',s.addEventListener("click",()=>{document.querySelectorAll("[id^=note-item-]").forEach(c=>{cachedSettings.selectedNotesView==="list"?(c.classList.remove("aspect-2"),c.classList.add("aspect-1")):(c.classList.remove("aspect-1"),c.classList.add("aspect-2"))}),cachedSettings.selectedNotesView==="list"?s.innerHTML='<svg fill="currentColor" class="icon icon-md" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M480 256h-160c-17.67 0-32 14.33-32 32v160c0 17.67 14.33 32 32 32h160c17.67 0 32-14.33 32-32V288C512 270.3 497.7 256 480 256zM464 432h-128v-128h128V432zM320 192h96c17.6 0 32-14.4 32-32V64c0-17.6-14.4-32-32-32h-96c-17.6 0-32 14.4-32 32v96C288 177.6 302.4 192 320 192zM336 80h64v64h-64V80zM145.6 39.37c-9.062-9.82-26.19-9.82-35.25 0L14.38 143.4c-9 9.758-8.406 24.96 1.344 33.94C20.35 181.7 26.19 183.8 32 183.8c6.469 0 12.91-2.594 17.62-7.719L104 117.1v338.9C104 469.2 114.8 480 128 480s24-10.76 24-24.02V117.1l54.37 58.95C215.3 185.8 230.5 186.5 240.3 177.4C250 168.4 250.6 153.2 241.6 143.4L145.6 39.37z"/></svg>':s.innerHTML='<svg fill="currentColor" class="icon icon-md" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M320 192h96c17.6 0 32-14.4 32-32V64c0-17.6-14.4-32-32-32h-96c-17.6 0-32 14.4-32 32v96C288 177.6 302.4 192 320 192zM336 80h64v64h-64V80zM480 256h-160c-17.67 0-32 14.33-32 32v160c0 17.67 14.33 32 32 32h160c17.67 0 32-14.33 32-32V288C512 270.3 497.7 256 480 256zM464 432h-128v-128h128V432zM206.4 335.1L152 394.9V56.02C152 42.76 141.3 32 128 32S104 42.76 104 56.02v338.9l-54.37-58.95c-4.719-5.125-11.16-7.719-17.62-7.719c-5.812 0-11.66 2.094-16.28 6.375c-9.75 8.977-10.34 24.18-1.344 33.94l95.1 104.1c9.062 9.82 26.19 9.82 35.25 0l95.1-104.1c9-9.758 8.406-24.96-1.344-33.94C230.5 325.5 215.3 326.2 206.4 335.1z"/></svg>',chrome.storage.local.set({settings:{...cachedSettings,selectedNotesView:cachedSettings.selectedNotesView==="list"?"grid":"list"}})}),t.appendChild(s),e.appendChild(t);const l=document.createElement("div");l.id="note-manager-search-term-pill",l.classList="hidden flex items-center justify-center bg-token-main-surface-secondary text-token-text-primary rounded-full p-1 px-2 me-2 mt-2 ms-4 border border-token-border-medium max-w-fit",l.innerHTML='<button id="note-manager-search-term-pill-clear-button" class="focus-visible:outline-0 hover:bg-token-main-surface-tertiary focus-visible:bg-token-main-surface-tertiary rounded-full mx-1"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="20" width="20" xmlns="http://www.w3.org/2000/svg"> <line x1="18" y1="6" x2="6" y2="18"></line> <line x1="6" y1="6" x2="18" y2="18"></line> </svg></button><span id="note-manager-search-term-pill-text" class="text-sm mx-1 text-danger"></span>',l.querySelector("#note-manager-search-term-pill-clear-button").addEventListener("click",()=>{const c=document.querySelector("#note-manager-search-input");c.value="",c.dispatchEvent(new Event("input"))}),e.appendChild(l);const d=noteListComponent();return e.appendChild(d),e}function fetchNotes(e=1){const{selectedNotesSortBy:t}=cachedSettings;noteListPageNumber=e,chrome.runtime.sendMessage({type:"getNotes",detail:{page:noteListPageNumber,sortBy:t.code,searchTerm:noteListSearchTerm}},o=>{renderNoteCards(o),e===1&&document.querySelector("#note-list")?.scrollTo(0,0)})}function noteListComponent(){const e=document.createElement("div");e.id="note-list",e.classList="w-full grid grid-cols-1 gap-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 overflow-y-auto p-4 pb-32 h-full content-start";const t=document.createElement("div");return t.style="position:absolute;display: flex; justify-content: center; align-items: center; height: 340px; width: 100%;",t.innerHTML='<svg x="0" y="0" viewbox="0 0 40 40" class="spinner icon icon-xl"><circle fill="transparent" stroke="#ffffff50" stroke-width="2" stroke-linecap="round" stroke-dasharray="125.6" cx="20" cy="20" r="18"></circle></svg>',e.appendChild(t),e}async function renderNoteCards(e){const t=document.querySelector("#note-list");if(!t)return;const o=t.querySelector("#load-more-notes-button");if(o&&o.remove(),noteListPageNumber===1&&(t.innerHTML=""),e.results.length===0){const n=document.createElement("div");n.style="position:absolute;display: flex; justify-content: center; align-items: center; height: 340px; width: 100%;",n.textContent=translate("No notes found"),t.appendChild(n);return}const{openai_id:r}=await chrome.storage.sync.get(["openai_id"]);if(e.results.forEach(n=>{const i=document.createElement("div");i.id=`note-item-${n.id}`,i.dataset.conversationId=n.conversation_id,i.classList=`group flex flex-col w-full ${cachedSettings.selectedNotesView==="list"?"aspect-2":"aspect-1"} p-3 pb-2 h-auto cursor-pointer border bg-token-main-surface-primary border-token-border-medium rounded-md overflow-hidden`,i.style="height:max-content;outline-offset: 4px; outline: none;",i.addEventListener("click",m=>{m.stopPropagation(),closeMenus(),updateSelectedNoteCard(n.id),openNotePreviewModal(n)});const a=document.createElement("div");a.classList="flex justify-between items-center border-b border-token-border-medium pb-1";const s=document.createElement("div");if(s.id=`note-name-${n.id}`,s.classList="text-token-text-primary text-md whitespace-nowrap overflow-hidden text-ellipsis",s.textContent=n.name,s.title=n.name,a.appendChild(s),n.conversation_id===r){const m=document.createElement("div");m.classList="ml-2 text-token-accent-text-primary",m.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" class="icon icon-md" width="20" height="20" fill="#19c37d"><path d="M415.9 344L225 344C227.9 408.5 242.2 467.9 262.5 511.4C273.9 535.9 286.2 553.2 297.6 563.8C308.8 574.3 316.5 576 320.5 576C324.5 576 332.2 574.3 343.4 563.8C354.8 553.2 367.1 535.8 378.5 511.4C398.8 467.9 413.1 408.5 416 344zM224.9 296L415.8 296C413 231.5 398.7 172.1 378.4 128.6C367 104.2 354.7 86.8 343.3 76.2C332.1 65.7 324.4 64 320.4 64C316.4 64 308.7 65.7 297.5 76.2C286.1 86.8 273.8 104.2 262.4 128.6C242.1 172.1 227.8 231.5 224.9 296zM176.9 296C180.4 210.4 202.5 130.9 234.8 78.7C142.7 111.3 74.9 195.2 65.5 296L176.9 296zM65.5 344C74.9 444.8 142.7 528.7 234.8 561.3C202.5 509.1 180.4 429.6 176.9 344L65.5 344zM463.9 344C460.4 429.6 438.3 509.1 406 561.3C498.1 528.6 565.9 444.8 575.3 344L463.9 344zM575.3 296C565.9 195.2 498.1 111.3 406 78.7C438.3 130.9 460.4 210.4 463.9 296L575.3 296z"/></svg>',addTooltip(m,{value:"Global",position:"top"}),a.appendChild(m)}const l=document.createElement("div");l.id=`note-item-body-${n.conversation_id}`,l.classList="flex flex-1 text-token-text-tertiary text-sm py-1 whitespace-wrap overflow-hidden text-ellipsis break-all border-b border-token-border-medium ",l.textContent=n.text,l.title=n.text;const d=document.createElement("div");d.classList="flex justify-between items-center pt-2";const c=document.createElement("div");c.id=`note-date-${n.id}`,c.classList="text-token-text-tertiary text-xs",cachedSettings.selectedNotesSortBy.code==="created_at"?(c.textContent=new Date(n.created_at).toLocaleString(),c.title=`Created: ${new Date(n.created_at).toLocaleString()}`):(c.textContent=new Date(n.updated_at).toLocaleString(),c.title=`Last updated: ${new Date(n.updated_at).toLocaleString()}`),d.appendChild(c);const u=document.createElement("button");u.id=`note-settings-button-${n.id}`,u.classList="relative flex items-center justify-center h-8 rounded-lg px-2 text-token-text-tertiary focus-visible:outline-0 hover:bg-token-sidebar-surface-tertiary focus-visible:bg-token-sidebar-surface-secondary",u.innerHTML='<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 12C3 10.8954 3.89543 10 5 10C6.10457 10 7 10.8954 7 12C7 13.1046 6.10457 14 5 14C3.89543 14 3 13.1046 3 12ZM10 12C10 10.8954 10.8954 10 12 10C13.1046 10 14 10.8954 14 12C14 13.1046 13.1046 14 12 14C10.8954 14 10 13.1046 10 12ZM17 12C17 10.8954 17.8954 10 19 10C20.1046 10 21 10.8954 21 12C21 13.1046 20.1046 14 19 14C17.8954 14 17 13.1046 17 12Z" fill="currentColor"></path></svg>',u.addEventListener("click",async m=>{m.stopPropagation(),closeMenus(),showNoteSettingsMenu(u,n,!0)}),d.appendChild(u),i.appendChild(a),i.appendChild(l),i.appendChild(d),t.appendChild(i)}),!await chrome.runtime.sendMessage({type:"checkHasSubscription"})){t.appendChild(managerUpgradeButton("notes","to see all Notes"));return}if(e.next){const n=document.createElement("button");n.id="load-more-notes-button",n.classList="w-full h-full flex justify-center items-center",n.innerHTML='<svg x="0" y="0" viewbox="0 0 40 40" class="spinner icon icon-xl"><circle fill="transparent" stroke="#ffffff50" stroke-width="2" stroke-linecap="round" stroke-dasharray="125.6" cx="20" cy="20" r="18"></circle></svg>',n.addEventListener("click",()=>{fetchNotes(noteListPageNumber+1)}),t.appendChild(n);const i=new IntersectionObserver(a=>{a.forEach(s=>{s.isIntersecting&&n?.click()})},{threshold:.5});n&&i.observe(n)}}function updateSelectedNoteCard(e){if(lastSelectedNoteCardId){const o=document.querySelector(`#modal-manager #note-item-${lastSelectedNoteCardId}`);o&&(o.style.outline="none")}if(!e)return;const t=document.querySelector(`#modal-manager #note-item-${e}`);lastSelectedNoteCardId=e,t.style.outline=`2px solid ${isDarkMode()?"#fff":"#000"}`}function openNotePreviewModal(e){const t=notePreviewModalContent(e),o=notePreviewModalActions(e);createModal(e.name,"",t,o,!1,"small"),document.querySelector(`#modal-close-button-${e.name.toLowerCase().replaceAll(" ","-")}`)?.addEventListener("click",()=>{setTimeout(()=>{document.querySelector(`#note-item-body-${e.conversation_id}`)?.textContent===""&&document.querySelector(`#modal-manager #note-item-${e.id}`)?.remove()},200)})}function notePreviewModalContent(e){const t=document.createElement("div");t.id="modal-content-note-preview",t.classList="w-full h-full flex justify-center items-center overflow-hidden";const o=document.createElement("div");o.classList="w-full rounded-md flex justify-center items-center relative",o.style="height: 100%;",o.innerHTML='<svg x="0" y="0" viewbox="0 0 40 40" class="spinner icon icon-xl"><circle fill="transparent" stroke="#ffffff50" stroke-width="2" stroke-linecap="round" stroke-dasharray="125.6" cx="20" cy="20" r="18"></circle></svg>';const r=document.createElement("textarea");return r.id="note-preview-text",r.classList="w-full h-full bg-token-main-surface-primary border border-token-border-medium text-token-text-primary p-3 rounded-md placeholder:text-gray-500 text-lg resize-none",r.placeholder=`Add notes here...
- Each conversation has its own note
- Notes are synced across devices`,chrome.runtime.sendMessage({type:"getNote",detail:{conversationId:e.conversation_id}},n=>{o.innerHTML="",r.value=n.text||"";const i=n.conversation_id||e.conversation_id,a=n.name||e.name;r.addEventListener("blur",()=>{chrome.runtime.sendMessage({type:"updateNote",detail:{conversationId:i,name:a,text:r.value}},async l=>{if(l.error&&l.error.type==="limit"){errorUpgradeConfirmation(l.error);return}const d=document.querySelector(`#note-item-body-${i}`);d&&(d.textContent=r.value);const c=document.querySelector(`#note-date-${n.id}`);c&&c?.title?.includes("updated")&&(c.textContent=new Date().toLocaleString(),c.title=`Last updated: ${new Date().toLocaleString()}`),toggleNoteIndicator(i,r.value);const{openai_id:u}=await chrome.storage.sync.get(["openai_id"]),m=window.localStorage.getItem("sp/sidebar-note-state")||"global",g=getConversationIdFromUrl();if(m==="chat"&&g&&g===i){const p=document.querySelector("#sidebar-note-input");p&&(p.value=r.value)}else if(m==="global"&&u===i){const p=document.querySelector("#sidebar-note-input");p&&(p.value=r.value)}})});const s=document.querySelector('#modal-manager input[id$="-manager-search-input"]')?.value;if(s){const l=createHighlightOverlay(r,s);o.appendChild(l)}o.appendChild(r)}),t.appendChild(o),t}function notePreviewModalActions(e){const t=document.createElement("div");t.classList="flex w-full justify-end items-center pt-2";const o=document.createElement("button");return o.classList="btn composer-submit-btn composer-submit-button-color",o.textContent=`${translate("Open Conversation in New Tab")} \u279C`,o.addEventListener("click",()=>{window.open(`https://chatgpt.com/c/${e.conversation_id}`,"_blank")}),t.appendChild(o),t}function addSidebarNoteInput(){const e=document.createElement("div");e.id="sidebar-note-input-wrapper",e.classList="absolute end-0 w-0 top-0 overflow-hidden transition transition-width z-10 flex flex-col h-full";const t=document.createElement("div");t.classList="w-full bg-token-main-surface-secondary border border-token-border-medium p-3 h-14 rounded-ts-md flex justify-between items-center relative";const o=document.createElement("div");o.innerHTML=`${translate("Notes")} <a href="https://www.youtube.com/watch?v=JjBuaNtvTv4" target="_blank" rel="noreferrer" title="Learn more"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md ps-0.5 text-token-text-tertiary h-5 w-5"><path fill="currentColor" d="M13 12a1 1 0 1 0-2 0v4a1 1 0 1 0 2 0zM12 9.5A1.25 1.25 0 1 0 12 7a1.25 1.25 0 0 0 0 2.5"></path><path fill="currentColor" fill-rule="evenodd" d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2M4 12a8 8 0 1 1 16 0 8 8 0 0 1-16 0" clip-rule="evenodd"></path></svg></a>`,o.classList="text-token-text-primary h-14 flex items-center justify-start gap-2",t.appendChild(o);const r=window.localStorage.getItem("sp/sidebar-note-state")||"global",n=document.createElement("div");n.classList="sp-toggle-container bg-token-main-surface-secondary";const i=document.createElement("div");i.classList="sp-toggle-slider",i.style=r==="chat"?"transform: translateX(0%);":"transform: translateX(100%);",n.appendChild(i);const a=document.createElement("div");a.classList=`sp-toggle-option ${r==="chat"?"active":""}`,a.dataset.value="chat",a.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-sm" viewBox="0 0 512 512" fill="currentColor"><path d="M360 144h-208C138.8 144 128 154.8 128 168S138.8 192 152 192h208C373.3 192 384 181.3 384 168S373.3 144 360 144zM264 240h-112C138.8 240 128 250.8 128 264S138.8 288 152 288h112C277.3 288 288 277.3 288 264S277.3 240 264 240zM447.1 0h-384c-35.25 0-64 28.75-64 63.1v287.1c0 35.25 28.75 63.1 64 63.1h96v83.1c0 9.836 11.02 15.55 19.12 9.7l124.9-93.7h144c35.25 0 64-28.75 64-63.1V63.1C511.1 28.75 483.2 0 447.1 0zM464 352c0 8.75-7.25 16-16 16h-160l-80 60v-60H64c-8.75 0-16-7.25-16-16V64c0-8.75 7.25-16 16-16h384c8.75 0 16 7.25 16 16V352z"/></svg>',addTooltip(a,{value:translate("Chat Notes"),position:"bottom"});const s=document.createElement("div");s.classList=`sp-toggle-option ${r==="global"?"active":""}`,s.dataset.value="global",s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" class="icon icon-sm" width="20" height="20" fill="currentColor"><path d="M415.9 344L225 344C227.9 408.5 242.2 467.9 262.5 511.4C273.9 535.9 286.2 553.2 297.6 563.8C308.8 574.3 316.5 576 320.5 576C324.5 576 332.2 574.3 343.4 563.8C354.8 553.2 367.1 535.8 378.5 511.4C398.8 467.9 413.1 408.5 416 344zM224.9 296L415.8 296C413 231.5 398.7 172.1 378.4 128.6C367 104.2 354.7 86.8 343.3 76.2C332.1 65.7 324.4 64 320.4 64C316.4 64 308.7 65.7 297.5 76.2C286.1 86.8 273.8 104.2 262.4 128.6C242.1 172.1 227.8 231.5 224.9 296zM176.9 296C180.4 210.4 202.5 130.9 234.8 78.7C142.7 111.3 74.9 195.2 65.5 296L176.9 296zM65.5 344C74.9 444.8 142.7 528.7 234.8 561.3C202.5 509.1 180.4 429.6 176.9 344L65.5 344zM463.9 344C460.4 429.6 438.3 509.1 406 561.3C498.1 528.6 565.9 444.8 575.3 344L463.9 344zM575.3 296C565.9 195.2 498.1 111.3 406 78.7C438.3 130.9 460.4 210.4 463.9 296L575.3 296z"/></svg>',addTooltip(s,{value:translate("Global Notes"),position:"bottom"}),n.appendChild(a),n.appendChild(s),t.appendChild(n),n.addEventListener("click",async p=>{const h=p.target?.closest("div");if(h.classList.contains("sp-toggle-option"))if(n.querySelectorAll(".sp-toggle-option").forEach(f=>{f.classList.remove("active")}),h.classList.add("active"),i.style.transform=`translateX(${h.dataset.value==="chat"?"0%":"100%"})`,window.localStorage.setItem("sp/sidebar-note-state",h.dataset.value),h.dataset.value==="chat"){e.querySelector("#sidebar-note-input").placeholder=chatNotePlaceholderText;const f=getConversationIdFromUrl();f?chrome.runtime.sendMessage({type:"getNote",detail:{conversationId:f}},v=>{e.querySelector("#sidebar-note-input").value=v.text||""}):(e.querySelector("#sidebar-note-input").value="",addStartChatOverlayToNote())}else{hideStartChatOverlayFromNote(),e.querySelector("#sidebar-note-input").placeholder=globalNotePlaceholderText;const{openai_id:f}=await chrome.storage.sync.get(["openai_id"]);chrome.runtime.sendMessage({type:"getNote",detail:{conversationId:f}},v=>{e.querySelector("#sidebar-note-input").value=v.text||""})}});const l=document.createElement("button");l.textContent=translate("See All Notes"),l.classList="btn composer-submit-btn composer-submit-button-color",l.addEventListener("click",()=>{createManager("notes")}),t.appendChild(l),e.appendChild(t);const d=document.createElement("textarea");d.id="sidebar-note-input",d.placeholder=r==="chat"?chatNotePlaceholderText:globalNotePlaceholderText,d.classList="w-full bg-token-main-surface-secondary border border-token-border-medium text-token-text-primary p-3 rounded-bs-md flex-grow placeholder:text-gray-500",d.style="border-top:none;",e.appendChild(d),d.addEventListener("blur",async()=>{const p=getConversationIdFromUrl(),h=window.localStorage.getItem("sp/sidebar-note-state")||"global",{openai_id:f}=await chrome.storage.sync.get(["openai_id"]);if(h==="chat"&&p||h==="global"&&f){const v=getConversationName(p),x=document.querySelector("#sidebar-note-input").value;chrome.runtime.sendMessage({type:"updateNote",detail:{conversationId:h==="chat"?p:f,name:h==="chat"?v:"Global Note",text:x}},y=>{if(y.error&&y.error.type==="limit"){errorUpgradeConfirmation(y.error);return}h==="chat"&&toggleNoteIndicator(p,x)})}});const c=document.querySelector('div[class*="@container/main"]'),u=document.querySelector('header[id="page-header"]');if(!c||!u||c.querySelector("#sidebar-note-input-wrapper"))return;c.appendChild(e);const m=document.querySelector("#floating-button-wrapper"),g=document.querySelector("main");g&&(sidebarNoteIsOpen?(e.style.width="30%",g.style.width="70%",u.style.width="70%",m&&(m.style.right=`calc(1rem + ${c.offsetWidth*(30/100)}px)`)):sidebarFolderIsOpen()||(e.style.width="0",g.style.width="100%",u.style.width="100%",m&&(m.style.right="3rem")))}function toggleNoteIndicator(e,t){const o=document.querySelectorAll(`#conversation-note-indicator-${e}`);if(o.length!==0)for(let r=0;r<o.length;r+=1){const n=o[r];t?.length>0?n.classList.remove("hidden"):n.classList.add("hidden")}}function hideNotesButton(){const e=document.querySelector("#sidebar-note-button");e&&e.classList.add("hidden"),sidebarNoteIsOpen&&toggleSidebarNote()}function createSidebarNotesButton(e=window.location){const t=e.pathname.includes("/gpts"),o=e.pathname.includes("/admin"),{showSidebarNoteButton:r}=cachedSettings,n=document.querySelector("#sidebar-note-button");if(n?r&&n.classList.remove("hidden"):addSidebarNoteButton(),document.querySelector("#sidebar-note-input-wrapper")||addSidebarNoteInput(),t||o){document.querySelector("#sidebar-note-button").classList.add("hidden");const i=document.querySelector("#floating-button-wrapper");i&&(i.style.right="3rem")}else loadNote()}async function showNoteSettingsMenu(e,t,o=!1){const r=t.id,n=await chrome.runtime.sendMessage({type:"checkHasSubscription"}),{right:i,top:a}=e.getBoundingClientRect(),s=o?i-224:i-6,l=a+20,d=`<div id="note-settings-menu" dir="ltr" style="transform:translate3d(${s}px,${l}px,0);position:fixed;left:0;top:0;min-width:max-content;z-index:10001;--radix-popper-anchor-width:18px;--radix-popper-anchor-height:18px;--radix-popper-available-width:1167px;--radix-popper-available-height:604px;--radix-popper-transform-origin:0% 0px"><div data-side="bottom" data-align="start" role="menu" aria-orientation="vertical" data-state="open" data-radix-menu-content="" dir="ltr" aria-labelledby="radix-:r6g:" class="max-w-xs rounded-2xl text-token-text-primary bg-token-main-surface-secondary shadow-long p-1" tabindex="-1" data-orientation="vertical" style="min-width:200px; outline:0;--radix-dropdown-menu-content-transform-origin:var(--radix-popper-transform-origin);--radix-dropdown-menu-content-available-width:var(--radix-popper-available-width);--radix-dropdown-menu-content-available-height:var(--radix-popper-available-height);--radix-dropdown-menu-trigger-width:var(--radix-popper-anchor-width);--radix-dropdown-menu-trigger-height:var(--radix-popper-anchor-height);pointer-events:auto">
  
  <div role="menuitem" id="rename-note-settings-button-${r}" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><div class="flex gap-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" fill="none" class="icon icon-md"><path fill="currentColor" d="M184 160C193.5 160 202.1 165.6 205.9 174.3L269.9 318.3C275.3 330.4 269.9 344.5 257.7 349.9C245.6 355.3 231.5 349.9 226.1 337.7L221.7 328H146.3L141.9 337.7C136.5 349.9 122.4 355.3 110.3 349.9C98.14 344.5 92.69 330.4 98.07 318.3L162.1 174.3C165.9 165.6 174.5 160 184 160H184zM167.6 280H200.4L184 243.1L167.6 280zM304 184C304 170.7 314.7 160 328 160H380C413.1 160 440 186.9 440 220C440 229.2 437.9 237.9 434.2 245.7C447.5 256.7 456 273.4 456 292C456 325.1 429.1 352 396 352H328C314.7 352 304 341.3 304 328V184zM352 208V232H380C386.6 232 392 226.6 392 220C392 213.4 386.6 208 380 208H352zM352 304H396C402.6 304 408 298.6 408 292C408 285.4 402.6 280 396 280H352V304zM0 128C0 92.65 28.65 64 64 64H576C611.3 64 640 92.65 640 128V384C640 419.3 611.3 448 576 448H64C28.65 448 0 419.3 0 384V128zM48 128V384C48 392.8 55.16 400 64 400H576C584.8 400 592 392.8 592 384V128C592 119.2 584.8 112 576 112H64C55.16 112 48 119.2 48 128z"/></svg>${translate("Rename")}</div></div>

  <div role="menuitem" id="edit-note-settings-button-${r}" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><div class="flex gap-2"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.2929 4.29291C15.0641 2.52167 17.9359 2.52167 19.7071 4.2929C21.4783 6.06414 21.4783 8.93588 19.7071 10.7071L18.7073 11.7069L11.1603 19.2539C10.7182 19.696 10.1489 19.989 9.53219 20.0918L4.1644 20.9864C3.84584 21.0395 3.52125 20.9355 3.29289 20.7071C3.06453 20.4788 2.96051 20.1542 3.0136 19.8356L3.90824 14.4678C4.01103 13.8511 4.30396 13.2818 4.7461 12.8397L13.2929 4.29291ZM13 7.41422L6.16031 14.2539C6.01293 14.4013 5.91529 14.591 5.88102 14.7966L5.21655 18.7835L9.20339 18.119C9.40898 18.0847 9.59872 17.9871 9.7461 17.8397L16.5858 11L13 7.41422ZM18 9.5858L14.4142 6.00001L14.7071 5.70712C15.6973 4.71693 17.3027 4.71693 18.2929 5.70712C19.2831 6.69731 19.2831 8.30272 18.2929 9.29291L18 9.5858Z" fill="currentColor"></path></svg>${translate("Edit")}</div></div>

  <div role="menuitem" id="download-note-settings-button-${r}" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><div class="flex gap-2"><svg stroke="currentColor" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md"><path fill-rule="evenodd" clip-rule="evenodd" d="M7.70711 10.2929C7.31658 9.90237 6.68342 9.90237 6.29289 10.2929C5.90237 10.6834 5.90237 11.3166 6.29289 11.7071L11.2929 16.7071C11.6834 17.0976 12.3166 17.0976 12.7071 16.7071L17.7071 11.7071C18.0976 11.3166 18.0976 10.6834 17.7071 10.2929C17.3166 9.90237 16.6834 9.90237 16.2929 10.2929L13 13.5858L13 4C13 3.44771 12.5523 3 12 3C11.4477 3 11 3.44771 11 4L11 13.5858L7.70711 10.2929ZM5 19C4.44772 19 4 19.4477 4 20C4 20.5523 4.44772 21 5 21H19C19.5523 21 20 20.5523 20 20C20 19.4477 19.5523 19 19 19L5 19Z" fill="currentColor"></path></svg>${translate("Download")}</div></div>

  <div role="menuitem" id="attach-note-settings-button-${r}" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><div class="flex gap-2"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md"><path fill-rule="evenodd" clip-rule="evenodd" d="M18.0322 5.02393C17.7488 5.00078 17.3766 5 16.8 5H11.5002C11.3 6 11.0989 6.91141 10.8903 7.85409C10.7588 8.44955 10.6432 8.97304 10.3675 9.41399C10.1262 9.80009 9.80009 10.1262 9.41399 10.3675C8.97304 10.6432 8.44955 10.7588 7.85409 10.8903C7.81276 10.8994 7.77108 10.9086 7.72906 10.9179L5.21693 11.4762C5.1442 11.4924 5.07155 11.5001 5 11.5002V16.8C5 17.3766 5.00078 17.7488 5.02393 18.0322C5.04612 18.3038 5.0838 18.4045 5.109 18.454C5.20487 18.6422 5.35785 18.7951 5.54601 18.891C5.59546 18.9162 5.69617 18.9539 5.96784 18.9761C6.25118 18.9992 6.62345 19 7.2 19H10C10.5523 19 11 19.4477 11 20C11 20.5523 10.5523 21 10 21H7.16144C6.6343 21 6.17954 21 5.80497 20.9694C5.40963 20.9371 5.01641 20.8658 4.63803 20.673C4.07354 20.3854 3.6146 19.9265 3.32698 19.362C3.13419 18.9836 3.06287 18.5904 3.03057 18.195C2.99997 17.8205 2.99998 17.3657 3 16.8385L3 11C3 8.92477 4.02755 6.93324 5.4804 5.4804C6.93324 4.02755 8.92477 3 11 3L16.8385 3C17.3657 2.99998 17.8205 2.99997 18.195 3.03057C18.5904 3.06287 18.9836 3.13419 19.362 3.32698C19.9265 3.6146 20.3854 4.07354 20.673 4.63803C20.8658 5.01641 20.9371 5.40963 20.9694 5.80497C21 6.17954 21 6.6343 21 7.16144V10C21 10.5523 20.5523 11 20 11C19.4477 11 19 10.5523 19 10V7.2C19 6.62345 18.9992 6.25118 18.9761 5.96784C18.9539 5.69617 18.9162 5.59546 18.891 5.54601C18.7951 5.35785 18.6422 5.20487 18.454 5.109C18.4045 5.0838 18.3038 5.04612 18.0322 5.02393ZM5.28014 9.41336L7.2952 8.96556C8.08861 8.78925 8.24308 8.74089 8.35381 8.67166C8.48251 8.59121 8.59121 8.48251 8.67166 8.35381C8.74089 8.24308 8.78925 8.08861 8.96556 7.2952L9.41336 5.28014C8.51014 5.59289 7.63524 6.15398 6.89461 6.89461C6.15398 7.63524 5.59289 8.51014 5.28014 9.41336ZM17 15C17 14.4477 17.4477 14 18 14C18.5523 14 19 14.4477 19 15V17H21C21.5523 17 22 17.4477 22 18C22 18.5523 21.5523 19 21 19H19V21C19 21.5523 18.5523 22 18 22C17.4477 22 17 21.5523 17 21V19H15C14.4477 19 14 18.5523 14 18C14 17.4477 14.4477 17 15 17H17V15Z" fill="currentColor"></path></svg>${translate("Reference this note")} ${n?"":'<span class="text-white rounded-md bg-green-500 px-2 text-sm ms-auto">Pro</span>'}</div></div>
  
  <div role="menuitem" id="delete-note-settings-button-${r}" class="flex gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group text-red-500" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5555 4C10.099 4 9.70052 4.30906 9.58693 4.75114L9.29382 5.8919H14.715L14.4219 4.75114C14.3083 4.30906 13.9098 4 13.4533 4H10.5555ZM16.7799 5.8919L16.3589 4.25342C16.0182 2.92719 14.8226 2 13.4533 2H10.5555C9.18616 2 7.99062 2.92719 7.64985 4.25342L7.22886 5.8919H4C3.44772 5.8919 3 6.33961 3 6.8919C3 7.44418 3.44772 7.8919 4 7.8919H4.10069L5.31544 19.3172C5.47763 20.8427 6.76455 22 8.29863 22H15.7014C17.2354 22 18.5224 20.8427 18.6846 19.3172L19.8993 7.8919H20C20.5523 7.8919 21 7.44418 21 6.8919C21 6.33961 20.5523 5.8919 20 5.8919H16.7799ZM17.888 7.8919H6.11196L7.30423 19.1057C7.3583 19.6142 7.78727 20 8.29863 20H15.7014C16.2127 20 16.6417 19.6142 16.6958 19.1057L17.888 7.8919ZM10 10C10.5523 10 11 10.4477 11 11V16C11 16.5523 10.5523 17 10 17C9.44772 17 9 16.5523 9 16V11C9 10.4477 9.44772 10 10 10ZM14 10C14.5523 10 15 10.4477 15 11V16C15 16.5523 14.5523 17 14 17C13.4477 17 13 16.5523 13 16V11C13 10.4477 13.4477 10 14 10Z" fill="currentColor"></path></svg>${translate("Delete")}</div>


  </div></div>`;document.body.insertAdjacentHTML("beforeend",d),adjustMenuPosition(document.querySelector("#note-settings-menu")),addNoteSettingsMenuEventListeners(t)}function addNoteSettingsMenuEventListeners(e){const t=e.id,o=document.getElementById(`rename-note-settings-button-${t}`),r=document.getElementById(`edit-note-settings-button-${t}`),n=document.getElementById(`download-note-settings-button-${t}`),i=document.getElementById(`attach-note-settings-button-${t}`),a=document.getElementById(`delete-note-settings-button-${t}`);o?.addEventListener("click",async s=>{s.stopPropagation(),closeMenus();const{openai_id:l}=await chrome.storage.sync.get(["openai_id"]);if(e.conversation_id===l){toast("Renaming the global note is not allowed.","error");return}handleRenameNoteClick(e)}),r?.addEventListener("click",s=>{s.stopPropagation(),closeMenus(),updateSelectedNoteCard(e.id),openNotePreviewModal(e)}),n?.addEventListener("click",s=>{s.stopPropagation(),closeMenus(),chrome.runtime.sendMessage({type:"getNote",detail:{conversationId:e.conversation_id}},l=>{const d=new Blob([`${l.name}

${l.text||""}`],{type:"text/plain"}),c=URL.createObjectURL(d),u=document.createElement("a");u.href=c,u.download=`${l.name}.txt`,u.click(),URL.revokeObjectURL(c)})}),i?.addEventListener("click",s=>{s.stopPropagation(),closeMenus(),chrome.runtime.sendMessage({type:"checkHasSubscription"},l=>{if(!l){errorUpgradeConfirmation({title:"This is a Pro feature",message:"Referencing note in conversations requires a Pro subscription. Upgrade to Pro to remove all limits."});return}chrome.runtime.sendMessage({type:"getNote",detail:{conversationId:e.conversation_id}},d=>{uploadTextToInput(d.text||"",`${d.name}.txt`)})})}),a?.addEventListener("click",async s=>{s.stopPropagation(),closeMenus();const{openai_id:l}=await chrome.storage.sync.get(["openai_id"]);if(e.conversation_id===l){toast("Deleting the global note is not allowed.","error");return}showConfirmDialog("Delete note","Are you sure you want to delete this note?","Cancel","Delete",null,()=>handleDeleteNote(e))})}function handleRenameNoteClick(e){let t=!1;closeMenus();const o=document.createElement("input"),r=document.querySelector(`#modal-manager #note-name-${e.id}`),n=r.innerText;o.id=`note-rename-${e.id}`,o.classList="border-0 bg-transparent p-0 focus:ring-0 focus-visible:ring-0 w-full",o.value=n,r?.parentElement?.replaceChild(o,r),o.focus(),setTimeout(()=>{o.select()},50),o?.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),closeMenus(),o.focus()}),o?.addEventListener("blur",()=>{if(t)return;const i=o.value;i!==n&&updateNoteNameElement(r,e.id,i),o.parentElement?.replaceChild(r,o)}),o?.addEventListener("keydown",i=>{if(i.key==="Enter"&&i.which===13){t=!0;const a=o.value;a!==n&&updateNoteNameElement(r,e.id,a),o.parentElement?.replaceChild(r,o)}i.key==="Escape"&&(t=!0,r.innerText=n,o.parentElement?.replaceChild(r,o))})}function updateNoteNameElement(e,t,o){o.trim()&&(e.innerText=o,chrome.runtime.sendMessage({type:"renameNote",detail:{noteId:t,newName:o}}))}function handleDeleteNote(e){document.getElementById(`note-item-${e.id}`)?.remove();const t=document.getElementById("note-list");if(!t?.children?.length){const r=document.createElement("div");r.style="position:absolute;display: flex; justify-content: center; align-items: center; height: 340px; width: 100%;",r.textContent=translate("No notes found"),t.appendChild(r)}toggleNoteIndicator(e.conversation_id,"");const o=getConversationIdFromUrl();if(o&&o===e.conversation_id){const r=document.querySelector("#sidebar-note-input");r&&(r.value="")}chrome.runtime.sendMessage({type:"deleteNote",detail:{noteId:e.id}})}const sidebarFolderDrawerWidth=280;let sidebarSelectedConversationIds=[],folderForNewChat;function sidebarFolderIsOpen(){return window.localStorage.getItem("sp/sidebarFolderIsOpen")==="true"}async function loadSidebarFolders(e=!1){const{selectedConversationsManagerFoldersSortBy:t="alphabetical"}=cachedSettings,o=document.querySelector("#sidebar-folder-content");if(!o)return;document.querySelector("#sidebar-folder-drawer #loading-spinner-sidebar-folder-content")||(o.innerHTML="",o.appendChild(loadingSpinner("sidebar-folder-content")));const r=document.querySelector("#sidebar-folder-search-input")?.value;chrome.runtime.sendMessage({type:"getConversationFolders",forceRefresh:e,detail:{sortBy:t,searchTerm:r}},async n=>{if(!n||!Array.isArray(n))return;const i=document.querySelector("#loading-spinner-sidebar-folder-content");if(i&&i.remove(),document.querySelector("#sidebar-folder-drawer")||await addSidebarFolderDrawer(),o.innerHTML="",r||o.appendChild(defaultConversationFoldersList(!0)),n.length===0&&!r){const a=getLastSelectedConversationFolder();(!a||a?.id==="root")&&o.appendChild(noConversationFolderElemet())}if(n.forEach(a=>{o.appendChild(conversationFolderElement(a,!0))}),selectedConversationFolderBreadcrumb.length>0){const a=getLastSelectedConversationFolder();throttleGetConvSubFolders(a.id),throttleFetchSidebarConversations()}})}const throttleFetchSidebarConversations=throttle(async(e=1,t=!1,o=!1)=>{await fetchSidebarConversations(e,t,o)},1e3);async function fetchSidebarConversations(e=1,t=!1,o=!1){const r=document.querySelector("#sidebar-folder-search-input")?.value,n=getLastSelectedConversationFolder(),i=document.querySelector("#new-conversation-in-folder-button-wrapper");if(!n&&!r)return;const a=document.querySelector("#sidebar-folder-content");if(!a)return;e===1&&(document.querySelectorAll("#sidebar-folder-drawer #load-more-conversations-button")?.forEach(m=>m.remove()),a.querySelector('button[id^="full-search-button"]')?.remove(),a.querySelector('p[id^="no-conversations-found"]')?.remove(),a.querySelector('p[id^="no-conversation-folder"]')?.remove(),a.querySelectorAll('div[id^="conversation-card-"]')?.forEach(m=>m.remove()),a.appendChild(loadingSpinner("sidebar-folder-content"))),r&&i?.classList.replace("flex","hidden");let s=[],l=!1;const d=[],c=[];if(r===""&&n?.id==="archived"){const m=(e-1)*100,g=100,p=n?.id==="archived";try{const h=await getConversations(m,g,"updated",p,o);s=syncHistoryResponseToConversationDB(h,p),l=h.total>m+g}catch{const h=document.querySelector("#sidebar-folder-drawer #load-more-conversations-button");if(h){h.innerHTML='<div class="w-full h-full flex items-center justify-center">Load more...</div>',h.onclick=()=>{fetchSidebarConversations(e+1,t,o)};return}}}else{document.querySelectorAll("#sidebar-folder-drawer #load-more-conversations-button")?.forEach(f=>f.remove());const{selectedConversationsManagerSortBy:m,excludeConvInFolders:g}=cachedSettings,p=m?.code,h=await chrome.runtime.sendMessage({type:"getConversations",forceRefresh:o,detail:{pageNumber:e,searchTerm:r,sortBy:r||["all","archived"].includes(n?.id)?"updated_at":p,fullSearch:t,folderId:r||typeof n?.id=="string"?null:n?.id,isArchived:n?.id==="archived"?!0:null,isFavorite:n?.id==="favorites"?!0:null,excludeConvInFolders:n?.id==="all"&&g}});s=h.results,l=h.next}const u=document.querySelector("#sidebar-folder-drawer #loading-spinner-sidebar-folder-content");if(u&&u.remove(),s?.length===0&&e===1)if(r&&!t){const m=createFullSearchButton(!0);a.appendChild(m),m.click()}else a.appendChild(noConversationElement());else if(s?.forEach(m=>{const g=d.includes(m.conversation_id)||m.is_favorite,p=c.includes(m.conversation_id)||m.has_note,h={...m,is_favorite:g,has_note:p},f=createConversationElement(h);a.appendChild(f),addConversationElementEventListeners(f,h)}),matchConversationNames(),l){const m=document.createElement("button");m.id="load-more-conversations-button",m.classList="flex items-center justify-between text-token-text-primary text-sm relative rounded-lg px-2 py-1 cursor-pointer w-full h-10",m.appendChild(loadingSpinner("load-more-conversations-button")),a.appendChild(m),m.onclick=()=>{fetchSidebarConversations(e+1,t,o)};const g=new IntersectionObserver(p=>{p.forEach(h=>{h.isIntersecting&&fetchSidebarConversations(e+1,t,o)})},{threshold:.5});m&&g.observe(m)}else if(r&&!t){const m=createFullSearchButton(!0);a.appendChild(m)}}function createConversationElement(e){const t=e.conversation_id||e.id,o=getLastSelectedConversationFolder(),r=getConversationIdFromUrl(),n=isDefaultConvFolder(o?.id),i=document.querySelector("#sidebar-folder-search-input")?.value,a=document.createElement("div");return a.id=`conversation-card-${t}`,a.dataset.conversationId=t,a.style="min-height: 42px;",a.draggable=!0,a.classList=`flex items-center justify-between text-token-text-primary text-sm relative rounded-lg ${r===t?"bg-token-sidebar-surface-tertiary":""} hover:bg-token-sidebar-surface-tertiary px-2 py-1 cursor-pointer group`,a.innerHTML=`
    ${n||i?`<div id="conversation-card-folder-color-indicator-${t}" data-folder-id="${e?.folder?.id}" title="${e?.folder?.name||""}" class="absolute w-1 h-full top-0 start-0 rounded-s-xl" style="background-color: ${e?.folder?.name?`${e?.folder?.color}`:"transparent"};"></div>`:""}

    <div class="flex flex-wrap grow overflow-hidden w-full">
      <div id="conversation-title" title="${e.title}" class="relative grow overflow-hidden whitespace-nowrap flex items-center ">
        <input id="sidebar-conversation-checkbox-${t}" data-conversation-id="${t}" type="checkbox" class="manager-modal border border-token-border-medium me-2" style="margin-left:1px; cursor: pointer; border-radius: 2px; display: ${sidebarSelectedConversationIds.length>0?"block":"none"};">
        
        <span class="w-full truncate relative">${e.title||"New chat"}</span>
      </div>

      <div class="w-full flex flex-wrap text-token-text-tertiary items-center" style="font-size: 0.7rem">
      

      ${cachedSettings?.showConversationTimestampInSidebar?`<span class="me-1">${formatDate(new Date(formatTime(e.update_time||e.create_time)))}</span>`:""}
      
      ${cachedSettings?.showConversationIndicatorsInSidebar?`
      
      ${conversationIndicators(e)}
      

      <span title="Favorite conversation" class="me-1">
        <svg id="conversation-favorite-indicator-${t}" class="icon icon-xs ${e.is_favorite?"":"hidden"}" fill="gold" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M381.2 150.3L524.9 171.5C536.8 173.2 546.8 181.6 550.6 193.1C554.4 204.7 551.3 217.3 542.7 225.9L438.5 328.1L463.1 474.7C465.1 486.7 460.2 498.9 450.2 506C440.3 513.1 427.2 514 416.5 508.3L288.1 439.8L159.8 508.3C149 514 135.9 513.1 126 506C116.1 498.9 111.1 486.7 113.2 474.7L137.8 328.1L33.58 225.9C24.97 217.3 21.91 204.7 25.69 193.1C29.46 181.6 39.43 173.2 51.42 171.5L195 150.3L259.4 17.97C264.7 6.954 275.9-.0391 288.1-.0391C300.4-.0391 311.6 6.954 316.9 17.97L381.2 150.3z"></path></svg>
      </span>
      `:""}
      </div>
    </div>

    <div id="conversation-card-settings-button-${t}" class="absolute end-1 items-center justify-center h-8 rounded-lg px-2 text-token-text-tertiary focus-visible:outline-0 hover:bg-token-sidebar-surface-secondary focus-visible:bg-token-sidebar-surface-secondary hidden group-hover:flex">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md flex items-center justify-center h-full"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 12C3 10.8954 3.89543 10 5 10C6.10457 10 7 10.8954 7 12C7 13.1046 6.10457 14 5 14C3.89543 14 3 13.1046 3 12ZM10 12C10 10.8954 10.8954 10 12 10C13.1046 10 14 10.8954 14 12C14 13.1046 13.1046 14 12 14C10.8954 14 10 13.1046 10 12ZM17 12C17 10.8954 17.8954 10 19 10C20.1046 10 21 10.8954 21 12C21 13.1046 20.1046 14 19 14C17.8954 14 17 13.1046 17 12Z" fill="currentColor"></path></svg>
    </div>
  `,a.addEventListener("click",s=>{if(s.stopPropagation(),closeMenus(),s.metaKey||isWindows()&&s.ctrlKey)window.open(`/c/${t}`,"_blank");else{const l=document.querySelector(`nav a[href$="/c/${t}"]`),d=document.querySelector("#sidebar-folder-search-input")?.value;l&&!d?(l.click(),setTimeout(()=>document.title=l.innerText,500),updateSelectedConvCard(t,!0)):d?(updateSelectedConvCard(t,!0),showConversationPreviewWrapper(t,null,!0)):window.location.href.includes(`/c/${t}`)||(window.history.pushState({},"",`/c/${t}`),window.dispatchEvent(new PopStateEvent("popstate",{state:{}})))}}),a.addEventListener("mouseenter",()=>{closeMenus(),document.querySelectorAll('#sidebar-folder-content div[id^="conversation-card-settings-button-"]').forEach(d=>{d.classList.replace("flex","hidden")});const s=document.querySelector(`#sidebar-conversation-checkbox-${t}`);s&&(s.style.display="block");const l=document.querySelector(`#conversation-card-${t} #conversation-title`);l&&(l.style.paddingRight="36px")}),a.addEventListener("mouseleave",()=>{const s=document.querySelector(`#sidebar-conversation-checkbox-${t}`);s&&sidebarSelectedConversationIds.length===0&&(s.style.display="none");const l=document.querySelector(`#conversation-card-${t} #conversation-title`);l&&(l.style.paddingRight="0px")}),a.querySelector(`#sidebar-conversation-checkbox-${t}`)?.addEventListener("click",s=>{if(s.stopPropagation(),closeMenus(),s.target.checked)if(s.shiftKey&&sidebarSelectedConversationIds.length>0){const c=sidebarSelectedConversationIds[sidebarSelectedConversationIds.length-1];sidebarSelectedConversationIds.push(t);const u=document.querySelectorAll('input[id^="sidebar-conversation-checkbox-"]');let m=!1;u.forEach(g=>{(g.dataset.conversationId===c||g.dataset.conversationId===t)&&(m=!m),m&&!sidebarSelectedConversationIds.includes(g.dataset.conversationId)&&(g.checked=!0,sidebarSelectedConversationIds.push(g.dataset.conversationId))})}else sidebarSelectedConversationIds.push(t);else sidebarSelectedConversationIds=sidebarSelectedConversationIds.filter(c=>c!==t);const l=document.querySelector("#sidebar-bulk-action-selected-count");l&&(l.textContent=`${sidebarSelectedConversationIds.length} chat${sidebarSelectedConversationIds.length!==1?"s":""} selected`);const d=document.querySelectorAll('input[id^="sidebar-conversation-checkbox-"]');sidebarSelectedConversationIds.length>0?(d.forEach(c=>{c.style.display="block"}),showSidebarBulkActions()):(d.forEach(c=>{c.style.display="none"}),hideSidebarBulkActions())}),a.addEventListener("dragstart",s=>{s.stopPropagation(),s.dataTransfer.setData("text/plain",JSON.stringify({draggingObject:"conversation",conversation:e})),s.dataTransfer.effectAllowed="move",a.classList.add("card-dragging")}),a.addEventListener("dragend",s=>{s.stopPropagation(),s.dataTransfer.clearData();try{a.classList.remove("card-dragging")}catch(l){console.error("Error removing card-dragging class:",l)}}),a}function showSidebarBulkActions(){if(document.querySelector("#sidebar-bulk-action-wrapper"))return;const{showFoldersInLeftSidebar:e}=cachedSettings,t=document.querySelector("nav");t.style.position="unset";const o=document.querySelector("#sidebar-folder-drawer"),r=e?t:o;if(!r)return;const n=document.createElement("div");n.id="sidebar-bulk-action-wrapper",n.classList="w-full m-2 p-1 absolute bottom-0 start-0 bg-token-main-surface-tertiary z-50 rounded-lg",n.style=`width: calc(100% - 16px);backdrop-filter: blur(3px);background: ${isDarkMode()?"#3e3e3ee0":"#ececece0"}`,n.innerHTML=`
  
  <div class="w-full p-2 flex items-center justify-between text-token-text-primary text-sm font-medium">
    <span id="sidebar-bulk-action-selected-count">1 chat selected</span>

    <div id="sidebar-bulk-action-reset-button" class="btn btn-secondary btn-small cursor-pointer">
          Cancel
    </div>
  </div>

  <div class="grid" style="grid-template-columns: repeat(5, minmax(0, 1fr));">

    <div id="sidebar-bulk-action-move-button" class="relative flex items-center justify-center px-2 text-token-red focus-visible:outline-0 hover:bg-token-main-surface-secondary focus-visible:bg-token-sidebar-surface-secondary h-12 rounded-lg cursor-pointer">
          <svg xmlns="http://www.w3.org/2000/svg" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round" class="icon icon-md" stroke-width="2" viewBox="0 0 512 512"><path d="M448 96h-172.1L226.7 50.75C214.7 38.74 198.5 32 181.5 32H64C28.66 32 0 60.66 0 96v320c0 35.34 28.66 64 64 64h384c35.34 0 64-28.66 64-64V160C512 124.7 483.3 96 448 96zM464 416c0 8.824-7.18 16-16 16H64c-8.82 0-16-7.176-16-16V96c0-8.824 7.18-16 16-16h117.5c4.273 0 8.289 1.664 11.31 4.688L256 144h192c8.82 0 16 7.176 16 16V416zM336 264h-56V207.1C279.1 194.7 269.3 184 256 184S232 194.7 232 207.1V264H175.1C162.7 264 152 274.7 152 288c0 13.26 10.73 23.1 23.1 23.1h56v56C232 381.3 242.7 392 256 392c13.26 0 23.1-10.74 23.1-23.1V311.1h56C349.3 311.1 360 301.3 360 288S349.3 264 336 264z"/></svg>
    </div>

    <div id="sidebar-bulk-action-add-to-project-button" class="relative flex items-center justify-center px-2 text-token-red focus-visible:outline-0 hover:bg-token-main-surface-secondary focus-visible:bg-token-sidebar-surface-secondary h-12 rounded-lg cursor-pointer">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" stroke="currentColor" fill="currentColor" class="icon icon-md"><path d="M448 96h-172.1L226.7 50.75C214.7 38.74 198.5 32 181.5 32H64C28.65 32 0 60.66 0 96v320c0 35.34 28.65 64 64 64h384c35.35 0 64-28.66 64-64V160C512 124.7 483.3 96 448 96zM64 80h117.5c4.273 0 8.293 1.664 11.31 4.688L256 144h192c8.822 0 16 7.176 16 16v32h-416V96C48 87.18 55.18 80 64 80zM448 432H64c-8.822 0-16-7.176-16-16V240h416V416C464 424.8 456.8 432 448 432z"/></svg>
    </div>

    <div id="sidebar-bulk-action-export-button" class="relative flex items-center justify-center px-2 text-token-red focus-visible:outline-0 hover:bg-token-main-surface-secondary focus-visible:bg-token-sidebar-surface-secondary h-12 rounded-lg cursor-pointer">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" stroke="currentColor" fill="currentColor" stroke-width="2" stroke-linejoin="round" class="icon icon-md"><path d="M568.1 303l-80-80c-9.375-9.375-24.56-9.375-33.94 0s-9.375 24.56 0 33.94L494.1 296H216C202.8 296 192 306.8 192 320s10.75 24 24 24h278.1l-39.03 39.03C450.3 387.7 448 393.8 448 400s2.344 12.28 7.031 16.97c9.375 9.375 24.56 9.375 33.94 0l80-80C578.3 327.6 578.3 312.4 568.1 303zM360 384c-13.25 0-24 10.74-24 24V448c0 8.836-7.164 16-16 16H64.02c-8.836 0-16-7.164-16-16L48 64.13c0-8.836 7.164-16 16-16h160L224 128c0 17.67 14.33 32 32 32h79.1v72c0 13.25 10.74 24 23.1 24S384 245.3 384 232V138.6c0-16.98-6.742-33.26-18.75-45.26l-74.63-74.64C278.6 6.742 262.3 0 245.4 0H63.1C28.65 0-.002 28.66 0 64l.0065 384c.002 35.34 28.65 64 64 64H320c35.2 0 64-28.8 64-64v-40C384 394.7 373.3 384 360 384z"/></svg>
    </div>

    <div id="sidebar-bulk-action-archive-button" class="relative flex items-center justify-center px-2 text-token-red focus-visible:outline-0 hover:bg-token-main-surface-secondary focus-visible:bg-token-sidebar-surface-secondary h-12 rounded-lg cursor-pointer">
          <svg viewBox="0 0 18 18" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="icon icon-md"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.62188 3.07918C3.87597 2.571 4.39537 2.25 4.96353 2.25H13.0365C13.6046 2.25 14.124 2.571 14.3781 3.07918L15.75 5.82295V13.5C15.75 14.7426 14.7426 15.75 13.5 15.75H4.5C3.25736 15.75 2.25 14.7426 2.25 13.5V5.82295L3.62188 3.07918ZM13.0365 3.75H4.96353L4.21353 5.25H13.7865L13.0365 3.75ZM14.25 6.75H3.75V13.5C3.75 13.9142 4.08579 14.25 4.5 14.25H13.5C13.9142 14.25 14.25 13.9142 14.25 13.5V6.75ZM6.75 9C6.75 8.58579 7.08579 8.25 7.5 8.25H10.5C10.9142 8.25 11.25 8.58579 11.25 9C11.25 9.41421 10.9142 9.75 10.5 9.75H7.5C7.08579 9.75 6.75 9.41421 6.75 9Z" fill="currentColor"></path></svg>
    </div>

    <div id="sidebar-bulk-action-delete-button" class="relative flex items-center justify-center px-2 text-token-red focus-visible:outline-0 hover:bg-token-main-surface-secondary focus-visible:bg-token-sidebar-surface-secondary text-red-500 h-12 rounded-lg cursor-pointer">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5555 4C10.099 4 9.70052 4.30906 9.58693 4.75114L9.29382 5.8919H14.715L14.4219 4.75114C14.3083 4.30906 13.9098 4 13.4533 4H10.5555ZM16.7799 5.8919L16.3589 4.25342C16.0182 2.92719 14.8226 2 13.4533 2H10.5555C9.18616 2 7.99062 2.92719 7.64985 4.25342L7.22886 5.8919H4C3.44772 5.8919 3 6.33961 3 6.8919C3 7.44418 3.44772 7.8919 4 7.8919H4.10069L5.31544 19.3172C5.47763 20.8427 6.76455 22 8.29863 22H15.7014C17.2354 22 18.5224 20.8427 18.6846 19.3172L19.8993 7.8919H20C20.5523 7.8919 21 7.44418 21 6.8919C21 6.33961 20.5523 5.8919 20 5.8919H16.7799ZM17.888 7.8919H6.11196L7.30423 19.1057C7.3583 19.6142 7.78727 20 8.29863 20H15.7014C16.2127 20 16.6417 19.6142 16.6958 19.1057L17.888 7.8919ZM10 10C10.5523 10 11 10.4477 11 11V16C11 16.5523 10.5523 17 10 17C9.44772 17 9 16.5523 9 16V11C9 10.4477 9.44772 10 10 10ZM14 10C14.5523 10 15 10.4477 15 11V16C15 16.5523 14.5523 17 14 17C13.4477 17 13 16.5523 13 16V11C13 10.4477 13.4477 10 14 10Z" fill="currentColor"></path></svg>
    </div>
</div>`,r.appendChild(n);const i=document.querySelector("#sidebar-bulk-action-reset-button"),a=document.querySelector("#sidebar-bulk-action-move-button"),s=document.querySelector("#sidebar-bulk-action-add-to-project-button"),l=document.querySelector("#sidebar-bulk-action-export-button"),d=document.querySelector("#sidebar-bulk-action-archive-button"),c=document.querySelector("#sidebar-bulk-action-delete-button"),u=getLastSelectedConversationFolder()?.id==="archived";addTooltip(i,{value:"Cancel",position:"top"}),addTooltip(a,{value:"Move to folder",position:"top"},{left:20}),addTooltip(s,{value:"Add to project",position:"top"}),addTooltip(l,{value:"Export",position:"top"}),addTooltip(d,{value:u?"Unarchive":"Archive",position:"top"}),addTooltip(c,{value:"Delete",position:"top"}),i?.addEventListener("click",()=>{resetSidebarConversationSelection()}),a?.addEventListener("click",()=>{openMoveConvToFolderModal(sidebarSelectedConversationIds)}),s?.addEventListener("click",m=>{m.stopPropagation(),m.preventDefault(),showProjectsList(s,sidebarSelectedConversationIds,!0)}),l?.addEventListener("click",()=>{openExportModal(sidebarSelectedConversationIds,"selected")}),d?.addEventListener("click",()=>{getLastSelectedConversationFolder()?.id==="archived"?handleClickUnarchiveConversationsButton(sidebarSelectedConversationIds):handleClickArchiveConversationsButton(sidebarSelectedConversationIds)}),c?.addEventListener("click",()=>{handleDeleteSelectedConversations(sidebarSelectedConversationIds)})}function hideSidebarBulkActions(){const e=document.querySelector("#sidebar-bulk-action-wrapper");e&&e.remove()}function resetSidebarConversationSelection(){hideSidebarBulkActions(),sidebarSelectedConversationIds=[],document.querySelectorAll('input[id^="sidebar-conversation-checkbox-"]')?.forEach(e=>{e.checked=!1,e.style.display="none"})}function toggleFovoriteIndicator(e,t){const o=document.querySelectorAll(`#conversation-favorite-indicator-${e}`);if(o.length!==0)for(let r=0;r<o.length;r+=1){const n=o[r];t?n.classList.remove("hidden"):n.classList.add("hidden")}}function toggleProjectIndicators(e,t){const o=document.querySelectorAll(`#conversation-project-indicator-${e}`);if(o.length!==0)for(let r=0;r<o.length;r+=1){const n=o[r];t?.startsWith("g-p-")?(n.classList.remove("hidden"),n?.addEventListener("click",async i=>{if(i.stopPropagation(),closeMenus(),i.metaKey||isWindows()&&i.ctrlKey){window.open(`/g/${t}/project`,"_blank");return}window.history.pushState({},"",`/g/${t}/project`),window.dispatchEvent(new PopStateEvent("popstate",{state:{}}))})):n.classList.add("hidden")}}function addConversationElementEventListeners(e,t){addConversationCardEventListeners(e,t,!0)}async function toggleSidebarFolder(){closeSidebarNote();const e=document.querySelector('header[id="page-header"]'),t=document.querySelector("main");if(!e||!t)return;const o=document.querySelector("#floating-button-wrapper"),r=document.querySelector("#sidebar-folder-drawer");r||await addSidebarFolderDrawer(),sidebarFolderIsOpen()?(r&&(r.style.width="0"),window.localStorage.setItem("sp/sidebarFolderIsOpen","false"),t.style.width="100%",e.style.width="100%",o&&(o.style.right="3rem")):(window.localStorage.setItem("sp/sidebarFolderIsOpen","true"),r.style.width="280px",t.style.width="calc(100% - 280px)",e.style.width="calc(100% - 280px)",o&&(o.style.right="calc(1rem + 280px)"))}function closeSidebarFolder(){const{showFoldersInLeftSidebar:e}=cachedSettings;if(e)return;const t=document.querySelector("#sidebar-folder-drawer");t&&(t.style.width="0"),window.localStorage.setItem("sp/sidebarFolderIsOpen","false")}function addSidebarFolderButton(){const e=document.querySelector("#sidebar-folder-button");e&&e.remove();const{showSidebarFolderButton:t}=cachedSettings,o=document.createElement("button");o.id="sidebar-folder-button",o.innerHTML=translate("Folders"),o.classList=`absolute flex items-center justify-center border border-token-border-medium text-token-text-tertiary hover:border-token-border-medium hover:text-token-text-primary text-xs font-sans cursor-pointer rounded-t-md z-10 bg-token-main-surface-primary hover:bg-token-main-surface-secondary opacity-85 hover:opacity-100 ${t?"":"hidden"}`,o.style="top: 16rem;right: -1rem;width: 4rem;height: 2rem;flex-wrap:wrap;transform: rotate(-90deg);",addTooltip(o,{value:()=>sidebarFolderIsOpen()?"Close Folders":"Open Folders",position:"left"}),o.addEventListener("click",()=>{toggleSidebarFolder()}),document.body.appendChild(o)}function toggleNewConversationInFolderButton(e=!0){folderForNewChat=null,initiateNewChatFolderIndicator();const t=getLastSelectedConversationFolder(),o=document.querySelector("#new-conversation-in-folder-button-wrapper"),r=document.querySelector("#new-conversation-in-folder-button"),n=document.querySelector("#conversation-manager-start-new-chat-button");e?(o?.classList?.replace("flex","hidden"),r&&(r.innerText=translate("Start a New Chat")),n&&(n.innerText=translate("Start a New Chat"))):(o?.classList?.replace("hidden","flex"),r&&(r.innerText=t?.gizmo_id?translate("Start a new chat with this GPT"):translate("Start a new chat in this folder")),n&&(n.innerText=t?.gizmo_id?translate("Start a new chat with this GPT"):translate("Start a new chat in this folder")))}async function addSidebarFolderDrawer(){const{showFoldersInLeftSidebar:e}=cachedSettings;e&&closeSidebarFolder();const t=getLastSelectedConversationFolder(),o=isDefaultConvFolder(t?.id),r=!t||t?.id==="all",n=document.createElement("div");n.id="sidebar-folder-drawer",n.classList=`overflow-hidden transition transition-width flex flex-col h-full z-20 ${e?"w-full bg-transparent":"absolute end-0 top-0 w-0 bg-token-sidebar-surface-primary"}`;const i=document.createElement("div");i.classList=`w-full ${e?"pb-3":"p-3"} flex justify-between`;const a=document.createElement("button");a.id="move-to-left-sidebar",a.classList=`flex items-center justify-center h-full rounded-lg me-1 text-token-text-tertiary focus-visible:outline-0 hover:bg-token-sidebar-surface-secondary focus-visible:bg-token-sidebar-surface-secondary px-1 ${e?"hidden":""}`,a.innerHTML='<svg fill="currentColor" class="icon icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M105.4 233.8C99.13 240 96 248.2 96 256.4S99.13 272.8 105.4 279l150.4 135.9C286.7 442.8 336 420.9 336 379.3v-42.91h64c26.51 0 48-21.49 48-48v-64c0-26.51-21.49-48-48-48h-64V133.1c0-41.63-49.37-63.52-80.23-35.58L105.4 233.8zM288 224.4h112v64H288v89.37L150.6 256.4L288 135V224.4zM48 424V88C48 74.75 37.25 64 24 64S0 74.75 0 88v336C0 437.3 10.75 448 24 448S48 437.3 48 424z"/></svg>',addTooltip(a,{value:"Move to Left Sidebar",position:"left"}),a.addEventListener("click",()=>{chrome.storage.local.set({settings:{...cachedSettings,showFoldersInLeftSidebar:!0}}).then(()=>{toggleLeftSidebarSwitch(!0)})}),i.appendChild(a);const s=document.createElement("div");s.classList="flex-grow w-full",i.appendChild(s);const l=document.createElement("input");l.id="sidebar-folder-search-input",l.type="search",l.placeholder=translate("Search conversations"),l.classList="w-full p-2 rounded-md border border-token-border-medium bg-token-main-surface-secondary text-token-text-tertiary";const d=debounce(()=>{const y=document.querySelector("#sidebar-folder-content");y&&(y.innerHTML=""),loadSidebarFolders();const b=document.querySelector("#sidebar-folder-breadcrumb");b&&(selectedConversationFolderBreadcrumb=[],chrome.storage.local.set({selectedConversationFolderBreadcrumb}),generateConvFolderBreadcrumb(b,!0)),fetchSidebarConversations()});l.addEventListener("input",y=>{y.target.value.trim().length>2?d(y):y.target.value.length===0&&loadSidebarFolders()}),s.appendChild(l);const c=document.createElement("div");c.id="sidebar-folder-search-hint",c.classList=`flex w-full items-center text-token-text-tertiary text-xs mt-1 ${l.value.length===0?"hidden":""}`,c.innerHTML=l.value.length===0?"":`<svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="icon-sm me-2"><path d="M14.086 8.75a5.335 5.335 0 1 0-10.67 0 5.335 5.335 0 0 0 10.67 0m1.33 0a6.64 6.64 0 0 1-1.512 4.225l.066.055 3 3 .086.104a.666.666 0 0 1-.922.922l-.104-.085-3-3-.055-.068a6.665 6.665 0 1 1 2.44-5.153"/></svg> <span class="text-danger truncate">${l.value.trim()}</span>`,s.appendChild(c),l.addEventListener("input",y=>{y.target.value.trim().length>0?(c.classList.remove("hidden"),c.innerHTML=`<svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="icon-sm me-2"><path d="M14.086 8.75a5.335 5.335 0 1 0-10.67 0 5.335 5.335 0 0 0 10.67 0m1.33 0a6.64 6.64 0 0 1-1.512 4.225l.066.055 3 3 .086.104a.666.666 0 0 1-.922.922l-.104-.085-3-3-.055-.068a6.665 6.665 0 1 1 2.44-5.153"/></svg> <span class="text-danger truncate">${y.target.value.trim()}</span>`):(c.classList.add("hidden"),c.innerText="")});const u=document.createElement("button");u.id="sidebar-new-folder-button",u.classList="flex items-center justify-center h-full rounded-lg p-2 ms-1 text-token-text-tertiary focus-visible:outline-0 hover:bg-token-sidebar-surface-secondary focus-visible:bg-token-sidebar-surface-secondary",u.innerHTML='<svg stroke="currentColor" fill="currentColor" class="icon icon-lg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M464 96h-192l-64-64h-160C21.5 32 0 53.5 0 80v352C0 458.5 21.5 480 48 480h416c26.5 0 48-21.5 48-48v-288C512 117.5 490.5 96 464 96zM336 311.1h-56v56C279.1 381.3 269.3 392 256 392c-13.27 0-23.1-10.74-23.1-23.1V311.1H175.1C162.7 311.1 152 301.3 152 288c0-13.26 10.74-23.1 23.1-23.1h56V207.1C232 194.7 242.7 184 256 184s23.1 10.74 23.1 23.1V264h56C349.3 264 360 274.7 360 288S349.3 311.1 336 311.1z"/></svg>',addTooltip(u,{value:"Add New Folder",position:e?"top":"left"}),chrome.runtime.sendMessage({type:"checkHasSubscription"},y=>{u.addEventListener("click",()=>{const b=getLastSelectedConversationFolder();if(b&&isDefaultConvFolder(b.id)){toast("You cannot add a folder to this folder.","error");return}const w=document.querySelectorAll('#sidebar-folder-drawer #sidebar-folder-content > div[id^="conversation-folder-wrapper-"]');if(!y&&w.length>=5){errorUpgradeConfirmation({type:"limit",title:"You have reached the limit",message:"You have reached the limits of Conversation Folders with free account. Upgrade to Pro to remove all limits."});return}document.querySelectorAll("#no-conversation-folders").forEach(S=>S.remove());const k={name:"New Folder",color:generateRandomDarkColor()};b&&(k.profile=b.profile?.id,k.color=b.color,k.parent_folder=b.id,k.image_url=b.image||b.image_url,k.gizmo_id=b.gizmo_id),chrome.runtime.sendMessage({type:"addConversationFolders",detail:{folders:[k]}},S=>{if(S.error&&S.error.type==="limit"){errorUpgradeConfirmation(S.error);return}!S||S.length===0||(addNewConvFolderElementToSidebar(S[0]),handleRenameConversationFolderClick(S[0].id,!0))})})}),i.appendChild(u);const m=document.createElement("button");m.id="move-to-right-sidebar",m.classList=`flex items-center justify-center h-full rounded-lg text-token-text-tertiary focus-visible:outline-0 hover:bg-token-sidebar-surface-secondary focus-visible:bg-token-sidebar-surface-secondary py-3 px-1 ${e?"":"hidden"}`,m.innerHTML='<svg fill="currentColor" class="icon icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M448 424V88C448 74.75 437.3 64 424 64S400 74.75 400 88v336c0 13.25 10.75 24 24 24S448 437.3 448 424zM342.6 278.3C348.9 272 352 263.8 352 255.6S348.9 239.3 342.6 233L192.2 97.09C161.3 69.21 112 91.11 112 132.7v42.91h-64c-26.51 0-48 21.49-48 48v64c0 26.51 21.49 48 48 48h64v43.29c0 41.63 49.37 63.52 80.23 35.58L342.6 278.3zM160 287.6H48v-64H160V134.3l137.4 121.4L160 376.1V287.6z"/></svg>',addTooltip(m,{value:"Move to Right Sidebar",position:"top"}),m.addEventListener("click",()=>{chrome.storage.local.set({settings:{...cachedSettings,showFoldersInLeftSidebar:!1}}).then(()=>{toggleLeftSidebarSwitch(!1)})}),i.appendChild(m),n.appendChild(i);const g=document.createElement("div");g.classList=`flex items-center justify-start pb-3 ${e?"":"px-3"} w-full`;const p=document.createElement("div");p.id="sidebar-folder-breadcrumb",p.classList="flex flex-wrap items-center justify-start bg-token-main-surface-tertiary p-2 rounded-lg border border-token-border-medium w-full",p.addEventListener("click",async y=>{if(y.target&&y.target.matches("[data-folder-id]")){const b=y.target.getAttribute("data-folder-id");if(resetSidebarConversationSelection(),b==="root"){const k=document.querySelector("#sidebar-folder-search-input");if(!document.querySelector("#sidebar-folder-content #loading-spinner-sidebar-folder-content")&&selectedConversationFolderBreadcrumb.length===0&&k?.value==="")return;selectedConversationFolderBreadcrumb=[],clearSidebarSearchInput(),await chrome.storage.local.set({selectedConversationFolderBreadcrumb}),generateConvFolderBreadcrumb(p,!0),loadSidebarFolders(),toggleNewConversationInFolderButton(!0);return}const w=selectedConversationFolderBreadcrumb.findIndex(k=>k.id.toString()===b.toString());w!==-1&&(w<selectedConversationFolderBreadcrumb.length-1||y.shiftKey)&&(selectedConversationFolderBreadcrumb=selectedConversationFolderBreadcrumb.slice(0,w+1),await chrome.storage.local.set({selectedConversationFolderBreadcrumb}),toggleNewConversationInFolderButton(isDefaultConvFolder(b)),generateConvFolderBreadcrumb(p,!0),throttleGetConvSubFolders(b,y.shiftKey),throttleFetchSidebarConversations(1,!1,y.shiftKey))}}),g.appendChild(p),n.appendChild(g);const h=document.createElement("div");h.id="new-conversation-in-folder-button-wrapper",h.classList=`items-center justify-start pb-3 ${e?"":"px-3"} w-full ${o||r?"hidden":"flex"}`;const f=document.createElement("button");f.id="new-conversation-in-folder-button",f.classList="btn btn-secondary w-full ",f.innerHTML=t?.gizmo_id?translate("Start a new chat with this GPT"):translate("Start a new chat in this folder"),f.addEventListener("click",()=>{const y=getLastSelectedConversationFolder();folderForNewChat=y,startNewChat(!1,y.gizmo_id),initiateNewChatFolderIndicator()}),h.appendChild(f),n.appendChild(h);const v=document.createElement("div");if(v.id="sidebar-folder-content",v.classList=`relative pb-20 ${e?"":"px-3"} overflow-y-auto min-w-full h-full`,v.appendChild(loadingSpinner("sidebar-folder-content")),n.appendChild(v),document.querySelector("#sidebar-folder-drawer"))return;if(document.querySelector("nav")&&e){const y=getOriginalHistory();y&&(y.style.padding="8px",y.classList.add("hide-asides"),y.appendChild(n),setTimeout(()=>{y.classList.add("hide-asides")},1e3))}else{const y=document.querySelector('div[class*="@container/main"]');if(!y)return;y.appendChild(n)}generateConvFolderBreadcrumb(p,!0);const x=document.querySelector("#floating-button-wrapper");if(e)n.style.width="100%";else{const y=document.querySelector('header[id="page-header"]'),b=document.querySelector("main");if(!y||!b)return;sidebarFolderIsOpen()?(n.style.width="280px",b.style.width="calc(100% - 280px)",y.style.width="calc(100% - 280px)",x&&(x.style.right="calc(1rem + 280px)")):sidebarNoteIsOpen||(n&&(n.style.width="0"),b.style.width="100%",y.style.width="100%",x&&(x.style.right="3rem"))}}function clearSidebarSearchInput(){const e=document.querySelector("#sidebar-folder-search-input");e&&(e.value="");const t=document.querySelector("#sidebar-folder-search-hint");t&&(t.classList.add("hidden"),t.innerText="")}function addNewConvFolderElementToSidebar(e){const t=document.querySelector("#sidebar-folder-content #default-conversation-folders");t?t.after(conversationFolderElement(e,!0)):document.querySelector("#sidebar-folder-content")?.prepend(conversationFolderElement(e,!0)),document.querySelector(`#sidebar-folder-content #conversation-folder-wrapper-${e.id}`)?.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})}async function addConversationToSidebarFolder(e,t="all"){if(getLastSelectedConversationFolder()?.id!==t)return;const o=document.querySelector("#sidebar-folder-content");if(!o)return;if(o.querySelector("#loading-spinner-sidebar-folder-content")){setTimeout(()=>{addConversationToSidebarFolder(e,t)},100);return}const r=document.querySelector(`#sidebar-folder-content #conversation-card-${e.conversation_id}`);let n=!1,i=!1,a={};if(r){n=!r.querySelector('svg[id^="conversation-favorite-indicator-"]')?.classList?.contains("hidden"),i=!r.querySelector('svg[id^="conversation-note-indicator-"]')?.classList?.contains("hidden");const c=r.querySelector('div[id^="conversation-card-folder-color-indicator-"]');c&&(a={id:c.dataset.folderId,name:c.title,color:rgba2hex(c.style.backgroundColor)}),r.remove()}const s=createConversationElement({...e,is_favorite:n,has_note:i,folder:a}),l=document.querySelector("#sidebar-folder-content #no-conversations-found"),d=document.querySelector("#sidebar-folder-content div[id^=conversation-card-]");l?(l.remove(),o.appendChild(s)):d&&d.before(s),addConversationElementEventListeners(s,e),setTimeout(()=>{matchConversationNames(!0)},2e3)}async function replaceConversationInSidebarFolder(e){if(!document.querySelector("#sidebar-folder-content"))return;const t=createConversationElement(e),o=document.querySelector(`#sidebar-folder-content #conversation-card-${e.conversation_id}`);o&&o.replaceWith(t),addConversationElementEventListeners(t,e)}function getOriginalHistory(){return document.querySelector('nav div[id="history"]')||document.querySelector('nav div[class="flex flex-col gap-2 text-token-text-primary text-sm mt-5 first:mt-0 false"]')||document.querySelector('nav div[class="flex flex-col gap-2 text-token-text-primary text-sm false mt-5 pb-2"]')}async function createSidebarFolderButton(e=window.location){const t=document.querySelector("nav");let o=getOriginalHistory();const{showFoldersInLeftSidebar:r}=cachedSettings;if(document.querySelector("#sidebar-folder-drawer")){r&&t&&o.classList.add("hide-asides");return}if(r&&!t)return;if(r&&t)if(o)o.previousElementSibling&&o.previousElementSibling.hasAttribute("aria-expanded")&&(o.previousElementSibling.style.display="none");else{let a=0;const s=setInterval(()=>{o=getOriginalHistory(),(o||a>=50)&&(clearInterval(s),createSidebarFolderButton(e)),a+=1},100);return}const n=e.pathname.includes("/gpts"),i=e.pathname.includes("/admin");if(!r){const a=document.querySelector("#sidebar-folder-button");a?a.classList.remove("hidden"):addSidebarFolderButton()}if(await addSidebarFolderDrawer(),!r&&(n||i)){document.querySelector("#sidebar-folder-button").classList.add("hidden");const a=document.querySelector("#floating-button-wrapper");a&&(a.style.right="3rem")}else loadSidebarFolders(),setTimeout(()=>{document.querySelector("#sidebar-folder-drawer #loading-spinner-sidebar-folder-content")&&loadSidebarFolders()},2e3)}function animateConversationName(e,t){e.innerText="",t.split("").forEach((o,r)=>{setTimeout(()=>{e.innerHTML+=o},r*50)})}function matchConversationNames(e=!1){Array.from(document.querySelectorAll("#sidebar-folder-content div[id^=conversation-card-][data-conversation-id]")).slice(0,5).forEach((t,o)=>{const r=document.querySelector(`nav a[href$="/c/${t.dataset.conversationId}"]`);r&&r.innerText!=="New chat"&&t.querySelector("#conversation-title").innerText!==r.innerText&&t.querySelector("#conversation-title").innerText==="New chat"&&r&&(o===0&&e?animateConversationName(t.querySelector("#conversation-title"),r.innerText):t.querySelector("#conversation-title").innerHTML=r.innerText)})}async function goToFolder(e){const t=document.querySelector("#sidebar-folder-content");if(!t)return;t.innerHTML="";const o=document.querySelector("#sidebar-folder-breadcrumb");o&&(selectedConversationFolderBreadcrumb=e,chrome.storage.local.set({selectedConversationFolderBreadcrumb}),generateConvFolderBreadcrumb(o,!0)),toggleNewConversationInFolderButton(isDefaultConvFolder(e[e.length-1]?.id)),await throttleGetConvSubFolders(e[e.length-1]?.id||"root"),await throttleFetchSidebarConversations(1,!1,!0)}function dropdown(e,t,o,r="code",n="right",i=null,a=!0){if(o||(o=t[0]),!o)return"";const s=e.replaceAll("-"," ").split(" ").pop();return`<button id="${e.toLowerCase()}-selector-button" class="relative w-full h-full cursor-pointer rounded-lg ${i||"bg-token-main-surface-secondary"} hover:bg-token-main-surface-tertiary ps-3 pe-6 text-start focus:outline-none  text-sm" type="button">
  ${a?`<label class="relative text-xs text-token-text-tertiary" style="top:-2px;">${translate(s)}</label>`:""}
  <span class="inline-flex w-full truncate text-token-text-primary pe-2">
    <span class="flex h-5 items-center gap-1 truncate relative" style="${a?"top:-2px;":""}"><span class="truncate" id="selected-${e.toLowerCase()}-title" data-option="${o[r]}">${translate(o.name)}</span>
    </span>
  </span>
  <span class="pointer-events-none absolute inset-y-0 end-0 flex items-center pe-2">
    <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4  text-gray-400" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg">
      <polyline points="6 9 12 15 18 9"></polyline>
    </svg>
  </span>
</button>
<ul id="${e.toLowerCase()}-list-dropdown" style="max-height:400px;overflow-y:auto;width:250px;" class="hidden shadow-long transition-all absolute z-10 ${n==="right"?"end-0":"start-0"} mt-1 overflow-auto rounded-2xl p-1 text-base focus:outline-none ${i||"bg-token-main-surface-secondary"} dark:ring-white/20 text-sm -translate-x-1/4" role="menu" aria-orientation="vertical" aria-labelledby="${e.toLowerCase()}-selector-button" tabindex="-1">
  ${t.map(l=>`<li title="${l.description||l.subtitle||""}" class="text-token-text-primary relative cursor-pointer select-none py-1 ps-3 pe-9 hover:bg-token-main-surface-tertiary rounded-xl min-h-9 flex items-center" id="${e.toLowerCase()}-selector-option-${l[r]}" role="option" tabindex="-1">
    <div class="flex flex-col">
      <span class="flex h-6 items-center gap-1 truncate text-token-text-primary">${translate(l.name)}</span>
      ${l.subtitle?`<span class="text-xs text-token-text-tertiary overflow-wrap">${translate(l.subtitle)}</span>`:""}
    </div>
    ${l[r]===o[r]?`<span id="${e.toLowerCase()}-selector-checkmark" class="absolute inset-y-0 end-0 flex items-center pe-4 text-token-text-primary">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md"><path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path></svg>
    </span>`:""}
  </li>`).join("")}
  </ul>`}function addDropdownEventListener(e,t,o="code",r=null){document.querySelector(`#${e.toLowerCase()}-selector-button`)?.addEventListener("click",()=>{const n=document.querySelector(`#${e.toLowerCase()}-list-dropdown`);n.classList.contains("block")?n.classList.replace("block","hidden"):n.classList.replace("hidden","block")}),document.body.addEventListener("click",n=>{const i=document.querySelector(`#${e.toLowerCase()}-list-dropdown`);i?.classList?.contains("block")&&!n.target.closest(`#${e.toLowerCase()}-selector-button`)&&i.classList.replace("block","hidden")}),document.querySelectorAll(`[id^=${e.toLowerCase()}-selector-option-]`).forEach(n=>{n.addEventListener("click",()=>{document.querySelector(`#${e.toLowerCase()}-list-dropdown`).classList.replace("block","hidden");const i=document.querySelector(`#${e.toLowerCase()}-selector-checkmark`);i?(i.remove(),n.appendChild(i)):n.insertAdjacentHTML("beforeend",`<span id="${e.toLowerCase()}-selector-checkmark" class="absolute inset-y-0 end-0 flex items-center pe-4 text-token-text-primary">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md"><path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path></svg>
    </span>`);const a=n.id.split(`${e.toLowerCase()}-selector-option-`)[1],s=t.find(d=>d[o].toString()===a.toString()),l=document.querySelector(`#selected-${e.toLowerCase()}-title`);l.textContent=translate(s.name),l.setAttribute("data-option",s[o]),chrome.storage.local.set({settings:{...cachedSettings,[`selected${e.replaceAll("-","")}`]:s}},()=>{r&&r(s)})})})}const KEY_PREFIX="sp/pv/",MAX_VALUES=5,IN_MEMORY_CACHE=new Map;let CACHE_WARMED=!1;const HAS_CHROME_STORAGE=typeof chrome<"u"&&chrome?.storage?.local;function sanitizePVName(e=""){return String(e).trim().replace(/\s+/g,"_").replace(/[\\/]+/g,"").replace(/[^a-zA-Z0-9\-_]/g,"_")}function buildPVKey(e){return`${KEY_PREFIX}${sanitizePVName(e)}`}function extractPVNameFromKey(e){return e.startsWith(KEY_PREFIX)?e.slice(KEY_PREFIX.length):e}function normalizePVArray(e){const t=(Array.isArray(e)?e:[]).map(r=>String(r)),o=[];for(const r of t)o.includes(r)||o.push(r);return o.slice(0,5)}async function chromeGetAll(){return new Promise((e,t)=>{chrome.storage.local.get(null,o=>{const r=chrome.runtime.lastError;r?(console.warn("chromeGetAll error",r),t(r)):e(o||{})})})}async function chromeGet(e){return new Promise((t,o)=>{chrome.storage.local.get([e],r=>{const n=chrome.runtime.lastError;n?(console.warn("chromeGet error",n),o(n)):t(r?.[e])})})}async function chromeSet(e,t){return new Promise((o,r)=>{chrome.storage.local.set({[e]:t},()=>{const n=chrome.runtime.lastError;n?(console.warn("chromeSet error",n),r(n)):o()})})}async function chromeRemove(e){return new Promise((t,o)=>{chrome.storage.local.remove([e],()=>{const r=chrome.runtime.lastError;r?(console.warn("chromeRemove error",r),o(r)):t()})})}function localStorageGetAll(){const e={};for(let t=0;t<localStorage.length;t+=1){const o=localStorage.key(t);try{const r=localStorage.getItem(o);e[o]=JSON.parse(r)}catch{}}return e}function localStorageGet(e){try{const t=localStorage.getItem(e);return t?JSON.parse(t):void 0}catch(t){console.warn("localStorageGet error",t);return}}function localStorageSet(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(o){throw console.warn("localStorageSet error",o),o}}function localStorageRemove(e){try{localStorage.removeItem(e)}catch(t){throw console.warn("localStorageRemove error",t),t}}async function warmCacheIfNeeded(){if(!CACHE_WARMED)try{const e=HAS_CHROME_STORAGE?await chromeGetAll():localStorageGetAll();Object.entries(e).forEach(([t,o])=>{t.startsWith(KEY_PREFIX)&&Array.isArray(o)&&IN_MEMORY_CACHE.set(t,normalizePVArray(o))}),CACHE_WARMED=!0,HAS_CHROME_STORAGE&&chrome.storage?.onChanged&&chrome.storage.onChanged.addListener((t,o)=>{if(o==="local")for(const[r,n]of Object.entries(t))r.startsWith(KEY_PREFIX)&&(Object.prototype.hasOwnProperty.call(n,"newValue")?IN_MEMORY_CACHE.set(r,normalizePVArray(n.newValue)):IN_MEMORY_CACHE.delete(r))})}catch(e){console.warn("warmCacheIfNeeded error",e)}}async function persist(e,t){const o=normalizePVArray(t);IN_MEMORY_CACHE.set(e,o),HAS_CHROME_STORAGE?await chromeSet(e,o):localStorageSet(e,o)}async function erase(e){IN_MEMORY_CACHE.delete(e),HAS_CHROME_STORAGE?await chromeRemove(e):localStorageRemove(e)}async function getPromptVariable(e){try{await warmCacheIfNeeded();const t=buildPVKey(e);if(IN_MEMORY_CACHE.has(t))return IN_MEMORY_CACHE.get(t).slice();const o=HAS_CHROME_STORAGE?await chromeGet(t):localStorageGet(t),r=normalizePVArray(Array.isArray(o)?o:[]);return IN_MEMORY_CACHE.set(t,r),r.slice()}catch(t){return console.warn("getPromptVariable error",t),[]}}async function setPromptVariable(e,t){try{await warmCacheIfNeeded();const o=buildPVKey(e);return await persist(o,t),!0}catch(o){return console.warn("setVariable error",o),!1}}async function addPromptVariableValue(e,t){try{await warmCacheIfNeeded();const o=buildPVKey(e),r=await getPromptVariable(e),n=String(t),i=r.filter(s=>s!==n);i.unshift(n);const a=normalizePVArray(i);return await persist(o,a),a.slice()}catch(o){return console.warn("addValue error",o),[]}}async function updatePromptVariableValue(e,t,o){try{await warmCacheIfNeeded();const r=buildPVKey(e),n=(await getPromptVariable(e)).filter(a=>a!==String(t));n.unshift(String(o));const i=normalizePVArray(n);return await persist(r,i),i.slice()}catch(r){return console.warn("updateValue error",r),[]}}async function removePromptVariableValue(e,t){try{await warmCacheIfNeeded();const o=buildPVKey(e),r=(await getPromptVariable(e)).filter(n=>n!==String(t));return await persist(o,r),r.slice()}catch(o){return console.warn("removeValue error",o),[]}}async function deletePromptVariable(e){try{await warmCacheIfNeeded();const t=buildPVKey(e);return await erase(t),!0}catch(t){return console.warn("deleteVariable error",t),!1}}async function listPromptVariables(){try{if(await warmCacheIfNeeded(),IN_MEMORY_CACHE.size>0)return Array.from(IN_MEMORY_CACHE.keys()).filter(t=>t.startsWith(KEY_PREFIX)).map(extractPVNameFromKey);const e=HAS_CHROME_STORAGE?await chromeGetAll():localStorageGetAll();return Object.keys(e).filter(t=>t.startsWith(KEY_PREFIX)).map(extractPVNameFromKey)}catch(e){return console.warn("listVariables error",e),[]}}async function getAllPromptVariables(){try{await warmCacheIfNeeded();const e=await listPromptVariables(),t={};for(const o of e)t[o]=await getPromptVariable(o);return t}catch(e){return console.warn("getAllVariables error",e),{}}}async function exists(e){return(await getPromptVariable(e)).length>0}async function size(e){return(await getPromptVariable(e)).length}async function createTemplateWordsModal(e){return new Promise((t,o)=>{const r=document.querySelector("#modal-prompt-variables");r&&r.remove();const n=[...new Set(e)],i=templateWordsModalContent(n),a=templateWordsModalActions(e,t);createModal("Prompt variables","Please enter the value for the variables in your prompt",i,a,!0,"large"),setTimeout(()=>{const s=document.querySelectorAll("[id^=template-input-]"),l=Array.from(s).filter(c=>c.value==="")[0],d=s[0];l?l.focus():d&&d.focus(),document.querySelector("#modal-close-button-prompt-variables")?.addEventListener("click",()=>{resetPromptChain()}),document.querySelector("#modal-prompt-variables")?.addEventListener("mousedown",c=>{const u=document.querySelector("#modal-wrapper-prompt-variables");isDescendant(u,c.target)||resetPromptChain()})},100)})}function templateWordsModalContent(e){const t=document.createElement("div");t.id="modal-content-prompt-variables",t.classList="flex relative overflow-hidden h-full";const o=document.querySelector("#prompt-textarea"),r=document.createElement("div");r.classList="overflow-y-auto h-full p-4",r.style.width="60%",e.forEach((s,l)=>{const d=document.createElement("div");d.id=`prompt-variable-row-${l}`,d.style="display: flex; flex-wrap:wrap;justify-content: space-between; align-items: center;width: 100%; margin-bottom: 12px;";const c=document.createElement("label");c.classList="text-token-text-primary w-full text-sm capitalize mb-2",c.innerHTML=s;const u=document.createElement("textarea");u.classList="w-full h-24 text-token-text-primary text-sm bg-token-main-surface-secondary rounded-md border border-token-border-medium px-2 py-1",u.id=`template-input-${s}`,u.placeholder=`Enter the value for "${s}"`,u.value=templateWordsMap[s]||"",u.addEventListener("input",g=>{const p=g.target.value,h=document.querySelectorAll(`#prompt-preview strong[data-word="${s}"]`);if(p.length===0){h.forEach(f=>{f.innerText=s});return}}),u.addEventListener("focus",()=>{document.querySelectorAll(`#prompt-preview strong[data-word="${s}"]`).forEach(g=>{g.classList.add("border-gold","text-gold")})}),u.addEventListener("blur",()=>{document.querySelectorAll(`#prompt-preview strong[data-word="${s}"]`).forEach(g=>{g.classList.remove("border-gold","text-gold")})});const m=document.createElement("div");m.classList="text-token-text-tertiary text-xs mt-2 flex gap-2 items-center flex-wrap",getPromptVariable(s).then(g=>{if(g&&g.length>0){const p=g.slice(0,5).map((h,f)=>`<div id="suggestion-${f}" title="${h}" class="cursor-pointer rounded-md border border-token-border-medium bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary py-0.5 px-2">${h.length>30?`${h.slice(0,30)}...`:h}</div>`);m.innerHTML=`Suggestions: ${p.join("")}`,g.slice(0,5).forEach((h,f)=>{m.querySelector(`#suggestion-${f}`).addEventListener("click",()=>{u.value=h,u.dispatchEvent(new Event("input",{bubbles:!0})),u.selectionStart=u.selectionEnd=h.length,u.focus()})}),d.appendChild(m)}}),d.appendChild(c),d.appendChild(u),r.appendChild(d)}),t.appendChild(r);const n=document.createElement("div");if(n.classList="overflow-y-auto h-full bg-token-main-surface-secondary p-4",n.style.width="40%",runningPromptChain.instruction){const s=document.createElement("div");s.classList="text-token-text-primary w-full text-md capitalize mb-2",s.innerHTML="Prompt Instruction",n.appendChild(s);const l=document.createElement("div");l.classList="w-full text-token-text-tertiary text-sm bg-token-sidebar-surface-secondary rounded-md border border-token-border-medium p-4 mb-8 italic",l.innerText=runningPromptChain.instruction,n.appendChild(l)}const i=document.createElement("div");i.classList="text-token-text-primary w-full text-md capitalize mb-2",i.innerHTML="Prompt preview",n.appendChild(i);const a=document.createElement("div");return a.id="prompt-preview",a.classList="w-full text-token-text-tertiary text-sm bg-token-sidebar-surface-secondary rounded-md border border-token-border-medium p-4 mb-8 italic",a.style="line-height: 2rem; white-space: pre-wrap; word-break: break-word;",a.innerHTML=highlightBracket(o.innerText),n.appendChild(a),t.appendChild(n),t}function templateWordsModalActions(e,t){const o=document.createElement("div");o.classList="flex items-center justify-end flex-wrap w-full mt-2";const r=document.createElement("button");return r.classList="btn composer-submit-btn composer-submit-button-color",r.innerHTML="Continue",r.id="modal-submit-button",r.addEventListener("click",()=>{const n=document.querySelector("#prompt-textarea");let i=n.innerText;const a={};e.forEach(s=>{const l=document.getElementById(`template-input-${s}`).value;i=i.replace(`{{${s}}}`,l),a[s]=l,templateWordsMap[s]=l,addPromptVariableValue(s,l)}),setTextAreaElementValue(i),n.dispatchEvent(new Event("input",{bubbles:!0})),document.querySelector("#modal-prompt-variables").remove(),t(i)}),o.appendChild(r),o}async function shareConversation(e){const t=await getConversation(e),o=t.current_node,r=document.createElement("div");r.id="share-modal-wrapper",r.classList="absolute inset-0",r.style.zIndex="999999",r.innerHTML='<div data-state="open" class="fixed inset-0 bg-black/50 dark:bg-black/80" style="pointer-events: auto;"><div class="grid h-full w-full grid-cols-[10px_1fr_10px] overflow-y-auto grid-cols-[10px_1fr_10px] grid-rows-[minmax(10px,1fr)_auto_minmax(10px,1fr)] md:grid-rows-[minmax(20px,1fr)_auto_minmax(20px,1fr)]"><div role="dialog" data-state="open" class="popover relative start-1/2 col-auto col-start-2 row-auto row-start-2 w-full rounded-2xl bg-token-main-surface-primary text-start shadow-xl ltr:-translate-x-1/2 rtl:translate-x-1/2 flex flex-col focus:outline-none max-w-[550px]" tabindex="-1" style="pointer-events: auto;"><div class="flex-grow overflow-y-auto p-4 sm:p-6"><div class="flex h-full items-center justify-center py-4"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="animate-spin text-center icon icon-md text-token-text-tertiary" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><line x1="12" y1="2" x2="12" y2="6"></line><line x1="12" y1="18" x2="12" y2="22"></line><line x1="4.93" y1="4.93" x2="7.76" y2="7.76"></line><line x1="16.24" y1="16.24" x2="19.07" y2="19.07"></line><line x1="2" y1="12" x2="6" y2="12"></line><line x1="18" y1="12" x2="22" y2="12"></line><line x1="4.93" y1="19.07" x2="7.76" y2="16.24"></line><line x1="16.24" y1="7.76" x2="19.07" y2="4.93"></line></svg></div></div></div></div></div>',document.body.appendChild(r),createShare(e,o).then(async n=>{if(n.share_id)r.innerHTML=await shareModal(t,n),addShareModalEventListener(n);else{const i=n?.detail?.description||"Failed to copy link to clipboard - could not create link";r.remove(),toast(i,"error")}})}async function shareModal(e,t){return`<div data-state="open" class="fixed inset-0 bg-black/50 dark:bg-black/80" style="pointer-events: auto;">
    <div class="grid h-full w-full grid-cols-[10px_1fr_10px] overflow-y-auto grid-cols-[10px_1fr_10px] grid-rows-[minmax(10px,1fr)_auto_minmax(10px,1fr)] md:grid-rows-[minmax(20px,1fr)_auto_minmax(20px,1fr)]">
      <div role="dialog" id="share-modal-dialog" aria-describedby="radix-:r53:" aria-labelledby="radix-:r52:" data-state="open" class="popover relative start-1/2 col-auto col-start-2 row-auto row-start-2 w-full rounded-2xl bg-token-main-surface-primary text-start shadow-xl ltr:-translate-x-1/2 rtl:translate-x-1/2 flex flex-col focus:outline-none max-w-[550px]" tabindex="-1" style="pointer-events: auto;">
        <div class="px-4 pb-4 pt-5 sm:p-6 flex items-center justify-between border-b border-token-border-medium">
          <div class="flex">
            <div class="flex items-center">
              <div class="flex grow flex-col gap-1">
                <h2 class="text-lg font-semibold leading-6 text-token-text-primary">${t.already_exists?"Update":"Share"} public link to chat</h2>
              </div>
            </div>
          </div>
          <button id="share-modal-close-button" class="text-token-text-tertiary hover:text-token-text-tertiary">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
              xmlns="http://www.w3.org/2000/svg">
              <path d="M6.34315 6.34338L17.6569 17.6571M17.6569 6.34338L6.34315 17.6571" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
          </button>
        </div>
        <div class="flex-grow overflow-y-auto p-4 sm:p-6">
          <div class="w-full">
            <p class="mb-6 text-token-text-tertiary">
              <span>Your name, custom instructions, and any messages you add after sharing stay private. 
                <a href="https://help.openai.com/en/articles/7925741-chatgpt-shared-links-faq" class="inline-flex items-center gap-2 text-token-text-tertiary underline hover:text-token-text-tertiary" target="_blank" rel="noreferrer">Learn more</a>
              </span>
            </p>
          </div>
          <div class="mb-2 flex items-center justify-between rounded-2xl border border-token-border-medium bg-token-main-surface-primary p-2 text-token-text-tertiary last:mb-2 juice:rounded-full">
            <div class="relative ms-1 flex-grow">
              <input type="text" readonly="" class="w-full rounded-xl border-0 bg-token-main-surface-primary px-2 py-2.5 text-lg text-token-text-tertiary" value="https://chatgpt.com/share/...">
                <div class="pointer-events-none absolute bottom-0 end-0 top-0 w-12 bg-gradient-to-l from-token-main-surface-primary"></div>
              </div>
              <button id='create-update-share-button' class="btn relative composer-submit-btn composer-submit-button-color ms-4 me-0 mt-0 rounded-xl px-4 py-3 text-base font-bold" as="button">
                <div class="flex w-full gap-2 items-center justify-center">
                  <svg
                    xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md">
                    <path fill="currentColor" fill-rule="evenodd" d="M18.293 5.707a4.657 4.657 0 0 0-6.586 0l-1 1a1 1 0 0 1-1.414-1.414l1-1a6.657 6.657 0 1 1 9.414 9.414l-1 1a1 1 0 0 1-1.414-1.414l1-1a4.657 4.657 0 0 0 0-6.586m-2.586 2.586a1 1 0 0 1 0 1.414l-6 6a1 1 0 0 1-1.414-1.414l6-6a1 1 0 0 1 1.414 0m-9 1a1 1 0 0 1 0 1.414l-1 1a4.657 4.657 0 0 0 6.586 6.586l1-1a1 1 0 0 1 1.414 1.414l-1 1a6.657 6.657 0 1 1-9.414-9.414l1-1a1 1 0 0 1 1.414 0" clip-rule="evenodd"></path>
                  </svg>${t.already_exists?"Update":"Create"} link
                </div>
              </button>
            </div>
            ${t.already_exists?`<div class="w-full">
              <p class="mb-3 text-sm text-token-text-tertiary">A past version of this chat has already been shared. Manage previously shared chats via 
                <a href="#settings/DataControls" target="_blank" rel="noreferrer" class="underline hover:text-token-text-quaternary">Settings</a>.
              </p>
            </div>`:""}
          </div>
        </div>
      </div>
    </div>`}function addShareModalEventListener(e){const t=document.querySelector("#share-modal-wrapper");t.addEventListener("click",r=>{const n=document.querySelector("#share-modal-dialog");n&&!n?.contains(r.target)&&t.remove()}),document.querySelector("#share-modal-close-button").addEventListener("click",()=>{t.remove()});const o=document.querySelector("#create-update-share-button");o.addEventListener("click",r=>{r.preventDefault(),r.stopPropagation(),closeMenus(),o.disabled=!0,o.innerHTML='<div class="flex w-full gap-2 items-center justify-center"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="animate-spin text-center" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><line x1="12" y1="2" x2="12" y2="6"></line><line x1="12" y1="18" x2="12" y2="22"></line><line x1="4.93" y1="4.93" x2="7.76" y2="7.76"></line><line x1="16.24" y1="16.24" x2="19.07" y2="19.07"></line><line x1="2" y1="12" x2="6" y2="12"></line><line x1="18" y1="12" x2="22" y2="12"></line><line x1="4.93" y1="19.07" x2="7.76" y2="16.24"></line><line x1="16.24" y1="7.76" x2="19.07" y2="4.93"></line></svg>Copying...</div>',shareConv({...e,is_public:!0}).then(()=>{shareModalPostShareContent(e)})})}function shareModalPostShareContent(e){const t=document.querySelector("#share-modal-dialog");t.innerHTML=`<div class="px-4 pb-4 pt-5 sm:p-6 flex items-center justify-between border-b border-token-border-medium">
  <div class="flex">
    <div class="flex items-center">
      <div class="flex grow flex-col gap-1">
        <h2 class="text-lg font-semibold leading-6 text-token-text-primary">Public link ${e.already_exists?"updated":"created"}</h2>
      </div>
    </div>
  </div>
  <button id="share-modal-close-button" class="text-token-text-tertiary hover:text-token-text-tertiary">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
      xmlns="http://www.w3.org/2000/svg">
      <path d="M6.34315 6.34338L17.6569 17.6571M17.6569 6.34338L6.34315 17.6571" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
    </svg>
  </button>
</div>
<div class="flex-grow overflow-y-auto p-4 sm:p-6">
  <div class="w-full">
    <p class="mb-6 text-token-text-tertiary">
      <span>A public link to your chat has been created. Manage previously shared chats at any time via 
        <a href="#settings/DataControls" target="_blank" rel="noreferrer" class="underline">Settings</a>. 
      </span>
    </p>
  </div>
  ${e.can_disable_discoverability?`<div id="make-chat-discoverable-button" data-checked="${e.is_discoverable}" class="mb-7" role="checkbox" aria-checked="false" aria-disabled="false" tabindex="0">
    <label class="flex items-start cursor-pointer">
      <div id="make-chat-discoverable-icon" class="flex h-5 w-5 items-center justify-center">
      ${e.is_discoverable?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="text-token-text-primary"><path fill="currentColor" d="M8.759 3h6.482c.805 0 1.47 0 2.01.044.563.046 1.08.145 1.565.392a4 4 0 0 1 1.748 1.748c.247.485.346 1.002.392 1.564C21 7.29 21 7.954 21 8.758v6.483c0 .805 0 1.47-.044 2.01-.046.563-.145 1.08-.392 1.565a4 4 0 0 1-1.748 1.748c-.485.247-1.002.346-1.564.392-.541.044-1.206.044-2.01.044H8.758c-.805 0-1.47 0-2.01-.044-.563-.046-1.08-.145-1.565-.392a4 4 0 0 1-1.748-1.748c-.247-.485-.346-1.002-.392-1.564C3 16.71 3 16.046 3 15.242V8.758c0-.805 0-1.47.044-2.01.046-.563.145-1.08.392-1.565a4 4 0 0 1 1.748-1.748c.485-.247 1.002-.346 1.564-.392C7.29 3 7.954 3 8.758 3m7.809 6.325a1 1 0 1 0-1.636-1.15L10.9 13.904l-1.66-1.827a1 1 0 0 0-1.48 1.346l2.5 2.75a1 1 0 0 0 1.558-.097z"></path></svg>':'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M8.759 3h6.482c.805 0 1.47 0 2.01.044.563.046 1.08.145 1.565.392a4 4 0 0 1 1.748 1.748c.247.485.346 1.002.392 1.564C21 7.29 21 7.954 21 8.758v6.483c0 .805 0 1.47-.044 2.01-.046.563-.145 1.08-.392 1.565a4 4 0 0 1-1.748 1.748c-.485.247-1.002.346-1.564.392-.541.044-1.206.044-2.01.044H8.758c-.805 0-1.47 0-2.01-.044-.563-.046-1.08-.145-1.565-.392a4 4 0 0 1-1.748-1.748c-.247-.485-.346-1.002-.392-1.564C3 16.71 3 16.046 3 15.242V8.758c0-.805 0-1.47.044-2.01.046-.563.145-1.08.392-1.565a4 4 0 0 1 1.748-1.748c.485-.247 1.002-.346 1.564-.392C7.29 3 7.954 3 8.758 3M6.91 5.038c-.438.035-.663.1-.819.18a2 2 0 0 0-.874.874c-.08.156-.145.38-.18.819C5 7.361 5 7.943 5 8.8v6.4c0 .857 0 1.439.038 1.889.035.438.1.663.18.819a2 2 0 0 0 .874.874c.156.08.38.145.819.18C7.361 19 7.943 19 8.8 19h6.4c.857 0 1.439 0 1.889-.038.438-.035.663-.1.819-.18a2 2 0 0 0 .874-.874c.08-.156.145-.38.18-.819.037-.45.038-1.032.038-1.889V8.8c0-.857 0-1.439-.038-1.889-.035-.438-.1-.663-.18-.819a2 2 0 0 0-.874-.874c-.156-.08-.38-.145-.819-.18C16.639 5 16.057 5 15.2 5H8.8c-.857 0-1.439 0-1.889.038"></path></svg>'}
      </div>
      <div class="ms-2 leading-tight">
        <div class="text-token-text-primary">Make this chat discoverable</div>
        <div class="text-xs text-token-text-tertiary">Allows it to be shown in web searches</div>
      </div>
    </label>
  </div>`:""}
  <div class="mb-2 flex items-center justify-between rounded-2xl border border-token-border-medium bg-token-main-surface-primary p-2 text-token-text-tertiary last:mb-2 juice:rounded-full">
    <div class="relative ms-1 flex-grow">
      <input type="text" readonly="" class="w-full rounded-xl border-0 bg-token-main-surface-primary px-2 py-2.5 text-lg text-token-text-primary" value="https://chatgpt.com/share/${e.share_id}">
        <div class="pointer-events-none absolute bottom-0 end-0 top-0 w-12 bg-gradient-to-l from-token-main-surface-primary"></div>
      </div>
      <button id="copy-share-button" class="btn relative composer-submit-btn composer-submit-button-color ms-4 me-0 mt-0 rounded-xl px-4 py-3 text-base font-bold" as="button">
        <div class="flex w-full gap-2 items-center justify-center">
          <svg
            xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-sm">
            <path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path>
          </svg>Copy link
        </div>
      </button>
    </div>
    <div class="mt-6 flex justify-center space-x-14">
      <div class="flex flex-col items-center">
        <a href="https://www.linkedin.com/shareArticle?url=https%3A%2F%2Fchatgpt.com%2Fshare%2F${e.share_id}" target="_blank" rel="noopener noreferrer">
          <div>
            <svg width="40" height="40" viewBox="0 0 40 40" fill="none"
              xmlns="http://www.w3.org/2000/svg">
              <rect width="40" height="40" rx="20" fill="var(--main-surface-secondary)"></rect>
              <path d="M27.65 11H12.35C11.992 11 11.6486 11.1422 11.3954 11.3954C11.1422 11.6486 11 11.992 11 12.35V27.65C11 28.008 11.1422 28.3514 11.3954 28.6046C11.6486 28.8578 11.992 29 12.35 29H27.65C28.008 29 28.3514 28.8578 28.6046 28.6046C28.8578 28.3514 29 28.008 29 27.65V12.35C29 11.992 28.8578 11.6486 28.6046 11.3954C28.3514 11.1422 28.008 11 27.65 11ZM16.4 26.3H13.7V18.2H16.4V26.3ZM15.05 16.625C14.7406 16.6162 14.4406 16.5163 14.1876 16.338C13.9346 16.1596 13.7397 15.9107 13.6274 15.6222C13.515 15.3337 13.4902 15.0186 13.5559 14.7161C13.6217 14.4136 13.7751 14.1372 13.9971 13.9214C14.2191 13.7056 14.4997 13.56 14.8039 13.5028C15.1081 13.4456 15.4225 13.4793 15.7077 13.5997C15.9928 13.7201 16.2362 13.9219 16.4074 14.1798C16.5785 14.4378 16.6699 14.7404 16.67 15.05C16.6629 15.4733 16.4885 15.8766 16.1849 16.1717C15.8814 16.4669 15.4733 16.6298 15.05 16.625ZM26.3 26.3H23.6V22.034C23.6 20.756 23.06 20.297 22.358 20.297C22.1522 20.3107 21.9511 20.3649 21.7663 20.4566C21.5815 20.5482 21.4166 20.6755 21.2811 20.831C21.1457 20.9866 21.0422 21.1674 20.9768 21.363C20.9114 21.5586 20.8853 21.7652 20.9 21.971C20.8955 22.0129 20.8955 22.0551 20.9 22.097V26.3H18.2V18.2H20.81V19.37C21.0733 18.9695 21.435 18.6433 21.8605 18.4227C22.286 18.2021 22.761 18.0944 23.24 18.11C24.635 18.11 26.264 18.884 26.264 21.404L26.3 26.3Z" fill="var(--text-secondary)"></path>
            </svg>
          </div>
        </a>
        <span class="mt-1 text-xs font-semibold text-token-text-tertiary">LinkedIn</span>
      </div>
      <div class="flex flex-col items-center">
        <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fchatgpt.com%2Fshare%2F${e.share_id}" target="_blank" rel="noopener noreferrer">
          <div>
            <svg width="40" height="40" viewBox="0 0 40 40" fill="none"
              xmlns="http://www.w3.org/2000/svg">
              <rect width="40" height="40" rx="20" fill="var(--main-surface-secondary)"></rect>
              <path d="M29.375 20.0349C29.375 14.8374 25.1782 10.625 20 10.625C14.8218 10.625 10.625 14.8374 10.625 20.0349C10.625 24.4458 13.6536 28.151 17.7368 29.1692V22.9094H15.8032V20.0349H17.7368V18.7962C17.7368 15.5946 19.1797 14.1096 22.3145 14.1096C22.9077 14.1096 23.9331 14.2272 24.3542 14.3449V16.9473C24.1345 16.9252 23.75 16.9105 23.2703 16.9105C21.7322 16.9105 21.1389 17.495 21.1389 19.0131V20.0349H24.2004L23.6731 22.9094H21.1353V29.375C25.7788 28.8126 29.375 24.8465 29.375 20.0349Z" fill="var(--text-secondary)"></path>
            </svg>
          </div>
        </a>
        <span class="mt-1 text-xs font-semibold text-token-text-tertiary">Facebook</span>
      </div>
      <div class="flex flex-col items-center">
        <a href="https://www.reddit.com/submit?url=https%3A%2F%2Fchatgpt.com%2Fshare%2F${e.share_id}&amp;title=User%20Request%3A%20Summarize%20Above%0AModel%20Response%3A%20Title%20Creation" target="_blank" rel="noopener noreferrer">
          <div>
            <svg width="40" height="40" viewBox="0 0 40 40" fill="none"
              xmlns="http://www.w3.org/2000/svg">
              <rect width="40" height="40" rx="20" fill="var(--main-surface-secondary)"></rect>
              <path d="M24.5703 15.1641C23.5859 15.1641 22.7617 14.4805 22.543 13.5625C21.3477 13.7305 20.4258 14.7617 20.4258 16V16.0078C22.2773 16.0781 23.9648 16.5977 25.3047 17.4258C25.7969 17.0469 26.4141 16.8203 27.082 16.8203C28.6953 16.8203 30 18.125 30 19.7383C30 20.9023 29.3203 21.9062 28.332 22.375C28.2383 25.7656 24.543 28.4922 20.0039 28.4922C15.4648 28.4922 11.7773 25.7695 11.6797 22.3828C10.6875 21.918 10 20.9102 10 19.7383C10 18.125 11.3047 16.8203 12.918 16.8203C13.5898 16.8203 14.207 17.0469 14.7031 17.4297C16.0312 16.6055 17.7031 16.0859 19.5352 16.0078V15.9961C19.5352 14.2656 20.8516 12.8359 22.5352 12.6562C22.7266 11.7109 23.5625 11 24.5703 11C25.7188 11 26.6523 11.9336 26.6523 13.082C26.6523 14.2305 25.7188 15.1641 24.5703 15.1641ZM16.1523 19.7227C15.3359 19.7227 14.6328 20.5352 14.582 21.5938C14.5312 22.6523 15.25 23.082 16.0664 23.082C16.8828 23.082 17.4961 22.6992 17.543 21.6406C17.5898 20.582 16.9688 19.7227 16.1484 19.7227H16.1523ZM25.4297 21.5898C25.3828 20.5312 24.6797 19.7188 23.8594 19.7188C23.0391 19.7188 22.418 20.5781 22.4648 21.6367C22.5117 22.6953 23.125 23.0781 23.9414 23.0781C24.7578 23.0781 25.4766 22.6484 25.4258 21.5898H25.4297ZM23.082 24.3555C23.1406 24.2148 23.043 24.0547 22.8906 24.0391C21.9922 23.9492 21.0195 23.8984 20.0078 23.8984C18.9961 23.8984 18.0234 23.9492 17.125 24.0391C16.9727 24.0547 16.875 24.2148 16.9336 24.3555C17.4375 25.5586 18.625 26.4023 20.0078 26.4023C21.3906 26.4023 22.5781 25.5586 23.082 24.3555Z" fill="var(--text-secondary)"></path>
            </svg>
          </div>
        </a>
        <span class="mt-1 text-xs font-semibold text-token-text-tertiary">Reddit</span>
      </div>
      <div class="flex flex-col items-center">
        <a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fchatgpt.com%2Fshare%2F${e.share_id}" target="_blank" rel="noopener noreferrer">
          <div>
            <svg width="40" height="40" viewBox="0 0 40 40" fill="none"
              xmlns="http://www.w3.org/2000/svg">
              <rect width="40" height="40" rx="20" fill="var(--main-surface-secondary)"></rect>
              <path d="M23.989 13.377H26.2902L21.2641 19.1201L27.1768 26.9363H22.5483L18.9206 22.197L14.7745 26.9363H12.4701L17.8449 20.7922L12.1768 13.377H16.9225L20.1983 17.7088L23.989 13.377ZM23.1807 25.5608H24.4551L16.2283 14.6807H14.8593L23.1807 25.5608Z" fill="var(--text-secondary)"></path>
            </svg>
          </div>
        </a>
        <span class="mt-1 text-xs font-semibold text-token-text-tertiary">X</span>
      </div>
    </div>
  </div>
</div>`,addShareModalPostShareContentEventListener(e)}function addShareModalPostShareContentEventListener(e){const t=document.querySelector("#share-modal-wrapper");document.querySelector("#share-modal-close-button").addEventListener("click",()=>{t.remove()}),document.querySelector("#copy-share-button").addEventListener("click",()=>{navigator.clipboard.writeText(e.share_url),toast("Copied shared conversation URL to clipboard!")});const o=document.querySelector("#make-chat-discoverable-button"),r=document.querySelector("#make-chat-discoverable-icon");o.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation(),closeMenus();const i=o.getAttribute("data-checked")==="true";o.style.pointerEvents="none",o.style.opacity="0.5",r.innerHTML='<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="animate-spin text-center icon icon-md text-token-text-tertiary" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><line x1="12" y1="2" x2="12" y2="6"></line><line x1="12" y1="18" x2="12" y2="22"></line><line x1="4.93" y1="4.93" x2="7.76" y2="7.76"></line><line x1="16.24" y1="16.24" x2="19.07" y2="19.07"></line><line x1="2" y1="12" x2="6" y2="12"></line><line x1="18" y1="12" x2="22" y2="12"></line><line x1="4.93" y1="19.07" x2="7.76" y2="16.24"></line><line x1="16.24" y1="7.76" x2="19.07" y2="4.93"></line></svg>',shareConv({...e,is_discoverable:!i}).then(a=>{o.style.pointerEvents="auto",o.style.opacity="1",o.setAttribute("data-checked",a.is_discoverable),r.innerHTML=a.is_discoverable?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="text-token-text-primary"><path fill="currentColor" d="M8.759 3h6.482c.805 0 1.47 0 2.01.044.563.046 1.08.145 1.565.392a4 4 0 0 1 1.748 1.748c.247.485.346 1.002.392 1.564C21 7.29 21 7.954 21 8.758v6.483c0 .805 0 1.47-.044 2.01-.046.563-.145 1.08-.392 1.565a4 4 0 0 1-1.748 1.748c-.485.247-1.002.346-1.564.392-.541.044-1.206.044-2.01.044H8.758c-.805 0-1.47 0-2.01-.044-.563-.046-1.08-.145-1.565-.392a4 4 0 0 1-1.748-1.748c-.247-.485-.346-1.002-.392-1.564C3 16.71 3 16.046 3 15.242V8.758c0-.805 0-1.47.044-2.01.046-.563.145-1.08.392-1.565a4 4 0 0 1 1.748-1.748c.485-.247 1.002-.346 1.564-.392C7.29 3 7.954 3 8.758 3m7.809 6.325a1 1 0 1 0-1.636-1.15L10.9 13.904l-1.66-1.827a1 1 0 0 0-1.48 1.346l2.5 2.75a1 1 0 0 0 1.558-.097z"></path></svg>':'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M8.759 3h6.482c.805 0 1.47 0 2.01.044.563.046 1.08.145 1.565.392a4 4 0 0 1 1.748 1.748c.247.485.346 1.002.392 1.564C21 7.29 21 7.954 21 8.758v6.483c0 .805 0 1.47-.044 2.01-.046.563-.145 1.08-.392 1.565a4 4 0 0 1-1.748 1.748c-.485.247-1.002.346-1.564.392-.541.044-1.206.044-2.01.044H8.758c-.805 0-1.47 0-2.01-.044-.563-.046-1.08-.145-1.565-.392a4 4 0 0 1-1.748-1.748c-.247-.485-.346-1.002-.392-1.564C3 16.71 3 16.046 3 15.242V8.758c0-.805 0-1.47.044-2.01.046-.563.145-1.08.392-1.565a4 4 0 0 1 1.748-1.748c.485-.247 1.002-.346 1.564-.392C7.29 3 7.954 3 8.758 3M6.91 5.038c-.438.035-.663.1-.819.18a2 2 0 0 0-.874.874c-.08.156-.145.38-.18.819C5 7.361 5 7.943 5 8.8v6.4c0 .857 0 1.439.038 1.889.035.438.1.663.18.819a2 2 0 0 0 .874.874c.156.08.38.145.819.18C7.361 19 7.943 19 8.8 19h6.4c.857 0 1.439 0 1.889-.038.438-.035.663-.1.819-.18a2 2 0 0 0 .874-.874c.08-.156.145-.38.18-.819.037-.45.038-1.032.038-1.889V8.8c0-.857 0-1.439-.038-1.889-.035-.438-.1-.663-.18-.819a2 2 0 0 0-.874-.874c-.156-.08-.38-.145-.819-.18C16.639 5 16.057 5 15.2 5H8.8c-.857 0-1.439 0-1.889.038"></path></svg>'})})}let lastLanguageCodeInConversation=null,lastToneCodeInConversation=null,lastWritingStyleCodeInConversation=null;window.localStorage.setItem("sp/lastInstruction",null),window.localStorage.setItem("sp/instructionsCache","{}");function resetInstructions(){lastLanguageCodeInConversation=null,lastToneCodeInConversation=null,lastWritingStyleCodeInConversation=null,window.localStorage.setItem("sp/lastInstruction",null)}function addInstructionDropdowns(e){const{autoResetTopNav:t,selectedLanguage:o,selectedTone:r,selectedWritingStyle:n,showLanguageSelector:i,showToneSelector:a,showWritingStyleSelector:s}=cachedSettings;let l=t||!i?languageList.find(u=>u.code==="default"):o,d=t||!a?toneList.find(u=>u.code==="default"):r,c=t||!s?writingStyleList.find(u=>u.code==="default"):n;l=lastLanguageCodeInConversation?languageList.find(u=>u.code===lastLanguageCodeInConversation):l,d=lastToneCodeInConversation?toneList.find(u=>u.code===lastToneCodeInConversation):d,c=lastWritingStyleCodeInConversation?writingStyleList.find(u=>u.code===lastWritingStyleCodeInConversation):c,chrome.storage.local.set({settings:{...cachedSettings,selectedLanguage:l,selectedTone:d,selectedWritingStyle:c}},()=>{const u=document.createElement("div");u.id="tone-selector-wrapper",u.style=`position:relative;width:150px;margin-left:8px;display:${cachedSettings.showToneSelector?"block":"none"}`,u.innerHTML=dropdown("Tone",toneList,d,"code","right"),e.appendChild(u);const m=document.createElement("div");m.id="writing-style-selector-wrapper",m.style=`position:relative;width:150px;margin-left:8px;display:${cachedSettings.showWritingStyleSelector?"block":"none"}`,m.innerHTML=dropdown("Writing-Style",writingStyleList,c,"code","right"),e.appendChild(m);const g=document.createElement("div");g.id="language-selector-wrapper",g.style=`position:relative;width:150px;margin-left:8px;display:${cachedSettings.showLanguageSelector?"block":"none"}`,g.innerHTML=dropdown("Language",languageList,l,"code","right"),e.appendChild(g),addDropdownEventListener("Tone",toneList,"code",()=>generateInstructions()),addDropdownEventListener("Writing-Style",writingStyleList,"code",()=>generateInstructions()),addDropdownEventListener("Language",languageList,"code",()=>generateInstructions()),generateInstructions()})}const throttleReplaceAllInstructionsInConversation=throttle(()=>{replaceAllInstructionsInConversation()});function replaceAllInstructionsInConversation(){const e=getConversationIdFromUrl(),t=document.querySelector("main");if(!t)return;const o=t.querySelectorAll("article");if(e&&o.length===0)return;const r=t.querySelectorAll('article div[data-message-author-role="user"]');if(!(e&&r.length===0)&&!(r.length>0&&!r[r.length-1]?.querySelector("div.whitespace-pre-wrap")?.innerText)){if(r.length>0){const n=JSON.parse(window.localStorage.getItem("sp/instructionsCache")||"{}");for(let i=0;i<r.length;i+=1){const a=r[i];if(a.innerText.match(/^## Instructions[\s\S]*?## End Instructions\n\n/m)||n[a.getAttribute("data-message-id")]){const s=replaceInstructionsInMessage(a,n);s&&(lastLanguageCodeInConversation=s.match(/\(languageCode: (.*)\)/)?.[1]||lastLanguageCodeInConversation,lastToneCodeInConversation=s.match(/\(toneCode: (.*)\)/)?.[1]||lastToneCodeInConversation,lastWritingStyleCodeInConversation=s.match(/\(writingStyleCode: (.*)\)/)?.[1]||lastWritingStyleCodeInConversation)}}}initializeNavbar()}}function replaceInstructionsInMessage(e,t=null){const o=e.parentElement.querySelector("#message-instructions");if(o&&o.remove(),!e)return"";let r=t;r||(r=JSON.parse(window.localStorage.getItem("sp/instructionsCache")||"{}"));const n=(r[e.getAttribute("data-message-id")]||null||e.innerText).match(/^## Instructions[\s\S]*?## End Instructions\n\n/m)?.[0];return n?(e.querySelector("div.whitespace-pre-wrap").innerText=e.querySelector("div.whitespace-pre-wrap").innerText.replace(/^## Instructions[\s\S]*?## End Instructions\n\n/m,""),addInstructionIndicators(e,n),n):""}function addInstructionIndicators(e,t){if(!t||!e)return;const o=e.getAttribute("data-message-id"),r=t.match(/\(languageCode: (.*)\)/)?.[1]||null,n=t.match(/\(toneCode: (.*)\)/)?.[1]||null,i=t.match(/\(writingStyleCode: (.*)\)/)?.[1]||null,a=languageList.find(c=>c.code===r)?.name,s=toneList.find(c=>c.code===n)?.name,l=writingStyleList.find(c=>c.code===i)?.name;if(e.parentElement.querySelector("#message-instructions"))return;const d=`<div id="message-instructions" class="absolute flex" style="bottom:0px; left:0px;">
      ${a?`<div id="language-code-hint-${o}" data-code="${r}" title="You changed the response language here. This prompt includes a hidden language instructions" class="h-6 p-2 me-1 flex items-center justify-center rounded-md border text-xs text-token-text-tertiary border-token-border-medium bg-token-main-surface-secondary">Language: &nbsp<b>${a}</b></div>`:""}
      ${s?`<div id="tone-code-hint-${o}" data-code="${n}" title="You changed the response tone here. This prompt includes a hidden tone instructions" class="h-6 p-2 me-1 flex items-center justify-center rounded-md border text-xs text-token-text-tertiary border-token-border-medium bg-token-main-surface-secondary">Tone: &nbsp<b>${s}</b></div>`:""}
      ${l?`<div id="writing-style-code-hint-${o}" data-code="${i}" title="You changed the response writing style here. This prompt includes a hidden writing style instructions" class="h-6 p-2 me-1 flex items-center justify-center rounded-md border text-xs text-token-text-tertiary border-token-border-medium bg-token-main-surface-secondary">Writing Style: &nbsp<b>${l}</b></div>`:""}
    </div>`;(r||n||i)&&e.parentElement.insertAdjacentHTML("beforeend",d)}async function generateInstructions(e=!1){const{selectedLanguage:t={code:"default",name:"Default"},selectedTone:o={code:"default",name:"Default"},selectedWritingStyle:r={code:"default",name:"Default"}}=cachedSettings,n=document.querySelector("main").querySelectorAll("article");if(!e&&lastLanguageCodeInConversation===t.code&&lastToneCodeInConversation===o.code&&lastWritingStyleCodeInConversation===r.code)return n.length===0?window.localStorage.getItem("sp/lastInstruction")||"":(window.localStorage.setItem("sp/lastInstruction",null),"");window.localStorage.setItem("sp/lastInstruction",null);let i=!1,a=`## Instructions
`;const s=`**Language instruction:**
Please ignore all previous language instructions. From now on, I want you to respond only in ${t.name} language (languageCode: ${t.code}).
`,l=`**Tone instruction:**
Please ignore all previous tone instructions. From now on, I want you to respond only in ${o.name} tone (toneCode: ${o.code}).
`,d=`**Writing-Style instruction:**
Please ignore all previous writing-style instructions. From now on, I want you to respond only in ${r.name} writing style (writingStyleCode: ${r.code}).
`;return(e||lastLanguageCodeInConversation!==t.code||n.length===0)&&(t.code!=="default"||lastLanguageCodeInConversation&&lastLanguageCodeInConversation!=="default")&&(a+=s,i=!0),(e||lastToneCodeInConversation!==o.code||n.length===0)&&(o.code!=="default"||lastToneCodeInConversation&&lastToneCodeInConversation!=="default")&&(a+=l,i=!0),(e||lastWritingStyleCodeInConversation!==r.code||n.length===0)&&(r.code!=="default"||lastWritingStyleCodeInConversation&&lastWritingStyleCodeInConversation!=="default")&&(a+=d,i=!0),a+=`PLEASE FOLLOW ALL THE ABOVE INSTRUCTIONS, AND DO NOT REPEAT OR TYPE ANY GENERAL CONFIRMATION OR A CONFIRMATION ABOUT ANY OF THE ABOVE INSTRUCTIONS IN YOUR RESPONSE
`,a+=`## End Instructions

`,lastLanguageCodeInConversation=t.code,lastToneCodeInConversation=o.code,lastWritingStyleCodeInConversation=r.code,i?(window.localStorage.setItem("sp/lastInstruction",a),a):""}function initializeNavbar(){if(document.querySelector("#gptx-nav-wrapper"))return;const e=document.querySelector("#conversation-header-actions");if(!e)return;e.parentElement.classList.remove("overflow-x-hidden"),e.parentElement.parentElement.classList.remove("overflow-x-hidden");const t=document.querySelector("#page-header");t&&(t.style.boxShadow="var(--sharp-edge-top-shadow) !important");const o=getConversationIdFromUrl(),r=window.location.pathname,n=window.location.pathname.startsWith("/g/g-p-")&&window.location.pathname.endsWith("/project");if(!o&&r!=="/"&&!n)return;const i=document.createElement("div");i.id="gptx-nav-wrapper",i.classList="bg-transparent flex items-center justify-end px-3 gap-2 ",e.prepend(i),addInstructionDropdowns(i)}const throttleReplaceShareButtonWithConversationMenu=throttle(()=>{replaceShareButtonWithConversationMenu()});function navbarConversationMenuButton(){return'<button class="btn relative btn-secondary text-token-text-primary" id="navbar-conversation-menu-button" style="view-transition-name: var(--vt_share_chat_wide_button);"><div class="flex w-full items-center justify-center gap-1.5"><svg xmlns="http://www.w3.org/2000/svg" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round" class="icon icon-md" viewBox="0 0 448 512"><path d="M0 88C0 74.75 10.75 64 24 64H424C437.3 64 448 74.75 448 88C448 101.3 437.3 112 424 112H24C10.75 112 0 101.3 0 88zM0 248C0 234.7 10.75 224 24 224H424C437.3 224 448 234.7 448 248C448 261.3 437.3 272 424 272H24C10.75 272 0 261.3 0 248zM424 432H24C10.75 432 0 421.3 0 408C0 394.7 10.75 384 24 384H424C437.3 384 448 394.7 448 408C448 421.3 437.3 432 424 432z"></path></svg></div></button>'}function replaceShareButtonWithConversationMenu(){if(document.querySelector("#navbar-conversation-menu-button"))return;const e=document.querySelector("#gptx-nav-wrapper");if(e)e.insertAdjacentHTML("afterend",navbarConversationMenuButton());else{const r=document.querySelector("#conversation-header-actions");if(!r)return;r.insertAdjacentHTML("afterbegin",navbarConversationMenuButton())}const t=document.querySelector('[data-testid="share-chat-button"]');t&&t.classList.add("hidden");const o=document.querySelector("#page-header");o&&(o.style.backgroundColor="var(--main-surface-primary) !important")}function addConversationMenuButtonEventListener(){document.body.addEventListener("click",async e=>{const t=e.target.closest("button");if(!t||t.id!=="navbar-conversation-menu-button")return;e.preventDefault(),e.stopPropagation();const o=getConversationIdFromUrl(),r=await getConversationsByIds([o]),n=await chrome.runtime.sendMessage({type:"getConversation",detail:{conversationId:o}});showConversationManagerCardMenu(t,{...n,...r[0]},!1,!0)})}function createModal(e,t,o,r,n=!1,i="small",a=null,s=!1){const l=document.createElement("div");l.id=`modal-${e.toLowerCase().replaceAll(" ","-")}`,l.style="position:fixed;top:0;left:0;width:100vw;height:100vh;display:flex;justify-content:center;align-items:center;z-index:10000;",l.classList="bg-black/50 dark:bg-black/80";const d=document.createElement("div");d.style="border-radius: 8px; display: flex; flex-direction: row; box-shadow: rgb(0 0 0 / 72%) 0px 0px 20px 0px",d.classList="bg-white dark:bg-black text-token-text-primary",s?(d.style.maxWidth="none",d.style.width="100vw",d.style.height="100vh"):(d.style.maxWidth="1400px",d.style.width=window.innerWidth>780?i==="small"?"65vw":"90vw":"100vw",d.style.height=window.innerWidth>780?i==="small"?"80vh":"90vh":"80vh"),d.id=`modal-wrapper-${e.toLowerCase().replaceAll(" ","-")}`,l.appendChild(d),l.addEventListener("mousedown",w=>{document.querySelector(`[id="modal-wrapper-${e.toLowerCase().replaceAll(" ","-")}"]`).contains(w.target)||(closeMenus(),window.location.hash="",l.remove())}),window.addEventListener("resize",()=>{d.style.width=window.innerWidth>780?i==="small"?"65vw":"90vw":"100vw",d.style.height=window.innerWidth>780?i==="small"?"80vh":"90vh":"80vh"});const c=document.createElement("div");c.id="modal-sidetab",c.classList="bg-token-sidebar-surface-secondary rounded-s-md",c.style="width: 64px; border-radius: 8px 0 0 8px; display: flex; flex-direction: column; justify-content: start; align-items: start; align-items: start;",a&&(c.appendChild(a),d.appendChild(c));const u=document.createElement("div");u.id="modal-main",u.classList=`bg-token-sidebar-surface-primary ${a?"rounded-e-md":"rounded-md"}`,u.style=`display: flex; flex-direction: column; justify-content: space-between; padding: 16px; width: calc(100% - ${a?"64px":"0px"}); height: 100%;`,d.appendChild(u);const m=document.createElement("div");m.style="display: flex; justify-content: space-between; align-items: center;";const g=document.createElement("div");g.style="display: flex; align-items: start; flex-direction: column;",m.appendChild(g);const p=document.createElement("div");p.id="modal-title",p.style="font-size: 1.5em;",p.classList="text-token-text-primary",p.innerHTML=translate(e),g.appendChild(p);const h=document.createElement("div");h.id="modal-subtitle",h.classList="text-xs text-token-text-tertiary my-1",h.innerHTML=t,g.appendChild(h);const f=document.createElement("div");f.style="display: flex; align-items: center;",m.appendChild(f);const v=document.createElement("button");v.id=`modal-fullscreen-button-${e.toLowerCase().replaceAll(" ","-")}`,v.classList="me-2 p-2 rounded-lg text-token-text-tertiary focus-visible:outline-0 hover:bg-token-sidebar-surface-secondary focus-visible:bg-token-sidebar-surface-secondary",v.innerHTML=s?'<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="icon icon-md" viewBox="0 0 512 512"><path d="M488.1 23.03c-9.375-9.375-24.56-9.375-33.94 0l-81.38 81.38l-47.03-47.03c-6.127-6.117-14.3-9.35-22.63-9.35c-4.117 0-8.275 .7918-12.24 2.413c-11.97 4.953-19.75 16.63-19.75 29.56v135.1c0 13.25 10.74 23.1 24 23.1h136c12.94 0 24.63-7.797 29.56-19.75c4.969-11.97 2.219-25.72-6.938-34.87l-47.04-47.03l81.38-81.38C498.3 47.59 498.3 32.41 488.1 23.03zM215.1 272h-136c-12.94 0-24.63 7.797-29.56 19.75C45.47 303.7 48.22 317.5 57.37 326.6l47.04 47.03l-81.38 81.38c-9.375 9.375-9.375 24.56 0 33.94s24.56 9.375 33.94 0l81.38-81.38l47.03 47.03c6.127 6.117 14.29 9.367 22.63 9.367c4.117 0 8.279-.8086 12.25-2.43c11.97-4.953 19.75-16.63 19.75-29.56V296C239.1 282.7 229.3 272 215.1 272z"/></svg>':'<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="icon icon-md" viewBox="0 0 512 512"><path d="M183 295l-81.38 81.38l-47.03-47.03c-6.127-6.117-14.29-9.367-22.63-9.367c-4.117 0-8.279 .8086-12.25 2.43c-11.97 4.953-19.75 16.63-19.75 29.56v135.1C.0013 501.3 10.75 512 24 512h136c12.94 0 24.63-7.797 29.56-19.75c4.969-11.97 2.219-25.72-6.938-34.87l-47.03-47.03l81.38-81.38c9.375-9.375 9.375-24.56 0-33.94S192.4 285.7 183 295zM487.1 0h-136c-12.94 0-24.63 7.797-29.56 19.75c-4.969 11.97-2.219 25.72 6.938 34.87l47.04 47.03l-81.38 81.38c-9.375 9.375-9.375 24.56 0 33.94s24.56 9.375 33.94 0l81.38-81.38l47.03 47.03c6.127 6.117 14.3 9.35 22.63 9.35c4.117 0 8.275-.7918 12.24-2.413C504.2 184.6 512 172.9 512 159.1V23.1C512 10.75 501.3 0 487.1 0z"/></svg>',v.addEventListener("click",()=>{const w=document.querySelector('[id="modal-body"]'),k=document.querySelector(`[id="modal-wrapper-${e.toLowerCase().replaceAll(" ","-")}"]`);if(k.style.width==="100vw"&&k.style.height==="100vh"){v.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="icon icon-md" viewBox="0 0 512 512"><path d="M183 295l-81.38 81.38l-47.03-47.03c-6.127-6.117-14.29-9.367-22.63-9.367c-4.117 0-8.279 .8086-12.25 2.43c-11.97 4.953-19.75 16.63-19.75 29.56v135.1C.0013 501.3 10.75 512 24 512h136c12.94 0 24.63-7.797 29.56-19.75c4.969-11.97 2.219-25.72-6.938-34.87l-47.03-47.03l81.38-81.38c9.375-9.375 9.375-24.56 0-33.94S192.4 285.7 183 295zM487.1 0h-136c-12.94 0-24.63 7.797-29.56 19.75c-4.969 11.97-2.219 25.72 6.938 34.87l47.04 47.03l-81.38 81.38c-9.375 9.375-9.375 24.56 0 33.94s24.56 9.375 33.94 0l81.38-81.38l47.03 47.03c6.127 6.117 14.3 9.35 22.63 9.35c4.117 0 8.275-.7918 12.24-2.413C504.2 184.6 512 172.9 512 159.1V23.1C512 10.75 501.3 0 487.1 0z"/></svg>',k.style.maxWidth="1400px",k.style.width=window.innerWidth>780?i==="small"?"60vw":"90vw":"100vw",k.style.height=window.innerWidth>780?i==="small"?"80vh":"90vh":"80vh";return}v.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="icon icon-md" viewBox="0 0 512 512"><path d="M488.1 23.03c-9.375-9.375-24.56-9.375-33.94 0l-81.38 81.38l-47.03-47.03c-6.127-6.117-14.3-9.35-22.63-9.35c-4.117 0-8.275 .7918-12.24 2.413c-11.97 4.953-19.75 16.63-19.75 29.56v135.1c0 13.25 10.74 23.1 24 23.1h136c12.94 0 24.63-7.797 29.56-19.75c4.969-11.97 2.219-25.72-6.938-34.87l-47.04-47.03l81.38-81.38C498.3 47.59 498.3 32.41 488.1 23.03zM215.1 272h-136c-12.94 0-24.63 7.797-29.56 19.75C45.47 303.7 48.22 317.5 57.37 326.6l47.04 47.03l-81.38 81.38c-9.375 9.375-9.375 24.56 0 33.94s24.56 9.375 33.94 0l81.38-81.38l47.03 47.03c6.127 6.117 14.29 9.367 22.63 9.367c4.117 0 8.279-.8086 12.25-2.43c11.97-4.953 19.75-16.63 19.75-29.56V296C239.1 282.7 229.3 272 215.1 272z"/></svg>',k.style.maxWidth="none",k.style.width="100vw",k.style.height="100vh"}),n&&f.appendChild(v);const x=document.createElement("button");x.id=`modal-close-button-${e.toLowerCase().replaceAll(" ","-")}`,x.classList="text-xs text-token-text-tertiary border border-token-border-medium rounded-md px-3 py-2 hover:bg-token-main-surface-secondary cursor-pointer hover:text-token-text-primary",x.textContent=translate("Close"),x.addEventListener("click",()=>{closeMenus(),window.location.hash="",l.remove()}),f.appendChild(x),u.appendChild(m);const y=document.createElement("div");y.id="modal-body",y.classList=" text-token-text-primary flex flex-col justify-between rounded-md h-full relative border border-token-border-medium",y.style="overflow-y: hidden;",y.appendChild(o),u.appendChild(y);const b=document.createElement("div");b.id="modal-action-bar",b.style="display: flex; justify-content: start; 8px; ",b.appendChild(r),u.appendChild(b),document.body.appendChild(l)}const articleObservers=[];let lastConvIDForMinimap=null;const debounceCreateConversationMiniMap=debounce((e=!1)=>{createConversationMiniMap(e)},500);function removeMiniMap(){const e=document.querySelector("#minimap-wrapper");e&&e.remove(),articleObservers?.forEach(t=>{t.disconnect()})}async function createConversationMiniMap(e=!1){const t=document.querySelector("#minimap-wrapper");if(!cachedSettings?.showMiniMap){removeMiniMap();return}const o=getConversationIdFromUrl();if(!o){t?.remove();return}if(t&&o===lastConvIDForMinimap&&!e)return;lastConvIDForMinimap=o;const r=await getConversationsByIds([o]),n=document.createElement("div"),i=document.querySelector('div[class*="@container/main"]');if(!i)return;n.id="minimap-wrapper",n.classList="absolute top-0 start-0 z-50 flex flex-col items-start transition-all duration-300",n.style.padding="60px 0 170px 0",n.style.height="100%";const a=i.querySelectorAll("article"),s=isDarkMode();removeMiniMap(),a.forEach(l=>{const d=l.querySelector("div[data-message-author-role]");if(!d)return;const c=d?.dataset?.messageId;if(!c)return;d.firstChild&&d.firstChild.firstChild&&(d.firstChild.firstChild.style.maxWidth="100%");const u=d?.dataset?.messageAuthorRole==="user",m=document.createElement("div");m.id=`mini-article-wrapper-${c}`,m.classList=`flex flex-col relative ${u?"pt-1.5":"pt-0.5"}`,m.style.height=`${Math.max(l.offsetHeight*(i.offsetHeight-240)/l.parentElement.offsetHeight,10)}%`,m.addEventListener("click",()=>{flashArticle(l,"up")}),m.addEventListener("mouseenter",()=>{if(m.querySelector("#floating-article-preview"))return;const h=document.createElement("div");h.id="floating-article-preview",h.classList=`absolute top-0 start-6 z-50 p-3 pb-8 bg-token-main-surface-secondary rounded-md shadow-md overflow-hidden text-xs border border-token-border-medium ${u?"mt-1.5":"mt-0.5"}`,h.style.width="500px",h.style.maxWidth="90vw",h.style.minHeight="100px",h.style.height=`${Math.min(Math.max(d?.parentElement.offsetHeight,d.firstChild.offsetHeight),300)}px`,h.style.maxHeight=`${Math.max(m.offsetHeight,300)}px`;const f=d?.parentElement?.cloneNode(!0);f&&(f.style.width="100%",f.style.height="100%",f.style.overflow="scroll",h.appendChild(f)),h.querySelectorAll(".relative").forEach(L=>{L.classList.remove("max-w-[var(--user-chat-width,70%)]","px-5","py-2.5","bg-token-message-surface")}),h.querySelectorAll('#message-char-word-counter, #message-timestamp, #message-instructions, div[id^="message-actions-"]').forEach(L=>{L.remove()}),h.querySelector("div[data-message-author-role]")?.classList.remove("bottom-fade-blur"),m.appendChild(h),adjustMenuPosition(document.querySelector("#floating-article-preview"));const v=document.createElement("div");v.classList="absolute bottom-0 start-0 end-0 h-24",v.style.maxHeight="50%",s?v.style.background="linear-gradient(180deg, rgba(0, 0, 0, 0), rgba(10, 10, 10, 1))":v.style.background="linear-gradient(180deg, rgba(255, 255, 255, 0), rgba(255, 255, 255, 1))";const x=document.createElement("div");x.classList="flex items-end justify-end gap-2 text-xs text-token-text-tertiary w-full h-full p-2",v.appendChild(x);const y=l.querySelectorAll("div[data-message-author-role]"),b=y[y.length-1]?.dataset.messageId,w=r[0]?.mapping[b],k=formatDate(w?new Date(formatTime(w?.message?.create_time)):new Date),S=document.createElement("div");S.innerHTML=`${k} <span style="margin: 0 8px;">\u2022</span>`,x.appendChild(S);const M=h?.firstChild?.innerText||"",$=getCharCount(M),q=getWordCount(M),E=`${$} chars \u2022 ${q} words`,C=document.createElement("div");C.textContent=E,x.appendChild(C),h.appendChild(v)}),m.addEventListener("mouseleave",()=>{document.querySelectorAll("#floating-article-preview").forEach(h=>{h.remove()})});const g=l.classList.contains("bg-pinned"),p=document.createElement("div");p.id=`mini-article-${c}`,p.classList=`${g?"bg-gold":"bg-token-main-surface-tertiary"} w-4 hover:w-6 ${u?"rounded-te-md":"rounded-be-md"} cursor-pointer transition-all duration-300 ms-auto h-full`,m.appendChild(p),n.appendChild(m)}),i.appendChild(n)}function highlightMiniMap(e){const t=document.querySelector(`#minimap-wrapper #mini-article-${e}`);t&&t.classList.replace("bg-token-main-surface-tertiary","bg-gold")}function unHighlightMiniMap(e){const t=document.querySelector(`#minimap-wrapper #mini-article-${e}`);t&&t.classList.replace("bg-gold","bg-token-main-surface-tertiary")}function observeArticle(e){const t=new IntersectionObserver(o=>{o.forEach(r=>{const n=e.querySelector("div[data-message-author-role]")?.dataset?.messageId;if(!n)return;const i=document.querySelectorAll('#minimap-wrapper div[id^="mini-article-"]'),a=document.querySelector(`#minimap-wrapper #mini-article-${n}`);a&&(r.isIntersecting?(i.forEach(s=>{s.classList.replace("w-6","w-4")}),a.classList.replace("w-4","w-6")):a.classList.replace("w-6","w-4"))})},{threshold:e.offsetHeight>window.innerHeight?.1:1});articleObservers.push(t),t.observe(e)}const titleMap={general:"Announcement",newsletter:"Newsletter"},subtitleMap={general:"You can see the latest announcement here",newsletter:"Daily dose of AI news and resources from the community"};function createAnnouncementModal(e,t=""){const o=announcementModalContent(e,t),r=announcementModalActions(e),n=titleMap[e.category],i=subtitleMap[e.category],a=new Date(e.release_date);createModal(n,`${i} (${new Date(a.getTime()+a.getTimezoneOffset()*6e4).toDateString()}${e.link?` - <a href="${e.link}" target="_blank" rel="noopener noreferrer" class="underline">Read Online</a>`:""})`,o,r,!0)}function announcementModalContent(e,t=""){const o=document.createElement("div");o.id=`modal-content-${e.category}`,o.tabIndex=0,o.style="position:relative;height:100%;overflow-y:auto;",o.classList="markdown prose-invert";const r=document.createElement("base");r.target="_blank",o.appendChild(r);const n=document.createElement("img");n.src=chrome.runtime.getURL("icons/logo.png"),n.style="position: fixed; top: 50%; right: 50%; width: 400px; height: 400px; opacity: 0.07; transform: translate(50%, -50%);box-shadow:none !important;",o.appendChild(n);const i=document.createElement("article");i.style="display: flex; flex-direction: column; justify-content: start; align-items: start; min-height: 100%; width: 100%; white-space: break-spaces; overflow-wrap: break-word;position: relative;z-index:10;";const a=e,s=a.text.replace(/href="([^"]*)"/g,'href="$1?ref=superpower-chatgpt-extension"').replace(/\{\{email\}\}/g,t);return i.innerHTML=a.category==="newsletter"?s:`<h1 style="margin-bottom: 24px; ">${a.title}</h1>${a.text}`,o.appendChild(i),o.addEventListener("click",()=>{chrome.runtime.sendMessage({type:"incrementClickRate",forceRefresh:!0,detail:{announcementId:e.id}})}),o}function announcementModalActions(e){const t=document.createElement("div");if(t.classList="flex items-center justify-between mt-3 w-full",e.category==="newsletter"){const o=document.createElement("input");o.type="checkbox",o.id="hide-newsletter-checkbox",o.classList="me-2 cursor-pointer w-3 h-3",o.checked=cachedSettings?.hideNewsletter||!1,o.addEventListener("change",i=>{chrome.storage.local.set({settings:{...cachedSettings,hideNewsletter:i.target.checked}})});const r=document.createElement("label");r.htmlFor="hide-newsletter-checkbox",r.textContent="Don\u2019t show me this newsletter again",r.classList="text-xs text-token-text-secondary";const n=document.createElement("div");n.classList="flex items-center justify-start",n.appendChild(o),n.appendChild(r),t.appendChild(n)}return t}function initializeAnnouncement(){setTimeout(()=>{chrome.storage.sync.get(["lastSeenAnnouncementId","email"],e=>{chrome.storage.local.get(["hasSubscription","readNewsletterIds","lastNewsletterId","installDate"],t=>{const{lastSeenAnnouncementId:o,email:r}=e,n=t.readNewsletterIds||[];chrome.runtime.sendMessage({type:"getLatestAnnouncement"},i=>{if(i&&i.id&&o!==i.id)createAnnouncementModal(i),chrome.storage.sync.set({lastSeenAnnouncementId:i.id}),chrome.runtime.sendMessage({type:"incrementOpenRate",detail:{announcementId:i.id}});else{if(typeof t.installDate>"u"||t.installDate&&new Date-new Date(t.installDate)<1728e5)return;chrome.runtime.sendMessage({type:"getLatestNewsletter"},a=>{if(!(!a||!a.id)&&(n.includes(a.id)||cachedSettings?.hideNewsletter||(createAnnouncementModal(a,r),chrome.storage.local.set({readNewsletterIds:[a.id,...n.slice(0,100)]}),chrome.runtime.sendMessage({type:"incrementOpenRate",detail:{announcementId:a.id}})),t.lastNewsletterId!==a.id&&!t.hasSubscription&&a.promo_links?.length>0&&Math.random()>.5)){const s=a.promo_links[Math.floor(Math.random()*a.promo_links.length)];if(!s)return;const l=Math.floor(Math.random()*9e4)+3e4;setTimeout(()=>{chrome.runtime.sendMessage({type:"openPromoLink",forceRefresh:!0,detail:{link:s}},()=>{chrome.storage.local.set({lastNewsletterId:a.id}),chrome.runtime.sendMessage({type:"incrementPromoLinkClickRate",forceRefresh:!0,detail:{announcementId:a.id,promoLink:s}})})},l)}})}})})})},12e4)}function createReleaseNoteModal(e,t=!1){chrome.runtime.sendMessage({type:"getReleaseNote",detail:{version:e}},o=>{if(!o||t&&o.skip)return;const r=releaseNoteModalContent(e,o),n=releaseNoteModalActions();createModal(`Release note (v ${e})`,"You can see the latest changes here",r,n,!0)})}function releaseNoteModalContent(e,t){const o=document.createElement("div");o.id=`modal-content-release-note-(v-${e})`,o.style="position: relative;height:100%;",o.classList="markdown prose-invert";const r=document.createElement("base");r.target="_blank",o.appendChild(r);const n=document.createElement("img");n.src=chrome.runtime.getURL("icons/logo.png"),n.style="position: fixed; top: 50%; right: 50%; width: 400px; height: 400px; opacity: 0.07; transform: translate(50%, -50%);box-shadow:none !important;",o.appendChild(n);const i=document.createElement("article");return i.style="display: flex; flex-direction: column; justify-content: start; align-items: start;height: 100%; width: 100%; white-space: break-spaces; overflow-wrap: break-word;position: relative;z-index:10;overflow-y:auto;",i.innerHTML=`<div style="font-size:1em;padding:8px 16px;width:100%;">Release date: ${new Date(t?.created_at||new Date).toDateString()} (<span id="previous-version" data-version="${t.previous_version}" style="cursor:pointer;text-decoration:underline;">Previous release note</span>)</div><div style="display: flex; flex-direction: column; justify-content: start; align-items: start;height: 100%; width: 100%; white-space: break-spaces; overflow-wrap: break-word;position: relative;z-index:10;padding:16px;">${t.text}</div>`,setTimeout(()=>{const a=document.querySelector("#previous-version");a&&a.addEventListener("click",()=>{document.querySelector(`button[id="modal-close-button-release-note-(v-${e})"]`).click(),createReleaseNoteModal(a.dataset.version)})},1e3),o.appendChild(i),o}function releaseNoteModalActions(){const e=document.createElement("div");e.style="display: flex; flex-wrap:wrap;justify-content: space-between; align-items: center;width: 100%; font-size: 12px;",e.appendChild(settingsModalActions());const t=document.createElement("input");t.type="checkbox",t.id="hide-release-note-checkbox",t.style="margin-right: 8px; width:12px; height:12px;",t.checked=cachedSettings?.hideReleaseNote||!1,t.addEventListener("change",n=>{chrome.storage.local.set({settings:{...cachedSettings,hideReleaseNote:n.target.checked}})});const o=document.createElement("label");o.htmlFor="hide-release-note-checkbox",o.textContent="Don\u2019t show release note when extension is updated",o.style="color: lightslategray;";const r=document.createElement("div");return r.style="display: flex; justify-content: flex-start; align-items: center; margin-left:48px;min-width:220px;",r.appendChild(t),r.appendChild(o),e.appendChild(r),e}function initializeReleaseNote(){setTimeout(()=>{const{version:e}=chrome.runtime.getManifest();chrome.storage.local.get(["installDate"],t=>{const{installDate:o}=t;typeof cachedSettings?.hideReleaseNote>"u"||cachedSettings?.hideReleaseNote||typeof o>"u"||o&&new Date-new Date(o)<1728e5||chrome.storage.sync.get(["lastSeenReleaseNoteVersion"],r=>{const{lastSeenReleaseNoteVersion:n}=r;n!==e&&(createReleaseNoteModal(e,!0),chrome.storage.sync.set({lastSeenReleaseNoteVersion:e},()=>{}))})})},6e4)}let lastSelectedNewsletterCardId=null;function loadNewsletterList(e=1){chrome.runtime.sendMessage({type:"getNewsletters",detail:{page:e}},t=>{const o=t.results;if(!o||!Array.isArray(o))return;const r=document.querySelector("#newsletter-list");chrome.storage.local.get(["readNewsletterIds"],a=>{const s=a.readNewsletterIds||[];for(let l=0;l<o.length;l+=1){const d=o[l],c=s.includes(d.id),u=createNewsletterCard(d,c);r.appendChild(u),!s.includes(d.id)&&l===0&&e===1&&u?.insertAdjacentElement("beforeend",animatePing("#ef4146"))}}),t.next&&r?.insertAdjacentHTML("beforeend",'<div id="newsletter-list-loading" style="font-size:1em;">Loading...</div>');const n=document.querySelector("#newsletter-list-loading"),i=new IntersectionObserver(a=>{a[0].isIntersecting&&(n.remove(),loadNewsletterList(e+1))},{threshold:.5});n&&i.observe(n)})}function createNewsletterCard(e,t=!1){const o=new Date(e.release_date),r=new Date(o.getTime()+o.getTimezoneOffset()*6e4),n=document.createElement("div");return n.id=`newsletter-card-${e.id}`,n.classList=`relative bg-token-main-surface-primary border border-token-border-medium rounded-md cursor-pointer hover:bg-token-main-surface-tertiary flex flex-col h-auto ${t?"opacity-50":""}`,n.style="height: max-content;outline-offset: 4px; outline: none;",n.innerHTML=`<div class="flex flex-col items-start justify-between border-b border-token-border-medium pb-1 flex-grow">
  
  <figure class="h-full overflow-hidden w-full"><img loading="eager" src="${e.thumbnail_url||"https://media.beehiiv.com/cdn-cgi/image/fit=scale-down,format=auto,onerror=redirect,quality=80/uploads/publication/logo/99fb7747-3ebe-4c53-9e43-47a744e8fa86/thumb_logo-bg.png"}" alt="${e.title}" class="rounded-t-md w-full h-full object-cover" style="max-height:150px;"></figure>

  <div class="flex items-start w-full break-all text-md p-2" style="min-height:100px;">${escapeHTML(e.title)}</div>
  </div>
  <div class="flex justify-between items-center p-2">
    <div class="flex items-center text-xs text-token-text-tertiary">
      ${r.toDateString()}
    </div>
    <div id="newsletter-card-action-right-${e.id}" class="flex items-center">
      <div class="flex items-center text-xs ${t?"visible":"invisible"}" id="newsletter-read-indicator">Read <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="icon icon-sm ms-2"><path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path></svg></div>
    </div>
  </div>`,n.addEventListener("click",i=>{i.preventDefault(),closeMenus(),updateSelectedNewsletterCard(e.id),chrome.runtime.sendMessage({type:"getNewsletter",detail:{id:e.id}},a=>{createAnnouncementModal(a),chrome.storage.local.get(["readNewsletterIds"],s=>{const l=s.readNewsletterIds||[];l.includes(e.id)||chrome.runtime.sendMessage({type:"incrementOpenRate",forceRefresh:!0,detail:{announcementId:e.id}}),chrome.storage.local.set({readNewsletterIds:[e.id,...l.slice(0,100)]},()=>{const d=document.querySelector(`#newsletter-card-${e.id}`);if(d.classList.add("opacity-50"),d&&d.querySelector("#ping")){d?.querySelector("#ping")?.remove();const c=document.querySelector("#modal-manager-side-tab-newsletters");c&&c?.querySelector("#ping")?.remove()}d.querySelector("#newsletter-read-indicator")?.classList?.replace("invisible","visible")})})})}),n}function updateSelectedNewsletterCard(e){if(lastSelectedNewsletterCardId){const o=document.querySelector(`#modal-manager #newsletter-card-${lastSelectedNewsletterCardId}`);o&&(o.style.outline="none")}if(!e)return;const t=document.querySelector(`#modal-manager #newsletter-card-${e}`);lastSelectedNewsletterCardId=e,t.style.outline=`2px solid ${isDarkMode()?"#fff":"#000"}`}function newsletterListModalContent(){lastSelectedNewsletterCardId=null;const e=document.createElement("div");e.id="modal-content-newsletter-list",e.style="overflow-y: hidden;position: relative;height:100%; width:100%;";const t=document.createElement("article");return t.id="newsletter-list",t.classList="grid grid grid-cols-1 gap-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 p-4 pb-32 overflow-y-auto h-full content-start",e.appendChild(t),e}function promptDropdown(){const e=document.createElement("div");e.id="favorite-prompts-dropdown-wrapper",e.style="max-height:300px;min-width:240px;max-width:fit-content;bottom:40px; left:0;z-index:200;",e.classList="hidden absolute z-10 end-0 overflow-auto rounded-lg text-base focus:outline-none dark:ring-white/20  text-sm -translate-x-1/4 bg-token-main-surface-secondary shadow-long";const t=document.createElement("div");t.classList="flex items-center text-token-text-primary font-bold relative cursor-pointer select-none p-2 py-3 bg-token-main-surface-tertiary sticky top-0 z-10",t.innerHTML=`<svg class="icon icon-md me-2" fill="gold" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M381.2 150.3L524.9 171.5C536.8 173.2 546.8 181.6 550.6 193.1C554.4 204.7 551.3 217.3 542.7 225.9L438.5 328.1L463.1 474.7C465.1 486.7 460.2 498.9 450.2 506C440.3 513.1 427.2 514 416.5 508.3L288.1 439.8L159.8 508.3C149 514 135.9 513.1 126 506C116.1 498.9 111.1 486.7 113.2 474.7L137.8 328.1L33.58 225.9C24.97 217.3 21.91 204.7 25.69 193.1C29.46 181.6 39.43 173.2 51.42 171.5L195 150.3L259.4 17.97C264.7 6.954 275.9-.0391 288.1-.0391C300.4-.0391 311.6 6.954 316.9 17.97L381.2 150.3z"/></svg> ${translate("Favorite Prompts")} <span class="flex items-center justify-center bg-white rounded-full h-4 w-4 ms-auto"><svg class="icon" style="width:12px;height:12px;" fill="#000" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M288 224H480C497.7 224 512 238.3 512 256C512 273.7 497.7 288 480 288H288V480C288 497.7 273.7 512 255.1 512C238.3 512 223.1 497.7 223.1 480V288H32C14.33 288 0 273.7 0 256C0 238.3 14.33 224 32 224H223.1V32C223.1 14.33 238.3 0 255.1 0C273.7 0 288 14.33 288 32V224z"/></svg></span>`,addTooltip(t,{value:"Create New Favorite Prompt",position:"right"}),t.addEventListener("click",()=>{openPromptEditorModal({title:"",steps:[""],is_favorite:!0})}),e.appendChild(t);const o=document.createElement("ul");return o.id="favorite-prompts-dropdown-list",o.classList="w-full h-full relative p-1",o.setAttribute("role","menu"),o.setAttribute("aria-orientation","vertical"),o.setAttribute("aria-labelledby","continue-conversation-dropdown-button"),o.setAttribute("tabindex","-1"),e.appendChild(o),document.body.addEventListener("click",r=>{const n=document.querySelector("#favorite-prompts-dropdown-wrapper");n?.classList?.contains("block")&&!r.target.closest("#continue-conversation-dropdown-button")&&n.classList.replace("block","hidden")}),e}function fetchFavoritePrompts(e=1){const t=document.querySelector("#favorite-prompts-dropdown-list");if(t){if(e===1)t.innerHTML="",t.appendChild(loadingSpinner("favorite-prompts-dropdown-list"));else{const o=document.querySelector("#load-more-prompts-button");o&&o.remove()}chrome.runtime.sendMessage({type:"getPrompts",detail:{pageNumber:e,sortBy:"alphabetical",isFavorite:!0,deepSearch:!1}},o=>{const r=o?.results;if(!r)return;const n=document.querySelector("#loading-spinner-favorite-prompts-dropdown-list");if(n&&n.remove(),r.length===0&&e===1){const i=document.createElement("p");i.classList="text-token-text-tertiary p-4",i.innerText=translate("No prompts found"),t.appendChild(i)}else if(r.forEach(i=>{const a=i.title,s=i.steps.map((u,m)=>`step ${m+1}:
${u}`).join(`
`),l=document.createElement("li");l.id=`continue-conversation-dropdown-item-${i.id}`,l.dir="auto",l.classList="text-token-text-primary relative cursor-pointer select-none p-2 rounded-lg";const d=document.createElement("span");d.classList="flex h-6 items-center justify-between text-token-text-primary";const c=document.createElement("span");c.style="text-transform: capitalize;",c.classList="truncate",c.innerText=a,d.appendChild(c),d.title=`${a}

${formatAttachmentsForPromptStep(s)}`,l.appendChild(d),l.setAttribute("role","option"),l.setAttribute("tabindex","-1"),l.addEventListener("mouseenter",async u=>{document.querySelectorAll("#prompt-action-menu").forEach(m=>m.remove()),document.querySelectorAll("#favorite-prompts-dropdown-list > li").forEach(m=>m.classList.remove("bg-token-main-surface-tertiary")),l.classList.add("bg-token-main-surface-tertiary"),showPromptActionMenu(u,i,l)}),l.addEventListener("click",async u=>{u.preventDefault(),u.stopPropagation()}),t.appendChild(l)}),o.next){const i=document.createElement("button");i.id="load-more-prompts-button",i.classList="p-2 cursor-pointer flex items-center justify-center h-auto relative",i.appendChild(loadingSpinner("load-more-prompts-button")),t.appendChild(i);const a=new IntersectionObserver(s=>{s.forEach(l=>{l.isIntersecting&&fetchFavoritePrompts(e+1)})},{threshold:0});i&&a.observe(i)}})}}function showPromptActionMenu(e,t,o){document.querySelectorAll("#prompt-action-menu").forEach(d=>d.remove());const r=t.id,{right:n,top:i}=o.getBoundingClientRect(),a=n+4,s=i-2,l=`<div id="prompt-action-menu" dir="ltr" style="transform:translate3d(${a}px,${s}px,0);position:fixed;left:0;top:0;min-width:max-content;z-index:10001;--radix-popper-anchor-width:18px;--radix-popper-anchor-height:18px;--radix-popper-available-width:1167px;--radix-popper-available-height:604px;--radix-popper-transform-origin:0% 0px"><div data-side="bottom" data-align="start" role="menu" aria-orientation="vertical" data-state="open" data-radix-menu-content="" dir="ltr" aria-labelledby="radix-:r6g:" class="min-w-[200px] max-w-xs rounded-lg text-token-text-primary bg-token-main-surface-secondary shadow-long p-1" tabindex="-1" data-orientation="vertical" style="outline:0;--radix-dropdown-menu-content-transform-origin:var(--radix-popper-transform-origin);--radix-dropdown-menu-content-available-width:var(--radix-popper-available-width);--radix-dropdown-menu-content-available-height:var(--radix-popper-available-height);--radix-dropdown-menu-trigger-width:var(--radix-popper-anchor-width);--radix-dropdown-menu-trigger-height:var(--radix-popper-anchor-height);pointer-events:auto">
  
  <div role="menuitem" id="run-favorite-prompt-button-${r}" class="flex gap-2 rounded p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="icon icon-md" xmlns="http://www.w3.org/2000/svg"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>${translate("Insert & Run")}</div>

  <div role="menuitem" id="insert-favorite-prompt-button-${r}" class="flex gap-2 rounded p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><svg xmlns="http://www.w3.org/2000/svg" stroke="currentColor" fill="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-md" viewBox="0 0 512 512"><path fill="currentColor" d="M416 128h-40C362.7 128 352 138.7 352 152c0 13.25 10.75 24 24 24H416c8.836 0 16 7.164 16 16v256c0 8.836-7.164 16-16 16H96c-8.836 0-16-7.164-16-16V192c0-8.836 7.164-16 16-16h40C149.3 176 160 165.3 160 152C160 138.7 149.3 128 136 128H96C60.65 128 32 156.7 32 192v256c0 35.34 28.65 64 64 64h320c35.35 0 64-28.66 64-64V192C480 156.7 451.3 128 416 128zM143.7 238.6C133.1 247.6 133.4 262.8 142.4 272.6l96 104.1c9.062 9.82 26.19 9.82 35.25 0l96-104.1c9-9.758 8.406-24.95-1.344-33.93c-9.781-9.07-24.97-8.414-33.91 1.344L280 298.9V24.02C280 10.76 269.3 0 256 0S232 10.76 232 24.02v274.9l-54.38-58.95C172.9 234.8 166.5 232.3 160 232.3C154.2 232.3 148.3 234.3 143.7 238.6z"/></svg>${translate("Insert")}</div>

  <div role="menuitem" id="default-favorite-prompt-button-${r}" class="flex gap-2 rounded p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" stroke="currentColor" fill="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-md"><path d="M211.8 339.8C200.9 350.7 183.1 350.7 172.2 339.8L108.2 275.8C97.27 264.9 97.27 247.1 108.2 236.2C119.1 225.3 136.9 225.3 147.8 236.2L192 280.4L300.2 172.2C311.1 161.3 328.9 161.3 339.8 172.2C350.7 183.1 350.7 200.9 339.8 211.8L211.8 339.8zM0 96C0 60.65 28.65 32 64 32H384C419.3 32 448 60.65 448 96V416C448 451.3 419.3 480 384 480H64C28.65 480 0 451.3 0 416V96zM48 96V416C48 424.8 55.16 432 64 432H384C392.8 432 400 424.8 400 416V96C400 87.16 392.8 80 384 80H64C55.16 80 48 87.16 48 96z"/></svg>${translate("Set as default")}</div>

  <div role="menuitem" id="edit-favorite-prompt-button-${r}" class="flex gap-2 rounded p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.2929 4.29291C15.0641 2.52167 17.9359 2.52167 19.7071 4.2929C21.4783 6.06414 21.4783 8.93588 19.7071 10.7071L18.7073 11.7069L11.1603 19.2539C10.7182 19.696 10.1489 19.989 9.53219 20.0918L4.1644 20.9864C3.84584 21.0395 3.52125 20.9355 3.29289 20.7071C3.06453 20.4788 2.96051 20.1542 3.0136 19.8356L3.90824 14.4678C4.01103 13.8511 4.30396 13.2818 4.7461 12.8397L13.2929 4.29291ZM13 7.41422L6.16031 14.2539C6.01293 14.4013 5.91529 14.591 5.88102 14.7966L5.21655 18.7835L9.20339 18.119C9.40898 18.0847 9.59872 17.9871 9.7461 17.8397L16.5858 11L13 7.41422ZM18 9.5858L14.4142 6.00001L14.7071 5.70712C15.6973 4.71693 17.3027 4.71693 18.2929 5.70712C19.2831 6.69731 19.2831 8.30272 18.2929 9.29291L18 9.5858Z" fill="currentColor"></path></svg>${translate("Edit")}</div>
  
  <div role="menuitem" id="remove-favorite-prompt-button-${r}" class="flex gap-2 rounded p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group text-red-500" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5555 4C10.099 4 9.70052 4.30906 9.58693 4.75114L9.29382 5.8919H14.715L14.4219 4.75114C14.3083 4.30906 13.9098 4 13.4533 4H10.5555ZM16.7799 5.8919L16.3589 4.25342C16.0182 2.92719 14.8226 2 13.4533 2H10.5555C9.18616 2 7.99062 2.92719 7.64985 4.25342L7.22886 5.8919H4C3.44772 5.8919 3 6.33961 3 6.8919C3 7.44418 3.44772 7.8919 4 7.8919H4.10069L5.31544 19.3172C5.47763 20.8427 6.76455 22 8.29863 22H15.7014C17.2354 22 18.5224 20.8427 18.6846 19.3172L19.8993 7.8919H20C20.5523 7.8919 21 7.44418 21 6.8919C21 6.33961 20.5523 5.8919 20 5.8919H16.7799ZM17.888 7.8919H6.11196L7.30423 19.1057C7.3583 19.6142 7.78727 20 8.29863 20H15.7014C16.2127 20 16.6417 19.6142 16.6958 19.1057L17.888 7.8919ZM10 10C10.5523 10 11 10.4477 11 11V16C11 16.5523 10.5523 17 10 17C9.44772 17 9 16.5523 9 16V11C9 10.4477 9.44772 10 10 10ZM14 10C14.5523 10 15 10.4477 15 11V16C15 16.5523 14.5523 17 14 17C13.4477 17 13 16.5523 13 16V11C13 10.4477 13.4477 10 14 10Z" fill="currentColor"></path></svg>${translate("Remove from favorites")}</div>
  
  </div></div>`;document.body.insertAdjacentHTML("beforeend",l),adjustMenuPosition(document.querySelector("#prompt-action-menu")),addPromptActionMenuEventListeners(t)}function addPromptActionMenuEventListeners(e){const t=e.id,o=document.querySelector(`#run-favorite-prompt-button-${t}`);o&&o.addEventListener("click",async()=>{await canRunPrompts(e)&&runPromptChain(e,0,!1)});const r=document.querySelector(`#insert-favorite-prompt-button-${t}`);r&&r.addEventListener("click",async()=>{await canRunPrompts(e)&&await insertPromptIntoTextArea(e)});const n=document.querySelector(`#default-favorite-prompt-button-${t}`);n&&n.addEventListener("click",()=>{chrome.runtime.sendMessage({type:"setDefaultFavoritePrompt",detail:{promptId:e.id}},()=>{toast("Default favorite prompt is changed","success");const s=document.querySelector("#continue-conversation-button");s.textContent=e.title})});const i=document.querySelector(`#edit-favorite-prompt-button-${t}`);i&&i.addEventListener("click",()=>{const s={...e,is_favorite:!0};openPromptEditorModal(s)});const a=document.querySelector(`#remove-favorite-prompt-button-${t}`);a&&a.addEventListener("click",()=>{chrome.runtime.sendMessage({type:"toggleFavoritePrompt",forceRefresh:!0,detail:{promptId:e.id}},()=>{toast("Removed prompt from favorites","success");const s=document.querySelector("#continue-prompt-button-wrapper");s&&s.remove(),initializeContinueButton(!0)})})}const debounceInitializeContinueButton=debounce(()=>{initializeContinueButton()},100);async function initializeContinueButton(e=!1){const t=document.querySelector("#continue-conversation-button-wrapper");if(t){if(!e)return;t?.remove()}cachedSettings?.autoClick&&chrome.storage.local.set({settings:{...cachedSettings,autoClick:!1}});const o=document.createElement("div");o.style="z-index:20;left:0;top:-44px;",o.id="continue-conversation-button-wrapper",o.classList="absolute flex shadow-long rounded-full";const r=document.createElement("button");r.textContent="\u22EE",r.id="continue-conversation-dropdown-button",r.type="button",r.style="width:38px;border-top-right-radius:0;border-bottom-right-radius:0;z-index:2;",r.classList="btn flex justify-center gap-2 btn-secondary border-0 border-r bg-token-main-surface-secondary",addTooltip(r,{value:"Select Favorite Prompt",position:"top"}),r.addEventListener("click",()=>{const l=document.querySelector("#favorite-prompts-dropdown-wrapper");if(l)if(l.classList.contains("block"))l.classList.replace("block","hidden");else{l.classList.replace("hidden","block");const d=r.getBoundingClientRect().top,c=l.offsetHeight;d<c+5?l.style.bottom=`${-(c+5)}px`:l.style.bottom="40px"}});const n=document.createElement("button");chrome.runtime.sendMessage({type:"getDefaultFavoritePrompt"},l=>{const d=l?l?.steps?.map((c,u)=>`step ${u+1}:
${c}`)?.join(`
`):"";n.title=l?`${l?.title}

${formatAttachmentsForPromptStep(d)}`:"No default selected",n.textContent=l?.title||"No default selected"}),n.id="continue-conversation-button",n.type="button",n.dir="auto",n.classList="btn block justify-center gap-2 btn-secondary border-0 max-w-10 truncate bg-token-main-surface-secondary",n.style="width:96px;border-radius:0;border-left:0;z-index:1;text-transform: capitalize;",n.addEventListener("click",l=>{chrome.runtime.sendMessage({type:"getDefaultFavoritePrompt"},async d=>{if(!d||!d.id){toast("No default prompt found","error");return}if(document.querySelector("#prompt-textarea"))if(l.shiftKey&&d.steps.length===1){if(!await canRunPrompts(d))return;await insertPromptIntoTextArea(d)}else runPromptChain(d,0,!1)})});const i=document.createElement("button");i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" stroke="currentColor" fill="currentColor" stroke-width="2" viewBox="0 0 512 512" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4"><path d="M256 464c114.9 0 208-93.1 208-208s-93.1-208-208-208S48 141.1 48 256c0 5.5 .2 10.9 .6 16.3L1.8 286.1C.6 276.2 0 266.2 0 256C0 114.6 114.6 0 256 0S512 114.6 512 256s-114.6 256-256 256c-10.2 0-20.2-.6-30.1-1.8l13.8-46.9c5.4 .4 10.8 .6 16.3 .6zm-2.4-48l14.3-48.6C324.2 361.4 368 313.8 368 256c0-61.9-50.1-112-112-112c-57.8 0-105.4 43.8-111.4 100.1L96 258.4c0-.8 0-1.6 0-2.4c0-88.4 71.6-160 160-160s160 71.6 160 160s-71.6 160-160 160c-.8 0-1.6 0-2.4 0zM39 308.5l204.8-60.2c12.1-3.6 23.4 7.7 19.9 19.9L203.5 473c-4.1 13.9-23.2 15.6-29.7 2.6l-28.7-57.3c-.7-1.3-1.5-2.6-2.5-3.7l-88 88c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3l88-88c-1.1-1-2.3-1.9-3.7-2.5L36.4 338.2c-13-6.5-11.3-25.6 2.6-29.7z"/></svg>',i.id="auto-click-button",i.type="button",i.style="width:38px;border-top-left-radius:0;border-bottom-left-radius:0;;z-index:1;padding:0;",addTooltip(i,{value:"Auto Click is OFF",position:"top"}),i.classList="btn flex justify-center gap-2 btn-secondary border-0 border-l bg-token-main-surface-secondary",i.addEventListener("click",()=>{cachedSettings.autoClick=!cachedSettings.autoClick,chrome.storage.local.set({settings:cachedSettings},()=>{const l=document.querySelector("#auto-click-button");cachedSettings.autoClick?(l.classList.add("composer-submit-btn","composer-submit-button-color"),l.classList.remove("btn-secondary","bg-token-sidebar-surface-secondary","hover:bg-token-main-surface-tertiary"),addTooltip(l,{value:"Auto Click is ON",position:"top"})):(l.classList.remove("composer-submit-btn","composer-submit-button-color"),l.classList.add("btn-secondary","bg-token-sidebar-surface-secondary","hover:bg-token-main-surface-tertiary"),addTooltip(l,{value:"Auto Click is OFF",position:"top"})),toast(`Auto Click is ${cachedSettings.autoClick?'Enabled (<a style="text-decoration:underline; color:gold;" href="https://www.notion.so/ezi/Superpower-ChatGPT-FAQ-9d43a8a1c31745c893a4080029d2eb24?pvs=4#ed16d04d414941d4abcb59b6d765008d" target="blank">Learn More</a>)':"Disabled"}`,"success")})}),o.appendChild(r),o.appendChild(promptDropdown()),o.appendChild(n),o.appendChild(i);const a=document.querySelector("main form"),s=window.location.pathname.startsWith("/g/g-p-")&&window.location.pathname.endsWith("/project");a&&(a.style.marginTop=s?"8px":"20px",a.prepend(o),addProjectHeaderGap(),fetchFavoritePrompts())}let exportAllCanceled=!1,exportTimeout;function fileFormatConverter(e){switch(e){case"json":return"json";case"text":return"txt";case"markdown":return"md";case"html":return"html";default:return"txt"}}function exportSelectedConversations(e,t=[],o="export",r=""){const n=document.querySelector("#export-all-modal-progress-bar-label"),i=document.querySelector("#export-all-modal-progress-bar-fill"),a=document.querySelector("#export-all-modal-progress-bar-filename"),s=document.querySelector("#export-all-modal-include-archived-checkbox")?.checked;getSelectedConversations(t,s).then(l=>{if(l.error&&l.error.type==="limit"){errorUpgradeConfirmation(l.error);return}const d=new JSZip,c=async(g,p)=>{exportAllCanceled||await getConversation(g).then(h=>{const f=h.title.replace(/[^a-zA-Z0-9]/g,"_");let v=h.current_node;const x=new Date(formatTime(h.create_time)),y=`${x.getFullYear()}-${x.getMonth()+1}-${x.getDate()}`,b=`${x.getHours()}-${x.getMinutes()}-${x.getSeconds()}`;h.is_archived&&d.folder("Archived");let w=[];for(;v;){const{message:$,parent:q}=h.mapping[v];$&&w.push($),v=q}if(p==="chatgpt")w=w.filter($=>$.author?.role==="assistant");else if(p==="selected"){const $=Array.from(document.querySelectorAll('input[name="export-all-modal-message-checkbox"]:checked')).map(q=>q.value);w=w.filter(q=>$.includes(q.id)||$.some(E=>document.querySelector(`main article[data-turn-id="${E}"] div[data-message-id="${q.id}"]`)))}const k=w.reverse();if(e.includes("text")){const $=k.filter(C=>{const L=C?.author?.role,_=C?.content?.content_type;return(_==="thoughts"?C?.content?.thoughts.map(T=>T.content).join(""):C?.content?.parts?.join(""))&&_!=="user_editable_context"&&(L==="user"||L==="assistant")}).map(C=>{const L=C?.content?.content_type,_=L==="thoughts"?C?.content?.thoughts.map(z=>z.content):C?.content?.parts,T=L==="thoughts"?"Thoughts":C?.author?.role?.toUpperCase();return`${p!=="chatgpt"?`>> ${T}: `:""}${replaceCitations((_||[])?.filter(z=>typeof z=="string")?.join(`
`).replace(/^## Instructions[\s\S]*?## End Instructions\n\n/m,""),C.metadata.citations,"text")}`})?.join(`

`),q=`https://chat.openai.com/c/${h.conversation_id}

`,E=`# ${escapeHTML(h.title)}

${q}${$}

`;d.file(`${y} ${b}-${f}.${fileFormatConverter("text")}`,E),o==="copy"&&copyToClipboard($,"text")}if(e.includes("json")){const $=h;d.file(`${y} ${b}-${f}.${fileFormatConverter("json")}`,JSON.stringify($)),o==="copy"&&copyToClipboard(JSON.stringify($),"JSON")}if(e.includes("markdown")){const $=k.filter(C=>{const L=C?.author?.role,_=C?.content?.content_type;return(_==="thoughts"?C?.content?.thoughts.map(T=>T.content).join(""):C?.content?.parts?.join(""))&&_!=="user_editable_context"&&(L==="user"||L==="assistant")}).map(C=>{const L=C?.content?.content_type,_=L==="thoughts"?C?.content?.thoughts.map(z=>z.content):C?.content?.parts,T=L==="thoughts"?"Thoughts":C?.author?.role?.toUpperCase();return`${p!=="chatgpt"?`## ${T}
`:""}${replaceCitations((_||[])?.filter(z=>typeof z=="string")?.join(`
`).replace(/^## Instructions[\s\S]*?## End Instructions\n\n/m,""),C.metadata.citations,"markdown")}`})?.join(`

`),q=`https://chat.openai.com/c/${h.conversation_id}

`,E=`# ${escapeHTML(h.title)}

${q}${$}

`;d.file(`${y} ${b}-${f}.${fileFormatConverter("markdown")}`,E),o==="copy"&&copyToClipboard($,"Markdown")}const S=Object.values(d.files).filter($=>!$.dir).length,M=Math.round(Math.round(S/e.length)/l.length*100);n.textContent=`${Math.round(S/e.length)} / ${l.length}`,i.style.width=`${M}%`,a.textContent=h.title}).catch(h=>{})},u=async(g,p)=>{for(let h=0;h<g.length;h+=1)await c(g[h],p,h)},m=document.querySelector('input[name="export-all-modal-export-mode"]:checked')?.value||"all";u(l,m).then(()=>{if(exportAllCanceled){exportAllCanceled=!1;return}if(clearTimeout(exportTimeout),o==="export")d.generateAsync({type:"blob",compression:"DEFLATE"}).then(g=>{const p=r?`${r}.zip`:`${new Date().toISOString().slice(0,10)}-conversations.zip`;saveAs(g,p);const h=document.querySelector("#export-all-modal");setTimeout(()=>{h.remove()},500)});else{const g=document.querySelector("#export-all-modal-copy-button");g.disabled=e.length!==1,g.style.opacity=e.length!==1?"0.5":"1",document.querySelectorAll('input[name="export-all-modal-checkbox"]').forEach(p=>{p.disabled=!1})}})},()=>{})}function copyToClipboard(e,t="text"){navigator.clipboard.writeText(e).then(()=>{toast(`Conversation ${t} copied to clipboard`)},()=>{toast("Failed to copy conversation to clipboard")})}async function saveConversationAsPDF(e,t=null){const o=await getConversation(e);document.querySelector("main article")?.parentElement?.querySelectorAll('button svg > use[href*="ba3792"]').forEach(d=>{d?.closest("svg")?.classList?.contains("rotate-90")||d?.closest("button")?.click()});const r=window.open("","_blank");r.document.write(`<html><head><title>${o.title}</title></head><body><div style="width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;"><svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><style>.spinner_S1WN{animation:spinner_MGfb .8s linear infinite;animation-delay:-.8s}.spinner_Km9P{animation-delay:-.65s}.spinner_JApP{animation-delay:-.5s}@keyframes spinner_MGfb{93.75%,100%{opacity:.2}}</style><circle class="spinner_S1WN" cx="4" cy="12" r="3"/><circle class="spinner_S1WN spinner_Km9P" cx="12" cy="12" r="3"/><circle class="spinner_S1WN spinner_JApP" cx="20" cy="12" r="3"/></svg></div></body></html>`),await sleep(1e3);let n=t?t.cloneNode(!0):document.querySelector("main article").parentElement.cloneNode(!0);const i=new Set;if(n.querySelectorAll("img").forEach(d=>{i.has(d.src)?d.parentElement.remove():i.add(d.src)}),t){const d=document.createElement("div");d.appendChild(n),n=d;const c=n.querySelector("h6");c?.textContent==="ChatGPT said:"&&c.remove()}n.childNodes.forEach(d=>{d.tagName!=="ARTICLE"&&d.remove()}),n.querySelectorAll("article").forEach(d=>{const c=document.createElement("pre");c.innerHTML=d.innerHTML,d.innerHTML="",d.appendChild(c)});const a=Array.from(n.querySelectorAll("h5"));if(a.forEach((d,c)=>{d.textContent===""&&(a[c-1].textContent.includes("You said")?d.textContent="ChatGPT said:":d.textContent="You said:")}),n.querySelectorAll('button, div[role="button"]').forEach(d=>{d.removeAttribute("role"),!d.querySelector("img")?.src.includes("files")&&(d.id.startsWith("textdoc-message-")||d.remove())}),n.querySelectorAll("*").forEach(d=>{d.style.opacity==="0"&&d.remove(),d.style.display==="none"&&d.remove(),d.removeAttribute("style")}),n.querySelectorAll('div[class*="ps-4"], div[class*="overflow-clip"]').forEach(d=>{d.style.borderLeft="2px solid #888",d.style.paddingLeft="1rem",d.style.margin="1rem 0.5rem"}),n.querySelectorAll("*").forEach(d=>{d.classList.contains("invisible")&&d.remove(),d.classList.contains("hidden")&&d.remove(),d.classList.contains("opacity-0")&&d.remove(),d.removeAttribute("class")}),n.querySelectorAll('[dir="auto"]').forEach(d=>{d.setAttribute("dir","ltr")}),n.querySelectorAll('#message-char-word-counter, #message-timestamp, #message-instructions, div[id^="message-actions-"]').forEach(d=>{d.remove()}),n.querySelectorAll("a").forEach(d=>{d.parentElement.tagName==="DIV"&&(d.parentElement.replaceWith(d),d.style="margin: 0 4px; background-color: #f0f0f0; padding: 0px 4px; border-radius: 4px; display: inline-block;line-height:1.8;word-break: break-all;overflow-wrap: break-word;")}),(document.querySelector('input[name="export-all-modal-export-mode"]:checked')?.value||"all")==="selected"){const d=Array.from(document.querySelectorAll('input[name="export-all-modal-message-checkbox"]:checked')).map(c=>c.value);n.querySelectorAll("article").forEach(c=>{d.some(u=>c.getAttribute("data-turn-id")===u||c.querySelector(`div[data-message-id="${u}"]`))||c.remove()})}const s=n.querySelectorAll('div[id^="textdoc-message-"]'),l=await getConversationTextDocs(e);s.forEach(d=>{const c=d.id.split("textdoc-message-")[1],u=l.find(m=>m.id===c);u&&(d.style.height="auto",d.lastChild.innerHTML=`<pre><code>${escapeHTML(u.content)}</code></pre>`)}),r.document.body.innerHTML="",r.document.write(`<html><head><title>${o.title}</title><style id="dynamic-style">${getPDFStyle("style1")}</style></head><body>`),r.document.write('<div class="hidden-print">'),r.document.write("<span>Select the style: </span>"),r.document.write('<select id="style-btn">'),r.document.write('<option value="style1">Default</option>'),r.document.write('<option value="style2">Dark Minimal</option>'),r.document.write('<option value="style3">Elegant Serif</option>'),r.document.write('<option value="style4">Retro Neon</option>'),r.document.write('<option value="style5">Clean and Structured</option>'),r.document.write('<option value="style6">Vintage Typewriter</option>'),r.document.write('<option value="style7">Futuristic Circuit</option>'),r.document.write('<option value="style8">Organic Nature</option>'),r.document.write('<option value="style9">Comic Pop</option>'),r.document.write('<option value="style10">Abstract Geometry</option>'),r.document.write('<option value="style11">Celestial Night</option>'),r.document.write('<option value="style12">Pop Art Explosion</option>'),r.document.write('<option value="style13">Industrial Blueprint</option>'),r.document.write('<option value="style14">Watercolor Dream</option>'),r.document.write('<option value="style15">Cosmic Space</option>'),r.document.write('<option value="style16">Botanical Illustration</option>'),r.document.write('<option value="style17">Digital Doodle</option>'),r.document.write('<option value="style18">Glitch Art</option>'),r.document.write('<option value="style19">Origami Fold</option>'),r.document.write('<option value="style20">Retro Computer</option>'),r.document.write('<option value="style21">Underwater Dream</option>'),r.document.write('<option value="style22">Enchanted Forest</option>'),r.document.write('<option value="style23">Aurora Sky</option>'),r.document.write('<option value="style24">Desert Mirage</option>'),r.document.write('<option value="style25">Mystic Marble</option>'),r.document.write('<option value="style26">Tropical Vibes</option>'),r.document.write('<option value="style27">Galactic Nebula</option>'),r.document.write('<option value="style28">Cosmic Watercolor</option>'),r.document.write("</select>"),r.document.write("<span>then click on print</span>"),r.document.write('<button id="print-btn">Print</button>'),t||(r.document.write('<div style="margin-left:auto;">'),r.document.write('<button id="print-mode-btn">Hide User Messages</button>'),r.document.write("</div>")),r.document.write("</div>"),r.document.write(n.outerHTML),r.document.write('<footer>Created by <a href="https://chromewebstore.google.com/detail/superpower-chatgpt/amhmeenmapldpjdedekalnfifgnpfnkc" target="_blank" rel="noreferrer">Superpower ChatGPT</a></footer>'),r.document.write("</body></html>"),r.document.close(),r.onload=function(){r.document.getElementById("style-btn")?.addEventListener("change",c=>{const u=c.target.value,m=r.document.getElementById("dynamic-style");m.innerHTML=getPDFStyle(u)}),r.document.getElementById("print-btn")?.addEventListener("click",()=>{r.print()});const d=r.document.getElementById("print-mode-btn");d?.addEventListener("click",()=>{const c=d.textContent==="Show User Messages";r.document.querySelectorAll("article").forEach(u=>{const m=u.querySelector("h6");m&&(m.style.display=c?"block":"none"),u.querySelector('div[data-message-author-role="user"]')&&(u.style.display=c?"block":"none")}),d.textContent=c?"Hide User Messages":"Show User Messages"})}}function addProjectHeaderGap(e=window.location){if(!(e.pathname.startsWith("/g/g-p-")&&e.pathname.endsWith("/project")))return;const t=document.querySelector('main button[data-testid="project-modal-trigger"]');if(!t)return;const o=t.parentElement.parentElement;o.classList.remove("mb-8"),o.classList.add("relative","mb-20")}async function openExportModal(e=[],t="all",o=""){clearTimeout(exportTimeout),exportAllCanceled=!1;const r=await chrome.runtime.sendMessage({type:"checkHasSubscription"}),n=document.createElement("div");n.style="position:fixed;top:0px;left:0px;width:100%;height:100%;z-index:100001;display:flex;align-items:center;justify-content:center;",n.classList="bg-black/50 dark:bg-black/80 text-token-text-primary",n.id="export-all-modal",n.addEventListener("click",H=>{const P=document.querySelector("#export-all-modal-progress-bar-fill");H.target.id==="export-all-modal"&&(P.style.width==="0%"||P.style.width==="100%")&&n.remove()});const i=document.createElement("div");i.style="max-width:700px; min-width: 500px;min-height:300px;max-height:90vh;",i.classList="bg-token-main-surface-primary rounded-md flex flex-col items-start justify-start border border-token-border-medium relative shadow-md",n.appendChild(i);const a=document.createElement("div");a.classList="w-full";const s={all:"Export All Conversations",favorite:"Export Favorite Conversations",folder:"Export Folder Conversations",selected:"Export Selected Conversations",current:"Export Current Conversation",dateRange:"Export Conversation in Date Range",project:"Export All Conversations in Project"};a.innerHTML=`
  <div class="px-4 pb-4 pt-5 flex items-center justify-between border-b border-token-border-medium">
    <div class="flex">
      <div class="flex items-center">
        <div class="flex grow gap-1">
          <h2 as="h3" class="text-lg font-medium leading-6 text-token-text-tertiary">
          ${translate(s[t])} </h2>
          <a href="https://www.youtube.com/watch?v=aDeU0A5gxMQ&ab_channel=SuperpowerChatGPT" target="_blank" rel="noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md ps-0.5 text-token-text-tertiary h-5 w-5 ms-2"><path fill="currentColor" d="M13 12a1 1 0 1 0-2 0v4a1 1 0 1 0 2 0zM12 9.5A1.25 1.25 0 1 0 12 7a1.25 1.25 0 0 0 0 2.5"></path><path fill="currentColor" fill-rule="evenodd" d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2M4 12a8 8 0 1 1 16 0 8 8 0 0 1-16 0" clip-rule="evenodd"></path></svg></a>
          </div>
      </div>
    </div>
  </div>`,i.appendChild(a);const l=document.createElement("div");l.classList="w-full h-full flex flex-col items-start justify-start relative p-4 overflow-hidden",i.appendChild(l);const d=document.createElement("div");d.classList="font-semibold text-token-text-primary my-1",d.textContent=translate("How would you like to export the conversation?"),l.appendChild(d);const c=document.createElement("div");c.classList="flex flex-wrap items-start justify-start w-full mt-2 text-token-text-tertiary",l.appendChild(c);const u=getConversationIdFromUrl(),m=e.length===1&&e[0]===u,g=[{id:"export-all-modal-all-checkbox",name:"export-all-modal-export-mode",value:"all",label:"Export all messages"},{id:"export-all-modal-chatgpt-checkbox",name:"export-all-modal-export-mode",value:"chatgpt",label:"Export ChatGPT messages only"},{id:"export-all-modal-selected-checkbox",name:"export-all-modal-export-mode",value:"selected",label:`Export selected messages ${m?"":"(Available only when exporting current conversation)"}`}],p=async H=>{const{value:P}=H.target;if(!r&&P==="selected"){H.preventDefault(),H.target.checked=!1,document.querySelector("#export-all-modal-all-checkbox").checked=!0,errorUpgradeConfirmation({title:"This is a Pro feature",message:"Exporting selected messages from a conversation requires a Pro subscription. Upgrade to Pro to remove all limits."});return}P==="selected"?showMessageListInExportModal():hideMessageListInExportModal()};g.forEach(H=>{const P=document.createElement("div");P.classList="w-full ps-3 my-1",c.appendChild(P);const j=document.createElement("input");j.type="radio",j.id=H.id,j.name=H.name,j.value=H.value,j.checked=H.value==="all",j.disabled=H.value==="selected"&&!m,j.style.opacity=H.value==="selected"&&!m?"0.5":"1",j.addEventListener("change",p),P.appendChild(j);const D=document.createElement("label");D.htmlFor=H.id,D.style="font-size:0.875rem;margin-left:8px;",D.innerHTML=`${H.label}${H.value==="selected"&&!r?'<span class="text-white rounded-md bg-green-500 px-2 ml-2 text-sm">Pro</span>':""}`,P.appendChild(D)});const h=document.createElement("div");h.id="export-all-modal-message-list-wrapper",h.classList="hidden w-full overflow-y-auto mt-2 text-token-text-tertiary border border-token-border-medium rounded-md p-2 bg-token-main-surface-secondary",h.style="max-height:100%;",l.appendChild(h);const f=document.createElement("div");f.classList="w-full flex items-center justify-start border-b border-token-border-medium",h.appendChild(f);const v=document.createElement("input");v.type="checkbox",v.id="export-all-modal-select-deselect-all-checkbox",v.name="export-all-modal-select-deselect-all-checkbox",v.value="select-deselect-all",v.checked=!1,v.classList="m-2 text-token-text-primary",f.appendChild(v);const x=document.createElement("label");x.htmlFor="export-all-modal-select-deselect-all-checkbox",x.style="font-size:1rem;font-weight:600;",x.textContent=translate("Select/Deselect All"),f.appendChild(x),v.addEventListener("change",H=>{const{checked:P}=H.target;h.querySelectorAll('input[name="export-all-modal-message-checkbox"]').forEach(j=>{j.checked=P})});let y=null;document.querySelectorAll("main article").forEach(H=>{const P=H.innerText.replace(/\s+/g," ").replace(/You said:|ChatGPT said:/g,"").trim().slice(0,100);if(!P)return;const j=H.getAttribute("data-turn-id"),D=H.getAttribute("data-turn"),K=document.createElement("div");K.classList="w-full my-1 flex items-center overflow-hidden cursor-pointer",h.appendChild(K);const U=document.createElement("input");U.type="checkbox",U.id=`export-all-modal-message-${j}-checkbox`,U.name="export-all-modal-message-checkbox",U.value=j,U.checked=!1,U.classList="m-2",K.appendChild(U);const Y=document.createElement("label");Y.htmlFor=`export-all-modal-message-${j}-checkbox`,Y.style="font-size:0.875rem;white-space: nowrap;overflow: hidden; text-overflow: ellipsis;",Y.textContent=`${P}`,D==="assistant"&&(Y.classList="text-token-text-secondary"),K.appendChild(Y),U.addEventListener("click",X=>{if(X.shiftKey){const Q=Array.from(h.querySelectorAll('input[name="export-all-modal-message-checkbox"]')),V=Q.indexOf(X.target),A=Q.findIndex(ee=>ee===y);if(A!==-1){const[ee,ne]=[Math.min(V,A),Math.max(V,A)];Q.slice(ee,ne+1).forEach(ae=>{ae.checked=y.checked})}}y=X.target})});const b=document.createElement("div");b.classList="font-semibold text-token-text-primary mt-6 mb-1",b.textContent=translate("Select the format(s) for export"),l.appendChild(b);const w=document.createElement("div");w.classList="flex items-center justify-between w-full mt-2 text-token-text-tertiary px-2",l.appendChild(w);const k=[{id:"export-all-modal-markdown-checkbox",name:"export-all-modal-checkbox",value:"markdown",label:"Markdown"},{id:"export-all-modal-json-checkbox",name:"export-all-modal-checkbox",value:"json",label:"Json"},{id:"export-all-modal-text-checkbox",name:"export-all-modal-checkbox",value:"text",label:"Text"}];let S=["text"];const M=H=>{const{checked:P,value:j}=H.target;P?S.push(j):S=S.filter(U=>U!==j);const D=document.querySelector("#export-all-modal-copy-button");D&&(D.style.opacity=e.length===1&&S.length===1?"1":"0.5",D.disabled=e.length!==1||S.length!==1);const K=document.querySelector("#export-all-modal-export-button");K.style.opacity=S.length===0?"0.5":"1",K.disabled=S.length===0};k.forEach(H=>{const P=document.createElement("div");P.style="display:flex;align-items:center;justify-content:center;",w.appendChild(P);const j=document.createElement("input");j.type="checkbox",j.id=H.id,j.name=H.name,j.value=H.value,j.checked=H.value==="text",j.addEventListener("change",M),P.appendChild(j);const D=document.createElement("label");D.htmlFor=H.id,D.style="font-size:0.875rem;margin-left:8px;",D.textContent=H.label,P.appendChild(D)});const $=document.createElement("div");$.id="export-all-modal-progress-bar-label",$.style="font-size:0.875rem;margin:32px auto 8px;",$.textContent=`0 / ${e?.length||"--"} `,l.appendChild($);const q=document.createElement("div");q.id="export-all-modal-progress-bar",q.style="min-height:12px;",q.classList="bg-token-main-surface-tertiary relative w-full h-3 rounded-md overflow-hidden",l.appendChild(q);const E=document.createElement("div");E.id="export-all-modal-progress-bar-fill",E.style="position:absolute;top:0px;left:0px;width:0%;height:12px;min-height:12px;background-color:gold;border-radius:4px;",q.appendChild(E);const C=document.createElement("div");C.id="export-all-modal-progress-bar-filename",C.style="font-size:0.875rem;margin:8px auto 32px;",C.classList="truncate w-full text-token-text-tertiary",C.textContent=" ",l.appendChild(C);const L=document.createElement("div");L.classList="mt-auto w-full flex items-center justify-end gap-2",l.appendChild(L);const _=document.createElement("div");_.style="display:flex;align-items:center;justify-content:center;margin-right:auto;",L.appendChild(_);const T=document.createElement("input");T.type="checkbox",T.id="export-all-modal-include-archived-checkbox",T.name="export-all-modal-include-archived-checkbox",T.value="includeArchived",T.checked=!0,_.appendChild(T);const z=document.createElement("label");z.htmlFor="export-all-modal-include-archived-checkbox",z.style="font-size:0.875rem;margin-left:8px;",z.classList="text-token-text-tertiary",z.textContent=translate("Include archived conversations"),_.appendChild(z);const B=document.createElement("button");B.classList="btn relative btn-secondary",B.textContent=translate("Cancel"),B.addEventListener("click",()=>{exportAllCanceled=!0;const H=setInterval(()=>{},Number.MAX_SAFE_INTEGER);for(let P=1;P<H;P+=1)clearInterval(P);clearTimeout(exportTimeout),n.remove()}),L.appendChild(B);const F=document.createElement("button");F.id="export-all-modal-copy-button",F.textContent=translate("Copy to clipboard"),F.classList="btn composer-submit-btn composer-submit-button-color",F.style.opacity=e?.length!==1||S.length!==1?"0.5":"1",F.disabled=e?.length!==1||S?.length!==1,addTooltip(F,{value:H=>H.disabled?"Copy only works when exporting single conversation in single format":"",position:"top"}),F.addEventListener("click",()=>{exportAllCanceled=!1,F.disabled=!0,document.querySelectorAll('input[name="export-all-modal-checkbox"]').forEach(H=>{H.disabled=!0}),exportSelectedConversations(S,e,"copy")}),L.appendChild(F);const N=document.createElement("button");N.id="export-all-modal-pdf-button",N.classList="btn composer-submit-btn composer-submit-button-color",N.style.opacity=e?.length!==1?"0.5":"1",N.disabled=e?.length!==1,e?.length!==1&&addTooltip(N,{value:H=>H.disabled?"Save as PDF only works when exporting single conversation":"",position:"top"}),N.textContent=translate("Save as PDF"),N.addEventListener("click",()=>{saveConversationAsPDF(e[0])}),L.appendChild(N);const O=document.createElement("button");O.id="export-all-modal-export-button",O.classList="btn composer-submit-btn composer-submit-button-color",O.style.opacity=e?.length===0||S.length===0?"0.5":"1",O.textContent=translate("Export"),O.disabled=e?.length===0||S.length===0,addTooltip(O,{value:H=>H.disabled?"Please select a format first":"",position:"top"}),O.addEventListener("click",()=>{exportAllCanceled=!1,O.disabled=!0,O.innerText=`${translate("Exporting")}...`,O.appendChild(loadingSpinner("export-all-modal-export-button")),document.querySelectorAll('input[name="export-all-modal-checkbox"]').forEach(H=>{H.disabled=!0}),exportSelectedConversations(S,e,"export",o)}),L.appendChild(O),e?.length===0&&chrome.runtime.sendMessage({type:"getTotalConversationsCount",forceRefresh:!0},H=>{H||(H=0,$.textContent="You don't have any conversations."),$.textContent=`0 / ${H} `,O.disabled=H===0||S.length===0,O.style.opacity=H===0||S.length===0?"0.5":"1"}),document.body.appendChild(n)}function showMessageListInExportModal(){const e=document.querySelector("#export-all-modal-message-list-wrapper");e&&e.classList.remove("hidden")}function hideMessageListInExportModal(){const e=document.querySelector("#export-all-modal-message-list-wrapper");e&&e.classList.add("hidden")}const messageExpandIconSmall='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="icon icon-sm" viewBox="0 0 512 512"><path d="M183 295l-81.38 81.38l-47.03-47.03c-6.127-6.117-14.29-9.367-22.63-9.367c-4.117 0-8.279 .8086-12.25 2.43c-11.97 4.953-19.75 16.63-19.75 29.56v135.1C.0013 501.3 10.75 512 24 512h136c12.94 0 24.63-7.797 29.56-19.75c4.969-11.97 2.219-25.72-6.938-34.87l-47.03-47.03l81.38-81.38c9.375-9.375 9.375-24.56 0-33.94S192.4 285.7 183 295zM487.1 0h-136c-12.94 0-24.63 7.797-29.56 19.75c-4.969 11.97-2.219 25.72 6.938 34.87l47.04 47.03l-81.38 81.38c-9.375 9.375-9.375 24.56 0 33.94s24.56 9.375 33.94 0l81.38-81.38l47.03 47.03c6.127 6.117 14.3 9.35 22.63 9.35c4.117 0 8.275-.7918 12.24-2.413C504.2 184.6 512 172.9 512 159.1V23.1C512 10.75 501.3 0 487.1 0z"></path></svg>',messageCollapseIconSmall='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="icon icon-sm" viewBox="0 0 512 512"><path d="M488.1 23.03c-9.375-9.375-24.56-9.375-33.94 0l-81.38 81.38l-47.03-47.03c-6.127-6.117-14.3-9.35-22.63-9.35c-4.117 0-8.275 .7918-12.24 2.413c-11.97 4.953-19.75 16.63-19.75 29.56v135.1c0 13.25 10.74 23.1 24 23.1h136c12.94 0 24.63-7.797 29.56-19.75c4.969-11.97 2.219-25.72-6.938-34.87l-47.04-47.03l81.38-81.38C498.3 47.59 498.3 32.41 488.1 23.03zM215.1 272h-136c-12.94 0-24.63 7.797-29.56 19.75C45.47 303.7 48.22 317.5 57.37 326.6l47.04 47.03l-81.38 81.38c-9.375 9.375-9.375 24.56 0 33.94s24.56 9.375 33.94 0l81.38-81.38l47.03 47.03c6.127 6.117 14.29 9.367 22.63 9.367c4.117 0 8.279-.8086 12.25-2.43c11.97-4.953 19.75-16.63 19.75-29.56V296C239.1 282.7 229.3 272 215.1 272z"></path></svg>';function addToggleButtonToArticle(e,t,o){if(!e)return;const r=e.querySelector('button[data-testid="copy-turn-action-button"]');if(!r||e.querySelector('button[data-testid="toggle-message-turn-action-button"]'))return;const n=`<button class="${r.classList} relative" aria-label="Toggle message" data-testid="toggle-message-turn-action-button" data-message-id="${t}"><span class="touch:w-[38px] flex h-[30px] w-[30px] items-center justify-center">${messageCollapseIconSmall}</span></button>`;r.insertAdjacentHTML("beforebegin",n),r.parentElement.id=`message-actions-${t}`;const i=e.querySelector('button[data-testid="toggle-message-turn-action-button"]');addTooltip(i,{value:"Collapse",position:"bottom"}),addArticleToggleButtonEventListener(e,i,t,o)}function addArticleToggleButtonEventListener(e,t,o,r){t?.addEventListener("click",async()=>{const n=e.querySelector('button[data-testid="toggle-message-turn-action-button"]'),i=n.querySelector("svg").outerHTML===messageExpandIconSmall,a=document.querySelector(`main article [data-message-id="${o}"]`)?.parentElement;i?(a.classList.remove("bottom-fade-blur"),n.innerHTML=`<span class="touch:w-[38px] flex h-[30px] w-[30px] items-center justify-center">${messageCollapseIconSmall}</span>`,addTooltip(n,{value:"Collapse",position:"bottom"})):(a.classList.add("bottom-fade-blur"),n.innerHTML=`<span class="touch:w-[38px] flex h-[30px] w-[30px] items-center justify-center">${messageExpandIconSmall}</span>`,addTooltip(n,{value:"Expand",position:"bottom"}))})}const debounceAddToggleButtonToArticle=debounce(async(e=!1)=>{const t=document.querySelectorAll('article button[data-testid="toggle-message-turn-action-button"]').length,o=document.querySelectorAll('button[data-testid="copy-turn-action-button"]').length,r=getConversationIdFromUrl();if(!r)return;const n=document.querySelectorAll("main article");n.length!==0&&t!==o&&n?.forEach(i=>{const a=i.querySelector("[data-message-id]");if(!a)return;const{messageId:s}=a.dataset;addToggleButtonToArticle(i,s,r)})},200);async function generateSplitterChain(e){const{autoSplit:t,autoSummarize:o,autoSplitLimit:r,autoSplitInitialPrompt:n,autoSplitChunkPrompt:i}=cachedSettings;if(!t)return[e];if(!r)return[e];if(e.length<r)return[e];const a=[];let s=e,l=1;const d=Math.ceil(s.length/r);for(;s.length>r;){const c=getChunk(s,n,i,r,l,d);if(!c)break;a.push(c),s=s.slice(c.length),l+=1}if(s.length>0){const c=getChunk(s,n,i,r,l,d);a.push(c)}return o&&a.push("Summarize all chunks"),a}function getChunk(e,t,o,r,n,i){let a="";return e.length===0||(n===1&&(a=t),a+=`[START CHUNK ${n} / ${i}]
    ${e.slice(0,r)}
    [END CHUNK ${n}/${i}]
    ${o}`),a}const modelSwitcherMap={"text-davinci-002-render-sha":{title:"ChatGPT 3.5",description:"Great for everyday tasks"},"gpt-5-2":{title:"ChatGPT 5.2 Auto",description:"Decides how long to think"},"gpt-5-2-thinking":{title:"ChatGPT 5.2 Thinking",description:"Thinks longer for better answers"},"gpt-5-2-instant":{title:"ChatGPT 5.2 Instant",description:"Answers right away"},"gpt-5-1":{title:"ChatGPT 5.1 Auto",description:"Decides how long to think"},"gpt-5-1-thinking":{title:"ChatGPT 5.1 Thinking",description:"Thinks longer for better answers"},"gpt-5-1-instant":{title:"ChatGPT 5.1 Instant",description:"Answers right away"},"gpt-5":{title:"ChatGPT 5 Auto",description:"Decides how long to think"},"gpt-5-thinking":{title:"ChatGPT 5 Thinking",description:"Thinks longer for better answers"},"gpt-5-t-mini":{title:"ChatGPT 5 Thinking Mini",description:"Thinks quickly"},"gpt-5-instant":{title:"ChatGPT 5 Instant",description:"Answers right away"},"gpt-5-pro":{title:"ChatGPT 5 Pro",description:"Research-grade intelligence"},"gpt-4":{title:"ChatGPT 4",description:"Legacy model"},"gpt-4-5":{title:"ChatGPT 4.5",description:"Good for writing and exploring"},"gpt-4o":{title:"ChatGPT 4o",description:"Great for most questions"},"gpt-4o-mini":{title:"ChatGPT 4o mini",description:"Faster for most questions"},o1:{title:"ChatGPT o1",description:"Uses advanced reasoning"},"o1-mini":{title:"ChatGPT o1-mini",description:"Faster at reasoning"},"o1-preview":{title:"ChatGPT o1-preview",description:"Uses advanced reasoning"},o3:{title:"ChatGPT o3",description:"Uses advanced reasoning"},"o3-mini":{title:"ChatGPT o3-mini",description:"Fast at advanced reasoning"},"o3-mini-high":{title:"ChatGPT o3-mini-high",description:"Great at coding and logic"},"o4-mini":{title:"ChatGPT o4-mini",description:"Fastest at advanced reasoning"},"o4-mini-high":{title:"ChatGPT o4-mini-high",description:"Great at coding and visual reasoning"},"gpt-4o-canmore":{title:"ChatGPT 4o Canvas",description:"Collaborate on writing and code"},"gpt-4o-jawbone":{title:"ChatGPT Tasks",description:"Ask ChatGPT to follow up later"},auto:{title:"Dynamic",description:"Use the right model from my requests"}};async function overrideModelSwitchers(){const e=document.querySelectorAll('button[data-testid="model-switcher-dropdown-button"]');if(e.length!==0)for(let t=0;t<e.length;t+=1)(async o=>{await overrideSingleModelSwitcher(o)})(e[t])}async function overrideSingleModelSwitcher(e){if(e?.classList?.contains("hidden"))return;e?.classList?.add("hidden");const{models:t}=await chrome.storage.local.get(["models"]);if(!cachedSettings.overrideModelSwitcher||!t||t.length===0){window.sessionStorage.removeItem("sp/selectedModel"),e?.classList?.remove("hidden");return}const o=await getSelectedModel();if(e.parentElement){const r=modelSwitcher(o,t);e.parentElement.parentElement.style.zIndex="10000",e.parentElement.classList="flex flex-row-reverse",e.parentElement.insertAdjacentHTML("afterbegin",r);const n=e.parentElement.querySelector("#model-switcher-button");addModelSwitcherEventListener(n)}}function modelSwitcher(e,t=[]){return e?`<div style="width: min-content;"><button id="model-switcher-button" class="relative w-full cursor-pointer rounded-md border border-token-border-medium bg-transparent ps-3 pe-10 text-start focus:outline-none  sm:text-sm" type="button">
  <label class="relative text-xs text-token-text-tertiary" style="top:-2px;">Model</label>
  <span class="inline-flex w-full truncate font-semibold text-token-text-primary">
    <span class="flex h-5 items-center gap-1 truncate relative" style="top:-2px;"><span id="selected-model-title">${modelSwitcherMap[e.slug]?.title||e.title}</span>
    </span>
  </span>
  <span class="pointer-events-none absolute inset-y-0 end-0 flex items-center pe-2">
    <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4 text-gray-400" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg">
      <polyline points="6 9 12 15 18 9"></polyline>
    </svg>
  </span>
</button>

<ul id="model-list-dropdown" style="width:300px;max-height:400px" class="hidden absolute z-10 mt-1 overflow-auto rounded-md text-base border border-token-border-medium focus:outline-none bg-token-main-surface-secondary sm:text-sm -translate-x-1/4" role="menu" aria-orientation="vertical" aria-labelledby="model-switcher-button" tabindex="-1">

  <div class="flex items-center justify-between pb-0 mx-2 ps-4 pe-4 pt-4 juice:mb-1 juice:px-5 juice:pt-2"><span class="text-sm text-token-text-tertiary">Model</span><a href="https://help.openai.com/en/articles/7102672-how-can-i-access-gpt-4" target="_blank" rel="noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md ps-0.5 text-token-text-tertiary h-5 w-5"><path fill="currentColor" d="M13 12a1 1 0 1 0-2 0v4a1 1 0 1 0 2 0zM12 9.5A1.25 1.25 0 1 0 12 7a1.25 1.25 0 0 0 0 2.5"></path><path fill="currentColor" fill-rule="evenodd" d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2M4 12a8 8 0 1 1 16 0 8 8 0 0 1-16 0" clip-rule="evenodd"></path></svg></a></div>

  ${createModelListDropDown(t,e)}
  <div role="separator" aria-orientation="horizontal" style="bottom:44px;" class="sticky h-[1px] border-token-border-medium"></div>
</ul></div>`:""}function createModelListDropDown(e,t){return`${e.filter(o=>!o.slug.includes("plugins")).map(o=>`<li class="group relative cursor-pointer select-none mx-2 py-2 ps-4 pe-12 rounded-md hover:bg-token-main-surface-tertiary" id="model-switcher-option-${o.slug}" role="option" tabindex="-1">
 <div class="flex flex-col">
   <span class="font-semibold flex h-6 items-center gap-1 truncate text-token-text-primary">${o.title||modelSwitcherMap[o.slug]?.title}</span>
   <span class="text-token-text-tertiary text-xs">${modelSwitcherMap[o.slug]?.description||o.description}</span>
 </div>
 ${o.slug===t.slug?`<span id="model-switcher-checkmark" style="right:36px;" class="absolute inset-y-0 flex items-center text-token-text-primary">
 <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md"><path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path></svg>
 </span>`:""}
</li>`).join("")}`}function addModelSwitcherEventListener(e){e?.addEventListener("click",()=>{const t=e.parentElement.querySelector("#model-list-dropdown");t.classList.contains("block")?t.classList.replace("block","hidden"):t.classList.replace("hidden","block")}),document.addEventListener("click",t=>{const o=e.parentElement.querySelector("#model-list-dropdown"),r=o?.classList;r&&r.contains("block")&&!t.target.closest("#model-switcher-button")&&o.classList.replace("block","hidden")}),e.parentElement.querySelectorAll("[id^=model-switcher-option-]").forEach(t=>{t.addEventListener("click",()=>{chrome.storage.local.get(["models"],({models:o})=>{const r=o||[],n=t.id.split("model-switcher-option-")[1],i=r.find(d=>d.slug===n);if(!i)return;window.sessionStorage.setItem("sp/selectedModel",i.slug);const a=e.parentElement.querySelector("#model-list-dropdown");if(!a)return;a.classList.replace("block","hidden");const s=document.querySelectorAll("#model-switcher-checkmark");s.forEach(d=>d.remove()),document.querySelectorAll("#selected-model-title").forEach(d=>{d.innerHTML=`${modelSwitcherMap[i.slug]?.title||i.title}`});const l=document.querySelectorAll(`#model-switcher-option-${i.slug?.replaceAll(".","\\.")}`);l.length!==0&&s.length!==0&&(l.forEach(d=>{d.appendChild(s[0])}),chrome.storage.local.set({selectedModel:i},()=>{const d=document.querySelector("main #prompt-textarea");d&&d.focus()}))})})})}async function getSelectedModel(){const{models:e,selectedModel:t}=await chrome.storage.local.get(["models","selectedModel"]);if(!e||e.length===0)return null;const o=window.sessionStorage.getItem("sp/selectedModel");return o&&e.find(r=>r.slug===o)?e.find(r=>r.slug===o):t||e[0]||null}function setSelectedModel(){chrome.storage.local.get(["selectedModel","models"],({selectedModel:e,models:t})=>{cachedSettings.overrideModelSwitcher?e?window.sessionStorage.setItem("sp/selectedModel",e.slug):window.sessionStorage.setItem("sp/selectedModel",t[0]?.slug):window.sessionStorage.removeItem("sp/selectedModel")})}let managerModalCurrentTab="prompts";chrome.storage.local.get(["managerModalCurrentTab"],e=>{managerModalCurrentTab=e.managerModalCurrentTab||"prompts"});const managerTabList=[{code:"conversations",name:"Conversations manager",icon:'<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-lg" viewBox="0 0 512 512" fill="currentColor"><path d="M360 144h-208C138.8 144 128 154.8 128 168S138.8 192 152 192h208C373.3 192 384 181.3 384 168S373.3 144 360 144zM264 240h-112C138.8 240 128 250.8 128 264S138.8 288 152 288h112C277.3 288 288 277.3 288 264S277.3 240 264 240zM447.1 0h-384c-35.25 0-64 28.75-64 63.1v287.1c0 35.25 28.75 63.1 64 63.1h96v83.1c0 9.836 11.02 15.55 19.12 9.7l124.9-93.7h144c35.25 0 64-28.75 64-63.1V63.1C511.1 28.75 483.2 0 447.1 0zM464 352c0 8.75-7.25 16-16 16h-160l-80 60v-60H64c-8.75 0-16-7.25-16-16V64c0-8.75 7.25-16 16-16h384c8.75 0 16 7.25 16 16V352z"/></svg>',keyboard:["\u2318","\u21E7","X"]},{code:"prompts",name:"Prompts manager",icon:'<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-lg" viewBox="0 0 512 512" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="0" fill="currentColor"><path d="M72 48C85.25 48 96 58.75 96 72V120C96 133.3 85.25 144 72 144V232H128C128 218.7 138.7 208 152 208H200C213.3 208 224 218.7 224 232V280C224 293.3 213.3 304 200 304H152C138.7 304 128 293.3 128 280H72V384C72 388.4 75.58 392 80 392H128C128 378.7 138.7 368 152 368H200C213.3 368 224 378.7 224 392V440C224 453.3 213.3 464 200 464H152C138.7 464 128 453.3 128 440H80C49.07 440 24 414.9 24 384V144C10.75 144 0 133.3 0 120V72C0 58.75 10.75 48 24 48H72zM160 96C160 82.75 170.7 72 184 72H488C501.3 72 512 82.75 512 96C512 109.3 501.3 120 488 120H184C170.7 120 160 109.3 160 96zM288 256C288 242.7 298.7 232 312 232H488C501.3 232 512 242.7 512 256C512 269.3 501.3 280 488 280H312C298.7 280 288 269.3 288 256zM288 416C288 402.7 298.7 392 312 392H488C501.3 392 512 402.7 512 416C512 429.3 501.3 440 488 440H312C298.7 440 288 429.3 288 416z"/></svg>',keyboard:["\u2318","\u21E7","P"]},{code:"gallery",name:"Image gallery",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon icon-lg" fill="currentColor"><path d="M152 120c-26.51 0-48 21.49-48 48s21.49 48 48 48s48-21.49 48-48S178.5 120 152 120zM447.1 32h-384C28.65 32-.0091 60.65-.0091 96v320c0 35.35 28.65 64 63.1 64h384c35.35 0 64-28.65 64-64V96C511.1 60.65 483.3 32 447.1 32zM463.1 409.3l-136.8-185.9C323.8 218.8 318.1 216 312 216c-6.113 0-11.82 2.768-15.21 7.379l-106.6 144.1l-37.09-46.1c-3.441-4.279-8.934-6.809-14.77-6.809c-5.842 0-11.33 2.529-14.78 6.809l-75.52 93.81c0-.0293 0 .0293 0 0L47.99 96c0-8.822 7.178-16 16-16h384c8.822 0 16 7.178 16 16V409.3z"/></svg>',keyboard:["\u2318","\u21E7","Y"]},{code:"gpts",name:"GPT Store",icon:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-lg"><path fill-rule="evenodd" clip-rule="evenodd" d="M6.75 4.5C5.50736 4.5 4.5 5.50736 4.5 6.75C4.5 7.99264 5.50736 9 6.75 9C7.99264 9 9 7.99264 9 6.75C9 5.50736 7.99264 4.5 6.75 4.5ZM2.5 6.75C2.5 4.40279 4.40279 2.5 6.75 2.5C9.09721 2.5 11 4.40279 11 6.75C11 9.09721 9.09721 11 6.75 11C4.40279 11 2.5 9.09721 2.5 6.75Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M17.25 4.5C16.0074 4.5 15 5.50736 15 6.75C15 7.99264 16.0074 9 17.25 9C18.4926 9 19.5 7.99264 19.5 6.75C19.5 5.50736 18.4926 4.5 17.25 4.5ZM13 6.75C13 4.40279 14.9028 2.5 17.25 2.5C19.5972 2.5 21.5 4.40279 21.5 6.75C21.5 9.09721 19.5972 11 17.25 11C14.9028 11 13 9.09721 13 6.75Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M6.75 15C5.50736 15 4.5 16.0074 4.5 17.25C4.5 18.4926 5.50736 19.5 6.75 19.5C7.99264 19.5 9 18.4926 9 17.25C9 16.0074 7.99264 15 6.75 15ZM2.5 17.25C2.5 14.9028 4.40279 13 6.75 13C9.09721 13 11 14.9028 11 17.25C11 19.5972 9.09721 21.5 6.75 21.5C4.40279 21.5 2.5 19.5972 2.5 17.25Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M17.25 15C16.0074 15 15 16.0074 15 17.25C15 18.4926 16.0074 19.5 17.25 19.5C18.4926 19.5 19.5 18.4926 19.5 17.25C19.5 16.0074 18.4926 15 17.25 15ZM13 17.25C13 14.9028 14.9028 13 17.25 13C19.5972 13 21.5 14.9028 21.5 17.25C21.5 19.5972 19.5972 21.5 17.25 21.5C14.9028 21.5 13 19.5972 13 17.25Z" fill="currentColor"></path></svg>',keyboard:["\u2318","\u21E7","F"]},{code:"notes",name:"Notes",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon icon-lg" fill="currentColor"><path d="M320 480l128-128h-128V480zM400 31.1h-352c-26.51 0-48 21.49-48 48v352C0 458.5 21.49 480 48 480H288l.0039-128c0-17.67 14.33-32 32-32H448v-240C448 53.49 426.5 31.1 400 31.1z"/></svg>',keyboard:["\u2318","\u21E7","E"]},{code:"custom-instruction-profiles",name:"Custom instruction profiles",icon:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="icon icon-xl" style="position:relative;left:-2px;"><path d="M10.663 6.3872C10.8152 6.29068 11 6.40984 11 6.59007V8C11 8.55229 11.4477 9 12 9C12.5523 9 13 8.55229 13 8V6.59007C13 6.40984 13.1848 6.29068 13.337 6.3872C14.036 6.83047 14.5 7.61105 14.5 8.5C14.5 9.53284 13.8737 10.4194 12.9801 10.8006C12.9932 10.865 13 10.9317 13 11V13C13 13.5523 12.5523 14 12 14C11.4477 14 11 13.5523 11 13V11C11 10.9317 11.0068 10.865 11.0199 10.8006C10.1263 10.4194 9.5 9.53284 9.5 8.5C9.5 7.61105 9.96397 6.83047 10.663 6.3872Z" fill="currentColor"></path><path d="M17.9754 4.01031C17.8588 4.00078 17.6965 4.00001 17.4 4.00001H9.8C8.94342 4.00001 8.36113 4.00078 7.91104 4.03756C7.47262 4.07338 7.24842 4.1383 7.09202 4.21799C6.7157 4.40974 6.40973 4.7157 6.21799 5.09202C6.1383 5.24842 6.07337 5.47263 6.03755 5.91104C6.00078 6.36113 6 6.94343 6 7.80001V16.1707C6.31278 16.0602 6.64937 16 7 16H18L18 4.60001C18 4.30348 17.9992 4.14122 17.9897 4.02464C17.9893 4.02 17.9889 4.0156 17.9886 4.01145C17.9844 4.01107 17.98 4.01069 17.9754 4.01031ZM17.657 18H7C6.44772 18 6 18.4477 6 19C6 19.5523 6.44772 20 7 20H17.657C17.5343 19.3301 17.5343 18.6699 17.657 18ZM4 19L4 7.75871C3.99999 6.95374 3.99998 6.28937 4.04419 5.74818C4.09012 5.18608 4.18868 4.66938 4.43597 4.18404C4.81947 3.43139 5.43139 2.81947 6.18404 2.43598C6.66937 2.18869 7.18608 2.09012 7.74818 2.0442C8.28937 1.99998 8.95373 1.99999 9.7587 2L17.4319 2C17.6843 1.99997 17.9301 1.99994 18.1382 2.01695C18.3668 2.03563 18.6366 2.07969 18.908 2.21799C19.2843 2.40974 19.5903 2.7157 19.782 3.09203C19.9203 3.36345 19.9644 3.63318 19.9831 3.86178C20.0001 4.06994 20 4.31574 20 4.56812L20 17C20 17.1325 19.9736 17.2638 19.9225 17.386C19.4458 18.5253 19.4458 19.4747 19.9225 20.614C20.0517 20.9227 20.0179 21.2755 19.8325 21.5541C19.6471 21.8326 19.3346 22 19 22H7C5.34315 22 4 20.6569 4 19Z" fill="currentColor"></path></svg>',keyboard:["\u2318","\u21E7","I"]},{code:"pinned-messages",name:"Pinned messages",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" fill="currentColor" class="icon icon-lg"><path d="M336 0h-288C21.49 0 0 21.49 0 48v431.9c0 24.7 26.79 40.08 48.12 27.64L192 423.6l143.9 83.93C357.2 519.1 384 504.6 384 479.9V48C384 21.49 362.5 0 336 0zM336 452L192 368l-144 84V54C48 50.63 50.63 48 53.1 48h276C333.4 48 336 50.63 336 54V452z"/></svg>',keyboard:["\u2318","\u21E7","M"]},{code:"newsletters",name:"Newsletters",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon icon-lg" fill="currentColor"><path d="M456 32h-304C121.1 32 96 57.13 96 88v320c0 13.22-10.77 24-24 24S48 421.2 48 408V112c0-13.25-10.75-24-24-24S0 98.75 0 112v296C0 447.7 32.3 480 72 480h352c48.53 0 88-39.47 88-88v-304C512 57.13 486.9 32 456 32zM464 392c0 22.06-17.94 40-40 40H139.9C142.5 424.5 144 416.4 144 408v-320c0-4.406 3.594-8 8-8h304c4.406 0 8 3.594 8 8V392zM264 272h-64C186.8 272 176 282.8 176 296S186.8 320 200 320h64C277.3 320 288 309.3 288 296S277.3 272 264 272zM408 272h-64C330.8 272 320 282.8 320 296S330.8 320 344 320h64c13.25 0 24-10.75 24-24S421.3 272 408 272zM264 352h-64c-13.25 0-24 10.75-24 24s10.75 24 24 24h64c13.25 0 24-10.75 24-24S277.3 352 264 352zM408 352h-64C330.8 352 320 362.8 320 376s10.75 24 24 24h64c13.25 0 24-10.75 24-24S421.3 352 408 352zM400 112h-192c-17.67 0-32 14.33-32 32v64c0 17.67 14.33 32 32 32h192c17.67 0 32-14.33 32-32v-64C432 126.3 417.7 112 400 112z"/></svg>',keyboard:["\u2318","\u21E7","L"]},{code:"invite",name:"Invite friends",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" class="icon icon-xl" fill="currentColor" style="position:relative;left:2px;"><path d="M96 128a128 128 0 1 1 256 0A128 128 0 1 1 96 128zM0 482.3C0 383.8 79.8 304 178.3 304l91.4 0C368.2 304 448 383.8 448 482.3c0 16.4-13.3 29.7-29.7 29.7L29.7 512C13.3 512 0 498.7 0 482.3zM504 312l0-64-64 0c-13.3 0-24-10.7-24-24s10.7-24 24-24l64 0 0-64c0-13.3 10.7-24 24-24s24 10.7 24 24l0 64 64 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-64 0 0 64c0 13.3-10.7 24-24 24s-24-10.7-24-24z"/></svg>'},{code:"settings",name:"Settings",icon:'<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-lg" fill="currentColor" viewBox="0 0 512 512"><path d="M495.9 166.6C499.2 175.2 496.4 184.9 489.6 191.2L446.3 230.6C447.4 238.9 448 247.4 448 256C448 264.6 447.4 273.1 446.3 281.4L489.6 320.8C496.4 327.1 499.2 336.8 495.9 345.4C491.5 357.3 486.2 368.8 480.2 379.7L475.5 387.8C468.9 398.8 461.5 409.2 453.4 419.1C447.4 426.2 437.7 428.7 428.9 425.9L373.2 408.1C359.8 418.4 344.1 427 329.2 433.6L316.7 490.7C314.7 499.7 307.7 506.1 298.5 508.5C284.7 510.8 270.5 512 255.1 512C241.5 512 227.3 510.8 213.5 508.5C204.3 506.1 197.3 499.7 195.3 490.7L182.8 433.6C167 427 152.2 418.4 138.8 408.1L83.14 425.9C74.3 428.7 64.55 426.2 58.63 419.1C50.52 409.2 43.12 398.8 36.52 387.8L31.84 379.7C25.77 368.8 20.49 357.3 16.06 345.4C12.82 336.8 15.55 327.1 22.41 320.8L65.67 281.4C64.57 273.1 64 264.6 64 256C64 247.4 64.57 238.9 65.67 230.6L22.41 191.2C15.55 184.9 12.82 175.3 16.06 166.6C20.49 154.7 25.78 143.2 31.84 132.3L36.51 124.2C43.12 113.2 50.52 102.8 58.63 92.95C64.55 85.8 74.3 83.32 83.14 86.14L138.8 103.9C152.2 93.56 167 84.96 182.8 78.43L195.3 21.33C197.3 12.25 204.3 5.04 213.5 3.51C227.3 1.201 241.5 0 256 0C270.5 0 284.7 1.201 298.5 3.51C307.7 5.04 314.7 12.25 316.7 21.33L329.2 78.43C344.1 84.96 359.8 93.56 373.2 103.9L428.9 86.14C437.7 83.32 447.4 85.8 453.4 92.95C461.5 102.8 468.9 113.2 475.5 124.2L480.2 132.3C486.2 143.2 491.5 154.7 495.9 166.6V166.6zM256 336C300.2 336 336 300.2 336 255.1C336 211.8 300.2 175.1 256 175.1C211.8 175.1 176 211.8 176 255.1C176 300.2 211.8 336 256 336z"/></svg>',keyboard:["\u2318","\u21E7","."]}],upgradeButton={code:"upgrade",name:"Upgrade to Pro",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon icon-lg" fill="#ef4146"><path d="M80 192V144C80 64.47 144.5 0 224 0C303.5 0 368 64.47 368 144V192H384C419.3 192 448 220.7 448 256V448C448 483.3 419.3 512 384 512H64C28.65 512 0 483.3 0 448V256C0 220.7 28.65 192 64 192H80zM144 192H304V144C304 99.82 268.2 64 224 64C179.8 64 144 99.82 144 144V192z"/></svg>'};function selectedManagerTabTitle(e){switch(e){case"conversations":return"Conversations manager";case"prompts":return"Prompts manager";case"gallery":return"Image gallery";case"notes":return"Notes";case"custom-instruction-profiles":return"Custom instruction profiles";case"gpts":return"GPT Store";case"pinned-messages":return"Pinned messages";case"newsletters":return"What's happening in the world of AI";case"invite":return"Invite friends. Earn Pro Subscription";default:return"Prompts manager"}}function selectedManagerTabSubtitle(e){switch(e){case"conversations":return'Organize all your conversations in one place  <a href="https://www.youtube.com/watch?v=cfp0df9gSJcT" target="_blank" class="underline" rel="noreferrer">Learn more</a>';case"prompts":return'Create and manage all your prompts in one place  <a href="https://www.youtube.com/watch?v=cfp0df9gSJcT" target="_blank" class="underline" rel="noreferrer">Learn more</a>';case"gallery":return'Manage all your images in one place  <a href="https://www.youtube.com/watch?v=cfp0df9gSJcT" target="_blank" class="underline" rel="noreferrer">Learn more</a>';case"notes":return'All of your notes in one place  <a href="https://www.youtube.com/watch?v=JjBuaNtvTv4" target="_blank" class="underline" rel="noreferrer">Learn more</a>';case"custom-instruction-profiles":return'Create and manage all your custom instruction profiles in one place  <a href="https://help.openai.com/en/articles/8096356-custom-instructions-for-chatgpt" target="_blank" class="underline" rel="noreferrer">Learn more</a>';case"gpts":return'Enhanced GPT Store with full list of GPTs  <a href="https://youtu.be/vrC0FAeUi1E?si=zDDUNL2UVPCxcUbd" target="_blank" class="underline" rel="noreferrer">Learn more</a>';case"pinned-messages":return'Manage all your pinned messages in one place  <a href="https://www.youtube.com/watch?v=cfp0df9gSJcT" target="_blank" class="underline" rel="noreferrer">Learn more</a>';case"newsletters":return'You can find all of our previous newsletters here (<a href="https://superpowerdaily.com" target="_blank" rel="noopener noreferrer" class="underline">Read Online</a>)';case"invite":return"Get a free month of Pro Subscription for every friend you invite after they upgrade to the Pro subscription.";default:return'Create and manage all your prompts in one place  <a href="https://www.youtube.com/watch?v=ha2AiwOglt4&ab_channel=Superpower" target="_blank" class="underline" rel="noreferrer">Learn more</a>'}}function selectedManagerTabContent(e){switch(e){case"conversations":return conversationManagerModalContent();case"prompts":return promptManagerModalContent();case"newsletters":return newsletterListModalContent();case"notes":return noteListModalContent();case"custom-instruction-profiles":return customInstructionProfileManagerModalContent();case"gpts":return renderGizmoDiscoveryPage();case"pinned-messages":return pinnedMessageManagerModalContent();case"gallery":return createImageGallery();case"invite":return inviteManagerModalContent();default:return promptManagerModalContent()}}function selectedManagerTabAction(e){switch(e){case"prompts":return promptManagerModalActions();case"conversations":return conversationManagerModalActions();case"custom-instruction-profiles":return customInstructionProfileManagerModalActions();case"gpts":return gizmoManagerModalActions();case"invite":return inviteManagerModalActions();default:return noTabActions()}}function noTabActions(){return document.createElement("div")}function createManagerSideTab(e){const t=document.createElement("div");t.id="modal-manager-side-tab",t.classList="flex flex-col items-start justify-start h-full pt-4",t.style="z-index: 100000;";const o=[...managerTabList];o.splice(managerTabList.length-2,0,upgradeButton),o.forEach(n=>{const i=document.createElement("div");i.id=`modal-manager-side-tab-${n.code}`,i.classList="flex items-start gap-1.5 relative mb-2",n.code==="upgrade"&&(i.classList.add("hidden"),i.classList.add("mt-auto")),n.code==="invite"&&i.classList.add("mt-auto");const a=document.createElement("div");a.classList=`w-1.5 h-11 rounded-e-xl ${e===n.code?"bg-black dark:bg-white":""}`,i.appendChild(a);const s=document.createElement("button");s.classList=`flex items-center gap-1.5 rounded-md p-2 m-auto text-token-text-${e===n.code?"primary":"tertiary"} hover:text-token-text-primary rounded-lg bg-token-sidebar-surface-secondary cursor-pointer`,s.innerHTML=n.icon,s.addEventListener("click",async l=>{if(n.code==="settings"){l.stopPropagation(),l.preventDefault(),closeMenus();const u=await chrome.runtime.sendMessage({type:"checkHasSubscription"}),m=l.shiftKey&&l.altKey;showManagerSidebarSettingsMenu(s,u,m);return}if(n.code==="upgrade"){l.stopPropagation(),l.preventDefault(),openUpgradeModal();return}const d=document.querySelector('[id="modal-wrapper-manager"]'),c=d.style.width==="100vw"&&d.style.height==="100vh";createManager(n.code,c)}),i.appendChild(s),addTooltip(i,{value:`<div class="me-2">${translate(n.name)}</div><div claass="text-token-text-tertiary ms-2">${buttonGenerator(n?.keyboard||[],"xs")}</div>`,position:"right"}),t.appendChild(i)});const r=document.createElement("div");return r.classList="w-full flex items-center justify-center cursor-pointer",chrome.runtime.sendMessage({type:"checkHasSubscription"},n=>{n||(document.querySelector("#modal-manager-side-tab-upgrade")?.classList.remove("hidden"),document.querySelector("#modal-manager-side-tab-invite")?.classList.remove("mt-auto")),r.innerHTML=`<span class="flex items-center text-xs text-token-text-tertiary mb-1 ms-1">v${chrome.runtime.getManifest().version} <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" class="ms-1 icon icon-xs" stroke="currentColor" fill="${n?"gold":"currentColor"}"><path d="M240.5 224H352C365.3 224 377.3 232.3 381.1 244.7C386.6 257.2 383.1 271.3 373.1 280.1L117.1 504.1C105.8 513.9 89.27 514.7 77.19 505.9C65.1 497.1 60.7 481.1 66.59 467.4L143.5 288H31.1C18.67 288 6.733 279.7 2.044 267.3C-2.645 254.8 .8944 240.7 10.93 231.9L266.9 7.918C278.2-1.92 294.7-2.669 306.8 6.114C318.9 14.9 323.3 30.87 317.4 44.61L240.5 224z"/></svg></span>`}),r.addEventListener("click",()=>{const{version:n}=chrome.runtime.getManifest();createReleaseNoteModal(n)}),t.appendChild(r),t}function postModalCreate(e,t){window.location.hash=`manager/${t}`;const o=document.querySelector("#modal-title");o.innerHTML=e,document.querySelector("#modal-close-button-manager")?.addEventListener("click",()=>{chrome.storage.local.set({selectedPromptFolderBreadcrumb,selectedConversationFolderBreadcrumb,managerModalCurrentTab})});const r=document.querySelector("#modal-manager"),n=document.querySelector("#modal-wrapper-manager");r.addEventListener("mousedown",a=>{n.contains(a.target)||chrome.storage.local.set({selectedPromptFolderBreadcrumb,selectedConversationFolderBreadcrumb,managerModalCurrentTab})}),addNewsletterIndicator();const i=[{code:"all",name:"All"},...languageList.slice(1)];switch(t){case"conversations":addDropdownEventListener("Conversations-Manager-SortBy",conversationsSortByList,"code",()=>fetchConversations());break;case"prompts":addDropdownEventListener("Prompts-Manager-SortBy",promptsSortByList,"code",()=>fetchPrompts()),addDropdownEventListener("Prompts-Manager-Language",i,"code",()=>fetchPrompts());break;case"notes":fetchNotes(),addDropdownEventListener("Notes-SortBy",notesSortByList,"code",()=>fetchNotes());break;case"newsletters":loadNewsletterList();break;case"gallery":addImageGalleryEventListeners(),loadImageList();break;case"custom-instruction-profiles":fetchCustomInstructionProfiles(),addDropdownEventListener("Profiles-Manager-SortBy",profilesSortByList,"code",()=>fetchCustomInstructionProfiles());break;case"pinned-messages":fetchPinnedMessages();break;default:break}}function addNewsletterIndicator(){chrome.storage.local.get(["readNewsletterIds"],e=>{const t=e.readNewsletterIds||[];chrome.runtime.sendMessage({type:"getLatestNewsletter"},o=>{!o||!o.id||t.includes(o.id)||document.querySelector("#modal-manager-side-tab-newsletters")?.insertAdjacentElement("beforeend",animatePing("#ef4146"))})})}async function createManager(e="prompts",t=!1){if(closeMenus(),closeModals(),managerTabList.map(l=>l.code).indexOf(e)===-1){window.location.hash="";return}managerModalCurrentTab=e,chrome.storage.local.set({selectedPromptFolderBreadcrumb,selectedConversationFolderBreadcrumb,managerModalCurrentTab});const o=document.querySelector("#modal-manager");o&&o.remove();const r=createManagerSideTab(managerModalCurrentTab),n=translate(selectedManagerTabTitle(managerModalCurrentTab)),i=selectedManagerTabSubtitle(managerModalCurrentTab),a=selectedManagerTabContent(managerModalCurrentTab),s=selectedManagerTabAction(managerModalCurrentTab);createModal("Manager",i,a,s,!0,"large",r,t),postModalCreate(n,managerModalCurrentTab)}async function addManagerButton(){if(document.querySelector("#manager-button"))return;const e=document.createElement("div");e.id="manager-button-wrapper",e.classList="flex flex-wrap z-10",e.style="margin-bottom: 1rem;right: 0;padding:0 12px;min-width: 56px;";const t=document.createElement("div");t.id="manager-button-hidden-list",t.classList="hidden mb-2 flex flex-wrap w-full gap-1.5 bg-token-main-surface-primary rounded-md",t.style="backdrop-filter: blur(10px);",e.appendChild(t),chrome.runtime.sendMessage({type:"checkHasSubscription"},n=>{const i=[...managerTabList].reverse();n||i.unshift(upgradeButton),i.forEach(a=>{if(["conversations","prompts","gallery","settings","upgrade"].includes(a.code)){const s=document.createElement("button");s.classList="flex items-center justify-center border border-token-border-medium text-token-text-tertiary bg-token-main-surface-primary hover:text-token-text-primary text-xs font-sans cursor-pointer rounded-md w-8 h-8 shawod-long",s.innerHTML=a.icon.replace("icon icon-lg","icon icon-sm").replace("icon icon-xl","icon icon-sm"),addTooltip(s,{value:`<div class="me-2">${translate(a.code)}</div><div claass="text-token-text-tertiary ms-2">${buttonGenerator(a?.keyboard||[],"xs")}</div>`,position:"left"}),s.addEventListener("click",()=>{if(a.code==="settings"){createSettingsModal();return}if(a.code==="upgrade"){openUpgradeModal();return}createManager(a.code)}),t.appendChild(s)}})});const o=document.createElement("button");o.id="manager-button",o.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" class="icon icon-lg" stroke="purple" fill="purple"><path d="M240.5 224H352C365.3 224 377.3 232.3 381.1 244.7C386.6 257.2 383.1 271.3 373.1 280.1L117.1 504.1C105.8 513.9 89.27 514.7 77.19 505.9C65.1 497.1 60.7 481.1 66.59 467.4L143.5 288H31.1C18.67 288 6.733 279.7 2.044 267.3C-2.645 254.8 .8944 240.7 10.93 231.9L266.9 7.918C278.2-1.92 294.7-2.669 306.8 6.114C318.9 14.9 323.3 30.87 317.4 44.61L240.5 224z"/></svg>',o.classList="flex items-center justify-center border border-token-border-medium text-token-text-tertiary bg-gold hover:bg-gold-dark hover:text-token-text-primary text-xs font-sans cursor-pointer rounded-md w-8 h-8 shadow-long",addTooltip(o,{value:translate("Manager"),position:"left"}),o.addEventListener("click",async n=>{if(n.shiftKey){(n.metaKey||n.ctrlKey)&&(await chrome.storage.local.set({lastFullSyncRun:null}),chrome.runtime.sendMessage({type:"initConvHistorySync",forceRefresh:!0,detail:{syncIntervalTime:5e3}})),chrome.runtime.sendMessage({type:"clearAllCache",forceRefresh:!0},()=>{window.location.reload()});return}createManager(managerModalCurrentTab)}),e.appendChild(o),e.addEventListener("mouseenter",()=>{t.classList.remove("hidden")}),e.addEventListener("mouseleave",()=>{t.classList.add("hidden")});const r=document.querySelector("#floating-button-wrapper");r||addFloatingButtons(),r?.insertAdjacentElement("afterbegin",e)}function showManagerSidebarSettingsMenu(e,t,o=!1){const{right:r,top:n}=e.getBoundingClientRect(),i=r+2,a=n-180,s=`<div id="manager-sidebar-settings-menu" dir="ltr" style="position:fixed;left:0;top:0;transform:translate3d(${i}px,${a}px,0);min-width:max-content;z-index:10001;--radix-popper-anchor-width:18px;--radix-popper-anchor-height:18px;--radix-popper-available-width:1167px;--radix-popper-available-height:604px;--radix-popper-transform-origin:0% 0px"><div data-side="bottom" data-align="start" role="menu" aria-orientation="vertical" data-state="open" data-radix-menu-content="" dir="ltr" aria-labelledby="radix-:r6g:" class="text-token-text-primary mt-2 min-w-[200px] max-w-xs rounded-2xl bg-token-main-surface-secondary shadow-long p-1" tabindex="-1" data-orientation="vertical" style="outline:0;--radix-dropdown-menu-content-transform-origin:var(--radix-popper-transform-origin);--radix-dropdown-menu-content-available-width:var(--radix-popper-available-width);--radix-dropdown-menu-content-available-height:var(--radix-popper-available-height);--radix-dropdown-menu-trigger-width:var(--radix-popper-anchor-width);--radix-dropdown-menu-trigger-height:var(--radix-popper-anchor-height);pointer-events:auto">
  

  <div role="menuitem" id="manager-settings-button" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item="">${translate("Settings")}</div>
  
  <!--div role="menuitem" id="manager-${t?"subscription":"upgrade"}-button" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item="">${translate(t?"Manage subscription":"Upgrade to Pro")}</div-->  
  
  
  <div role="menuitem" id="manager-keyboard-shortcuts-button" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item="">${translate("Keyboard shortcuts")}</div>
  
  <div role="menuitem" id="manager-release-note-button" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item="">${translate("Release note")}</div>
  
  <div role="menuitem" id="manager-help-button" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item="">${translate("Help")}</div>
  
  <div role="menuitem" id="manager-about-button" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item="">${translate("About")}</div>
  <div id="conv-sync-status" class="text-xs m-1 px-2.5 ${o?"":"hidden"}"></div>
  </div></div>`;document.body.insertAdjacentHTML("beforeend",s),addManagerSidebarSettingsMenuEventListeners(o)}function addManagerSidebarSettingsMenuEventListeners(e=!1){const t=document.querySelector("#manager-sidebar-settings-menu"),o=document.querySelector("#manager-settings-button"),r=document.querySelector("#manager-upgrade-button"),n=document.querySelector("#manager-subscription-button"),i=document.querySelector("#manager-help-button"),a=document.querySelector("#manager-keyboard-shortcuts-button"),s=document.querySelector("#manager-release-note-button"),l=document.querySelector("#manager-about-button");o?.addEventListener("click",()=>{t?.remove(),createSettingsModal()}),r?.addEventListener("click",()=>{t?.remove(),openUpgradeModal(!1)}),n?.addEventListener("click",()=>{t?.remove(),openUpgradeModal(!0)}),i?.addEventListener("click",()=>{t?.remove(),showHelpModal()}),a?.addEventListener("click",()=>{t?.remove(),createKeyboardShortcutsModal()}),s?.addEventListener("click",()=>{t?.remove();const{version:d}=chrome.runtime.getManifest();createReleaseNoteModal(d)}),l?.addEventListener("click",()=>{t?.remove(),showAboutModal()}),e&&chrome.runtime.sendMessage({type:"getTotalConversationsCount",forceRefresh:!0},d=>{chrome.runtime.sendMessage({type:"getSyncedConversationCount",forceRefresh:!0},c=>{const u=document.querySelector("#conv-sync-status");u&&(u.classList.remove("hidden"),u.textContent=`${c} / ${d} ${translate("synced")}`)})})}function showHelpModal(){document.body.insertAdjacentHTML("beforeend",`<div id="manager-help-modal" class="absolute inset-0" style="z-index:10000;">
  <div data-state="open" class="fixed inset-0 bg-black/50 dark:bg-black/80" style="pointer-events: auto;">
    <div class="z-50 h-full w-full overflow-y-auto grid grid-cols-[10px_1fr_10px] grid-cols-[10px_1fr_10px] grid-rows-[minmax(10px,1fr)_auto_minmax(10px,1fr)] md:grid-rows-[minmax(20px,1fr)_auto_minmax(20px,1fr)]">
      <div id="manager-help-modal-dialog" role="dialog" aria-describedby="radix-:r9e:" aria-labelledby="radix-:r9d:" data-state="open" class="popover relative start-1/2 col-auto col-start-2 row-auto row-start-2 h-full w-full bg-token-main-surface-primary text-start shadow-xl ltr:-translate-x-1/2 rtl:translate-x-1/2 rounded-2xl flex flex-col focus:outline-none max-w-[550px]" tabindex="-1" style="pointer-events: auto;">
        <div class="p-4 flex items-center justify-between border-b border-black/10 dark:border-white/10">
          <div class="flex">
            <div class="flex items-center">
              <div class="flex grow items-center gap-1">
                <h2 class="text-lg font-semibold leading-6 text-token-text-primary">Help center</h2>
              </div>
            </div>
          </div>
          <button id="help-modal-close-button" data-testid="close-button" class="flex h-8 w-8 items-center justify-center rounded-full text-token-text-primary  bg-transparent hover:bg-token-main-surface-tertiary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-token-text-quaternary focus-visible:ring-offset-1 focus-visible:ring-offset-transparent dark:hover:bg-token-main-surface-tertiary sm:mt-0" aria-label="Close">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"
              xmlns="http://www.w3.org/2000/svg" class="icon icon-md">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M5.63603 5.63604C6.02656 5.24552 6.65972 5.24552 7.05025 5.63604L12 10.5858L16.9497 5.63604C17.3403 5.24552 17.9734 5.24552 18.364 5.63604C18.7545 6.02657 18.7545 6.65973 18.364 7.05025L13.4142 12L18.364 16.9497C18.7545 17.3403 18.7545 17.9734 18.364 18.364C17.9734 18.7545 17.3403 18.7545 16.9497 18.364L12 13.4142L7.05025 18.364C6.65972 18.7545 6.02656 18.7545 5.63603 18.364C5.24551 17.9734 5.24551 17.3403 5.63603 16.9497L10.5858 12L5.63603 7.05025C5.24551 6.65973 5.24551 6.02657 5.63603 5.63604Z"></path>
            </svg>
          </button>
        </div>
        <div class="flex-grow overflow-y-auto p-4 sm:p-6">
          <div class="w-full">
            <p>Here are some resources to help you get started with Superpower ChatGPT:</p>
            <ul class="list-disc list-inside mt-4">
              <li class="text-token-text-tertiary">
                Join our <a href="https://discord.gg/superpower-chatgpt-1083455984489476220" class="inline-flex items-center gap-2 text-token-text-tertiary underline hover:text-token-text-tertiary" target="_blank" rel="noreferrer">Discord</a> community to get help and share your feedback
              </li>
              <li class="text-token-text-tertiary">
                Watch our <a href="https://www.youtube.com/@spchatgpt" class="inline-flex items-center gap-2 text-token-text-tertiary underline hover:text-token-text-tertiary" target="_blank" rel="noreferrer">YouTube</a> channel for tutorials and tips
              </li>
              <li class="text-token-text-tertiary">
                Read our <a href="https://ezi.notion.site/Superpower-ChatGPT-FAQ-9d43a8a1c31745c893a4080029d2eb24" class="inline-flex items-center gap-2 text-token-text-tertiary underline hover:text-token-text-tertiary" target="_blank" rel="noreferrer">FAQ</a>
              </li>
              <li class="text-token-text-tertiary">
                Visit <a href="https://help.openai.com/en/collections/3742473-chatgpt" class="inline-flex items-center gap-2 text-token-text-tertiary underline hover:text-token-text-tertiary" target="_blank" rel="noreferrer">ChatGPT help center</a>
              </li>
            </ul>
            <br/>
            <p>For any other questions, feel free to <a target="_blank" class="mx-1 font-semibold underline" href="mailto:support@spchatgpt.com?subject=Superpower ChatGPT Pro Subscription">Email Us</a> or <a target="_blank" class="mx-1 font-semibold underline" href="https://calendly.com/ezii/20min">Book a call</a> with us. We will be happy to walk you through the features and answer any questions you may have.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>`),addManagerHelpModalEventListeners()}function addManagerHelpModalEventListeners(){const e=document.querySelector("#manager-help-modal"),t=e.querySelector('[data-testid="close-button"]');e?.addEventListener("click",o=>{const r=document.querySelector("#manager-help-modal-dialog");r&&!r?.contains(o.target)&&e?.remove()}),t?.addEventListener("click",()=>{e?.remove()})}function showAboutModal(){const{version:e}=chrome.runtime.getManifest(),t=`<div id="manager-about-modal" class="absolute inset-0" style="z-index:10000;">
  <div data-state="open" class="fixed inset-0 bg-black/50 dark:bg-black/80" style="pointer-events: auto;">
    <div class="z-50 h-full w-full overflow-y-auto grid grid-cols-[10px_1fr_10px] grid-cols-[10px_1fr_10px] grid-rows-[minmax(10px,1fr)_auto_minmax(10px,1fr)] md:grid-rows-[minmax(20px,1fr)_auto_minmax(20px,1fr)]">
      <div id="manager-about-modal-dialog" role="dialog" aria-describedby="radix-:r9e:" aria-labelledby="radix-:r9d:" data-state="open" class="popover relative start-1/2 col-auto col-start-2 row-auto row-start-2 h-full w-full bg-token-main-surface-primary text-start shadow-xl ltr:-translate-x-1/2 rtl:translate-x-1/2 rounded-2xl flex flex-col focus:outline-none max-w-[550px]" tabindex="-1" style="pointer-events: auto;">
        <div class="p-4 flex items-center justify-between border-b border-black/10 dark:border-white/10">
          <div class="flex">
            <div class="flex items-center">
              <div class="flex grow items-center gap-1">
                <img src="chrome-extension://amhmeenmapldpjdedekalnfifgnpfnkc/icons/logo.png" style="width: 64px; height: 64px;">
                <h2 class="text-lg font-semibold leading-6 text-token-text-primary">Superpower ChatGPT</h2>
              </div>
            </div>
          </div>
          <button id="about-modal-close-button" data-testid="close-button" class="flex h-8 w-8 items-center justify-center rounded-full text-token-text-primary  bg-transparent hover:bg-token-main-surface-tertiary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-token-text-quaternary focus-visible:ring-offset-1 focus-visible:ring-offset-transparent dark:hover:bg-token-main-surface-tertiary sm:mt-0" aria-label="Close">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"
              xmlns="http://www.w3.org/2000/svg" class="icon icon-md">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M5.63603 5.63604C6.02656 5.24552 6.65972 5.24552 7.05025 5.63604L12 10.5858L16.9497 5.63604C17.3403 5.24552 17.9734 5.24552 18.364 5.63604C18.7545 6.02657 18.7545 6.65973 18.364 7.05025L13.4142 12L18.364 16.9497C18.7545 17.3403 18.7545 17.9734 18.364 18.364C17.9734 18.7545 17.3403 18.7545 16.9497 18.364L12 13.4142L7.05025 18.364C6.65972 18.7545 6.02656 18.7545 5.63603 18.364C5.24551 17.9734 5.24551 17.3403 5.63603 16.9497L10.5858 12L5.63603 7.05025C5.24551 6.65973 5.24551 6.02657 5.63603 5.63604Z"></path>
            </svg>
          </button>
        </div>
        <div class="flex-grow overflow-y-auto p-4 sm:p-6">
          <div class="w-full">
            <p class="mb-6 text-token-text-tertiary">
              <span>Take ChatGPT to the next level with features like folders, search, enhanced GPT store, image gallery, voice GPT, custom prompts, prompt chains, hidden models, and many more...  
                <a href="https://spchatgpt.com/" class="inline-flex items-center gap-2 text-token-text-tertiary underline hover:text-token-text-tertiary" target="_blank" rel="noreferrer">Learn more</a>
              </span>
            </p>
            <p class="mb-6 text-token-text-tertiary">
              <span>Enjoy Superpower ChatGPT and want the share it with others?   
                <a href="https://spchatgpt.com/affiliate" class="inline-flex items-center gap-2 text-token-text-tertiary underline hover:text-token-text-tertiary" target="_blank" rel="noreferrer">Become an affiliate</a>
              </span>
            </p>
            <p class="mb-6 text-token-text-tertiary">
              <span>Version v${e} -   
                <span id="manager-release-note" class="underline cursor-pointer inline-flex items-center gap-2 text-token-text-tertiary underline hover:text-token-text-tertiary">Release Note</span>
              </span>
            </p>
            <p class="mb-6 text-token-text-tertiary">
              <span>
                Created by <a href="https://twitter.com/eeeziii" target="_blank" class="underline cursor-pointer inline-flex items-center gap-2 text-token-text-tertiary underline hover:text-token-text-tertiary">Saeed Ezzati</a> - 
                <a href="https://www.buymeacoffee.com/ezii" target="_blank" class="underline cursor-pointer inline-flex items-center gap-2 text-token-text-tertiary underline hover:text-token-text-tertiary">\u{1F355} Buy me a pizza \u279C</a>
              </span>
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>`;document.body.insertAdjacentHTML("beforeend",t),addAboutModalEventListeners(e)}function addAboutModalEventListeners(e){const t=document.querySelector("#manager-about-modal");if(!t)return;const o=t?.querySelector("button"),r=t?.querySelector("#manager-release-note");t?.addEventListener("click",n=>{const i=document.querySelector("#manager-about-modal-dialog");i&&!i?.contains(n.target)&&t?.remove()}),o?.addEventListener("click",n=>{n.stopPropagation(),closeMenus(),t?.remove()}),r?.addEventListener("click",n=>{n.stopPropagation(),closeMenus(),t?.remove(),createReleaseNoteModal(e)})}function customInstructionProfileManagerModalContent(){const e=document.createElement("div");e.id="modal-content-custom-instruction-profile-manager",e.classList="markdown prose-invert relative h-full overflow-hidden",e.style.paddingBottom="59px";const t=document.createElement("div");t.classList="flex items-center justify-between p-2 bg-token-main-surface-primary border-b border-token-border-medium sticky top-0 z-10",e.appendChild(t);const o=document.createElement("input");o.id="custom-instruction-profile-manager-search-input",o.type="search",o.placeholder=translate("Search profiles"),o.classList="text-token-text-primary bg-token-main-surface-secondary border border-token-border-medium text-sm rounded-md w-full h-10",o.autocomplete="off";const r=debounce(()=>{fetchCustomInstructionProfiles()});o.addEventListener("input",d=>{d.target.value.trim()!==""?r(d):fetchCustomInstructionProfiles();const c=document.querySelector("#custom-instruction-profile-manager-search-term-pill"),u=document.querySelector("#custom-instruction-profile-manager-search-term-pill-text");d.target.value.trim()!==""?(u.innerText=d.target.value.trim(),c.classList.remove("hidden")):(u.innerText="",c.classList.add("hidden"))}),t.appendChild(o);const{selectedProfilesManagerSortBy:n}=cachedSettings,i=document.createElement("div");i.id="custom-instruction-profile-manager-sort-by-wrapper",i.style="position:relative;width:150px;z-index:1000;margin-left:8px;",i.innerHTML=dropdown("Profiles-Manager-SortBy",profilesSortByList,n,"code","right"),t.appendChild(i);const a=profileCardCompactViewButton();t.appendChild(a);const s=document.createElement("div");s.id="custom-instruction-profile-manager-search-term-pill",s.classList="hidden flex items-center justify-center bg-token-main-surface-secondary text-token-text-primary rounded-full p-1 px-2 me-2 mt-2 ms-4 border border-token-border-medium max-w-fit",s.innerHTML='<button id="custom-instruction-profile-manager-search-term-pill-clear-button" class="focus-visible:outline-0 hover:bg-token-main-surface-tertiary focus-visible:bg-token-main-surface-tertiary rounded-full mx-1"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="20" width="20" xmlns="http://www.w3.org/2000/svg"> <line x1="18" y1="6" x2="6" y2="18"></line> <line x1="6" y1="6" x2="18" y2="18"></line> </svg></button><span id="custom-instruction-profile-manager-search-term-pill-text" class="text-sm mx-1 text-danger"></span>',s.querySelector("#custom-instruction-profile-manager-search-term-pill-clear-button").addEventListener("click",()=>{const d=document.querySelector("#custom-instruction-profile-manager-search-input");d.value="",d.dispatchEvent(new Event("input"))}),e.appendChild(s);const l=document.createElement("div");return l.id="custom-instruction-profile-manager-profile-list",l.classList="grid grid-cols-1 gap-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 p-4 pb-32 overflow-y-auto h-full content-start",e.appendChild(l),e}function customInstructionProfileManagerModalActions(){const e=document.createElement("div");e.classList="flex items-center justify-end w-full mt-2";const t=document.createElement("button");return t.classList="btn composer-submit-btn composer-submit-button-color",t.innerText=translate("plus Add New Profile"),t.addEventListener("click",async o=>{if(o.shiftKey){chrome.storage.local.get(["customInstructionProfiles"]).then(i=>{const a=JSON.stringify(i.customInstructionProfiles),s=document.createElement("textarea");s.value=a,document.body.appendChild(s),s.select(),document.execCommand("copy"),document.body.removeChild(s),toast("Copied to clipboard")});return}const r=await chrome.runtime.sendMessage({type:"checkHasSubscription"}),n=document.querySelectorAll('#modal-manager div[id^="custom-instruction-profile-card-"]');if(!r&&n.length>=2){errorUpgradeConfirmation({type:"limit",title:"You have reached the limit",message:"You have reached the limits of Custom Instruction Profiles with free account. Upgrade to Pro to remove all limits."});return}createCustomInstructionProfileEditor()}),e.appendChild(t),e}function profileCardCompactViewButton(){const{selectedProfileView:e}=cachedSettings,t=document.createElement("button");return t.classList="h-10 aspect-1 flex items-center justify-center rounded-lg px-2 ms-2 text-token-text-tertiary focus-visible:outline-0 bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary focus-visible:bg-token-main-surface-secondary",t.innerHTML=e==="list"?'<svg fill="currentColor" class="icon icon-md" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M320 192h96c17.6 0 32-14.4 32-32V64c0-17.6-14.4-32-32-32h-96c-17.6 0-32 14.4-32 32v96C288 177.6 302.4 192 320 192zM336 80h64v64h-64V80zM480 256h-160c-17.67 0-32 14.33-32 32v160c0 17.67 14.33 32 32 32h160c17.67 0 32-14.33 32-32V288C512 270.3 497.7 256 480 256zM464 432h-128v-128h128V432zM206.4 335.1L152 394.9V56.02C152 42.76 141.3 32 128 32S104 42.76 104 56.02v338.9l-54.37-58.95c-4.719-5.125-11.16-7.719-17.62-7.719c-5.812 0-11.66 2.094-16.28 6.375c-9.75 8.977-10.34 24.18-1.344 33.94l95.1 104.1c9.062 9.82 26.19 9.82 35.25 0l95.1-104.1c9-9.758 8.406-24.96-1.344-33.94C230.5 325.5 215.3 326.2 206.4 335.1z"/></svg>':'<svg fill="currentColor" class="icon icon-md" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M480 256h-160c-17.67 0-32 14.33-32 32v160c0 17.67 14.33 32 32 32h160c17.67 0 32-14.33 32-32V288C512 270.3 497.7 256 480 256zM464 432h-128v-128h128V432zM320 192h96c17.6 0 32-14.4 32-32V64c0-17.6-14.4-32-32-32h-96c-17.6 0-32 14.4-32 32v96C288 177.6 302.4 192 320 192zM336 80h64v64h-64V80zM145.6 39.37c-9.062-9.82-26.19-9.82-35.25 0L14.38 143.4c-9 9.758-8.406 24.96 1.344 33.94C20.35 181.7 26.19 183.8 32 183.8c6.469 0 12.91-2.594 17.62-7.719L104 117.1v338.9C104 469.2 114.8 480 128 480s24-10.76 24-24.02V117.1l54.37 58.95C215.3 185.8 230.5 186.5 240.3 177.4C250 168.4 250.6 153.2 241.6 143.4L145.6 39.37z"/></svg>',t.addEventListener("click",()=>{document.querySelectorAll('#modal-manager div[id^="custom-instruction-profile-card-"]').forEach(o=>{cachedSettings.selectedProfileView==="list"?(o.classList.remove("aspect-2"),o.classList.add("aspect-1")):(o.classList.remove("aspect-1"),o.classList.add("aspect-2"))}),cachedSettings.selectedProfileView==="list"?t.innerHTML='<svg fill="currentColor" class="icon icon-md" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M480 256h-160c-17.67 0-32 14.33-32 32v160c0 17.67 14.33 32 32 32h160c17.67 0 32-14.33 32-32V288C512 270.3 497.7 256 480 256zM464 432h-128v-128h128V432zM320 192h96c17.6 0 32-14.4 32-32V64c0-17.6-14.4-32-32-32h-96c-17.6 0-32 14.4-32 32v96C288 177.6 302.4 192 320 192zM336 80h64v64h-64V80zM145.6 39.37c-9.062-9.82-26.19-9.82-35.25 0L14.38 143.4c-9 9.758-8.406 24.96 1.344 33.94C20.35 181.7 26.19 183.8 32 183.8c6.469 0 12.91-2.594 17.62-7.719L104 117.1v338.9C104 469.2 114.8 480 128 480s24-10.76 24-24.02V117.1l54.37 58.95C215.3 185.8 230.5 186.5 240.3 177.4C250 168.4 250.6 153.2 241.6 143.4L145.6 39.37z"/></svg>':t.innerHTML='<svg fill="currentColor" class="icon icon-md" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M320 192h96c17.6 0 32-14.4 32-32V64c0-17.6-14.4-32-32-32h-96c-17.6 0-32 14.4-32 32v96C288 177.6 302.4 192 320 192zM336 80h64v64h-64V80zM480 256h-160c-17.67 0-32 14.33-32 32v160c0 17.67 14.33 32 32 32h160c17.67 0 32-14.33 32-32V288C512 270.3 497.7 256 480 256zM464 432h-128v-128h128V432zM206.4 335.1L152 394.9V56.02C152 42.76 141.3 32 128 32S104 42.76 104 56.02v338.9l-54.37-58.95c-4.719-5.125-11.16-7.719-17.62-7.719c-5.812 0-11.66 2.094-16.28 6.375c-9.75 8.977-10.34 24.18-1.344 33.94l95.1 104.1c9.062 9.82 26.19 9.82 35.25 0l95.1-104.1c9-9.758 8.406-24.96-1.344-33.94C230.5 325.5 215.3 326.2 206.4 335.1z"/></svg>',chrome.storage.local.set({settings:{...cachedSettings,selectedProfileView:cachedSettings.selectedProfileView==="list"?"grid":"list"}})}),t}function createCustomInstructionProfileCard(e){const t=document.createElement("div");return t.id=`custom-instruction-profile-card-${e.id}`,t.classList=`bg-token-main-surface-primary border border-token-border-medium p-4 pb-2 rounded-md cursor-pointer hover:bg-token-main-surface-tertiary ${cachedSettings.selectedProfileView==="list"?"aspect-2":"aspect-1"} flex flex-col h-auto`,t.style="height: max-content;outline-offset: 4px; outline: none;",t.innerHTML=`<div class="flex items-center justify-between border-b border-token-border-medium pb-1">
    <div class="text-md text-token-text-primary whitespace-nowrap overflow-hidden text-ellipsis flex items-center w-full">
      ${escapeHTML(e.name)}
    </div>
    
    <button id="profile-card-settings-button-${e.id}" class="relative flex items-center justify-center h-8 rounded-lg px-2 text-token-text-tertiary focus-visible:outline-0 hover:bg-token-sidebar-surface-tertiary focus-visible:bg-token-sidebar-surface-secondary">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 12C3 10.8954 3.89543 10 5 10C6.10457 10 7 10.8954 7 12C7 13.1046 6.10457 14 5 14C3.89543 14 3 13.1046 3 12ZM10 12C10 10.8954 10.8954 10 12 10C13.1046 10 14 10.8954 14 12C14 13.1046 13.1046 14 12 14C10.8954 14 10 13.1046 10 12ZM17 12C17 10.8954 17.8954 10 19 10C20.1046 10 21 10.8954 21 12C21 13.1046 20.1046 14 19 14C17.8954 14 17 13.1046 17 12Z" fill="currentColor"></path></svg>
    </button>

  </div>
  <div class="text-token-text-tertiary text-sm whitespace-wrap overflow-hidden text-ellipsis  break-all">${escapeHTML(`${e.name_user_message||""} ${e.name_user_message?" - ":""} ${e.role_user_message||""}`.substring(0,250))}</div>

  <div class="flex-1 text-token-text-tertiary text-sm whitespace-wrap overflow-hidden text-ellipsis  break-all">${escapeHTML(`${e.traits_model_message||""} ${e.other_user_message||""}`.substring(0,250))}</div>

  <div class="flex overflow-hidden my-1" style="min-height:18px;">
    ${["browsing","code","canmore","advanced_voice"].filter(o=>!e.disabled_tools.includes(o)).map(o=>`<span title="${o==="canmore"?"Canvas":capitalize(o.replaceAll("_"," "))}" id="profile-card-tag-${o}" class="border border-token-border-medium hover:bg-token-main-surface-secondary text-token-text-tertiary text-xs px-2 rounded-full me-1 capitalize whitespace-nowrap overflow-hidden text-ellipsis">${o==="canmore"?"Canvas":o.replaceAll("_"," ")}</span>`).join("")}
  </div>
  
  <div class="border-t border-token-border-medium flex justify-between items-center pt-1">
   
    <div id="profile-card-action-${e.id}" class="flex items-center w-full">
      <div class="cursor-pointer text-sm flex items-center justify-between gap-2 mt-1 w-full">${translate("Enable this profile")}<label class="sp-switch" style="margin-right:0;"><input id="profile-card-status-switch-${e.id}" type="checkbox" ${e.enabled?'checked=""':""}><span class="sp-switch-slider round"></span></label></div>
    </div>
  </div>`,t.addEventListener("click",()=>{const o=t.querySelector(`#profile-card-status-switch-${e.id}`).checked;e.enabled=o,createCustomInstructionProfileEditor(e)}),t}function addCustomInstructionProfileCardEventListeners(e){const t=document.querySelector(`#custom-instruction-profile-card-${e.id}`),o=t.querySelector(`#profile-card-action-${e.id}`),r=t.querySelector(`#profile-card-status-switch-${e.id}`),n=t.querySelector(`#profile-card-settings-button-${e.id}`);n.addEventListener("click",async i=>{i.stopPropagation(),closeMenus();const a=!0,s=t.querySelector(`#profile-card-status-switch-${e.id}`).checked;e.enabled=s,showProfileCardSettingsMenu(n,e,a)}),o.addEventListener("click",i=>{i.stopPropagation(),closeMenus()}),r.addEventListener("input",i=>{i.stopPropagation(),closeMenus()}),r.addEventListener("change",i=>{i.stopPropagation(),closeMenus(),i.isTrusted&&(i.target.checked&&document.querySelectorAll('#modal-manager input[id^="profile-card-status-switch-"]').forEach(a=>{a.id!==i.target.id&&(a.checked=!1)}),chrome.runtime.sendMessage({type:"updateCustomInstructionProfile",detail:{profileId:e.id,profile:{enabled:i.target.checked}}},async()=>{i.target.checked?setUserSystemMessage(e.name_user_message,e.role_user_message,e.traits_model_message,e.other_user_message,e.personality_type_selection,e.personality_traits,i.target.checked,e.disabled_tools):setUserSystemMessage("","","","","default",{},!1,[]),initializeCustomInstructionProfileSelector(!0)}))})}function addOrReplaceProfileCard(e,t=null){const o=document.querySelector(`#modal-manager #custom-instruction-profile-card-${e.id}`);if(o){const r=createCustomInstructionProfileCard(e);o.replaceWith(r),addCustomInstructionProfileCardEventListeners(e)}else{const r=document.querySelector("#modal-manager #custom-instruction-profile-manager-profile-list"),n=document.querySelector("#modal-manager #no-profiles-found");n&&n.remove();const i=createCustomInstructionProfileCard(e);t?t.after(i):r.prepend(i),addCustomInstructionProfileCardEventListeners(e)}}function fetchCustomInstructionProfiles(e=1){const t=document.querySelector("#modal-manager #custom-instruction-profile-manager-profile-list");if(!t)return;e===1&&(t.innerHTML="",t.appendChild(loadingSpinner("custom-instruction-profile-manager-main-content")));const{selectedProfilesManagerSortBy:o}=cachedSettings,r=document.querySelector("#modal-manager [id=custom-instruction-profile-manager-search-input]")?.value;chrome.runtime.sendMessage({type:"getCustomInstructionProfiles",detail:{pageNumber:e,searchTerm:r,sortBy:o?.code}},async n=>{const i=n.results;if(!i||!Array.isArray(i))return;const a=document.querySelector("#modal-manager #load-more-profiles-button");a&&a.remove();const s=document.querySelector("#modal-manager #loading-spinner-custom-instruction-profile-manager-main-content");if(s&&s.remove(),i?.length===0&&e===1){const l=document.createElement("p");l.id="no-profiles-found",l.style="position:absolute;display: flex; justify-content: center; align-items: center; height: 340px; width: 100%;",l.innerText=translate("No profiles found"),t.appendChild(l)}else{if(i.forEach(l=>{const d=createCustomInstructionProfileCard(l);t.appendChild(d),addCustomInstructionProfileCardEventListeners(l)}),!await chrome.runtime.sendMessage({type:"checkHasSubscription"})){t.appendChild(managerUpgradeButton("custom-instruction-profiles","to see all profiles"));return}if(n.next){const l=document.createElement("button");l.id="load-more-profiles-button",l.classList="bg-token-main-surface-secondary p-4 pb-2 rounded-md cursor-pointer hover:bg-token-main-surface-tertiary aspect-1 flex flex-col h-auto relative",l.appendChild(loadingSpinner("load-more-profiles-button")),t.appendChild(l);const d=new IntersectionObserver(c=>{c.forEach(u=>{u.isIntersecting&&fetchCustomInstructionProfiles(e+1)})},{threshold:.5});l&&d.observe(l)}}})}function profileDropdown(){const e=document.createElement("div");e.id="profile-list-dropdown-wrapper",e.style="max-height:300px;min-width:230px;max-width:fit-content;bottom:40px;z-index:200;",e.classList="hidden absolute z-10 end-0 overflow-auto rounded-lg shadow-long text-base focus:outline-none dark:ring-white/20 text-sm -translate-x-1/4 bg-token-main-surface-secondary";const t=document.createElement("div");t.classList="flex items-center text-token-text-primary font-bold relative cursor-pointer select-none p-2 py-3 bg-token-main-surface-tertiary sticky top-0 z-10",t.innerHTML=`${translate("Custom Instruction Profiles")} <span class="flex items-center justify-center bg-white rounded-full h-4 w-4 ms-auto"><svg class="icon" style="width:12px;height:12px;" fill="#000" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M288 224H480C497.7 224 512 238.3 512 256C512 273.7 497.7 288 480 288H288V480C288 497.7 273.7 512 255.1 512C238.3 512 223.1 497.7 223.1 480V288H32C14.33 288 0 273.7 0 256C0 238.3 14.33 224 32 224H223.1V32C223.1 14.33 238.3 0 255.1 0C273.7 0 288 14.33 288 32V224z"/></svg></span>`,addTooltip(t,{value:translate("Manage profiles"),position:"left"}),t.addEventListener("click",()=>{createManager("custom-instruction-profiles")}),e.appendChild(t);const o=document.createElement("ul");return o.id="custom-instruction-profile-dropdown-list",o.classList="w-full h-full relative p-1",o.setAttribute("role","menu"),o.setAttribute("aria-orientation","vertical"),o.setAttribute("aria-labelledby","profile-selector-dropdown-button"),o.setAttribute("tabindex","-1"),e.appendChild(o),document.body.addEventListener("click",r=>{const n=document.querySelector("#profile-list-dropdown-wrapper");n?.classList?.contains("block")&&!r.target.closest("#profile-selector-dropdown-button")&&n.classList.replace("block","hidden")}),e}function fetchDropdownProfiles(e=1){const t=document.querySelector("#custom-instruction-profile-dropdown-list");if(t){if(e===1)t.innerHTML="",t.appendChild(loadingSpinner("custom-instruction-profile-dropdown-list"));else{const o=document.querySelector("#load-more-profiles-dropdown-button");o&&o.remove()}chrome.runtime.sendMessage({type:"getCustomInstructionProfiles",detail:{pageNumber:e,sortBy:"alphabetical"}},async o=>{const r=o.results;if(!r||!Array.isArray(r))return;const n=document.querySelector("#loading-spinner-custom-instruction-profile-dropdown-list");if(n&&n.remove(),r.length===0&&e===1){const i=document.createElement("p");i.style="position:absolute;display: flex; justify-content: center; align-items: center; height: 340px; width: 100%;",i.innerText=translate("no_profiles_found"),t.appendChild(i)}else{const i=isDarkMode();if(r.forEach(a=>{const s=a.name,l=a.enabled,d=`name:
${a.name_user_message}

role:
${a.role_user_message}

model traits:
${a.traits_model_message}

other user message:
${a.other_user_message}

personality type:
${a.personality_type_selection}

personality traits:
${Object.keys(a?.personality_traits||{})?.map(p=>`${p}: ${a.personality_traits?.[p]}`)?.join(", ")}

disabled tools:
${a.disabled_tools?.join(", ")}`,c=document.createElement("li");c.id=`custom-instruction-profile-dropdown-item-${s}`,c.dir="auto",c.classList="text-token-text-primary relative cursor-pointer select-none p-2 hover:bg-token-main-surface-tertiary rounded-lg";const u=document.createElement("span");u.classList="flex h-6 items-center justify-between text-token-text-primary";const m=document.createElement("span");m.style="text-transform: capitalize; max-width: 200px;",m.classList="truncate",m.innerText=s,u.appendChild(m);const g=document.createElement("button");g.id=`enable-profile-button-${a.id}`,g.classList=`text-xs px-1 ms-1 flex items-center justify-center ${i?"bg-white text-black":"text-white bg-black"} ${l?"":"hidden"} rounded-full border border-token-border-medium hover:border-token-border-medium`,g.dataset.enabled=l,g.innerText=translate("enabled"),g.addEventListener("click",p=>{p.preventDefault()}),u.appendChild(g),u.title=`${s}

${d}`,c.appendChild(u),c.setAttribute("role","option"),c.setAttribute("tabindex","-1"),c.addEventListener("click",()=>{const p=g.dataset.enabled==="true";updateCustomInstructionProfileSelector(a,!p)}),t.appendChild(c)}),!await chrome.runtime.sendMessage({type:"checkHasSubscription"})){t.appendChild(managerUpgradeButton("custom-instruction-profiles-dropdown","to see all profiles","sm"));return}if(o.next){const a=document.createElement("button");a.id="load-more-profiles-dropdown-button",a.classList="p-2 cursor-pointer flex items-center justify-center h-auto relative",a.appendChild(loadingSpinner("load-more-profiles-dropdown-button")),t.appendChild(a);const s=new IntersectionObserver(l=>{l.forEach(d=>{d.isIntersecting&&fetchDropdownProfiles(e+1)})},{threshold:0});a&&s.observe(a)}}})}}function updateCustomInstructionProfileSelector(e,t){chrome.runtime.sendMessage({type:"updateCustomInstructionProfile",detail:{profileId:e.id,profile:{enabled:t}}},()=>{if(setUserSystemMessage(e.name_user_message,e.role_user_message,e.traits_model_message,e.other_user_message,e.personality_type_selection,e.personality_traits,t,e.disabled_tools),document.querySelectorAll('#profile-list-dropdown-wrapper [id^="enable-profile-button-"]').forEach(r=>{r.classList.add("hidden"),r.dataset.enabled="false"}),t){const r=document.querySelector(`#custom-instruction-profile-selector-wrapper button[id^="enable-profile-button-${e.id}"]`);r&&(r.classList.remove("hidden"),r.dataset.enabled="true")}const o=document.querySelector("#profile-selector-dropdown-button");o.innerHTML=`<span class="me-6 truncate" style="min-width:100px; max-width:200px;">${t?e.name:"Select a profile"}</span><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md text-token-text-tertiary absolute" style="right:10px;transform: rotate(180deg);"><path fill-rule="evenodd" clip-rule="evenodd" d="M5.29289 9.29289C5.68342 8.90237 6.31658 8.90237 6.70711 9.29289L12 14.5858L17.2929 9.29289C17.6834 8.90237 18.3166 8.90237 18.7071 9.29289C19.0976 9.68342 19.0976 10.3166 18.7071 10.7071L12.7071 16.7071C12.5196 16.8946 12.2652 17 12 17C11.7348 17 11.4804 16.8946 11.2929 16.7071L5.29289 10.7071C4.90237 10.3166 4.90237 9.68342 5.29289 9.29289Z" fill="currentColor"></path></svg>`})}const debounceInitializeCustomInstructionProfileSelector=debounce(()=>{initializeCustomInstructionProfileSelector()},100);async function initializeCustomInstructionProfileSelector(e=!1){const t=isOnNewChatPage(),o=window.location.pathname.startsWith("/g/g-p-")&&window.location.pathname.endsWith("/project"),r=window.location.pathname.startsWith("/g/g-"),n=document.querySelector("#custom-instruction-profile-selector-wrapper");if(n){if(!t){n.remove();return}if(!e)return;n?.remove()}if(!t||o||r)return;const i=document.createElement("div");i.style="z-index:20;right:0;top:-44px;",i.classList="absolute flex shadow-long rounded-full",i.id="custom-instruction-profile-selector-wrapper";const a=document.createElement("button");a.id="profile-selector-dropdown-button",a.type="button",a.style="z-index:2;",a.classList="btn flex justify-center gap-2 btn-secondary bg-token-main-surface-secondary border-0",a.appendChild(loadingSpinner("profile-selector-dropdown-button")),addTooltip(a,{value:"Set a Custom Instruction Profile",position:"top"}),a.addEventListener("click",()=>{const l=document.querySelector("#profile-list-dropdown-wrapper");l&&(l.classList.contains("block")?l.classList.replace("block","hidden"):l.classList.replace("hidden","block"))}),chrome.runtime.sendMessage({type:"getEnabledCustomInstructionProfile"},l=>{a.innerHTML=`<span class="me-6 truncate" style="min-width:100px; max-width:200px;">${l?.name||"Select a profile"}</span><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md text-token-text-tertiary absolute" style="right:10px;transform: rotate(180deg);"><path fill-rule="evenodd" clip-rule="evenodd" d="M5.29289 9.29289C5.68342 8.90237 6.31658 8.90237 6.70711 9.29289L12 14.5858L17.2929 9.29289C17.6834 8.90237 18.3166 8.90237 18.7071 9.29289C19.0976 9.68342 19.0976 10.3166 18.7071 10.7071L12.7071 16.7071C12.5196 16.8946 12.2652 17 12 17C11.7348 17 11.4804 16.8946 11.2929 16.7071L5.29289 10.7071C4.90237 10.3166 4.90237 9.68342 5.29289 9.29289Z" fill="currentColor"></path></svg>`}),i.appendChild(a),i.appendChild(profileDropdown());const s=document.querySelector("main form");s&&(s.style.marginTop="20px",s.appendChild(i),fetchDropdownProfiles())}async function openFolderProfileSelectorModal(e){const t=`
  <div id="folder-profile-selector-modal" class="absolute inset-0" style="z-index: 10000;">
    <div data-state="open" class="fixed inset-0 bg-black/50 dark:bg-black/80" style="pointer-events: auto;">
      <div class="h-full w-full grid grid-cols-[10px_1fr_10px] grid-rows-[minmax(10px,1fr)_auto_minmax(10px,1fr)] md:grid-rows-[minmax(20px,1fr)_auto_minmax(20px,1fr)] overflow-y-auto">
        <div id="folder-profile-selector-content" role="dialog" aria-describedby="radix-:r3o:" aria-labelledby="radix-:r3n:" data-state="open" class="popover bg-token-main-surface-primary relative start-1/2 col-auto col-start-2 row-auto row-start-2 h-full w-full text-start ltr:-translate-x-1/2 rtl:translate-x-1/2 rounded-2xl shadow-xl flex flex-col focus:outline-hidden overflow-hidden max-w-lg" tabindex="-1" style="pointer-events: auto;">
          <div class="px-4 pb-4 pt-5 flex flex-wrap items-center justify-between border-b border-token-border-medium">
            <div class="flex">
              <div class="flex items-center">
                <div class="flex grow flex-col gap-1">
                  <h2 as="h3" class="text-lg font-medium leading-6 text-token-text-primary">${translate("Select a profile")}</h2>
                </div>
              </div>
            </div>
            <div class="flex items-center">
              <button id="folder-profile-selector-new-profile" class="btn flex justify-center gap-2 composer-submit-btn composer-submit-button-color me-2 border" data-default="true" style="min-width: 72px; height: 34px;">${translate("plus Create new profile")}</button>
              <button id="folder-profile-selector-close-button" class="text-token-text-tertiary hover:text-token-text-primary transition">
                <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="20" width="20"
                  xmlns="http://www.w3.org/2000/svg">
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
              </button>
            </div>
            </div>
          <div class="flex text-sm text-token-text-tertiary p-4 w-full">
            Enable the profile you want to be used for all new conversations created in this folder.
          </div>
          <div id="folder-profile-selector-folder-wrapper" class="px-4 overflow-y-auto">
          </div>
          <div id="folder-profile-selector-profile-list" class="p-4 overflow-y-auto" style="height:500px;">
            <!-- profile list here -->
          </div>
        </div>
      </div>
    </div>
  </div>`;document.body.insertAdjacentHTML("beforeend",t),document.querySelector("#folder-profile-selector-folder-wrapper")?.prepend(conversationFolderElement(e,!1,!1,!1,!1,!0)),await folderProfileSelectorLoadProfileList(e.id,1),addFolderProfileSelectorModalEventListener(e)}async function folderProfileSelectorLoadProfileList(e,t=1){const o=document.querySelector("#folder-profile-selector-profile-list");if(!o)return;if(t===1)o.innerHTML="",o.appendChild(loadingSpinner("folder-profile-selector-profile-list"));else{const n=document.querySelector("#load-more-folder-profile-selector");n&&n.remove()}const r=await chrome.runtime.sendMessage({type:"getConversationFolder",forceRefresh:t===1,detail:{folderId:e}});chrome.runtime.sendMessage({type:"getCustomInstructionProfiles",detail:{pageNumber:t,sortBy:"alphabetical"}},async n=>{const i=n.results;if(!i||!Array.isArray(i))return;const a=document.querySelector("#loading-spinner-folder-profile-selector-profile-list");if(a&&a.remove(),i.length===0&&t===1){const s=document.createElement("p");s.style="position:absolute;display: flex; justify-content: center; align-items: center; height: 340px; width: 100%;",s.innerText=translate("No profiles found"),o.appendChild(s)}else{const s=isDarkMode();if(i.forEach(l=>{const d=l.name,c=l.id===r.profile?.id,u=`about user message:
${l.about_user_message}

about model message:
${l.about_model_message}`,m=document.createElement("div");m.id=`folder-profile-selector-item-${d}`,m.dir="auto",m.classList="text-token-text-primary relative cursor-pointer select-none p-2 py-3 rounded-md hover:bg-token-main-surface-secondary";const g=document.createElement("span");g.classList="flex h-6 items-center justify-between text-token-text-primary";const p=document.createElement("span");p.style="text-transform: capitalize; max-width: 380px;",p.classList="truncate",p.innerText=d,g.appendChild(p);const h=document.createElement("div");h.id=`enable-profile-button-${l.id}`,h.classList="cursor-pointer text-sm flex items-center justify-between gap-2 ms-auto",h.innerHTML=`<label class="sp-switch" style="margin-right:0;"><input id="folder-profile-selector-switch-${l.id}" type="checkbox" ${c?'checked=""':""}><span class="sp-switch-slider round"></span></label>`,g.appendChild(h),g.title=`${d}

${u}`,m.appendChild(g),m.setAttribute("role","option"),m.setAttribute("tabindex","-1"),m.addEventListener("click",()=>{const f=h.querySelector("input").checked,v={profile_id:f?0:l.id};if(chrome.runtime.sendMessage({type:"updateConversationFolder",detail:{folderId:r.id,newData:v}}),document.querySelectorAll('#folder-profile-selector-profile-list [id^="enable-profile-button-"]').forEach(x=>{x.querySelector("input").checked=!1}),!f){const x=m.querySelector('[id^="enable-profile-button-"]');x.querySelector("input").checked=!0}folderForNewChat&&folderForNewChat.id===r.id&&updateCustomInstructionProfileSelector(l,!f)}),o.appendChild(m)}),!await chrome.runtime.sendMessage({type:"checkHasSubscription"})){o.appendChild(managerUpgradeButton("custom-instruction-profiles-folder","to see all profiles","sm"));return}if(n.next){const l=document.createElement("button");l.id="load-more-folder-profile-selector",l.classList="p-2 cursor-pointer flex items-center justify-center h-auto relative",l.appendChild(loadingSpinner("load-more-folder-profile-selector")),o.appendChild(l);const d=new IntersectionObserver(c=>{c.forEach(u=>{u.isIntersecting&&folderProfileSelectorLoadProfileList(t+1)})},{threshold:0});l&&d.observe(l)}}})}function addFolderProfileSelectorModalEventListener(e){document.querySelector("#folder-profile-selector-close-button").addEventListener("click",()=>{document.querySelector("#folder-profile-selector-modal").remove()}),document.body.addEventListener("click",t=>{const o=document.querySelector("#folder-profile-selector-modal"),r=document.querySelector("#folder-profile-selector-content");r&&isDescendant(o,t.target)&&!isDescendant(r,t.target)&&o?.remove()}),document.querySelector("#folder-profile-selector-new-profile").addEventListener("click",()=>{createManager("custom-instruction-profiles")})}const baseStyleList=[{name:"Default",code:"default",subtitle:"Preset style or tone"},{name:"Professional",code:"professional",subtitle:"Polished and precise"},{name:"Friendly",code:"friendly",subtitle:"Warm and chatty"},{name:"Candid",code:"candid",subtitle:"Direct and encouraging"},{name:"Quirky",code:"quirky",subtitle:"Playful and imaginative"},{name:"Efficient",code:"efficient",subtitle:"Concise and plain"},{name:"Nerdy",code:"nerdy",subtitle:"Exploratory and enthusiastic"},{name:"Cynical",code:"cynical",subtitle:"Critical and sarcastic"}],characteristicListWarm=[{name:"More",code:"more",subtitle:"Friendlier and more personable"},{name:"Default",code:"default",subtitle:""},{name:"Less",code:"less",subtitle:"More professional and factual"}],characteristicListEnthusiastic=[{name:"More",code:"more",subtitle:"More energy and excitement"},{name:"Default",code:"default",subtitle:""},{name:"Less",code:"less",subtitle:"Calmer and more natural"}],characteristicListScannable=[{name:"More",code:"more",subtitle:"Use clear formatting and lists"},{name:"Default",code:"default",subtitle:""},{name:"Less",code:"less",subtitle:"More paragraphs instead of lists"}],characteristicListEmoji=[{name:"More",code:"more",subtitle:"Use more emoji"},{name:"Default",code:"default",subtitle:""},{name:"Less",code:"less",subtitle:"Don't use as many emoji"}];async function createCustomInstructionProfileEditor(e={name:"",name_user_message:"",role_user_message:"",other_user_message:"",traits_model_message:"",disabled_tools:[],enabled:!0}){const{name:t,name_user_message:o,role_user_message:r,other_user_message:n,traits_model_message:i,personality_type_selection:a,personality_traits:s,disabled_tools:l,enabled:d}=e,c=t.length>0&&o?.length<1500&&r?.length<1500&&n?.length<1500&&i?.length<1500,u=baseStyleList.find(p=>p.code===(a||baseStyleList[0].code))||baseStyleList[0],m={warm:characteristicListWarm.find(p=>p.code===(s?.warm||characteristicListWarm[1].code))||characteristicListWarm[1],enthusiastic:characteristicListEnthusiastic.find(p=>p.code===(s?.enthusiastic||characteristicListEnthusiastic[1].code))||characteristicListEnthusiastic[1],scannable:characteristicListScannable.find(p=>p.code===(s?.scannable||characteristicListScannable[1].code))||characteristicListScannable[1],emoji:characteristicListEmoji.find(p=>p.code===(s?.emoji||characteristicListEmoji[1].code))||characteristicListEmoji[1]},g=`<div id="custom-instruction-editor-wrapper" class="absolute inset-0" style="z-index:100010">
<div data-state="open" class="fixed inset-0 z-50 bg-black/50 dark:bg-black/80" style="pointer-events: auto;">
  <div class="z-50 h-full w-full overflow-y-auto grid grid-cols-[10px_1fr_10px] grid-cols-[10px_1fr_10px] grid-rows-[minmax(10px,1fr)_auto_minmax(10px,1fr)] md:grid-rows-[minmax(20px,1fr)_auto_minmax(20px,1fr)]">
    <div role="dialog" id="custom-instruction-editor" aria-describedby="radix-:r7m:" aria-labelledby="radix-:r7l:" data-state="open" class="popover relative start-1/2 col-auto col-start-2 row-auto row-start-2 h-full w-full bg-token-main-surface-primary text-start ltr:-translate-x-1/2 rtl:translate-x-1/2 rounded-2xl shadow-xl flex flex-col overflow-hidden focus:outline-none max-w-xl" tabindex="-1" style="pointer-events: auto;">
      <div class="px-4 pb-4 pt-5 p-6 flex items-center justify-between border-b border-black/10 dark:border-white/10">
        <div class="flex">
          <div class="flex items-center">
            <div class="flex grow flex-col gap-1">
              <h2 class="text-lg font-semibold leading-6 text-token-text-primary">Customize ChatGPT</h2>
              <p class="text-sm text-token-text-tertiary">
                <span class="text-token-text-tertiary">Introduce yourself to get better, more personalized responses</span>
              </p>
            </div>
          </div>
        </div>
      </div>
      <div class="flex-grow">
        <div class="max-h-[60vh] overflow-y-auto md:max-h-[calc(100vh-300px)] p-6">
          <div class="flex items-center pt-0 pb-3 border-token-border-default"><h3 class="w-full text-lg font-normal"><div class="truncate select-none">${translate("profile_name")}</div></h3></div>

          <input id="custom-instruction-editor-name-input" placeholder="Work, personal, coding, creative,..." class="rounded p-2 mb-3 w-full resize-none rounded bg-token-main-surface-primary placeholder:text-gray-500 border border-token-border-medium focus-within:border-token-border-xheavy focus:ring-0 focus-visible:ring-0 outline-none focus-visible:outline-none" value="${t}">

          <div class="min-h-header-height flex items-center py-3 mt-2 border-token-border-default border-b"><h3 class="w-full text-lg font-normal"><div class="truncate select-none">${translate("personalization")}</div></h3></div>





          <div class="grid [grid-auto-rows:minmax(min-content,auto)] grid-cols-[minmax(0,1fr)_max-content] items-center gap-2 my-4">
            <div class="truncate select-none">Base style and tone</div>
            <div class="w-fit justify-self-end">
              <div class="grid w-fit [&amp;&gt;*]:col-start-1 [&amp;&gt;*]:row-start-1">
                <div id="custom-instruction-editor-personality-wrapper" style="position: relative; min-width: 100px; width: fit-content; max-width: 200px; z-index: 1004; margin-left: 8px;height:36px;justify-self:end;">
                  ${dropdown("Personality",baseStyleList,u||baseStyleList[0],"code","right","bg-token-main-surface-secondary",!1)}
                </div>
              </div>
            </div>
            <div class="text-token-text-tertiary -mt-3 text-xs text-pretty">Set the style and tone of how ChatGPT responds to
              you. This doesn't impact ChatGPT's capabilities.</div>
            <div data-empty="true"></div>
            <div class="col-span-full h-1.5 w-full"></div>
            
            <div class="col-span-full mb-2 w-full">
              <div class="w-full truncate select-none">Characteristics</div>
              <div class="text-token-text-tertiary text-xs text-pretty">Choose additional customizations on top of your base
                style and tone.</div>
            </div>
            <div class="truncate select-none">Warm</div>
            <div id="custom-instruction-editor-warm-wrapper" style="position: relative; min-width: 100px; width: fit-content; max-width: 200px; z-index: 1003; margin-left: 8px;height:36px;justify-self:end;">
              ${dropdown("Warm",characteristicListWarm,m?.warm||characteristicListWarm[1],"code","right","bg-token-main-surface-secondary",!1)}
            </div>
            <div class="truncate select-none">Enthusiastic</div>
            <div id="custom-instruction-editor-enthusiastic-wrapper" style="position: relative; min-width: 100px; width: fit-content; max-width: 200px; z-index: 1002; margin-left: 8px;height:36px;justify-self:end;">
              ${dropdown("Enthusiastic",characteristicListEnthusiastic,m?.enthusiastic||characteristicListEnthusiastic[1],"code","right","bg-token-main-surface-secondary",!1)}
            </div>
            <div class="truncate select-none">Headers &amp; Lists</div>
            <div id="custom-instruction-editor-headers-and-lists-wrapper" style="position: relative; min-width: 100px; width: fit-content; max-width: 200px; z-index: 1001; margin-left: 8px;height:36px;justify-self:end;">
              ${dropdown("Scannable",characteristicListScannable,m?.scannable||characteristicListScannable[1],"code","right","bg-token-main-surface-secondary",!1)}
            </div>
            <div class="truncate select-none">Emoji</div>
            <div id="custom-instruction-editor-emoji-wrapper" style="position: relative; min-width: 100px; width: fit-content; max-width: 200px; z-index: 1000; margin-left: 8px;height:36px;justify-self:end;">
              ${dropdown("Emoji",characteristicListEmoji,m?.emoji||characteristicListEmoji[1],"code","right","bg-token-main-surface-secondary",!1)}
            </div>
          </div>





          <div class="flex items-center">
            <p class="text-muted my-2 py-2 me-2 text-sm font-medium text-token-text-primary">${translate("custom_instructions")}</p>
            <span id="custom-instruction-editor-traits-model-message-info-icon" class="relative" data-state="closed">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-token-text-tertiary">
                <path d="M13 12C13 11.4477 12.5523 11 12 11C11.4477 11 11 11.4477 11 12V16C11 16.5523 11.4477 17 12 17C12.5523 17 13 16.5523 13 16V12Z" fill="currentColor"></path>
                <path d="M12 9.5C12.6904 9.5 13.25 8.94036 13.25 8.25C13.25 7.55964 12.6904 7 12 7C11.3096 7 10.75 7.55964 10.75 8.25C10.75 8.94036 11.3096 9.5 12 9.5Z" fill="currentColor"></path>
                <path fill-rule="evenodd" clip-rule="evenodd" d="M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2ZM4 12C4 7.58172 7.58172 4 12 4C16.4183 4 20 7.58172 20 12C20 16.4183 16.4183 20 12 20C7.58172 20 4 16.4183 4 12Z" fill="currentColor"></path>
              </svg>
            </span>
          </div>
          <div>
            <textarea id="custom-instruction-editor-traits-model-message" class="w-full resize-none bg-token-main-surface-primary rounded-lg border text-sm focus-token-border-heavy border-token-border-medium placeholder:text-gray-400" placeholder="Additional behavior, style, and tone preferences" rows="5" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:r7q:" data-state="closed">${i||""}</textarea>
            <div class="flex items-center justify-between px-1 text-xs tabular-nums text-token-text-tertiary"></div>
          </div>


          <div class="min-h-header-height flex items-center py-3 mt-2 border-token-border-default border-b"><h3 class="w-full text-lg font-normal"><div class="truncate select-none">${translate("about_you")}</div></h3></div>

          <p class="text-muted py-2 mt-2 text-sm font-medium">${translate("nickname")}</p>
          <div class="mb-3">
            <textarea id="custom-instruction-editor-name-user-message" placeholder="What should ChatGPT call you?" class="w-full resize-none bg-token-main-surface-primary rounded-lg border text-sm focus-token-border-heavy border-token-border-medium placeholder:text-gray-400 placeholder:text-gray-300" rows="1" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:r7n:" data-state="closed">${o||""}</textarea>
            <div class="flex items-center justify-between px-1 text-xs tabular-nums text-token-text-tertiary"></div>
          </div>
          <p class="text-muted py-2 text-sm font-medium text-token-text-primary">${translate("occupation")}</p>
          <div class="mb-3">
            <textarea id="custom-instruction-editor-role-user-message" class="w-full resize-none bg-token-main-surface-primary rounded-lg border text-sm focus-token-border-heavy border-token-border-medium placeholder:text-gray-400 placeholder:text-gray-300" placeholder="interior designer, freelance copywriter, etc." rows="1" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:r7o:" data-state="closed">${r||""}</textarea>
            <div class="flex items-center justify-between px-1 text-xs tabular-nums text-token-text-tertiary"></div>
          </div>
          
          
          <div class="flex items-center">
            <p class="text-muted me-2 py-2 text-sm font-medium text-token-text-primary">${translate("more_about_you")}</p>
            <span id="custom-instruction-editor-other-user-message-info-icon" class="relative" data-state="closed">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-token-text-tertiary">
                <path d="M13 12C13 11.4477 12.5523 11 12 11C11.4477 11 11 11.4477 11 12V16C11 16.5523 11.4477 17 12 17C12.5523 17 13 16.5523 13 16V12Z" fill="currentColor"></path>
                <path d="M12 9.5C12.6904 9.5 13.25 8.94036 13.25 8.25C13.25 7.55964 12.6904 7 12 7C11.3096 7 10.75 7.55964 10.75 8.25C10.75 8.94036 11.3096 9.5 12 9.5Z" fill="currentColor"></path>
                <path fill-rule="evenodd" clip-rule="evenodd" d="M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2ZM4 12C4 7.58172 7.58172 4 12 4C16.4183 4 20 7.58172 20 12C20 16.4183 16.4183 20 12 20C7.58172 20 4 16.4183 4 12Z" fill="currentColor"></path>
              </svg>
            </span>
          </div>
          <div>
            <textarea id="custom-instruction-editor-other-user-message" class="w-full resize-none bg-token-main-surface-primary rounded-lg border text-sm focus-token-border-heavy border-token-border-medium placeholder:text-gray-400" placeholder="Interests, values, or preferences to keep in mind" rows="5" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:r7s:" data-state="closed">${n||""}</textarea>
            <div class="flex items-center justify-between px-1 text-xs tabular-nums text-token-text-tertiary"></div>
          </div>
          <div class="mt-3">
            <button id="custom-instruction-editor-advanced-button" class="text-muted flex items-center justify-between py-2 text-sm font-medium text-token-text-primary">${translate("advanced")}
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none"
                xmlns="http://www.w3.org/2000/svg" class="ms-1 h-5 w-5">
                <g>
                  <path fill-rule="evenodd" clip-rule="evenodd" d="M15.0337 7.74408C14.7082 7.41864 14.1806 7.41864 13.8552 7.74408L9.99998 11.5993L6.14479 7.74408C5.81935 7.41864 5.29171 7.41864 4.96628 7.74408C4.64084 8.06951 4.64084 8.59715 4.96628 8.92259L9.41072 13.367C9.73616 13.6925 10.2638 13.6925 10.5892 13.367L15.0337 8.92259C15.3591 8.59715 15.3591 8.06951 15.0337 7.74408Z" fill="currentColor"></path>
                </g>
              </svg>
            </button>
            <div id="custom-instruction-editor-advanced-settings" class="flex flex-col gap-2 mt-2 ps-3 hidden">
              
              <div class="mt-2">
                <div class="border-token-border-light flex min-h-15 items-center border-b py-2 last-of-type:border-none">
                  <div class="w-full">
                    <div class="flex items-center justify-between gap-2">
                      <div class="flex items-center gap-2">Web search</div>
                      <div class="flex items-center gap-1">
                        <label class="sp-switch">
                          <input id="custom-instruction-editor-browser-switch" data-testid="browser" type="checkbox" ${l.includes("browser")?"":'checked=""'}><span class="sp-switch-slider round"></span>
                        </label>
                      </div>
                    </div>
                    <div class="text-xs text-token-text-tertiary pe-12 my-1">Let ChatGPT automatically search the web for
                      answers.</div>
                  </div>
                </div>
                <div class="border-token-border-light flex min-h-15 items-center border-b py-2 last-of-type:border-none">
                  <div class="w-full">
                    <div class="flex items-center justify-between gap-2">
                      <div class="flex items-center gap-2">Code</div>
                      <div class="flex items-center gap-1">
                        <label class="sp-switch">
                          <input id="custom-instruction-editor-code-switch" data-testid="python" type="checkbox"  ${l.includes("python")?"":'checked=""'}><span class="sp-switch-slider round"></span>
                        </label>
                      </div>
                    </div>
                    <div class="text-xs text-token-text-tertiary pe-12 my-1">Let ChatGPT execute code using Code Interpreter.
                    </div>
                  </div>
                </div>
                <div class="border-token-border-light flex min-h-15 items-center border-b py-2 last-of-type:border-none">
                  <div class="w-full">
                    <div class="flex items-center justify-between gap-2">
                      <div class="flex items-center gap-2">Canvas</div>
                      <div class="flex items-center gap-1">
                        <label class="sp-switch">
                          <input id="custom-instruction-editor-canvas-switch" data-testid="canmore" type="checkbox" ${l.includes("canmore")?"":'checked=""'}><span class="sp-switch-slider round"></span>
                        </label>
                      </div>
                    </div>
                    <div class="text-xs text-token-text-tertiary pe-12 my-1">Collaborate with ChatGPT on text and code.</div>
                  </div>
                </div>
                <div class="border-token-border-light flex min-h-15 items-center border-b py-2 last-of-type:border-none">
                  <div class="w-full">
                    <div class="flex items-center justify-between gap-2">
                      <div class="flex items-center gap-2">ChatGPT Voice</div>
                      <div class="flex items-center gap-1">
                        <label class="sp-switch">
                          <input id="custom-instruction-editor-chatgpt-voice-switch" data-testid="chatgpt_voice" type="checkbox" ${l.includes("chatgpt_voice")?"":'checked=""'}><span class="sp-switch-slider round"></span>
                        </label>
                      </div>
                    </div>
                    <div class="text-xs text-token-text-tertiary pe-12 my-1">Enable voice mode in ChatGPT</div>
                  </div>
                </div>
                <div id="custom-instruction-editor-advanced-voice-switch-wrapper" class="border-token-border-light flex min-h-15 items-center border-b py-2 last-of-type:border-none ${l.includes("chatgpt_voice")?"hidden":""}">
                  <div class="w-full">
                    <div class="flex items-center justify-between gap-2">
                      <div class="flex items-center gap-2">Advanced voice</div>
                      <div class="flex items-center gap-1">
                        <label class="sp-switch">
                          <input id="custom-instruction-editor-advanced-voice-switch" data-testid="advanced_voice" type="checkbox" ${l.includes("advanced_voice")?"":'checked=""'}><span class="sp-switch-slider round"></span>
                        </label>
                      </div>
                    </div>
                    <div class="text-xs text-token-text-tertiary pe-12 my-1">Have more natural conversations in voice mode.
                    </div>
                  </div>
                </div>
                <div>
                  <div class="border-token-border-light flex min-h-15 items-center border-b py-2 last-of-type:border-none">
                    <div class="w-full">
                      <div class="flex items-center justify-between gap-2">
                        <div class="flex items-center gap-2">Connector search</div>
                        <div class="flex items-center gap-1">
                          <label class="sp-switch">
                              <input id="custom-instruction-editor-connector-search-switch" data-testid="connector_search" type="checkbox" ${l.includes("connector_search")?"":'checked=""'}><span class="sp-switch-slider round"></span>
                          </label>
                        </div>
                      </div>
                      <div class="text-xs text-token-text-tertiary pe-12 my-1">Let ChatGPT automatically search connected
                        sources for answers.</div>
                    </div>
                  </div>
                </div><span></span>
              </div>

            </div>
          </div>
        </div>
        <div class="border-t p-6">
          <div class="flex flex-grow flex-col items-stretch justify-between gap-0 flex-row items-center gap-3">
            
            <div class="cursor-pointer text-sm flex items-center justify-start gap-2">
              ${translate("enable_this_profile")}
              <label class="sp-switch">
                <input id="custom-instruction-editor-status-switch" type="checkbox" ${d?'checked=""':""}><span class="sp-switch-slider round"></span>
              </label>
            </div>

            <div class="flex flex-col gap-3 flex-row-reverse">
              <button id="custom-instruction-editor-save-button" class="disabled:opacity-50 hover:bg-inherit disabled:cursor-not-allowed btn relative composer-submit-btn composer-submit-button-color" ${c?"":'disabled=""'} as="button">
                <div class="flex items-center justify-center">${translate("Save")}</div>
              </button>
              <button id="custom-instruction-editor-cancel-button" class="btn relative btn-secondary" as="button">
                <div class="flex items-center justify-center">${translate("Cancel")}</div>
              </button>
              ${e.id?`<button id="custom-instruction-editor-delete-button" class="btn relative btn-danger" as="button">
                <div class="flex items-center justify-center">${translate("Delete")}</div>
              </button>`:""}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</div>`;document.body.insertAdjacentHTML("beforeend",g),addCustomInstructionProfileEditorEventListeners(e)}function addCustomInstructionProfileEditorEventListeners(e){addDropdownEventListener("Personality",baseStyleList,"code",()=>{}),addDropdownEventListener("Warm",characteristicListWarm,"code",()=>{}),addDropdownEventListener("Enthusiastic",characteristicListEnthusiastic,"code",()=>{}),addDropdownEventListener("Scannable",characteristicListScannable,"code",()=>{}),addDropdownEventListener("Emoji",characteristicListEmoji,"code",()=>{});const t=document.querySelector("#custom-instruction-editor-wrapper"),o=document.querySelector("#custom-instruction-editor"),r=o.querySelector("#custom-instruction-editor-cancel-button"),n=o.querySelector("#custom-instruction-editor-delete-button"),i=o.querySelector("#custom-instruction-editor-save-button"),a=o.querySelector("#custom-instruction-editor-status-switch"),s=o.querySelector("#custom-instruction-editor-name-input"),l=o.querySelector("#selected-personality-title"),d={warm:o.querySelector("#selected-warm-title"),enthusiastic:o.querySelector("#selected-enthusiastic-title"),scannable:o.querySelector("#selected-scannable-title"),emoji:o.querySelector("#selected-emoji-title")},c=o.querySelector("#custom-instruction-editor-name-user-message"),u=o.querySelector("#custom-instruction-editor-role-user-message"),m=o.querySelector("#custom-instruction-editor-traits-model-message"),g=o.querySelector("#custom-instruction-editor-other-user-message"),p=o.querySelector("#custom-instruction-editor-advanced-button"),h=o.querySelector("#custom-instruction-editor-advanced-settings"),f=o.querySelector("#custom-instruction-editor-browser-switch"),v=o.querySelector("#custom-instruction-editor-code-switch"),x=o.querySelector("#custom-instruction-editor-canvas-switch"),y=o.querySelector("#custom-instruction-editor-chatgpt-voice-switch"),b=o.querySelector("#custom-instruction-editor-advanced-voice-switch"),w=o.querySelector("#custom-instruction-editor-connector-search-switch"),k=[f,v,x,y,b,w],S=o.querySelector("#custom-instruction-editor-traits-model-message-info-icon"),M=o.querySelector("#custom-instruction-editor-other-user-message-info-icon"),$=o.querySelector("#custom-instruction-editor-capabilities-info-icon"),q=(E,C,L=null)=>{L&&(L.textContent=`${C.length}/1500`),C.length>1500?(L?.classList.add("text-red-500"),E.classList.add("border-red-500"),E.classList.add("focus:border-red-500"),E.classList.remove("border-token-border-medium"),E.classList.remove("focus:border-token-border-medium"),i.setAttribute("disabled","")):(L?.classList.remove("text-red-500"),E.classList.remove("border-red-500"),E.classList.remove("focus:border-red-500"),E.classList.add("border-token-border-medium"),E.classList.add("focus:border-token-border-medium"),s.value.length>0&&c.value.length<=1500&&u.value.length<=1500&&m.value.length<=1500&&g.value.length<=1500?i.removeAttribute("disabled"):i.setAttribute("disabled",""))};addTooltip(S,{value:'<div id="custom-instruction-editor-traits-model-message-tooltip" style="min-width: max-content;z-index: 50;"><div data-side="top" data-align="center" data-state="delayed-open" class="relative z-50 select-none shadow-xs transition-opacity p-2 rounded-lg bg-black max-w-xs" style="pointer-events: auto; --radix-tooltip-content-transform-origin: var(--radix-popper-transform-origin); --radix-tooltip-content-available-width: var(--radix-popper-available-width); --radix-tooltip-content-available-height: var(--radix-popper-available-height); --radix-tooltip-trigger-width: var(--radix-popper-anchor-width); --radix-tooltip-trigger-height: var(--radix-popper-anchor-height);"><span class="flex items-center whitespace-pre-wrap font-semibold normal-case text-start text-default-text-primary text-sm"><div><div class="text-muted mx-3 mb-[6px] mt-3 text-sm font-medium">You can tell ChatGPT to do things like...</div></div></span><span class="flex items-center whitespace-pre-wrap text-start text-gray-400 text-sm"><div><ul class="text-muted mx-2 mb-3 list-disc justify-start space-y-[6px] ps-5 text-sm text-token-text-primary"><li>Use a formal, professional tone.</li><li>Be casual and chatty.</li><li>Be opinionated. If a question could have multiple answers, try to give only the best one.</li></ul></div></span><span style="position: absolute; bottom: 0px; transform: translateY(100%); left: 155px;"><div class="relative top-[-4px] h-2 w-2 rotate-45 transform shadow-xs dark:border-e dark:border-b border-white/10 bg-black" width="10" height="5" viewbox="0 0 30 10" preserveaspectratio="none" style="display: block;"></div></span><span id="radix-:rb5:" role="tooltip" style="position: absolute; border: 0px; width: 1px; height: 1px; padding: 0px; margin: -1px; overflow: hidden; clip: rect(0px, 0px, 0px, 0px); white-space: nowrap; overflow-wrap: normal;"><span class="flex items-center whitespace-pre-wrap font-semibold normal-case text-start text-default-text-primary text-sm"><div><div class="text-muted mx-3 mb-[6px] mt-3 text-sm font-medium">You can tell ChatGPT to do things like...</div></div></span><span class="flex items-center whitespace-pre-wrap text-start text-gray-400 text-sm"><div><ul class="text-muted mx-2 mb-3 list-disc justify-start space-y-[6px] ps-5 text-sm text-token-text-primary"><li>Use a formal, professional tone.</li><li>Be casual and chatty.</li><li>Be opinionated. If a question could have multiple answers, try to give only the best one.</li></ul></div></span></span></div></div>',position:"top"}),addTooltip(M,{value:`<div id="custom-instruction-editor-other-user-message-tooltip" style="min-width: max-content; z-index: 50;"><div data-side="top" data-align="center" data-state="delayed-open" class="relative z-50 select-none shadow-xs transition-opacity p-2 rounded-lg bg-black max-w-xs" style="pointer-events: auto; --radix-tooltip-content-transform-origin: var(--radix-popper-transform-origin); --radix-tooltip-content-available-width: var(--radix-popper-available-width); --radix-tooltip-content-available-height: var(--radix-popper-available-height); --radix-tooltip-trigger-width: var(--radix-popper-anchor-width); --radix-tooltip-trigger-height: var(--radix-popper-anchor-height);"><span class="flex items-center whitespace-pre-wrap font-semibold normal-case text-start text-default-text-primary text-sm"><div><div class="text-muted mx-3 mb-2 mt-3 text-sm font-medium">You can share things like...</div></div></span><span class="flex items-center whitespace-pre-wrap text-start text-gray-400 text-sm"><div><ul class="text-muted mx-2 mb-3 list-disc justify-start space-y-[6px] ps-5 text-sm text-token-text-primary"><li>I love hiking and jazz</li><li>I'm vegetarian</li><li>I'm trying to learn French</li></ul></div></span><span style="position: absolute; bottom: 0px; transform: translateY(100%); left: 104px;"><div class="relative top-[-4px] h-2 w-2 rotate-45 transform shadow-xs dark:border-e dark:border-b border-white/10 bg-black" width="10" height="5" viewbox="0 0 30 10" preserveaspectratio="none" style="display: block;"></div></span><span id="radix-:rb7:" role="tooltip" style="position: absolute; border: 0px; width: 1px; height: 1px; padding: 0px; margin: -1px; overflow: hidden; clip: rect(0px, 0px, 0px, 0px); white-space: nowrap; overflow-wrap: normal;"><span class="flex items-center whitespace-pre-wrap font-semibold normal-case text-start text-default-text-primary text-sm"><div><div class="text-muted mx-3 mb-2 mt-3 text-sm font-medium">You can share things like...</div></div></span><span class="flex items-center whitespace-pre-wrap text-start text-gray-400 text-sm"><div><ul class="text-muted mx-2 mb-3 list-disc justify-start space-y-[6px] ps-5 text-sm text-token-text-primary"><li>I love hiking and jazz</li><li>I'm vegetarian</li><li>I'm trying to learn French</li></ul></div></span></span></div></div>`,position:"top"}),addTooltip($,{value:'<div id="custom-instruction-editor-capabilities-tooltip" style="min-width: max-content;z-index: 50;"><div data-side="top" data-align="center" data-state="delayed-open" class="relative z-50 select-none shadow-xs transition-opacity px-3 py-2 rounded-lg bg-black max-w-xs" style="pointer-events: auto; --radix-tooltip-content-transform-origin: var(--radix-popper-transform-origin); --radix-tooltip-content-available-width: var(--radix-popper-available-width); --radix-tooltip-content-available-height: var(--radix-popper-available-height); --radix-tooltip-trigger-width: var(--radix-popper-anchor-width); --radix-tooltip-trigger-height: var(--radix-popper-anchor-height);"><span class="flex items-center whitespace-pre-wrap font-semibold normal-case text-center text-gray-100 text-sm"><div>Choose which tools can be used with GPT-4</div></span><span style="position: absolute; bottom: 0px; transform: translateY(100%); left: 155px;"><div class="relative top-[-4px] h-2 w-2 rotate-45 transform shadow-xs bg-black" width="10" height="5" viewbox="0 0 30 10" preserveaspectratio="none" style="display: block;"></div></span><span id="radix-:rb9:" role="tooltip" style="position: absolute; border: 0px; width: 1px; height: 1px; padding: 0px; margin: -1px; overflow: hidden; clip: rect(0px, 0px, 0px, 0px); white-space: nowrap; overflow-wrap: normal;"><span class="flex items-center whitespace-pre-wrap font-semibold normal-case text-center text-gray-100 text-sm"><div>Choose which tools can be used with GPT-4</div></span></span></div></div>',position:"top"}),t?.addEventListener("click",E=>{isDescendant(o,E.target)||t.remove()}),s?.addEventListener("input",()=>{s.value.length>0&&c.value.length<=1500&&u.value.length<=1500&&m.value.length<=1500&&g.value.length<=1500?i.removeAttribute("disabled"):i.setAttribute("disabled","")}),c?.addEventListener("input",()=>{q(c,c.value)}),u?.addEventListener("input",()=>{q(u,u.value)}),m?.addEventListener("input",()=>{q(m,m.value)}),g?.addEventListener("input",()=>{q(g,g.value)}),p?.addEventListener("click",()=>{h.classList.toggle("hidden")}),y?.addEventListener("change",()=>{y.checked?(document.querySelector("#custom-instruction-editor-advanced-voice-switch-wrapper").classList.remove("hidden"),a.checked&&updateAccountUserSetting("voice_enabled",!0)):(b.checked=!1,document.querySelector("#custom-instruction-editor-advanced-voice-switch-wrapper").classList.add("hidden"),a.checked&&updateAccountUserSetting("voice_enabled",!1))}),w?.addEventListener("change",()=>{a.checked&&(w.checked?updateAccountUserSetting("connector_search_enabled",!0):updateAccountUserSetting("connector_search_enabled",!1))}),r?.addEventListener("click",()=>{t.remove()}),n?.addEventListener("click",()=>{showConfirmDialog("Delete profile","Are you sure you want to delete this custom instruction profile?","Cancel","Delete",null,()=>{chrome.runtime.sendMessage({type:"deleteCustomInstructionProfile",detail:{profileId:e.id}},()=>{const E=document.querySelector(`#custom-instruction-profile-card-${e.id}`);E&&E.remove();const C=document.querySelector("#modal-manager #custom-instruction-profile-manager-profile-list");if(C&&C.children.length===0){const L=document.createElement("p");L.id="no-conversations-found",L.innerText="No profiles found",C.appendChild(L)}e.enabled&&setUserSystemMessage("","","","","default",{},!1,[]),initializeCustomInstructionProfileSelector(!0)}),t.remove()})}),i?.addEventListener("click",()=>{const E=k.filter(L=>!L.checked).map(L=>L.dataset.testid),C={name:s.value,name_user_message:c.value,role_user_message:u.value,traits_model_message:m.value,other_user_message:g.value,personality_type_selection:l.dataset.option,personality_traits:{warm:d.warm.dataset.option,enthusiastic:d.enthusiastic.dataset.option,scannable:d.scannable.dataset.option,emoji:d.emoji.dataset.option},enabled:a.checked,disabled_tools:E};e.id&&(C.id=e.id),chrome.runtime.sendMessage({type:e.id?"updateCustomInstructionProfile":"addCustomInstructionProfile",detail:{profileId:e.id,profile:C}},async L=>{if(L.error&&L.error.type==="limit"){errorUpgradeConfirmation(L.error);return}t.remove();const _=document.querySelector("#modal-manager #no-profiles-found");_&&_.remove(),L.enabled&&document.querySelectorAll('#modal-manager input[id^="profile-card-status-switch-"]').forEach(z=>{z.checked=!1}),initializeCustomInstructionProfileSelector(!0);const T=document.querySelector(`#custom-instruction-profile-card-${e.id}`);addOrReplaceProfileCard(L,T),L.enabled&&setUserSystemMessage(C.name_user_message,C.role_user_message,C.traits_model_message,C.other_user_message,C.personality_type_selection,C.personality_traits,C.enabled,C.disabled_tools)})})}async function showProfileCardSettingsMenu(e,t,o=!1){const r=t.id,{right:n,top:i}=e.getBoundingClientRect(),a=o?n-224:n-6,s=i+20,l=`<div id="profile-card-settings-menu" dir="ltr" style="transform:translate3d(${a}px,${s}px,0);position:fixed;left:0;top:0;min-width:max-content;z-index:10001;--radix-popper-anchor-width:18px;--radix-popper-anchor-height:18px;--radix-popper-available-width:1167px;--radix-popper-available-height:604px;--radix-popper-transform-origin:0% 0px"><div data-side="bottom" data-align="start" role="menu" aria-orientation="vertical" data-state="open" data-radix-menu-content="" dir="ltr" aria-labelledby="radix-:r6g:" class="max-w-xs rounded-2xl text-token-text-primary bg-token-main-surface-secondary shadow-long p-1" tabindex="-1" data-orientation="vertical" style="min-width:200px; outline:0;--radix-dropdown-menu-content-transform-origin:var(--radix-popper-transform-origin);--radix-dropdown-menu-content-available-width:var(--radix-popper-available-width);--radix-dropdown-menu-content-available-height:var(--radix-popper-available-height);--radix-dropdown-menu-trigger-width:var(--radix-popper-anchor-width);--radix-dropdown-menu-trigger-height:var(--radix-popper-anchor-height);pointer-events:auto">
  
  <div role="menuitem" id="edit-profile-settings-button-${r}" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><div class="flex gap-2"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.2929 4.29291C15.0641 2.52167 17.9359 2.52167 19.7071 4.2929C21.4783 6.06414 21.4783 8.93588 19.7071 10.7071L18.7073 11.7069L11.1603 19.2539C10.7182 19.696 10.1489 19.989 9.53219 20.0918L4.1644 20.9864C3.84584 21.0395 3.52125 20.9355 3.29289 20.7071C3.06453 20.4788 2.96051 20.1542 3.0136 19.8356L3.90824 14.4678C4.01103 13.8511 4.30396 13.2818 4.7461 12.8397L13.2929 4.29291ZM13 7.41422L6.16031 14.2539C6.01293 14.4013 5.91529 14.591 5.88102 14.7966L5.21655 18.7835L9.20339 18.119C9.40898 18.0847 9.59872 17.9871 9.7461 17.8397L16.5858 11L13 7.41422ZM18 9.5858L14.4142 6.00001L14.7071 5.70712C15.6973 4.71693 17.3027 4.71693 18.2929 5.70712C19.2831 6.69731 19.2831 8.30272 18.2929 9.29291L18 9.5858Z" fill="currentColor"></path></svg>${translate("Edit")}</div></div>

  <div role="menuitem" id="duplicate-profile-settings-button-${r}" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><div class="flex gap-2"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="icon icon-md" xmlns="http://www.w3.org/2000/svg"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>${translate("Duplicate")}</div></div>
  
  <div role="menuitem" id="delete-profile-settings-button-${r}" class="flex gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group text-red-500" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5555 4C10.099 4 9.70052 4.30906 9.58693 4.75114L9.29382 5.8919H14.715L14.4219 4.75114C14.3083 4.30906 13.9098 4 13.4533 4H10.5555ZM16.7799 5.8919L16.3589 4.25342C16.0182 2.92719 14.8226 2 13.4533 2H10.5555C9.18616 2 7.99062 2.92719 7.64985 4.25342L7.22886 5.8919H4C3.44772 5.8919 3 6.33961 3 6.8919C3 7.44418 3.44772 7.8919 4 7.8919H4.10069L5.31544 19.3172C5.47763 20.8427 6.76455 22 8.29863 22H15.7014C17.2354 22 18.5224 20.8427 18.6846 19.3172L19.8993 7.8919H20C20.5523 7.8919 21 7.44418 21 6.8919C21 6.33961 20.5523 5.8919 20 5.8919H16.7799ZM17.888 7.8919H6.11196L7.30423 19.1057C7.3583 19.6142 7.78727 20 8.29863 20H15.7014C16.2127 20 16.6417 19.6142 16.6958 19.1057L17.888 7.8919ZM10 10C10.5523 10 11 10.4477 11 11V16C11 16.5523 10.5523 17 10 17C9.44772 17 9 16.5523 9 16V11C9 10.4477 9.44772 10 10 10ZM14 10C14.5523 10 15 10.4477 15 11V16C15 16.5523 14.5523 17 14 17C13.4477 17 13 16.5523 13 16V11C13 10.4477 13.4477 10 14 10Z" fill="currentColor"></path></svg>${translate("Delete")}</div>

  </div></div>`;document.body.insertAdjacentHTML("beforeend",l),adjustMenuPosition(document.querySelector("#profile-card-settings-menu")),addProfileSettingsMenuEventListeners(t)}function addProfileSettingsMenuEventListeners(e){const t=e.id,o=document.getElementById(`edit-profile-settings-button-${t}`),r=document.getElementById(`duplicate-profile-settings-button-${t}`),n=document.getElementById(`delete-profile-settings-button-${t}`);o?.addEventListener("click",i=>{i.stopPropagation(),closeMenus(),createCustomInstructionProfileEditor(e)}),r?.addEventListener("click",i=>{i.stopPropagation(),closeMenus(),chrome.runtime.sendMessage({type:"duplicateCustomInstructionProfile",forceRefresh:!0,detail:{profileId:t}},a=>{if(a.error&&a.error.type==="limit"){errorUpgradeConfirmation(a.error);return}initializeCustomInstructionProfileSelector(!0);const s=document.querySelector(`#custom-instruction-profile-card-${t}`);addOrReplaceProfileCard(a,s)})}),n?.addEventListener("click",()=>{closeMenus(),handleDeleteProfile(e)})}function handleDeleteProfile(e){showConfirmDialog("Delete profile","Are you sure you want to delete this custom instruction profile?","Cancel","Delete",null,()=>{chrome.runtime.sendMessage({type:"deleteCustomInstructionProfile",detail:{profileId:e.id}},()=>{const t=document.querySelector(`#custom-instruction-profile-card-${e.id}`);t&&t.remove();const o=document.querySelector("#modal-manager #custom-instruction-profile-manager-profile-list");if(o&&o.children.length===0){const r=document.createElement("p");r.id="no-conversations-found",r.innerText="No profiles found",o.appendChild(r)}e.enabled&&setUserSystemMessage("","","","","default",{},!1,[]),initializeCustomInstructionProfileSelector(!0)})})}let selectedConversationFolderBreadcrumb=[],lastSelectedConversationCardId="",lastSelectedConversationCheckboxId="";chrome.storage.local.get(["selectedConversationFolderBreadcrumb"],e=>{selectedConversationFolderBreadcrumb=e.selectedConversationFolderBreadcrumb||[]});function getLastSelectedConversationFolder(){return selectedConversationFolderBreadcrumb.length===0?null:selectedConversationFolderBreadcrumb[selectedConversationFolderBreadcrumb.length-1]}function convBreadcrumbIncludesFolder(e){return selectedConversationFolderBreadcrumb.map(t=>t.id.toString()).some(t=>t===e.toString())}function generateConvFolderBreadcrumb(e,t=!1){e.innerHTML="";const o='<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md-heavy me-1"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.29289 18.7071C8.90237 18.3166 8.90237 17.6834 9.29289 17.2929L14.5858 12L9.29289 6.70711C8.90237 6.31658 8.90237 5.68342 9.29289 5.29289C9.68342 4.90237 10.3166 4.90237 10.7071 5.29289L16.7071 11.2929C16.8946 11.4804 17 11.7348 17 12C17 12.2652 16.8946 12.5196 16.7071 12.7071L10.7071 18.7071C10.3166 19.0976 9.68342 19.0976 9.29289 18.7071Z" fill="currentColor"></path></svg>',r=i=>`<svg stroke="currentColor" fill="currentColor" class="icon icon-sm me-1 ${i?"text-token-text-primary":""} group-hover:text-token-text-primary" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M147.8 192H480V144C480 117.5 458.5 96 432 96h-160l-64-64h-160C21.49 32 0 53.49 0 80v328.4l90.54-181.1C101.4 205.6 123.4 192 147.8 192zM543.1 224H147.8C135.7 224 124.6 230.8 119.2 241.7L0 480h447.1c12.12 0 23.2-6.852 28.62-17.69l96-192C583.2 249 567.7 224 543.1 224z"/></svg>`;if(e.innerHTML+=o,!t){const i=isDefaultConvFolder(selectedConversationFolderBreadcrumb[0]?.id),a=document.querySelector("#modal-manager #conversation-manager-new-folder-button");i?a&&a.classList.replace("flex","hidden"):a&&a.classList.replace("hidden","flex")}const n=t?[{id:"root",name:"Root"},...selectedConversationFolderBreadcrumb]:selectedConversationFolderBreadcrumb;n.forEach((i,a)=>{const s=document.createElement("span");s.classList="flex items-center text-token-text-tertiary text-sm group";const l=`<span id="folder-breadcrumb-${i.id}" class="me-1 ${t?"":"text-nowrap"} hover:underline cursor-pointer ${a===n.length-1?"text-token-text-primary":"text-token-text-tertiary hover:text-token-text-primary"}" data-folder-id="${i.id}">
      ${isDefaultConvFolder(i.id)?i.displayName:i.name}
    </span>`;s.innerHTML=`${r(a===n.length-1)}${l}`,a<n.length-1&&(s.innerHTML+=o),e.appendChild(s)})}const defaultConversationFolders=[{id:"all",name:'<div class="flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-sm me-2" viewBox="0 0 512 512" fill="currentColor"><path d="M360 144h-208C138.8 144 128 154.8 128 168S138.8 192 152 192h208C373.3 192 384 181.3 384 168S373.3 144 360 144zM264 240h-112C138.8 240 128 250.8 128 264S138.8 288 152 288h112C277.3 288 288 277.3 288 264S277.3 240 264 240zM447.1 0h-384c-35.25 0-64 28.75-64 63.1v287.1c0 35.25 28.75 63.1 64 63.1h96v83.1c0 9.836 11.02 15.55 19.12 9.7l124.9-93.7h144c35.25 0 64-28.75 64-63.1V63.1C511.1 28.75 483.2 0 447.1 0zM464 352c0 8.75-7.25 16-16 16h-160l-80 60v-60H64c-8.75 0-16-7.25-16-16V64c0-8.75 7.25-16 16-16h384c8.75 0 16 7.25 16 16V352z"/></svg> All conversations</div>',code:"all-conversations",displayName:"All Conversations"},{id:"favorites",name:'<div class="flex items-center"><svg class="icon icon-sm me-2" fill="gold" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M381.2 150.3L524.9 171.5C536.8 173.2 546.8 181.6 550.6 193.1C554.4 204.7 551.3 217.3 542.7 225.9L438.5 328.1L463.1 474.7C465.1 486.7 460.2 498.9 450.2 506C440.3 513.1 427.2 514 416.5 508.3L288.1 439.8L159.8 508.3C149 514 135.9 513.1 126 506C116.1 498.9 111.1 486.7 113.2 474.7L137.8 328.1L33.58 225.9C24.97 217.3 21.91 204.7 25.69 193.1C29.46 181.6 39.43 173.2 51.42 171.5L195 150.3L259.4 17.97C264.7 6.954 275.9-.0391 288.1-.0391C300.4-.0391 311.6 6.954 316.9 17.97L381.2 150.3z"/></svg> Favorites</div>',code:"favorites",displayName:"Favorite Conversations"},{id:"archived",name:'<div class="flex items-center"><svg viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-sm me-2"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.62188 3.07918C3.87597 2.571 4.39537 2.25 4.96353 2.25H13.0365C13.6046 2.25 14.124 2.571 14.3781 3.07918L15.75 5.82295V13.5C15.75 14.7426 14.7426 15.75 13.5 15.75H4.5C3.25736 15.75 2.25 14.7426 2.25 13.5V5.82295L3.62188 3.07918ZM13.0365 3.75H4.96353L4.21353 5.25H13.7865L13.0365 3.75ZM14.25 6.75H3.75V13.5C3.75 13.9142 4.08579 14.25 4.5 14.25H13.5C13.9142 14.25 14.25 13.9142 14.25 13.5V6.75ZM6.75 9C6.75 8.58579 7.08579 8.25 7.5 8.25H10.5C10.9142 8.25 11.25 8.58579 11.25 9C11.25 9.41421 10.9142 9.75 10.5 9.75H7.5C7.08579 9.75 6.75 9.41421 6.75 9Z" fill="currentColor"></path></svg> Archived</div>',code:"archived",displayName:"Archived Conversations"}];function isDefaultConvFolder(e){return e?defaultConversationFolders.map(t=>t.id).includes(e.toString()):!1}function conversationManagerModalContent(){resetConversationManagerParams(),clearSidebarSearchInput();const e=document.createElement("div");e.id="modal-content-conversation-manager",e.style="overflow-y: hidden;position: relative;height:100%; width:100%",e.classList="markdown prose-invert flex";const{managerSidebarWidth:t=220}=cachedSettings,o=document.createElement("div");o.id="conversation-manager-sidebar",o.style=`width:${t}px;min-width:220px;resize:horizontal;overflow:hidden;`,o.classList="bg-token-main-surface-primary border-e border-token-border-medium relative h-full",o.appendChild(conversationManagerSidebarContent()),elementResizeObserver(o,"managerSidebarWidth"),e.appendChild(o);const r=document.createElement("div");return r.id="conversation-manager-main-content",r.style=`width:calc(100% - ${t}px)`,r.classList="overflow-y-auto h-full",r.addEventListener("dragover",n=>{if(n.preventDefault(),n.stopPropagation(),!document.querySelector(".folder-dragging"))return;const i=getLastSelectedConversationFolder();isDefaultConvFolder(i.id)||(event.dataTransfer.dropEffect="move",r.classList.add("conversation-list-drag-hover"))}),r.addEventListener("dragleave",n=>{if(n.preventDefault(),n.stopPropagation(),!document.querySelector(".folder-dragging"))return;const i=getLastSelectedConversationFolder();isDefaultConvFolder(i.id)||r.classList.remove("conversation-list-drag-hover")}),r.addEventListener("drop",n=>{if(n.preventDefault(),n.stopPropagation(),resetConversationManagerSelection(),!document.querySelector(".folder-dragging"))return;const i=getLastSelectedConversationFolder();if(isDefaultConvFolder(i.id))return;r.classList.remove("conversation-list-drag-hover");let a;try{a=JSON.parse(n.dataTransfer.getData("text/plain"))}catch(s){console.error("Error parsing dragged data:",s);return}if(a&&a.draggingObject==="folder"){const s=a.folder;if(!s||s.id===i?.id||convBreadcrumbIncludesFolder(s.id))return;moveConvFolder(s,i.id)}}),r.appendChild(conversationManagerMainContent()),e.appendChild(r),e}function conversationManagerModalActions(){const e=getLastSelectedConversationFolder(),t=isDefaultConvFolder(e?.id),o=document.createElement("div");o.classList="flex items-center justify-end w-full mt-2";const r=document.createElement("button");return r.id="conversation-manager-start-new-chat-button",r.classList="btn composer-submit-btn composer-submit-button-color",r.innerText=t?translate("Start a New Chat"):e?.gizmo_id?translate("Start a new chat with this GPT"):translate("Start a new chat in this folder"),r.addEventListener("click",()=>{closeMenus();const n=getLastSelectedConversationFolder();isDefaultConvFolder(n?.id)||(folderForNewChat=n,initiateNewChatFolderIndicator());const i=document.querySelector("#modal-manager #modal-close-button-manager");i&&i.click(),startNewChat(!1,n.gizmo_id)}),o.appendChild(r),o}function conversationManagerSidebarContent(){const e=document.createElement("div");e.classList="relative h-full";const t=document.createElement("div");t.classList="text-lg p-4",t.innerText=translate("Folders"),e.appendChild(t);const o=document.createElement("div");o.id="conversation-manager-sidebar-folders",o.classList="px-2 pb-64 overflow-y-auto h-full",o.addEventListener("scroll",()=>{const s=document.querySelector("#modal-manager #conversation-manager-folder-menu");s&&s.remove()}),e.appendChild(o),o.appendChild(defaultConversationFoldersList()),o.appendChild(loadingSpinner("conversation-manager-sidebar"));const{selectedConversationsManagerFoldersSortBy:r="alphabetical"}=cachedSettings;chrome.runtime.sendMessage({type:"getConversationFolders",detail:{sortBy:r}},async s=>{if(!s||!Array.isArray(s))return;const l=document.querySelector("#modal-manager #loading-spinner-conversation-manager-sidebar");l&&l.remove();let d=getLastSelectedConversationFolder();s.length===0?(o.appendChild(noConversationFolderElemet()),(!d||!isDefaultConvFolder(d?.id?.toString()))&&(selectedConversationFolderBreadcrumb=[defaultConversationFolders[0]],document.querySelector(`#modal-manager #conversation-folder-wrapper-${selectedConversationFolderBreadcrumb[0]?.id}`)?.querySelector('div[id^="selected-conversation-folder-indicator-"]')?.classList?.add("bg-black","dark:bg-white"))):((!d||![...defaultConversationFolders,...s].map(m=>m.id.toString()).includes(selectedConversationFolderBreadcrumb?.[0]?.id?.toString()))&&(selectedConversationFolderBreadcrumb=[s[0]]),s.forEach(m=>{o.appendChild(conversationFolderElement(m))})),d=getLastSelectedConversationFolder(),chrome.storage.local.set({selectedConversationFolderBreadcrumb});const c=document.querySelector("#modal-manager #conversation-manager-breadcrumb");c&&generateConvFolderBreadcrumb(c);const u=document.querySelector("#sidebar-folder-drawer #sidebar-folder-breadcrumb");u&&generateConvFolderBreadcrumb(u,!0),toggleNewConversationInFolderButton(isDefaultConvFolder(d?.id)),await fetchConversations(),await throttleFetchSidebarConversations(1,!1,!1),throttleGetConvSubFolders(d?.id)});const n=document.createElement("div");n.classList="flex items-center justify-between absolute start-0 bottom-0 w-full bg-token-main-surface-secondary border-t border-token-border-medium px-2 h-10 z-10",e.appendChild(n);const i=document.createElement("button");i.id="conversation-manager-sidebar-settings-button",i.classList="flex items-center justify-center h-8 rounded-lg px-2 text-token-text-tertiary focus-visible:outline-0 hover:bg-token-sidebar-surface-secondary focus-visible:bg-token-sidebar-surface-secondary",i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round" class="icon icon-md" fill="currentColor" viewBox="0 0 448 512"><path d="M0 88C0 74.75 10.75 64 24 64H424C437.3 64 448 74.75 448 88C448 101.3 437.3 112 424 112H24C10.75 112 0 101.3 0 88zM0 248C0 234.7 10.75 224 24 224H424C437.3 224 448 234.7 448 248C448 261.3 437.3 272 424 272H24C10.75 272 0 261.3 0 248zM424 432H24C10.75 432 0 421.3 0 408C0 394.7 10.75 384 24 384H424C437.3 384 448 394.7 448 408C448 421.3 437.3 432 424 432z"/></svg>',i.addEventListener("click",s=>{s.stopPropagation(),s.preventDefault(),closeMenus(),showConversationManagerSidebarSettingsMenu(i)}),n.appendChild(i);const a=document.createElement("button");return a.id="add-conversation-folder-button",a.classList="flex items-center justify-center h-8 rounded-lg px-2 text-token-text-tertiary focus-visible:outline-0 hover:bg-token-sidebar-surface-secondary focus-visible:bg-token-sidebar-surface-secondary",a.innerHTML='<svg stroke="currentColor" fill="currentColor" stroke-width="2" viewBox="0 0 448 512" stroke-linecap="round" stroke-linejoin="round" class="icon icon-md" xmlns="http://www.w3.org/2000/svg"> <path d="M432 256C432 269.3 421.3 280 408 280h-160v160c0 13.25-10.75 24.01-24 24.01S200 453.3 200 440v-160h-160c-13.25 0-24-10.74-24-23.99C16 242.8 26.75 232 40 232h160v-160c0-13.25 10.75-23.99 24-23.99S248 58.75 248 72v160h160C421.3 232 432 242.8 432 256z"> </path> </svg>',addTooltip(a,{value:"Add New Root Folder",position:"top"}),chrome.runtime.sendMessage({type:"checkHasSubscription"},s=>{a.addEventListener("click",()=>{document.querySelectorAll("#no-conversation-folders").forEach(d=>d.remove());const l=document.querySelectorAll('#modal-manager #conversation-manager-sidebar-folders > div[id^="conversation-folder-wrapper-"]');if(!s&&l.length>=5){errorUpgradeConfirmation({type:"limit",title:"You have reached the limit",message:"You have reached the limits of Conversation Folders with free account. Upgrade to Pro to remove all limits."});return}chrome.runtime.sendMessage({type:"addConversationFolders",detail:{folders:[{name:"New Folder",color:generateRandomDarkColor()}]}},d=>{if(d.error&&d.error.type==="limit"){errorUpgradeConfirmation(d.error);return}!d||d.length===0||(addNewConvFolderElementToManagerSidebar(d[0]),document.querySelector(`#modal-manager #conversation-folder-wrapper-${d[0].id}`).click(),handleRenameConversationFolderClick(d[0].id))})})}),n.appendChild(a),e.addEventListener("dragover",s=>{s.preventDefault(),s.stopPropagation(),document.querySelector(".folder-dragging")&&(event.dataTransfer.dropEffect="move",e.classList.add("conversation-sidebar-drag-hover"))}),e.addEventListener("dragleave",s=>{s.preventDefault(),s.stopPropagation(),document.querySelector(".folder-dragging")&&e.classList.remove("conversation-sidebar-drag-hover")}),e.addEventListener("drop",s=>{if(s.preventDefault(),s.stopPropagation(),resetConversationManagerSelection(),!document.querySelector(".folder-dragging"))return;e.classList.remove("conversation-sidebar-drag-hover");let l;try{l=JSON.parse(s.dataTransfer.getData("text/plain"))}catch(d){console.error("Error parsing dragged data:",d);return}if(l&&l.draggingObject==="folder"){const d=l.folder;if(!d||!d.parent_folder)return;moveConvFolder(d,0)}}),e}function addNewConvFolderElementToManagerSidebar(e){const t=document.querySelector("#modal-manager #conversation-manager-sidebar-folders");t&&(t.appendChild(conversationFolderElement(e)),t.scrollTop=t.scrollHeight)}function defaultConversationFoldersList(e=!1){const t=document.createElement("div");t.id="default-conversation-folders",t.classList="pb-2 mb-4 border-b border-token-border-medium relative";const{showFoldersInLeftSidebar:o}=cachedSettings;defaultConversationFolders.forEach(a=>{t.appendChild(conversationFolderElement(a,e))});const{selectedConversationsManagerFoldersSortBy:r="alphabetical"}=cachedSettings,n={alphabetical:"A\u2192Z","alphabetical-reverse":"Z\u2192A",created_at:"Created At",updated_at:"Updated At"},i=document.createElement("button");return i.innerText=`\u21C5 ${n[r]||"A\u2192Z"}`,i.id="conversation-manager-folders-sort-button",i.classList=`absolute ${e&&!o?"start-0 pe-2":"end-0 ps-2"} text-token-text-tertiary hover:text-token-text-primary cursor-pointer ${e?"bg-token-sidebar-surface-primary":"bg-token-main-surface-primary"}`,i.style="bottom:-10px; font-size: 12px;",addTooltip(i,{value:"Sort Folders",position:e&&!o?"left":"right"}),i.addEventListener("click",a=>{a.stopPropagation(),a.preventDefault(),showConversationFolderSortByMenu(i,e,o)}),t.appendChild(i),t}function conversationFolderElement(e,t=!1,o=!1,r=!1,n=!1,i=!1){if(!e)return null;const a=isDefaultConvFolder(e.id),s=e.id===-1,l=document.createElement("div");l.id=`conversation-folder-wrapper-${e.id}`,l.classList=`relative flex items-center justify-between p-2 ${a?"":"py-1"} ${i?"":"cursor-pointer"} border bg-token-main-surface-secondary border-token-border-medium rounded-md mb-2 group ${s?"opacity-50":""}`;const d=document.querySelector("#sidebar-folder-search-input");if(d&&d.value.trim()!==""){const v=[{name:"Root"},...e.breadcrumb,{name:e.name}].map(x=>x.name).join('<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-sm mx-1"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.29289 18.7071C8.90237 18.3166 8.90237 17.6834 9.29289 17.2929L14.5858 12L9.29289 6.70711C8.90237 6.31658 8.90237 5.68342 9.29289 5.29289C9.68342 4.90237 10.3166 4.90237 10.7071 5.29289L16.7071 11.2929C16.8946 11.4804 17 11.7348 17 12C17 12.2652 16.8946 12.5196 16.7071 12.7071L10.7071 18.7071C10.3166 19.0976 9.68342 19.0976 9.29289 18.7071Z" fill="currentColor"></path></svg>');e.breadcrumb&&addTooltip(l,{value:`<div class="flex items-center">${v}</div>`,position:"right"})}if(a||(l.draggable=!0),l.style.minHeight="42px",r&&(l.style.width="240px"),e.color&&(l.style.backgroundColor=e.color),!t){const v=document.createElement("div");v.id=`selected-conversation-folder-indicator-${e.id}`,v.classList=`w-1 h-10 rounded-s-xl absolute ${selectedConversationFolderBreadcrumb[0]?.id?.toString()===e.id.toString()?"bg-black dark:bg-white":""}`,v.style.right="-9px",l.appendChild(v)}l.addEventListener("click",v=>{if(v.preventDefault(),v.stopPropagation(),i)return;if(closeMenus(),s){errorUpgradeConfirmation({type:"limit",title:"You have reached the limit",message:"With free account, you can only have up to 5 conversation folders. Upgrade to Pro to remove all limits."});return}e.name=l.querySelector(`#conversation-folder-name-${e.id}`).innerHTML,e.color=rgba2hex(l.style.backgroundColor);const x=l.querySelector(`#conversation-folder-image-${e.id}`)?.src;!a&&!x?.startsWith("chrome-extension://")&&(e.image=x);const y=getLastSelectedConversationFolder();if(!t&&!v.shiftKey&&y?.id?.toString()===e.id.toString())return;clearSidebarSearchInput(),e.parent_folder&&e.parent_folder===y?.id?selectedConversationFolderBreadcrumb.push(e):selectedConversationFolderBreadcrumb=[e];const b=document.querySelector("#modal-manager #conversation-manager-breadcrumb");b&&generateConvFolderBreadcrumb(b);const w=document.querySelector("#sidebar-folder-drawer #sidebar-folder-breadcrumb");w&&generateConvFolderBreadcrumb(w,!0),chrome.storage.local.set({selectedConversationFolderBreadcrumb}),toggleNewConversationInFolderButton(isDefaultConvFolder(e.id)),document.querySelectorAll('#modal-manager div[id^="conversation-folder-wrapper-"]')?.forEach(k=>{k.querySelector('div[id^="selected-conversation-folder-indicator-"]')?.classList.remove("bg-black","dark:bg-white")}),document.querySelector(`#modal-manager #conversation-folder-wrapper-${selectedConversationFolderBreadcrumb[0]?.id}`)?.querySelector('div[id^="selected-conversation-folder-indicator-"]')?.classList?.add("bg-black","dark:bg-white"),resetConversationManagerSelection(),resetSidebarConversationSelection(),throttleGetConvSubFolders(e.id,v.shiftKey),t?throttleFetchSidebarConversations(1,!1,v.shiftKey):(fetchConversations(1,!1,v.shiftKey),throttleFetchSidebarConversations(1,!1,!1))}),l.addEventListener("contextmenu",v=>{v.preventDefault(),v.stopPropagation(),document.querySelector(`#conversation-folder-settings-button-${e.id}`)?.click()}),l.addEventListener("dblclick",v=>{v.preventDefault(),v.stopPropagation(),!s&&(i||a||handleRenameConversationFolderClick(e.id))}),l.addEventListener("mouseenter",()=>{if(closeMenus(),i)return;document.querySelectorAll('div[id^="conversation-folder-settings-button-"]').forEach(x=>{x.classList.replace("flex","hidden")});const v=document.querySelector(`#conversation-folder-name-${e.id}`);v&&(v.style.paddingRight="36px")}),l.addEventListener("mouseleave",()=>{const v=document.querySelector(`#conversation-folder-name-${e.id}`);v&&(v.style.paddingRight="0px")}),l.addEventListener("dragstart",v=>{v.stopPropagation(),v.dataTransfer.setData("text/plain",JSON.stringify({draggingObject:"folder",folder:e})),v.dataTransfer.effectAllowed="move",l.classList.add("folder-dragging")}),l.addEventListener("dragend",v=>{v.stopPropagation(),v.dataTransfer.clearData();try{l.classList.remove("folder-dragging")}catch(x){console.error("Error removing folder-dragging class:",x)}}),l.addEventListener("dragover",v=>{if(v.preventDefault(),v.stopPropagation(),i||s||document.querySelector(".folder-dragging")&&isDefaultConvFolder(e.id))return;event.dataTransfer.dropEffect="move";const x=getLastSelectedConversationFolder();e.id==="all"&&x?.id!=="archived"||l.classList.add("folder-drag-hover")}),l.addEventListener("dragleave",v=>{if(v.preventDefault(),v.stopPropagation(),i||s)return;const x=getLastSelectedConversationFolder();e.id==="all"&&x?.id!=="archived"||l.classList.remove("folder-drag-hover")}),l.addEventListener("drop",v=>{if(v.preventDefault(),v.stopPropagation(),resetConversationManagerSelection(),i||s)return;l.classList.remove("folder-drag-hover");let x;try{x=JSON.parse(v.dataTransfer.getData("text/plain"))}catch(y){console.error("Error parsing dragged data:",y);return}if(x){if(x.draggingObject==="conversation"){const y=x.conversation?.conversation_id;if(!y)return;const b=getLastSelectedConversationFolder();if(e.id===b?.id)return;if(e.id==="favorites"){const w=document.querySelector(`#modal-manager #conversation-card-${y}`).querySelector("#modal-manager #conversation-card-favorite");w&&w.querySelector("svg")&&w.querySelector("svg").getAttribute("fill")!=="gold"&&w.click();return}if(e.id==="archived"){handleClickArchiveConversationsButton([y]);return}if(b?.id==="archived"&&handleClickUnarchiveConversationsButton([y]),e.id==="all")return;moveConvToFolder([y],e.id,e.name,e.color)}if(x.draggingObject==="folder"){if(isDefaultConvFolder(e.id))return;const y=x.folder;if(!y)return;const b=getLastSelectedConversationFolder();if(y.id===b?.id||e.id===y.id)return;moveConvFolder(y,e.id)}}});const c=document.createElement("div");c.classList="flex items-center justify-start w-full h-full overflow-hidden";const u=e.image||e.image_url,m=e.image||e.image_url||(a?"":chrome.runtime.getURL("icons/folder.png")),g=document.createElement("img");g.id=`conversation-folder-image-${e.id}`,g.src=m,g.classList=`${u?"w-6 h-6 me-2":"w-5 h-5 me-3"} rounded-md object-cover ${m?"":"hidden"}`,g.style="filter:drop-shadow(0px 0px 1px black);padding-left:1px;",c.appendChild(g);const p=document.createElement("div");p.classList="flex items-center justify-start w-full flex-wrap overflow-hidden",c.appendChild(p);const h=document.createElement("span");if(h.id=`conversation-folder-name-${e.id}`,h.classList=`w-full truncate max-h-5 relative text-sm ${a?"text-token-text-primary":"text-white"}`,h.innerHTML=e.name,p.appendChild(h),!a){const v=document.createElement("span");v.id=`folder-subfolder-count-${e.id}`,v.style="color: rgba(255, 255, 255, 0.6); font-size: 0.7rem;margin-right: 4px;",v.innerText=`${e?.subfolders?.length||0} folder${e?.subfolders?.length===1?"":"s"} -`,p.appendChild(v);const x=document.createElement("span");x.id=`folder-conv-count-${e.id}`,x.style="color: rgba(255, 255, 255, 0.6); font-size: 0.7rem;",x.innerText=`${e.conversation_count||0} chat${e.conversation_count===1?"":"s"}`,p.appendChild(x)}l.appendChild(c);const f=document.createElement("div");if(f.id=`conversation-folder-settings-button-${e.id}`,f.classList="absolute end-1 items-center justify-center h-6 rounded-lg px-2 text-token-text-primary focus-visible:outline-0 bg-token-sidebar-surface-secondary focus-visible:bg-token-sidebar-surface-secondary hidden group-hover:flex",f.innerHTML='<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 12C3 10.8954 3.89543 10 5 10C6.10457 10 7 10.8954 7 12C7 13.1046 6.10457 14 5 14C3.89543 14 3 13.1046 3 12ZM10 12C10 10.8954 10.8954 10 12 10C13.1046 10 14 10.8954 14 12C14 13.1046 13.1046 14 12 14C10.8954 14 10 13.1046 10 12ZM17 12C17 10.8954 17.8954 10 19 10C20.1046 10 21 10.8954 21 12C21 13.1046 20.1046 14 19 14C17.8954 14 17 13.1046 17 12Z" fill="currentColor"></path></svg>',f.addEventListener("click",async v=>{v.stopPropagation(),v.preventDefault(),closeMenus(),f.classList.replace("hidden","flex"),showConversationManagerFolderMenu(f,e,t,o)}),!i&&e.id!=="archived"&&!s&&l.appendChild(f),n){const v=document.createElement("div");v.id=`conversation-folder-settings-button-${e.id}`,v.classList="cursor-pointer items-center justify-center p-1 rounded-full text-token-text-primary focus-visible:outline-0 bg-token-sidebar-surface-secondary focus-visible:bg-token-sidebar-surface-secondary",v.innerHTML='<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>',v.addEventListener("click",()=>{folderForNewChat=null,initiateNewChatFolderIndicator()}),l.appendChild(v)}if(s){const v=document.createElement("div");v.classList="absolute end-1 flex items-center justify-center h-6 rounded-lg px-2",v.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon icon-lg" fill="#ef4146"><path d="M80 192V144C80 64.47 144.5 0 224 0C303.5 0 368 64.47 368 144V192H384C419.3 192 448 220.7 448 256V448C448 483.3 419.3 512 384 512H64C28.65 512 0 483.3 0 448V256C0 220.7 28.65 192 64 192H80zM144 192H304V144C304 99.82 268.2 64 224 64C179.8 64 144 99.82 144 144V192z"/></svg>',l.appendChild(v)}return l}function updateConversationFolderCount(e,t){const o=document.querySelectorAll(`#folder-conv-count-${e}`);t.forEach(r=>{const n=document.querySelector(`div#conversation-card-${r}[data-folder-id]`);if(n){const i=n.dataset.folderId;if(!i||i===e)return;isDefaultConvFolder(i)||document.querySelectorAll(`#folder-conv-count-${i}`).forEach(a=>{const s=parseInt(a.innerText.split(" ")[0],10)-1;a.innerText=`${s} chat${s!==1?"s":""}`})}e&&(isDefaultConvFolder(e)||o.forEach(i=>{const a=parseInt(i.innerText.split(" ")[0],10)+1;i.innerText=`${a} chat${a!==1?"s":""}`}))})}function resetConversationCounts(){document.querySelectorAll('span[id^="folder-conv-count-"]').forEach(e=>{e.innerText="0 chats"})}const throttleGetConvSubFolders=throttle(async(e,t=!1)=>{await getConvSubFolders(e,t)},500);async function getConvSubFolders(e,t=!1){const o=document.querySelector("#modal-manager input[id=conversation-manager-search-input]")?.value;if(!e&&!o)return;const r=document.querySelector("#modal-manager #conversation-manager-subfolder-list");r&&(r.innerHTML="");const n=document.querySelector("#sidebar-folder-drawer #sidebar-folder-content");if(n?.querySelector("#default-conversation-folders")?.remove(),n&&n.querySelectorAll('div[id^="conversation-folder-wrapper-"]').forEach(a=>a.remove()),isDefaultConvFolder(e))return;const{selectedConversationsManagerFoldersSortBy:i="alphabetical"}=cachedSettings;chrome.runtime.sendMessage({type:"getConversationFolders",forceRefresh:t,detail:o?{sortBy:i,searchTerm:o}:{sortBy:i,parentFolderId:e}},a=>{a&&Array.isArray(a)&&a.length>0&&(a.forEach(s=>{r?.appendChild(conversationFolderElement(s,!1,!0))}),o||a.reverse().forEach(s=>{n?.prepend(conversationFolderElement(s,!0))}))})}function conversationCardCompactViewButton(){const{selectedConversationView:e}=cachedSettings,t=document.createElement("button");return t.classList="h-10 aspect-1 flex items-center justify-center rounded-lg px-2 ms-2 text-token-text-tertiary focus-visible:outline-0 bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary focus-visible:bg-token-sidebar-surface-secondary ",t.innerHTML=e==="list"?'<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="icon icon-md" viewBox="0 0 448 512"><path d="M88 32C110.1 32 128 49.91 128 72V120C128 142.1 110.1 160 88 160H40C17.91 160 0 142.1 0 120V72C0 49.91 17.91 32 40 32H88zM88 64H40C35.58 64 32 67.58 32 72V120C32 124.4 35.58 128 40 128H88C92.42 128 96 124.4 96 120V72C96 67.58 92.42 64 88 64zM88 192C110.1 192 128 209.9 128 232V280C128 302.1 110.1 320 88 320H40C17.91 320 0 302.1 0 280V232C0 209.9 17.91 192 40 192H88zM88 224H40C35.58 224 32 227.6 32 232V280C32 284.4 35.58 288 40 288H88C92.42 288 96 284.4 96 280V232C96 227.6 92.42 224 88 224zM0 392C0 369.9 17.91 352 40 352H88C110.1 352 128 369.9 128 392V440C128 462.1 110.1 480 88 480H40C17.91 480 0 462.1 0 440V392zM32 392V440C32 444.4 35.58 448 40 448H88C92.42 448 96 444.4 96 440V392C96 387.6 92.42 384 88 384H40C35.58 384 32 387.6 32 392zM248 32C270.1 32 288 49.91 288 72V120C288 142.1 270.1 160 248 160H200C177.9 160 160 142.1 160 120V72C160 49.91 177.9 32 200 32H248zM248 64H200C195.6 64 192 67.58 192 72V120C192 124.4 195.6 128 200 128H248C252.4 128 256 124.4 256 120V72C256 67.58 252.4 64 248 64zM160 232C160 209.9 177.9 192 200 192H248C270.1 192 288 209.9 288 232V280C288 302.1 270.1 320 248 320H200C177.9 320 160 302.1 160 280V232zM192 232V280C192 284.4 195.6 288 200 288H248C252.4 288 256 284.4 256 280V232C256 227.6 252.4 224 248 224H200C195.6 224 192 227.6 192 232zM248 352C270.1 352 288 369.9 288 392V440C288 462.1 270.1 480 248 480H200C177.9 480 160 462.1 160 440V392C160 369.9 177.9 352 200 352H248zM248 384H200C195.6 384 192 387.6 192 392V440C192 444.4 195.6 448 200 448H248C252.4 448 256 444.4 256 440V392C256 387.6 252.4 384 248 384zM320 72C320 49.91 337.9 32 360 32H408C430.1 32 448 49.91 448 72V120C448 142.1 430.1 160 408 160H360C337.9 160 320 142.1 320 120V72zM352 72V120C352 124.4 355.6 128 360 128H408C412.4 128 416 124.4 416 120V72C416 67.58 412.4 64 408 64H360C355.6 64 352 67.58 352 72zM408 192C430.1 192 448 209.9 448 232V280C448 302.1 430.1 320 408 320H360C337.9 320 320 302.1 320 280V232C320 209.9 337.9 192 360 192H408zM408 224H360C355.6 224 352 227.6 352 232V280C352 284.4 355.6 288 360 288H408C412.4 288 416 284.4 416 280V232C416 227.6 412.4 224 408 224zM320 392C320 369.9 337.9 352 360 352H408C430.1 352 448 369.9 448 392V440C448 462.1 430.1 480 408 480H360C337.9 480 320 462.1 320 440V392zM352 392V440C352 444.4 355.6 448 360 448H408C412.4 448 416 444.4 416 440V392C416 387.6 412.4 384 408 384H360C355.6 384 352 387.6 352 392z"/></svg>':'<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="icon icon-md" viewBox="0 0 512 512"><path d="M16 72C16 58.75 26.75 48 40 48H88C101.3 48 112 58.75 112 72V120C112 133.3 101.3 144 88 144H40C26.75 144 16 133.3 16 120V72zM80 112V80H48V112H80zM496 80C504.8 80 512 87.16 512 96C512 104.8 504.8 112 496 112H176C167.2 112 160 104.8 160 96C160 87.16 167.2 80 176 80H496zM496 240C504.8 240 512 247.2 512 256C512 264.8 504.8 272 496 272H176C167.2 272 160 264.8 160 256C160 247.2 167.2 240 176 240H496zM496 400C504.8 400 512 407.2 512 416C512 424.8 504.8 432 496 432H176C167.2 432 160 424.8 160 416C160 407.2 167.2 400 176 400H496zM88 208C101.3 208 112 218.7 112 232V280C112 293.3 101.3 304 88 304H40C26.75 304 16 293.3 16 280V232C16 218.7 26.75 208 40 208H88zM48 240V272H80V240H48zM16 392C16 378.7 26.75 368 40 368H88C101.3 368 112 378.7 112 392V440C112 453.3 101.3 464 88 464H40C26.75 464 16 453.3 16 440V392zM80 432V400H48V432H80z"/></svg>',t.addEventListener("click",()=>{const o=document.querySelector("#modal-manager #conversation-manager-conversation-list");o.classList=`grid ${cachedSettings.selectedConversationView!=="list"?"grid-cols-1 gap-2":"grid-cols-1 sm:grid-cols-2 gap-2 lg:grid-cols-3 xl:grid-cols-4"} w-full content-start`,cachedSettings.selectedConversationView==="list"?t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="icon icon-md" viewBox="0 0 512 512"><path d="M16 72C16 58.75 26.75 48 40 48H88C101.3 48 112 58.75 112 72V120C112 133.3 101.3 144 88 144H40C26.75 144 16 133.3 16 120V72zM80 112V80H48V112H80zM496 80C504.8 80 512 87.16 512 96C512 104.8 504.8 112 496 112H176C167.2 112 160 104.8 160 96C160 87.16 167.2 80 176 80H496zM496 240C504.8 240 512 247.2 512 256C512 264.8 504.8 272 496 272H176C167.2 272 160 264.8 160 256C160 247.2 167.2 240 176 240H496zM496 400C504.8 400 512 407.2 512 416C512 424.8 504.8 432 496 432H176C167.2 432 160 424.8 160 416C160 407.2 167.2 400 176 400H496zM88 208C101.3 208 112 218.7 112 232V280C112 293.3 101.3 304 88 304H40C26.75 304 16 293.3 16 280V232C16 218.7 26.75 208 40 208H88zM48 240V272H80V240H48zM16 392C16 378.7 26.75 368 40 368H88C101.3 368 112 378.7 112 392V440C112 453.3 101.3 464 88 464H40C26.75 464 16 453.3 16 440V392zM80 432V400H48V432H80z"/></svg>':t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="icon icon-md" viewBox="0 0 448 512"><path d="M88 32C110.1 32 128 49.91 128 72V120C128 142.1 110.1 160 88 160H40C17.91 160 0 142.1 0 120V72C0 49.91 17.91 32 40 32H88zM88 64H40C35.58 64 32 67.58 32 72V120C32 124.4 35.58 128 40 128H88C92.42 128 96 124.4 96 120V72C96 67.58 92.42 64 88 64zM88 192C110.1 192 128 209.9 128 232V280C128 302.1 110.1 320 88 320H40C17.91 320 0 302.1 0 280V232C0 209.9 17.91 192 40 192H88zM88 224H40C35.58 224 32 227.6 32 232V280C32 284.4 35.58 288 40 288H88C92.42 288 96 284.4 96 280V232C96 227.6 92.42 224 88 224zM0 392C0 369.9 17.91 352 40 352H88C110.1 352 128 369.9 128 392V440C128 462.1 110.1 480 88 480H40C17.91 480 0 462.1 0 440V392zM32 392V440C32 444.4 35.58 448 40 448H88C92.42 448 96 444.4 96 440V392C96 387.6 92.42 384 88 384H40C35.58 384 32 387.6 32 392zM248 32C270.1 32 288 49.91 288 72V120C288 142.1 270.1 160 248 160H200C177.9 160 160 142.1 160 120V72C160 49.91 177.9 32 200 32H248zM248 64H200C195.6 64 192 67.58 192 72V120C192 124.4 195.6 128 200 128H248C252.4 128 256 124.4 256 120V72C256 67.58 252.4 64 248 64zM160 232C160 209.9 177.9 192 200 192H248C270.1 192 288 209.9 288 232V280C288 302.1 270.1 320 248 320H200C177.9 320 160 302.1 160 280V232zM192 232V280C192 284.4 195.6 288 200 288H248C252.4 288 256 284.4 256 280V232C256 227.6 252.4 224 248 224H200C195.6 224 192 227.6 192 232zM248 352C270.1 352 288 369.9 288 392V440C288 462.1 270.1 480 248 480H200C177.9 480 160 462.1 160 440V392C160 369.9 177.9 352 200 352H248zM248 384H200C195.6 384 192 387.6 192 392V440C192 444.4 195.6 448 200 448H248C252.4 448 256 444.4 256 440V392C256 387.6 252.4 384 248 384zM320 72C320 49.91 337.9 32 360 32H408C430.1 32 448 49.91 448 72V120C448 142.1 430.1 160 408 160H360C337.9 160 320 142.1 320 120V72zM352 72V120C352 124.4 355.6 128 360 128H408C412.4 128 416 124.4 416 120V72C416 67.58 412.4 64 408 64H360C355.6 64 352 67.58 352 72zM408 192C430.1 192 448 209.9 448 232V280C448 302.1 430.1 320 408 320H360C337.9 320 320 302.1 320 280V232C320 209.9 337.9 192 360 192H408zM408 224H360C355.6 224 352 227.6 352 232V280C352 284.4 355.6 288 360 288H408C412.4 288 416 284.4 416 280V232C416 227.6 412.4 224 408 224zM320 392C320 369.9 337.9 352 360 352H408C430.1 352 448 369.9 448 392V440C448 462.1 430.1 480 408 480H360C337.9 480 320 462.1 320 440V392zM352 392V440C352 444.4 355.6 448 360 448H408C412.4 448 416 444.4 416 440V392C416 387.6 412.4 384 408 384H360C355.6 384 352 387.6 352 392z"/></svg>',chrome.storage.local.set({settings:{...cachedSettings,selectedConversationView:cachedSettings.selectedConversationView==="list"?"grid":"list"}},()=>{fetchConversations()})}),t}function conversationManagerMainContent(){const e=getLastSelectedConversationFolder(),t=isDefaultConvFolder(selectedConversationFolderBreadcrumb[0]?.id),o=document.createElement("div");o.id="conversation-manager-content-wrapper",o.classList="relative h-full overflow-hidden",o.style.paddingBottom="59px";const r=document.createElement("div");r.classList="flex items-center justify-between p-2 bg-token-main-surface-primary border-b border-token-border-medium sticky top-0 z-10",o.appendChild(r);const n=document.createElement("input");n.id="conversation-manager-search-input",n.type="search",n.placeholder=translate("Search conversations"),n.classList="w-full p-2 rounded-md border border-token-border-medium bg-token-main-surface-secondary text-token-text-tertiary";const i=debounce(()=>{fetchConversations(),throttleGetConvSubFolders()});n.addEventListener("input",C=>{const L=getLastSelectedConversationFolder();if(L?.id!=="all"&&L?.id!=="archived"&&document.querySelector("#modal-manager #conversation-folder-wrapper-all").click(),C.target.value.trim().length>0){const T=document.querySelector("#modal-manager #conversation-manager-conversation-list");T&&(T.innerHTML="",T.appendChild(loadingSpinner("conversation-manager-main-content"))),i(C)}else fetchConversations(),throttleGetConvSubFolders();const _=document.querySelector("#conversation-manager-search-term-pill-text");C.target.value.trim().length>0?(_.innerText=C.target.value.trim(),document.querySelector("#conversation-manager-search-term-pill").classList.remove("hidden")):(_.innerText="",document.querySelector("#conversation-manager-search-term-pill").classList.add("hidden"))}),r.appendChild(n);const a=document.createElement("div");a.id="conversation-manager-filters-right-section",a.classList=`flex items-center ${e?.id==="all"||e?.id==="archived"?"hidden":""}`,r.appendChild(a);const{selectedConversationsManagerSortBy:s}=cachedSettings,l=document.createElement("div");l.id="conversation-manager-sort-by-wrapper",l.style="position:relative;width:150px;z-index:1000;margin-left:8px;",l.innerHTML=dropdown("Conversations-Manager-SortBy",conversationsSortByList,s,"code","right"),a.appendChild(l);const d=conversationCardCompactViewButton();r.appendChild(d);const c=document.createElement("div");c.id="conversation-manager-selection-bar",c.classList="flex items-center justify-end px-2 py-3 hidden sticky top-0 bg-token-main-surface-primary z-10",o.appendChild(c);const u=document.createElement("button");u.id="conversation-manager-selection-cancel-button",u.classList="flex items-center justify-center h-8 rounded-lg px-2 text-token-text-primary focus-visible:outline-0 bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary focus-visible:bg-token-main-surface-tertiary ms-2 me-auto border border-token-border-medium",u.innerText=translate("Cancel"),u.addEventListener("click",()=>{resetConversationManagerSelection()}),c.appendChild(u);const m=document.createElement("span");m.id="conversation-manager-selection-count",m.classList="text-token-text-tertiary text-xs me-4",m.innerText="0 selected",c.appendChild(m);const g=document.createElement("button");g.classList="flex items-center justify-center h-8 rounded-lg px-2 text-token-text-primary focus-visible:outline-0 bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary focus-visible:bg-token-main-surface-tertiary me-2 border border-token-border-medium",g.innerText=translate("Delete"),g.addEventListener("click",()=>{const C=Array.from(document.querySelectorAll('#modal-manager input[id^="conversation-checkbox-"]:checked'));if(C.length===0)return;const L=C.map(_=>_.dataset.conversationId);handleDeleteSelectedConversations(L)}),c.appendChild(g);const p=document.createElement("button");p.id="conversation-manager-remove-button",p.classList=`flex items-center justify-center h-8 rounded-lg px-2 text-token-text-primary focus-visible:outline-0 bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary focus-visible:bg-token-main-surface-tertiary me-2 border border-token-border-medium ${t?"hidden":""}`,p.innerText=translate("Remove from folder"),p.addEventListener("click",()=>{handleClickRemoveConversationsButton()}),c.appendChild(p);const h=document.createElement("button");h.id="conversation-manager-move-button",h.classList=`flex items-center justify-center h-8 rounded-lg px-2 text-token-text-primary focus-visible:outline-0 bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary focus-visible:bg-token-main-surface-tertiary me-2 border border-token-border-medium ${t?"hidden":""}`,h.innerText=translate("Move"),h.addEventListener("click",()=>{handleClickMoveConversationsButton()}),c.appendChild(h);const f=document.createElement("button");f.id="conversation-manager-add-to-project-button",f.classList="flex items-center justify-center h-8 rounded-lg px-2 text-token-text-primary focus-visible:outline-0 bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary focus-visible:bg-token-main-surface-tertiary me-2 border border-token-border-medium",f.innerText=translate("Add to project"),f.addEventListener("click",C=>{C.stopPropagation(),C.preventDefault();const L=Array.from(document.querySelectorAll('#modal-manager input[id^="conversation-checkbox-"]:checked')).map(_=>_.dataset.conversationId);showProjectsList(f,L,!1)}),c.appendChild(f);const v=document.createElement("button");v.id="conversation-manager-add-to-folder-button",v.classList=`flex items-center justify-center h-8 rounded-lg px-2 text-token-text-primary focus-visible:outline-0 bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary focus-visible:bg-token-main-surface-tertiary me-2 border border-token-border-medium ${["all"].includes(e?.id)?"":"hidden"}`,v.innerText=translate("Add to folder"),v.addEventListener("click",()=>{handleClickMoveConversationsButton()}),c.appendChild(v);const x=document.createElement("button");x.id="conversation-manager-archive-button",x.classList=`flex items-center justify-center h-8 rounded-lg px-2 text-token-text-primary focus-visible:outline-0 bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary focus-visible:bg-token-main-surface-tertiary me-2 border border-token-border-medium ${["archived"].includes(e?.id)?"hidden":""}`,x.innerText=translate("Archive"),x.addEventListener("click",()=>{const C=Array.from(document.querySelectorAll('#modal-manager input[id^="conversation-checkbox-"]:checked')).map(L=>L.dataset.conversationId);handleClickArchiveConversationsButton(C)}),c.appendChild(x);const y=document.createElement("button");y.id="conversation-manager-unarchive-button",y.classList=`flex items-center justify-center h-8 rounded-lg px-2 text-token-text-primary focus-visible:outline-0 bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary focus-visible:bg-token-main-surface-tertiary me-2 border border-token-border-medium ${e?.id==="archived"?"":"hidden"}`,y.innerText=translate("Unarchive"),y.addEventListener("click",()=>{const C=Array.from(document.querySelectorAll('#modal-manager input[id^="conversation-checkbox-"]:checked')).map(L=>L.dataset.conversationId);handleClickUnarchiveConversationsButton(C)}),c.appendChild(y);const b=document.createElement("button");b.id="conversation-manager-export-button",b.classList="flex items-center justify-center h-8 rounded-lg px-2 text-token-text-primary focus-visible:outline-0 bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary focus-visible:bg-token-main-surface-tertiary me-2 border border-token-border-medium",b.innerText=translate("Export"),b.addEventListener("click",()=>{handleClickExportConversationsButton()}),c.appendChild(b);const w=document.createElement("div");w.id="conversation-manager-folder-content-wrapper",w.classList="bg-token-sidebar-surface-primary flex flex-wrap h-full overflow-y-auto p-4 pb-32 content-start",o.appendChild(w);const k=document.createElement("div");k.id="conversation-manager-header",k.classList="flex items-center justify-between mb-4 w-full",w.appendChild(k);const S=document.createElement("div");S.id="conversation-manager-breadcrumb",S.classList="flex items-center justify-start bg-token-main-surface-secondary p-2 rounded-lg border border-token-border-medium overflow-x-auto",S.style.maxWidth="calc(100% - 48px)",S.addEventListener("click",C=>{if(C.target&&C.target.matches("[data-folder-id]")){const L=C.target.getAttribute("data-folder-id"),_=selectedConversationFolderBreadcrumb.findIndex(T=>T.id.toString()===L.toString());if(_!==-1&&(_<selectedConversationFolderBreadcrumb.length-1||C.shiftKey)){resetConversationManagerSelection(),selectedConversationFolderBreadcrumb=selectedConversationFolderBreadcrumb.slice(0,_+1),chrome.storage.local.set({selectedConversationFolderBreadcrumb}),toggleNewConversationInFolderButton(L==="root"||isDefaultConvFolder(L)),generateConvFolderBreadcrumb(S);const T=document.querySelector("#sidebar-folder-breadcrumb");generateConvFolderBreadcrumb(T,!0),throttleGetConvSubFolders(L,C.shiftKey),fetchConversations(1,!1,C.shiftKey)}}}),k.appendChild(S);const M=document.createElement("button");M.id="conversation-manager-new-folder-button",M.classList=`${t?"hidden":"flex"} items-center justify-center h-full rounded-lg p-2 ms-2 text-token-text-tertiary focus-visible:outline-0 hover:bg-token-sidebar-surface-secondary focus-visible:bg-token-sidebar-surface-secondary`,M.innerHTML='<svg stroke="currentColor" fill="currentColor" class="icon icon-lg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M464 96h-192l-64-64h-160C21.5 32 0 53.5 0 80v352C0 458.5 21.5 480 48 480h416c26.5 0 48-21.5 48-48v-288C512 117.5 490.5 96 464 96zM336 311.1h-56v56C279.1 381.3 269.3 392 256 392c-13.27 0-23.1-10.74-23.1-23.1V311.1H175.1C162.7 311.1 152 301.3 152 288c0-13.26 10.74-23.1 23.1-23.1h56V207.1C232 194.7 242.7 184 256 184s23.1 10.74 23.1 23.1V264h56C349.3 264 360 274.7 360 288S349.3 311.1 336 311.1z"/></svg>',addTooltip(M,{value:"Add New Folder",position:"top"}),chrome.runtime.sendMessage({type:"checkHasSubscription"},C=>{M.addEventListener("click",()=>{const L=getLastSelectedConversationFolder();if(L&&isDefaultConvFolder(L.id)){toast("You cannot add a folder to this folder.","error");return}const _=document.querySelectorAll('#modal-manager #conversation-manager-sidebar-folders > div[id^="conversation-folder-wrapper-"]');if(!C&&_.length>=5){errorUpgradeConfirmation({type:"limit",title:"You have reached the limit",message:"You have reached the limits of Conversation Folders with free account. Upgrade to Pro to remove all limits."});return}document.querySelectorAll("#no-conversation-folders").forEach(z=>z.remove());const T={name:"New Folder",color:generateRandomDarkColor()};L&&(T.profile=L.profile?.id,T.color=L.color,T.parent_folder=L.id,T.image_url=L.image||L.image_url,T.gizmo_id=L.gizmo_id),chrome.runtime.sendMessage({type:"addConversationFolders",detail:{folders:[T]}},z=>{if(z.error&&z.error.type==="limit"){errorUpgradeConfirmation(z.error);return}if(!z||z.length===0)return;const B=document.querySelector("#conversation-manager-subfolder-list");B?.prepend(conversationFolderElement(z[0])),B?.scrollIntoView({block:"nearest",inline:"nearest"}),addNewConvFolderElementToSidebar(z[0]),document.querySelectorAll(`#folder-subfolder-count-${L?.id}`).forEach(F=>{const N=parseInt(F.innerText.split(" ")[0],10);F.innerText=`${N+1} folder${N+1===1?"":"s"} -`}),handleRenameConversationFolderClick(z[0].id,!1)})})}),k.appendChild(M);const $=document.createElement("div");$.id="conversation-manager-search-term-pill",$.classList="hidden flex items-center justify-center bg-token-main-surface-secondary text-token-text-primary rounded-full p-1 px-2 me-2 border border-token-border-medium",$.innerHTML='<button id="conversation-manager-search-term-pill-clear-button" class="focus-visible:outline-0 hover:bg-token-main-surface-tertiary focus-visible:bg-token-main-surface-tertiary rounded-full mx-1"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="20" width="20" xmlns="http://www.w3.org/2000/svg"> <line x1="18" y1="6" x2="6" y2="18"></line> <line x1="6" y1="6" x2="18" y2="18"></line> </svg></button><span id="conversation-manager-search-term-pill-text" class="text-sm mx-1 text-danger"></span>',$.querySelector("#conversation-manager-search-term-pill-clear-button").addEventListener("click",()=>{const C=document.querySelector("#conversation-manager-search-input");C.value="",C.dispatchEvent(new Event("input"))}),w.appendChild($);const q=document.createElement("div");q.id="conversation-manager-subfolder-list",q.classList="grid grid-cols-1 sm:grid-cols-2 gap-2 lg:grid-cols-3 xl:grid-cols-4 content-start w-full mb-2",w.appendChild(q);const E=document.createElement("div");return E.id="conversation-manager-conversation-list",w.appendChild(E),E.classList=`grid ${cachedSettings.selectedConversationView==="list"?"grid-cols-1 gap-2":"grid-cols-1 sm:grid-cols-2 gap-2 lg:grid-cols-3 xl:grid-cols-4"} content-start w-full`,o}function handleDeleteSelectedConversations(e){showConfirmDialog("Delete conversation",`Are you sure you want to delete the ${e.length} selected conversations?`,"Cancel","Delete",null,async()=>{resetConversationManagerSelection(),resetSidebarConversationSelection(),updateConversationFolderCount(null,e),e.forEach(r=>{removeConversationElements(r)}),chrome.runtime.sendMessage({type:"deleteConversations",detail:{conversationIds:e}});const t=document.querySelector("#confirm-action-dialog #confirm-button div");for(let r=0;r<e.length;r+=1){const n=e[r];try{await deleteConversation(n)}catch(i){console.error(i)}t&&e.length>1&&(t.innerHTML=`<div class="w-full h-full inset-0 flex items-center justify-center text-white"><svg x="0" y="0" viewbox="0 0 40 40" style="width:16px; height:16px;" class="spinner icon icon-xl me-2"><circle fill="transparent" stroke="#ffffff50" stroke-width="2" stroke-linecap="round" stroke-dasharray="125.6" cx="20" cy="20" r="18"></circle></svg><span class="visually-hidden">${r+1} / ${e.length}</span></div>`)}const o=document.querySelector("#confirm-action-dialog");o&&o.remove()},"red",!1)}function handleClickMoveConversationsButton(){const e=Array.from(document.querySelectorAll('#modal-manager input[id^="conversation-checkbox-"]:checked'));if(e.length===0)return;const t=e.map(o=>o.dataset.conversationId);openMoveConvToFolderModal(t)}function handleClickRemoveConversationsButton(){const e=Array.from(document.querySelectorAll('#modal-manager input[id^="conversation-checkbox-"]:checked')).map(t=>t.dataset.conversationId);e.length!==0&&(resetConversationManagerSelection(),updateConversationFolderCount(null,e),e.forEach(t=>{document.querySelectorAll(`#conversation-card-${t}`).forEach(o=>{o.remove()})}),chrome.runtime.sendMessage({type:"removeConversationsFromFolder",detail:{conversationIds:e}},()=>{toast("Conversations removed from folder")}))}async function handleClickArchiveConversationsButton(e){if(e.length!==0){resetConversationManagerSelection(),resetSidebarConversationSelection(),updateConversationFolderCount(null,e),e.forEach(t=>{removeConversationElements(t)}),chrome.runtime.sendMessage({type:"archiveConversations",detail:{conversationIds:e}});for(let t=0;t<e.length;t+=1){const o=e[t];try{await archiveConversation(o)}catch(r){console.error(r)}}}}async function handleClickUnarchiveConversationsButton(e){if(e.length!==0){resetConversationManagerSelection(),resetSidebarConversationSelection(),e.forEach(t=>{removeConversationElements(t)}),chrome.runtime.sendMessage({type:"unarchiveConversations",detail:{conversationIds:e}});for(let t=0;t<e.length;t+=1){const o=e[t];try{await unarchiveConversation(o)}catch(r){console.error(r)}}}}async function handleClickExportConversationsButton(){const e=Array.from(document.querySelectorAll('#modal-manager input[id^="conversation-checkbox-"]:checked')).map(t=>t.dataset.conversationId);e.length!==0&&openExportModal(e,"selected")}function resetConversationManagerParams(){lastSelectedConversationCardId="",lastSelectedConversationCheckboxId=""}function resetConversationManagerSelection(){if(!document.querySelector("#modal-manager #modal-content-conversation-manager"))return;const e=getLastSelectedConversationFolder();if(lastSelectedConversationCheckboxId="",e?.id!=="all"){const u=document.querySelector('#modal-manager input[id="conversation-manager-search-input"]');u&&(u.value="");const m=document.querySelector("#conversation-manager-search-term-pill-text");m.innerText="";const g=document.querySelector("#conversation-manager-search-term-pill");g&&g.classList.add("hidden")}clearSidebarSearchInput();const t=document.querySelector("#modal-manager #conversation-manager-filters-right-section");t&&(e?.id==="all"||e?.id==="archived"?t.classList.add("hidden"):t.classList.remove("hidden"));const o=document.querySelector("#modal-manager #conversation-card-menu");o&&o.remove();const r=document.querySelector('#modal-manager div[id="conversation-manager-selection-bar"]');r&&r.classList.add("hidden");const n=document.querySelector('#modal-manager div[id="conversation-manager-content-wrapper"]');n&&(n.style.paddingBottom="59px");const i=document.querySelector('#modal-manager button[id="conversation-manager-move-button"]');i&&(isDefaultConvFolder(e?.id)?i.classList.add("hidden"):i.classList.remove("hidden"));const a=document.querySelector('#modal-manager button[id="conversation-manager-remove-button"]');a&&(isDefaultConvFolder(e?.id)?a.classList.add("hidden"):a.classList.remove("hidden"));const s=document.querySelector('#modal-manager button[id="conversation-manager-add-to-folder-button"]');s&&(["all"].includes(e?.id)?s.classList.remove("hidden"):s.classList.add("hidden"));const l=document.querySelector('#modal-manager button[id="conversation-manager-archive-button"]');l&&(["archived"].includes(e?.id)?l.classList.add("hidden"):l.classList.remove("hidden"));const d=document.querySelector('#modal-manager button[id="conversation-manager-unarchive-button"]');d&&(e?.id==="archived"?d.classList.remove("hidden"):d.classList.add("hidden")),document.querySelectorAll('#modal-manager input[id^="conversation-checkbox-"]').forEach(u=>{u.checked=!1});const c=document.querySelector('#modal-manager span[id="conversation-manager-selection-count"]');c&&(c.innerText="0 selected")}function syncHistoryResponseToConversationDB(e,t=!1,o=!1){const r=e.items.slice(0,t||cachedSettings?.syncHistoryResponses?e.items.length:5);return o&&chrome.runtime.sendMessage({type:"addConversations",detail:{conversations:r}},()=>{chrome.runtime.sendMessage({type:"initializeConversationSync",forceRefresh:!0})}),r}async function fetchConversations(e=1,t=!1,o=!1){const r=getLastSelectedConversationFolder();if(!r)return;const n=document.querySelector("#modal-manager #conversation-manager-conversation-list");if(!n)return;e===1&&(n.innerHTML="",n.appendChild(loadingSpinner("conversation-manager-main-content")));let i=[],a=!1,s=[],l=[];const d=document.querySelector("#modal-manager input[id=conversation-manager-search-input]")?.value;if(d===""&&r?.id==="archived"){e===1&&(s=await chrome.runtime.sendMessage({type:"getAllFavoriteConversationIds"}),l=await chrome.runtime.sendMessage({type:"getAllNoteConversationIds"}));const u=100,m=(e-1)*u,g=u,p=r?.id==="archived";try{const h=await getConversations(m,g,"updated",p,o);i=syncHistoryResponseToConversationDB(h,p),a=h.total>m+g}catch{const h=document.querySelector("#modal-manager #load-more-conversations-button");if(h){h.innerHTML='<div class="w-full h-full flex items-center justify-center">Load more...</div>',h.onclick=()=>fetchConversations(e+1,t,o);return}}}else{document.querySelectorAll("#modal-manager #load-more-conversations-button")?.forEach(h=>h.remove());const{selectedConversationsManagerSortBy:u,excludeConvInFolders:m}=cachedSettings,g=u?.code,p=await chrome.runtime.sendMessage({type:"getConversations",forceRefresh:o,detail:{pageNumber:e,searchTerm:d,sortBy:["all","archived"].includes(r?.id)?"updated_at":g,fullSearch:t,folderId:d||typeof r?.id=="string"?null:r?.id,isArchived:r?.id==="archived"?!0:null,isFavorite:r?.id==="favorites"?!0:null,excludeConvInFolders:r?.id==="all"&&m}});i=p.results,a=p.next}const c=document.querySelector("#modal-manager #loading-spinner-conversation-manager-main-content");if(c&&c.remove(),i?.length===0&&e===1)if(d&&!t){const u=createFullSearchButton();n.appendChild(u),u.click()}else n.appendChild(noConversationElement());else if(i?.forEach(u=>{const m=s.includes(u.conversation_id)||u.is_favorite,g=l.includes(u.conversation_id)||u.has_note,p={...u,is_favorite:m,has_note:g},h=createConversationCard(p);n.appendChild(h),addConversationCardEventListeners(h,p)}),a){const u=document.createElement("button");u.id="load-more-conversations-button",u.classList=`bg-token-main-surface-secondary p-4 pb-2 rounded-md cursor-pointer hover:bg-token-main-surface-tertiary ${cachedSettings.selectedConversationView==="list"?"h-14":"h-auto aspect-1.5"} flex flex-col relative`,u.appendChild(loadingSpinner("load-more-conversations-button")),n.appendChild(u),u.onclick=()=>fetchConversations(e+1,t,o);const m=new IntersectionObserver(g=>{g.forEach(p=>{p.isIntersecting&&fetchConversations(e+1,t,o)})},{threshold:.5});u&&m.observe(u)}else if(d&&!t){const u=createFullSearchButton();n.appendChild(u)}}function createFullSearchButton(e=!1){const t=document.createElement("button");return t.id="full-search-button",t.classList=`flex items-center justify-center text-2xl bg-token-main-surface-secondary p-4 rounded-md cursor-pointer hover:bg-token-main-surface-tertiary ${e?"mt-2":""} ${e||cachedSettings.selectedConversationView==="list"?"w-full h-14":"h-auto aspect-1.5"} relative`,t.innerHTML=`<div class="flex items-center justify-center">
      <div class="w-full text-sm">Click to load more</div>
      </div>`,t.addEventListener("click",o=>{e?throttleFetchSidebarConversations(1,!0,o.shiftKey):fetchConversations(1,!0,o.shiftKey)}),t}function isProjectConversation(e){return e.gizmo_id?.startsWith("g-p-")&&e.gizmo_id!=="g-p-688945422f8c8191a1825cd5ccf29079"}function isStudyMode(e){return e.gizmo_id==="g-p-688945422f8c8191a1825cd5ccf29079"||e.is_study_mode===!0}function isDeepResearch(e){return e.default_model_slug==="research"}function letterIndicator(e,t="#3c80f5",o="#000"){return`<span class="inline-flex items-center justify-center w-4 h-4 text-xs font-semibold rounded-sm" style="background-color: ${t}; color: ${o};">${e}</span>`}function conversationIndicators(e){if(!e)return"";const t=e.has_attachments||conversationHasAttachments(e);return setTimeout(async()=>{if(!e?.gizmo_id)return;const o=await getGizmoById(e?.gizmo_id),r=o?.resource?.gizmo?.display?.name||"",n=o?.resource?.gizmo?.display?.profile_picture_url,i=document.querySelectorAll(`#conversation-gizmo-indicator-${e.conversation_id}`);if(i.length!==0)for(let a=0;a<i.length;a+=1){const s=i[a];n?(s.innerHTML=`<img src="${n}" alt="${r}" class="w-4 h-4 rounded-sm" />`,s.title=r):(s.innerHTML="",s.title="")}},100),`
    <div class="flex me-1 ${t?"":"hidden"}" title="This conversations has attachments" id="conversation-attachments-indicator-${e.conversation_id}">
      <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="icon"><path d="M4.33496 12.5V7.5C4.33496 7.13273 4.63273 6.83496 5 6.83496C5.36727 6.83496 5.66504 7.13273 5.66504 7.5V12.5C5.66504 14.8942 7.60585 16.835 10 16.835C12.3942 16.835 14.335 14.8942 14.335 12.5V5.83301C14.3348 4.35959 13.1404 3.16522 11.667 3.16504C10.1934 3.16504 8.99822 4.35948 8.99805 5.83301V12.5C8.99805 13.0532 9.44679 13.502 10 13.502C10.5532 13.502 11.002 13.0532 11.002 12.5V7.5C11.002 7.13273 11.2997 6.83496 11.667 6.83496C12.0341 6.83514 12.332 7.13284 12.332 7.5V12.5C12.332 13.7877 11.2877 14.832 10 14.832C8.71226 14.832 7.66797 13.7877 7.66797 12.5V5.83301C7.66814 3.62494 9.45888 1.83496 11.667 1.83496C13.875 1.83514 15.6649 3.62505 15.665 5.83301V12.5C15.665 15.6287 13.1287 18.165 10 18.165C6.87131 18.165 4.33496 15.6287 4.33496 12.5Z"></path></svg>
    </div>

    <div class="flex me-1 ${e?.gizmo_id?"":"hidden"}" title="" id="conversation-gizmo-indicator-${e.conversation_id}">
      <!-- gizmo picture will be loaded here -->
    </div>

    <div class="flex me-1 ${isProjectConversation(e)?"":"hidden"}" title="This conversations belongs to a project" id="conversation-project-indicator-${e.conversation_id}">
      ${letterIndicator("P","royalblue","#fff")}
    </div>

    <div class="flex me-1 ${isStudyMode(e)?"":"hidden"}" title="Study Mode" id="conversation-study-indicator-${e.conversation_id}">
      ${letterIndicator("S","skyblue","#000")}
    </div>

    <div class="flex me-1 ${isDeepResearch(e)?"":"hidden"}" title="Deep Research" id="conversation-research-indicator-${e.conversation_id}">
      ${letterIndicator("D","hotpink","#000")}
    </div>

    <span class="flex me-1" title="This conversation has notes">
      <svg id="conversation-note-indicator-${e.conversation_id}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="#19c37d" class="ms-1 icon icon-sm ${e.has_note?"":"hidden"}"><path d="M320 480l128-128h-128V480zM400 31.1h-352c-26.51 0-48 21.49-48 48v352C0 458.5 21.49 480 48 480H288l.0039-128c0-17.67 14.33-32 32-32H448v-240C448 53.49 426.5 31.1 400 31.1z"/></svg>
    </span>
  `}function conversationListView(e){return e?`<div class="flex items-center">
      <input id="conversation-checkbox-${e.conversation_id}" data-conversation-id="${e.conversation_id}" type="checkbox" class="manager-modal border border-token-border-medium me-2" style="cursor: pointer; border-radius: 2px;">
      
    </div>
    
  <div class="flex flex-1 items-center pe-2">
    <div id="conversation-title" class="flex items-center text-sm truncate">
      ${escapeHTML(e.title||"New chat")}
    </div>
      
    <div class="flex items-center justify-between">
      <div class="truncate text-xs text-token-text-tertiary flex items-center w-full">
        <div id="conversation-card-folder-tag-${e.conversation_id}" class="flex items-center py-1 px-2 ms-2 rounded-md text-white ${e?.folder?.name?"":"hidden"}" style="background-color: ${e?.folder?.name?`${e?.folder?.color}`:"transparent"};">
          <div class="flex items-center rounded-md px-1 text-xs font-normal overflow-hidden">
            <svg stroke="currentColor" fill="currentColor" class="icon icon-xs me-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M147.8 192H480V144C480 117.5 458.5 96 432 96h-160l-64-64h-160C21.49 32 0 53.49 0 80v328.4l90.54-181.1C101.4 205.6 123.4 192 147.8 192zM543.1 224H147.8C135.7 224 124.6 230.8 119.2 241.7L0 480h447.1c12.12 0 23.2-6.852 28.62-17.69l96-192C583.2 249 567.7 224 543.1 224z"/></svg>
            <span id="conversation-card-folder-name-${e.conversation_id}">
              ${e?.folder?.name}
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>


  <div class="flex justify-between items-center pt-1">
    <span class="text-xs text-token-text-tertiary me-2">${formatDate(new Date(formatTime(e.update_time,10)))}</span>
    
    ${e.is_archived?'<span title="Archived"><svg viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md me-2 text-token-text-tertiary"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.62188 3.07918C3.87597 2.571 4.39537 2.25 4.96353 2.25H13.0365C13.6046 2.25 14.124 2.571 14.3781 3.07918L15.75 5.82295V13.5C15.75 14.7426 14.7426 15.75 13.5 15.75H4.5C3.25736 15.75 2.25 14.7426 2.25 13.5V5.82295L3.62188 3.07918ZM13.0365 3.75H4.96353L4.21353 5.25H13.7865L13.0365 3.75ZM14.25 6.75H3.75V13.5C3.75 13.9142 4.08579 14.25 4.5 14.25H13.5C13.9142 14.25 14.25 13.9142 14.25 13.5V6.75ZM6.75 9C6.75 8.58579 7.08579 8.25 7.5 8.25H10.5C10.9142 8.25 11.25 8.58579 11.25 9C11.25 9.41421 10.9142 9.75 10.5 9.75H7.5C7.08579 9.75 6.75 9.41421 6.75 9Z" fill="currentColor"></path></svg></span>':""}

    ${conversationIndicators(e)}

    <div id="conversation-card-favorite" title="favorite conversation" class="me-1">
      ${e.is_favorite?'<svg class="icon icon-md" fill="gold" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M381.2 150.3L524.9 171.5C536.8 173.2 546.8 181.6 550.6 193.1C554.4 204.7 551.3 217.3 542.7 225.9L438.5 328.1L463.1 474.7C465.1 486.7 460.2 498.9 450.2 506C440.3 513.1 427.2 514 416.5 508.3L288.1 439.8L159.8 508.3C149 514 135.9 513.1 126 506C116.1 498.9 111.1 486.7 113.2 474.7L137.8 328.1L33.58 225.9C24.97 217.3 21.91 204.7 25.69 193.1C29.46 181.6 39.43 173.2 51.42 171.5L195 150.3L259.4 17.97C264.7 6.954 275.9-.0391 288.1-.0391C300.4-.0391 311.6 6.954 316.9 17.97L381.2 150.3z"/></svg>':'<svg class="icon icon-md" fill="#b4b4b4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M287.9 0C297.1 0 305.5 5.25 309.5 13.52L378.1 154.8L531.4 177.5C540.4 178.8 547.8 185.1 550.7 193.7C553.5 202.4 551.2 211.9 544.8 218.2L433.6 328.4L459.9 483.9C461.4 492.9 457.7 502.1 450.2 507.4C442.8 512.7 432.1 513.4 424.9 509.1L287.9 435.9L150.1 509.1C142.9 513.4 133.1 512.7 125.6 507.4C118.2 502.1 114.5 492.9 115.1 483.9L142.2 328.4L31.11 218.2C24.65 211.9 22.36 202.4 25.2 193.7C28.03 185.1 35.5 178.8 44.49 177.5L197.7 154.8L266.3 13.52C270.4 5.249 278.7 0 287.9 0L287.9 0zM287.9 78.95L235.4 187.2C231.9 194.3 225.1 199.3 217.3 200.5L98.98 217.9L184.9 303C190.4 308.5 192.9 316.4 191.6 324.1L171.4 443.7L276.6 387.5C283.7 383.7 292.2 383.7 299.2 387.5L404.4 443.7L384.2 324.1C382.9 316.4 385.5 308.5 391 303L476.9 217.9L358.6 200.5C350.7 199.3 343.9 194.3 340.5 187.2L287.9 78.95z"/></svg>'}
    </div>

    <div id="conversation-card-action-right-${e.conversation_id}" class="flex items-center">
      <div id="conversation-card-settings-button-${e.conversation_id}" class="relative flex items-center justify-center h-8 rounded-lg px-2 text-token-text-tertiary focus-visible:outline-0 hover:bg-token-sidebar-surface-tertiary focus-visible:bg-token-sidebar-surface-secondary"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 12C3 10.8954 3.89543 10 5 10C6.10457 10 7 10.8954 7 12C7 13.1046 6.10457 14 5 14C3.89543 14 3 13.1046 3 12ZM10 12C10 10.8954 10.8954 10 12 10C13.1046 10 14 10.8954 14 12C14 13.1046 13.1046 14 12 14C10.8954 14 10 13.1046 10 12ZM17 12C17 10.8954 17.8954 10 19 10C20.1046 10 21 10.8954 21 12C21 13.1046 20.1046 14 19 14C17.8954 14 17 13.1046 17 12Z" fill="currentColor"></path></svg>
      </div>
    </div>
  </div>`:""}function conversationGridView(e){if(!e)return"";const t=getLastSelectedConversationFolder();return`<div class="flex items-center justify-between border-b border-token-border-medium pb-1"><div class="truncate text-xs text-token-text-tertiary flex items-center w-full"><div id="conversation-card-folder-wrapper-${e.conversation_id}" class="flex items-center ${e?.folder?.name&&typeof t?.id!="number"?"":"hidden"}"><div class="flex items-center border border-token-border-medium rounded-md px-1 text-xs font-normal overflow-hidden hover:w-fit-sp w-auto min-w-5 max-w-5"><svg stroke="currentColor" fill="currentColor" class="icon icon-xs me-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M147.8 192H480V144C480 117.5 458.5 96 432 96h-160l-64-64h-160C21.49 32 0 53.49 0 80v328.4l90.54-181.1C101.4 205.6 123.4 192 147.8 192zM543.1 224H147.8C135.7 224 124.6 230.8 119.2 241.7L0 480h447.1c12.12 0 23.2-6.852 28.62-17.69l96-192C583.2 249 567.7 224 543.1 224z"/></svg><span id="conversation-card-folder-name-${e.conversation_id}">${e?.folder?.name}</span></div> <svg aria-hidden="true" fill="none" focusable="false" height="1em" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" style="min-width:16px" viewBox="0 0 24 24" width="1em"><path d="m9 18 6-6-6-6"></path></svg></div>${formatDate(new Date(formatTime(e.update_time,10)))}</div>
  <div id="conversation-card-favorite" title="favorite conversation" class="ps-1">
    ${e.is_favorite?'<svg class="icon icon-md" fill="gold" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M381.2 150.3L524.9 171.5C536.8 173.2 546.8 181.6 550.6 193.1C554.4 204.7 551.3 217.3 542.7 225.9L438.5 328.1L463.1 474.7C465.1 486.7 460.2 498.9 450.2 506C440.3 513.1 427.2 514 416.5 508.3L288.1 439.8L159.8 508.3C149 514 135.9 513.1 126 506C116.1 498.9 111.1 486.7 113.2 474.7L137.8 328.1L33.58 225.9C24.97 217.3 21.91 204.7 25.69 193.1C29.46 181.6 39.43 173.2 51.42 171.5L195 150.3L259.4 17.97C264.7 6.954 275.9-.0391 288.1-.0391C300.4-.0391 311.6 6.954 316.9 17.97L381.2 150.3z"/></svg>':'<svg class="icon icon-md" fill="#b4b4b4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M287.9 0C297.1 0 305.5 5.25 309.5 13.52L378.1 154.8L531.4 177.5C540.4 178.8 547.8 185.1 550.7 193.7C553.5 202.4 551.2 211.9 544.8 218.2L433.6 328.4L459.9 483.9C461.4 492.9 457.7 502.1 450.2 507.4C442.8 512.7 432.1 513.4 424.9 509.1L287.9 435.9L150.1 509.1C142.9 513.4 133.1 512.7 125.6 507.4C118.2 502.1 114.5 492.9 115.1 483.9L142.2 328.4L31.11 218.2C24.65 211.9 22.36 202.4 25.2 193.7C28.03 185.1 35.5 178.8 44.49 177.5L197.7 154.8L266.3 13.52C270.4 5.249 278.7 0 287.9 0L287.9 0zM287.9 78.95L235.4 187.2C231.9 194.3 225.1 199.3 217.3 200.5L98.98 217.9L184.9 303C190.4 308.5 192.9 316.4 191.6 324.1L171.4 443.7L276.6 387.5C283.7 383.7 292.2 383.7 299.2 387.5L404.4 443.7L384.2 324.1C382.9 316.4 385.5 308.5 391 303L476.9 217.9L358.6 200.5C350.7 199.3 343.9 194.3 340.5 187.2L287.9 78.95z"/></svg>'}
  </div>
  </div>
  <div id="conversation-title" class="flex-1 text-sm truncate">${escapeHTML(e.title||"New chat")}</div>
  <div class="border-t border-token-border-medium flex justify-between items-center pt-1">
    <div class="flex items-center">
      <input id="conversation-checkbox-${e.conversation_id}" data-conversation-id="${e.conversation_id}" type="checkbox" id="checkbox" class="manager-modal border border-token-border-medium me-2" style="cursor: pointer; border-radius: 2px;">
      ${conversationIndicators(e)}
    </div>
    <div id="conversation-card-action-right-${e.conversation_id}" class="flex items-center">
      ${e.is_archived?'<span title="Archived"><svg viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md me-2 text-token-text-tertiary"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.62188 3.07918C3.87597 2.571 4.39537 2.25 4.96353 2.25H13.0365C13.6046 2.25 14.124 2.571 14.3781 3.07918L15.75 5.82295V13.5C15.75 14.7426 14.7426 15.75 13.5 15.75H4.5C3.25736 15.75 2.25 14.7426 2.25 13.5V5.82295L3.62188 3.07918ZM13.0365 3.75H4.96353L4.21353 5.25H13.7865L13.0365 3.75ZM14.25 6.75H3.75V13.5C3.75 13.9142 4.08579 14.25 4.5 14.25H13.5C13.9142 14.25 14.25 13.9142 14.25 13.5V6.75ZM6.75 9C6.75 8.58579 7.08579 8.25 7.5 8.25H10.5C10.9142 8.25 11.25 8.58579 11.25 9C11.25 9.41421 10.9142 9.75 10.5 9.75H7.5C7.08579 9.75 6.75 9.41421 6.75 9Z" fill="currentColor"></path></svg></span>':""}
      <div id="conversation-card-settings-button-${e.conversation_id}" class="relative flex items-center justify-center h-8 rounded-lg px-2 text-token-text-tertiary focus-visible:outline-0 hover:bg-token-sidebar-surface-tertiary focus-visible:bg-token-sidebar-surface-secondary"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 12C3 10.8954 3.89543 10 5 10C6.10457 10 7 10.8954 7 12C7 13.1046 6.10457 14 5 14C3.89543 14 3 13.1046 3 12ZM10 12C10 10.8954 10.8954 10 12 10C13.1046 10 14 10.8954 14 12C14 13.1046 13.1046 14 12 14C10.8954 14 10 13.1046 10 12ZM17 12C17 10.8954 17.8954 10 19 10C20.1046 10 21 10.8954 21 12C21 13.1046 20.1046 14 19 14C17.8954 14 17 13.1046 17 12Z" fill="currentColor"></path></svg>
      </div>
    </div>
    <div id="conversation-card-folder-color-indicator-${e.conversation_id}" title="${e?.folder?.name||""}" data-folder-id="${e?.folder?.id}" class="absolute w-full h-2 bottom-0 start-0 rounded-b-md" style="background-color: ${e?.folder?.name?`${e?.folder?.color}`:"transparent"};">
    </div>
  </div>`}function createConversationCard(e){const t=document.createElement("div");return t.id=`conversation-card-${e.conversation_id}`,t.draggable=!0,t.dataset.conversationId=e.conversation_id,t.classList=`relative flex bg-token-main-surface-primary border border-token-border-medium rounded-md cursor-pointer hover:bg-token-main-surface-tertiary ${cachedSettings.selectedConversationView==="list"?"w-full p-2 flex-row h-10":"aspect-1.5 p-4 pb-2 flex-col h-auto"}`,e.folder&&(t.dataset.folderId=e.folder.id),t.style="height: max-content;outline-offset: 4px; outline: none;",t.innerHTML=cachedSettings.selectedConversationView==="list"?conversationListView(e):conversationGridView(e),t.addEventListener("click",o=>{o.stopPropagation(),closeMenus(),o.metaKey||isWindows()&&o.ctrlKey?window.open(`/c/${e.conversation_id}`,"_blank"):(updateSelectedConvCard(e.conversation_id),showConversationPreviewWrapper(e.conversation_id))}),t.addEventListener("mouseenter",()=>{closeMenus()}),t.addEventListener("dragstart",o=>{o.stopPropagation(),o.dataTransfer.setData("text/plain",JSON.stringify({draggingObject:"conversation",conversation:e})),o.dataTransfer.effectAllowed="move",t.classList.add("card-dragging")}),t.addEventListener("dragend",o=>{o.stopPropagation(),o.dataTransfer.clearData();try{t.classList.remove("card-dragging")}catch(r){console.error("Error removing card-dragging class:",r)}}),t}function updateSelectedConvCard(e,t=!1){if(document.querySelectorAll('div[id^="conversation-card-"][data-conversation-id]').forEach(r=>{r.style.outline="none",r.classList.remove("bg-token-sidebar-surface-tertiary")}),!e)return;const o=document.querySelectorAll(`#conversation-card-${e}`);lastSelectedConversationCardId=e,o.forEach(r=>{t||(r.style.outline=`2px solid ${isDarkMode()?"#fff":"#000"}`),r.classList.add("bg-token-sidebar-surface-tertiary")})}function addOrReplaceConversationCard(e,t=null){const o=getLastSelectedConversationFolder();if(o&&o?.id?.toString()===e.folder?.id?.toString()){const r=document.querySelector(`#modal-manager [data-conversation-id="${e.conversation_id}"]`);if(r){const n=createConversationCard(e);r.replaceWith(n),addConversationCardEventListeners(n,e)}else{const n=document.querySelector("#modal-manager #conversation-manager-conversation-list"),i=document.querySelector("#modal-manager #no-conversations-found");i&&i.remove();const a=createConversationCard(e);t?t.after(a):n.prepend(a),addConversationCardEventListeners(a,e)}}}function addConversationCardEventListeners(e,t,o=!1){e.addEventListener("contextmenu",i=>{i.preventDefault(),i.stopPropagation(),e.querySelector(`#conversation-card-settings-button-${t.conversation_id}`)?.click()}),e.querySelector(`#modal-manager #conversation-checkbox-${t.conversation_id}`)?.addEventListener("click",i=>{i.stopPropagation(),closeMenus();const a=Array.from(document.querySelectorAll('#modal-manager input[id^="conversation-checkbox-"]:checked'));if(a.length>0){if(i.shiftKey&&a.filter(c=>c.id!==`conversation-checkbox-${t.id}`).length>0){const c=t.conversation_id,u=document.querySelectorAll('#modal-manager div[id^="conversation-card-"]');let m=!1,g=!1;u.forEach(p=>{const h=p.id.split("conversation-card-")[1];if((h===lastSelectedConversationCheckboxId||h===c)&&(m?g=!0:m=!0),m&&!g){const f=document.querySelector(`#modal-manager #conversation-checkbox-${h}`);f&&(f.checked=!0)}})}lastSelectedConversationCheckboxId=t.conversation_id;const s=document.querySelector('#modal-manager span[id="conversation-manager-selection-count"]'),l=Array.from(document.querySelectorAll('#modal-manager input[id^="conversation-checkbox-"]:checked'));s.innerText=`${l.length} selected`,document.querySelector('#modal-manager div[id="conversation-manager-selection-bar"]').classList.remove("hidden");const d=document.querySelector('#modal-manager div[id="conversation-manager-content-wrapper"]');d&&(d.style.paddingBottom="calc(59px + 56px)")}else resetConversationManagerSelection()});const r=e.querySelector("#modal-manager #conversation-card-favorite");r?.addEventListener("click",async i=>{i.stopPropagation();const a=getLastSelectedConversationFolder();a?.id==="favorites"&&document.querySelectorAll(`#conversation-card-${t.conversation_id}`).forEach(d=>{d.remove()});const s=await getConversationsByIds([t.conversation_id]),l=await chrome.runtime.sendMessage({type:"toggleConversationFavorite",forceRefresh:!0,detail:{conversation:s[0]}});a?.id!=="favorites"&&(l.is_favorite?r.innerHTML='<svg class="icon icon-md" fill="gold" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M381.2 150.3L524.9 171.5C536.8 173.2 546.8 181.6 550.6 193.1C554.4 204.7 551.3 217.3 542.7 225.9L438.5 328.1L463.1 474.7C465.1 486.7 460.2 498.9 450.2 506C440.3 513.1 427.2 514 416.5 508.3L288.1 439.8L159.8 508.3C149 514 135.9 513.1 126 506C116.1 498.9 111.1 486.7 113.2 474.7L137.8 328.1L33.58 225.9C24.97 217.3 21.91 204.7 25.69 193.1C29.46 181.6 39.43 173.2 51.42 171.5L195 150.3L259.4 17.97C264.7 6.954 275.9-.0391 288.1-.0391C300.4-.0391 311.6 6.954 316.9 17.97L381.2 150.3z"/></svg>':r.innerHTML='<svg class="icon icon-md" fill="#b4b4b4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M287.9 0C297.1 0 305.5 5.25 309.5 13.52L378.1 154.8L531.4 177.5C540.4 178.8 547.8 185.1 550.7 193.7C553.5 202.4 551.2 211.9 544.8 218.2L433.6 328.4L459.9 483.9C461.4 492.9 457.7 502.1 450.2 507.4C442.8 512.7 432.1 513.4 424.9 509.1L287.9 435.9L150.1 509.1C142.9 513.4 133.1 512.7 125.6 507.4C118.2 502.1 114.5 492.9 115.1 483.9L142.2 328.4L31.11 218.2C24.65 211.9 22.36 202.4 25.2 193.7C28.03 185.1 35.5 178.8 44.49 177.5L197.7 154.8L266.3 13.52C270.4 5.249 278.7 0 287.9 0L287.9 0zM287.9 78.95L235.4 187.2C231.9 194.3 225.1 199.3 217.3 200.5L98.98 217.9L184.9 303C190.4 308.5 192.9 316.4 191.6 324.1L171.4 443.7L276.6 387.5C283.7 383.7 292.2 383.7 299.2 387.5L404.4 443.7L384.2 324.1C382.9 316.4 385.5 308.5 391 303L476.9 217.9L358.6 200.5C350.7 199.3 343.9 194.3 340.5 187.2L287.9 78.95z"/></svg>',toggleFovoriteIndicator(t.conversation_id,l.is_favorite))}),e.querySelector(`#conversation-project-indicator-${t.conversation_id}`)?.addEventListener("click",async i=>{if(i.stopPropagation(),closeMenus(),i.metaKey||isWindows()&&i.ctrlKey){window.open(`/g/${t.gizmo_id}/project`,"_blank");return}closeModals(),window.history.pushState({},"",`/g/${t.gizmo_id}/project`),window.dispatchEvent(new PopStateEvent("popstate",{state:{}}))});const n=e.querySelector(`#conversation-card-settings-button-${t.conversation_id}`);n?.addEventListener("click",async i=>{i.stopPropagation(),closeMenus(),n.classList.replace("hidden","flex"),showConversationManagerCardMenu(n,t,o,!0)})}function noConversationElement(){const e=document.createElement("p");return e.classList="absolute text-center text-sm text-token-text-tertiary w-full p-4",e.id="no-conversations-found",e.innerText=translate("No conversations found"),e}function noConversationFolderElemet(){const e=document.createElement("p");return e.id="no-conversation-folders",e.classList="text-token-text-tertiary text-center text-sm py-4",e.innerText=translate("new_folder_hint"),e}async function showConversationManagerFolderMenu(e,t,o=!1,r=!1){const{showFoldersInLeftSidebar:n}=cachedSettings,i=await chrome.runtime.sendMessage({type:"checkHasSubscription"}),a=t.id,s=document.querySelector(`#conversation-folder-wrapper-${a}`),l=t.image||t.image_url,{right:d,top:c}=e.getBoundingClientRect(),u=!n&&o||r?d-224:d-6,m=c+12,g=`<div id="conversation-manager-folder-menu" dir="ltr" style="position:fixed;left:0;top:0;transform:translate3d(${u}px,${m}px,0);min-width:max-content;z-index:10001;--radix-popper-anchor-width:18px;--radix-popper-anchor-height:18px;--radix-popper-available-width:1167px;--radix-popper-available-height:604px;--radix-popper-transform-origin:0% 0px"><div data-side="bottom" data-align="start" role="menu" aria-orientation="vertical" data-state="open" data-radix-menu-content="" dir="ltr" aria-labelledby="radix-:r6g:" class="text-token-text-primary mt-2 min-w-[200px] max-w-xs rounded-2xl bg-token-main-surface-secondary shadow-long p-1" tabindex="-1" data-orientation="vertical" style="outline:0;--radix-dropdown-menu-content-transform-origin:var(--radix-popper-transform-origin);--radix-dropdown-menu-content-available-width:var(--radix-popper-available-width);--radix-dropdown-menu-content-available-height:var(--radix-popper-available-height);--radix-dropdown-menu-trigger-width:var(--radix-popper-anchor-width);--radix-dropdown-menu-trigger-height:var(--radix-popper-anchor-height);pointer-events:auto">

  ${["all"].includes(a)?`<div role="menuitem" id="view-mode-conversation-folder-button-${a}" class="flex gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" fill="currentColor" class="icon icon-md"><path d="M0 73.7C0 50.67 18.67 32 41.7 32H470.3C493.3 32 512 50.67 512 73.7C512 83.3 508.7 92.6 502.6 100L336 304.5V447.7C336 465.5 321.5 480 303.7 480C296.4 480 289.3 477.5 283.6 472.1L191.1 399.6C181.6 392 176 380.5 176 368.3V304.5L9.373 100C3.311 92.6 0 83.3 0 73.7V73.7zM54.96 80L218.6 280.8C222.1 285.1 224 290.5 224 296V364.4L288 415.2V296C288 290.5 289.9 285.1 293.4 280.8L457 80H54.96z"/></svg>${translate("View mode")} <svg aria-hidden="true" fill="none" focusable="false" height="1em" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" style="margin-left:auto; min-width:16px" viewBox="0 0 24 24" width="1em"><path d="m9 18 6-6-6-6"></path></svg></div>`:""}
    
  ${["all","favorites"].includes(a)?`<div role="menuitem" id="export-folder-conversations-button-${a}" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><div class="flex gap-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" stroke="currentColor" fill="currentColor" stroke-width="2" stroke-linejoin="round" class="icon icon-md"><path d="M568.1 303l-80-80c-9.375-9.375-24.56-9.375-33.94 0s-9.375 24.56 0 33.94L494.1 296H216C202.8 296 192 306.8 192 320s10.75 24 24 24h278.1l-39.03 39.03C450.3 387.7 448 393.8 448 400s2.344 12.28 7.031 16.97c9.375 9.375 24.56 9.375 33.94 0l80-80C578.3 327.6 578.3 312.4 568.1 303zM360 384c-13.25 0-24 10.74-24 24V448c0 8.836-7.164 16-16 16H64.02c-8.836 0-16-7.164-16-16L48 64.13c0-8.836 7.164-16 16-16h160L224 128c0 17.67 14.33 32 32 32h79.1v72c0 13.25 10.74 24 23.1 24S384 245.3 384 232V138.6c0-16.98-6.742-33.26-18.75-45.26l-74.63-74.64C278.6 6.742 262.3 0 245.4 0H63.1C28.65 0-.002 28.66 0 64l.0065 384c.002 35.34 28.65 64 64 64H320c35.2 0 64-28.8 64-64v-40C384 394.7 373.3 384 360 384z"></path></svg>${translate("Export")} ${i?"":'<span class="text-white rounded-md bg-green-500 px-2 text-sm">Pro</span>'}</div></div>
      
      <div role="menuitem" id="clear-all-conversation-folder-button-${a}" class="flex gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group text-red-500" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5555 4C10.099 4 9.70052 4.30906 9.58693 4.75114L9.29382 5.8919H14.715L14.4219 4.75114C14.3083 4.30906 13.9098 4 13.4533 4H10.5555ZM16.7799 5.8919L16.3589 4.25342C16.0182 2.92719 14.8226 2 13.4533 2H10.5555C9.18616 2 7.99062 2.92719 7.64985 4.25342L7.22886 5.8919H4C3.44772 5.8919 3 6.33961 3 6.8919C3 7.44418 3.44772 7.8919 4 7.8919H4.10069L5.31544 19.3172C5.47763 20.8427 6.76455 22 8.29863 22H15.7014C17.2354 22 18.5224 20.8427 18.6846 19.3172L19.8993 7.8919H20C20.5523 7.8919 21 7.44418 21 6.8919C21 6.33961 20.5523 5.8919 20 5.8919H16.7799ZM17.888 7.8919H6.11196L7.30423 19.1057C7.3583 19.6142 7.78727 20 8.29863 20H15.7014C16.2127 20 16.6417 19.6142 16.6958 19.1057L17.888 7.8919ZM10 10C10.5523 10 11 10.4477 11 11V16C11 16.5523 10.5523 17 10 17C9.44772 17 9 16.5523 9 16V11C9 10.4477 9.44772 10 10 10ZM14 10C14.5523 10 15 10.4477 15 11V16C15 16.5523 14.5523 17 14 17C13.4477 17 13 16.5523 13 16V11C13 10.4477 13.4477 10 14 10Z" fill="currentColor"></path></svg>${translate("Clear all")}</div>`:`<div role="menuitem" id="rename-conversation-folder-button-${a}" class="flex gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" fill="none" class="icon icon-md"><path fill="currentColor" d="M184 160C193.5 160 202.1 165.6 205.9 174.3L269.9 318.3C275.3 330.4 269.9 344.5 257.7 349.9C245.6 355.3 231.5 349.9 226.1 337.7L221.7 328H146.3L141.9 337.7C136.5 349.9 122.4 355.3 110.3 349.9C98.14 344.5 92.69 330.4 98.07 318.3L162.1 174.3C165.9 165.6 174.5 160 184 160H184zM167.6 280H200.4L184 243.1L167.6 280zM304 184C304 170.7 314.7 160 328 160H380C413.1 160 440 186.9 440 220C440 229.2 437.9 237.9 434.2 245.7C447.5 256.7 456 273.4 456 292C456 325.1 429.1 352 396 352H328C314.7 352 304 341.3 304 328V184zM352 208V232H380C386.6 232 392 226.6 392 220C392 213.4 386.6 208 380 208H352zM352 304H396C402.6 304 408 298.6 408 292C408 285.4 402.6 280 396 280H352V304zM0 128C0 92.65 28.65 64 64 64H576C611.3 64 640 92.65 640 128V384C640 419.3 611.3 448 576 448H64C28.65 448 0 419.3 0 384V128zM48 128V384C48 392.8 55.16 400 64 400H576C584.8 400 592 392.8 592 384V128C592 119.2 584.8 112 576 112H64C55.16 112 48 119.2 48 128z"/></svg>${translate("Rename")}</div>
      
    <div role="menuitem" id="add-subfolder-conversation-folder-button-${a}" class="flex gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><svg stroke="currentColor" fill="currentColor" class="icon icon-md" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M448 96h-172.1L226.7 50.75C214.7 38.74 198.5 32 181.5 32H64C28.66 32 0 60.66 0 96v320c0 35.34 28.66 64 64 64h384c35.34 0 64-28.66 64-64V160C512 124.7 483.3 96 448 96zM464 416c0 8.824-7.18 16-16 16H64c-8.82 0-16-7.176-16-16V96c0-8.824 7.18-16 16-16h117.5c4.273 0 8.289 1.664 11.31 4.688L256 144h192c8.82 0 16 7.176 16 16V416zM336 264h-56V207.1C279.1 194.7 269.3 184 256 184S232 194.7 232 207.1V264H175.1C162.7 264 152 274.7 152 288c0 13.26 10.73 23.1 23.1 23.1h56v56C232 381.3 242.7 392 256 392c13.26 0 23.1-10.74 23.1-23.1V311.1h56C349.3 311.1 360 301.3 360 288S349.3 264 336 264z"/></svg>${translate("Add subfolder")}</div>

    <div role="menuitem" id="move-folder-conversation-folder-button-${a}" class="flex gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><svg xmlns="http://www.w3.org/2000/svg" stroke="currentColor" fill="currentColor" class="icon icon-md" viewBox="0 0 576 512"><path d="M544 320h-96l-44.16-27.23C398.8 289.6 392.1 288 387 288H320c-17.67 0-32 14.33-32 32v160c0 17.67 14.33 32 32 32h224c17.67 0 32-14.33 32-32v-128C576 334.3 561.7 320 544 320zM528 464h-192v-128h46.5l40.3 24.86C430.4 365.5 439.1 368 448 368h80V464zM232 160C245.3 160 256 149.3 256 136C256 122.7 245.3 112 232 112H48V24C48 10.74 37.25 0 24 0S0 10.74 0 24v368C0 422.9 25.07 448 56 448h176C245.3 448 256 437.3 256 424c0-13.26-10.75-24-24-24h-176c-4.4 0-8-3.602-8-8V160H232zM544 32h-96l-44.16-27.23C398.8 1.648 392.1 0 387 0H320c-17.67 0-32 14.33-32 32v160c0 17.67 14.33 32 32 32h224c17.67 0 32-14.33 32-32V64C576 46.33 561.7 32 544 32zM528 176h-192v-128h46.5l40.3 24.86C430.4 77.53 439.1 80 448 80h80V176z"/></svg>${translate("Move folder")}</div>

      <div role="menuitem" id="color-conversation-folder-button-${a}" class="flex gap-2 items-center justify-between rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><div class="flex gap-2"><svg stroke="currentColor" fill="currentColor" stroke-width="2" viewBox="0 0 512 512" stroke-linecap="round" stroke-linejoin="round" class="icon icon-md" xmlns="http://www.w3.org/2000/svg"><path d="M160 255.1C160 273.7 145.7 287.1 128 287.1C110.3 287.1 96 273.7 96 255.1C96 238.3 110.3 223.1 128 223.1C145.7 223.1 160 238.3 160 255.1zM128 159.1C128 142.3 142.3 127.1 160 127.1C177.7 127.1 192 142.3 192 159.1C192 177.7 177.7 191.1 160 191.1C142.3 191.1 128 177.7 128 159.1zM288 127.1C288 145.7 273.7 159.1 256 159.1C238.3 159.1 224 145.7 224 127.1C224 110.3 238.3 95.1 256 95.1C273.7 95.1 288 110.3 288 127.1zM320 159.1C320 142.3 334.3 127.1 352 127.1C369.7 127.1 384 142.3 384 159.1C384 177.7 369.7 191.1 352 191.1C334.3 191.1 320 177.7 320 159.1zM441.9 319.1H344C317.5 319.1 296 341.5 296 368C296 371.4 296.4 374.7 297 377.9C299.2 388.1 303.5 397.1 307.9 407.8C313.9 421.6 320 435.3 320 449.8C320 481.7 298.4 510.5 266.6 511.8C263.1 511.9 259.5 512 256 512C114.6 512 0 397.4 0 256C0 114.6 114.6 0 256 0C397.4 0 512 114.6 512 256C512 256.9 511.1 257.8 511.1 258.7C511.6 295.2 478.4 320 441.9 320V319.1zM463.1 258.2C463.1 257.4 464 256.7 464 255.1C464 141.1 370.9 47.1 256 47.1C141.1 47.1 48 141.1 48 255.1C48 370.9 141.1 464 256 464C258.9 464 261.8 463.9 264.6 463.8C265.4 463.8 265.9 463.6 266.2 463.5C266.6 463.2 267.3 462.8 268.2 461.7C270.1 459.4 272 455.2 272 449.8C272 448.1 271.4 444.3 266.4 432.7C265.8 431.5 265.2 430.1 264.5 428.5C260.2 418.9 253.4 403.5 250.1 387.8C248.7 381.4 248 374.8 248 368C248 314.1 290.1 271.1 344 271.1H441.9C449.6 271.1 455.1 269.3 459.7 266.2C463 263.4 463.1 260.9 463.1 258.2V258.2z"/></svg>${translate("Set color")}</div>
        <div id="color-picker-button-${a}" class="flex z-10 cursor-pointer flex items-center">
          <svg id="reset-color-picker" stroke="currentColor" fill="currentColor" stroke-width="2" viewBox="0 0 512 512" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4 me-2" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M496 40v160C496 213.3 485.3 224 472 224h-160C298.8 224 288 213.3 288 200s10.75-24 24-24h100.5C382.8 118.3 322.5 80 256 80C158.1 80 80 158.1 80 256s78.97 176 176 176c41.09 0 81.09-14.47 112.6-40.75c10.16-8.5 25.31-7.156 33.81 3.062c8.5 10.19 7.125 25.31-3.062 33.81c-40.16 33.44-91.17 51.77-143.5 51.77C132.4 479.9 32 379.5 32 256s100.4-223.9 223.9-223.9c79.85 0 152.4 43.46 192.1 109.1V40c0-13.25 10.75-24 24-24S496 26.75 496 40z"/></svg><input type="color" class="w-8 h-6" id="color-picker-input-${a}" style="cursor:pointer" value="${rgba2hex(s?.style?.backgroundColor)||"#2f2f2f"}" />
        </div>
      </div>

      <div id="set-profile-folder-conversations-button-${a}" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><div class="flex gap-1"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="icon icon-lg" style="position:relative;left:-2px;"><path d="M10.663 6.3872C10.8152 6.29068 11 6.40984 11 6.59007V8C11 8.55229 11.4477 9 12 9C12.5523 9 13 8.55229 13 8V6.59007C13 6.40984 13.1848 6.29068 13.337 6.3872C14.036 6.83047 14.5 7.61105 14.5 8.5C14.5 9.53284 13.8737 10.4194 12.9801 10.8006C12.9932 10.865 13 10.9317 13 11V13C13 13.5523 12.5523 14 12 14C11.4477 14 11 13.5523 11 13V11C11 10.9317 11.0068 10.865 11.0199 10.8006C10.1263 10.4194 9.5 9.53284 9.5 8.5C9.5 7.61105 9.96397 6.83047 10.663 6.3872Z" fill="currentColor"></path><path d="M17.9754 4.01031C17.8588 4.00078 17.6965 4.00001 17.4 4.00001H9.8C8.94342 4.00001 8.36113 4.00078 7.91104 4.03756C7.47262 4.07338 7.24842 4.1383 7.09202 4.21799C6.7157 4.40974 6.40973 4.7157 6.21799 5.09202C6.1383 5.24842 6.07337 5.47263 6.03755 5.91104C6.00078 6.36113 6 6.94343 6 7.80001V16.1707C6.31278 16.0602 6.64937 16 7 16H18L18 4.60001C18 4.30348 17.9992 4.14122 17.9897 4.02464C17.9893 4.02 17.9889 4.0156 17.9886 4.01145C17.9844 4.01107 17.98 4.01069 17.9754 4.01031ZM17.657 18H7C6.44772 18 6 18.4477 6 19C6 19.5523 6.44772 20 7 20H17.657C17.5343 19.3301 17.5343 18.6699 17.657 18ZM4 19L4 7.75871C3.99999 6.95374 3.99998 6.28937 4.04419 5.74818C4.09012 5.18608 4.18868 4.66938 4.43597 4.18404C4.81947 3.43139 5.43139 2.81947 6.18404 2.43598C6.66937 2.18869 7.18608 2.09012 7.74818 2.0442C8.28937 1.99998 8.95373 1.99999 9.7587 2L17.4319 2C17.6843 1.99997 17.9301 1.99994 18.1382 2.01695C18.3668 2.03563 18.6366 2.07969 18.908 2.21799C19.2843 2.40974 19.5903 2.7157 19.782 3.09203C19.9203 3.36345 19.9644 3.63318 19.9831 3.86178C20.0001 4.06994 20 4.31574 20 4.56812L20 17C20 17.1325 19.9736 17.2638 19.9225 17.386C19.4458 18.5253 19.4458 19.4747 19.9225 20.614C20.0517 20.9227 20.0179 21.2755 19.8325 21.5541C19.6471 21.8326 19.3346 22 19 22H7C5.34315 22 4 20.6569 4 19Z" fill="currentColor"></path></svg>${translate("Set profile")}</div></div>

      <div role="menuitem" id="set-image-folder-conversations-button-${a}" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><div class="flex gap-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" stroke="currentColor" fill="currentColor" stroke-width="2" stroke-linejoin="round" class="icon icon-md"><path d="M112 112c-17.67 0-32 14.33-32 32s14.33 32 32 32c17.68 0 32-14.33 32-32S129.7 112 112 112zM448 96c0-35.35-28.65-64-64-64H64C28.65 32 0 60.65 0 96v320c0 35.35 28.65 64 64 64h320c35.35 0 64-28.65 64-64V96zM400 416c0 8.822-7.178 16-16 16H64c-8.822 0-16-7.178-16-16v-48h352V416zM400 320h-28.76l-96.58-144.9C271.7 170.7 266.7 168 261.3 168c-5.352 0-10.35 2.672-13.31 7.125l-62.74 94.11L162.9 238.6C159.9 234.4 155.1 232 150 232c-5.109 0-9.914 2.441-12.93 6.574L77.7 320H48V96c0-8.822 7.178-16 16-16h320c8.822 0 16 7.178 16 16V320z"/></svg>${translate("Set image")}</div></div>
      
      ${l?`<div role="menuitem" id="remove-image-folder-conversations-button-${a}" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><div class="flex gap-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" stroke="currentColor" fill="currentColor" stroke-width="2" stroke-linejoin="round" class="icon icon-md"><path d="M630.8 469.1l-55.95-43.85C575.3 422.2 575.1 419.2 575.1 416l.0034-320c0-35.35-28.65-64-64-64H127.1C113.6 32 100.4 36.98 89.78 45.06L38.81 5.113C28.34-3.058 13.31-1.246 5.109 9.192C-3.063 19.63-1.235 34.72 9.187 42.89L601.2 506.9C605.6 510.3 610.8 512 615.1 512c7.125 0 14.17-3.156 18.91-9.188C643.1 492.4 641.2 477.3 630.8 469.1zM527.1 388.5l-36.11-28.3l-100.7-136.8C387.8 218.8 382.1 216 376 216c-6.113 0-11.82 2.768-15.21 7.379L344.9 245L261.9 180C262.1 176.1 264 172.2 264 168c0-26.51-21.49-48-48-48c-8.336 0-16.05 2.316-22.88 6.057L134.4 80h377.6c8.822 0 16 7.178 16 16V388.5zM254.2 368.3l-37.09-46.1c-3.441-4.279-8.934-6.809-14.77-6.809c-5.842 0-11.33 2.529-14.78 6.809l-75.52 93.81c0-.0293 0 .0293 0 0L111.1 184.5l-48-37.62L63.99 416c0 35.35 28.65 64 64 64h361.1l-201.1-157.6L254.2 368.3z"/></svg>${translate("Remove image")}</div></div>`:""}

      <div role="menuitem" id="export-folder-conversations-button-${a}" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><div class="flex gap-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" stroke="currentColor" fill="currentColor" stroke-width="2" stroke-linejoin="round" class="icon icon-md"><path d="M568.1 303l-80-80c-9.375-9.375-24.56-9.375-33.94 0s-9.375 24.56 0 33.94L494.1 296H216C202.8 296 192 306.8 192 320s10.75 24 24 24h278.1l-39.03 39.03C450.3 387.7 448 393.8 448 400s2.344 12.28 7.031 16.97c9.375 9.375 24.56 9.375 33.94 0l80-80C578.3 327.6 578.3 312.4 568.1 303zM360 384c-13.25 0-24 10.74-24 24V448c0 8.836-7.164 16-16 16H64.02c-8.836 0-16-7.164-16-16L48 64.13c0-8.836 7.164-16 16-16h160L224 128c0 17.67 14.33 32 32 32h79.1v72c0 13.25 10.74 24 23.1 24S384 245.3 384 232V138.6c0-16.98-6.742-33.26-18.75-45.26l-74.63-74.64C278.6 6.742 262.3 0 245.4 0H63.1C28.65 0-.002 28.66 0 64l.0065 384c.002 35.34 28.65 64 64 64H320c35.2 0 64-28.8 64-64v-40C384 394.7 373.3 384 360 384z"></path></svg>${translate("Export")} ${i?"":'<span class="text-white rounded-md bg-green-500 px-2 text-sm">Pro</span>'}</div></div>

      
      <div role="menuitem" id="delete-conversation-folder-button-${a}" class="flex gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group text-red-500" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5555 4C10.099 4 9.70052 4.30906 9.58693 4.75114L9.29382 5.8919H14.715L14.4219 4.75114C14.3083 4.30906 13.9098 4 13.4533 4H10.5555ZM16.7799 5.8919L16.3589 4.25342C16.0182 2.92719 14.8226 2 13.4533 2H10.5555C9.18616 2 7.99062 2.92719 7.64985 4.25342L7.22886 5.8919H4C3.44772 5.8919 3 6.33961 3 6.8919C3 7.44418 3.44772 7.8919 4 7.8919H4.10069L5.31544 19.3172C5.47763 20.8427 6.76455 22 8.29863 22H15.7014C17.2354 22 18.5224 20.8427 18.6846 19.3172L19.8993 7.8919H20C20.5523 7.8919 21 7.44418 21 6.8919C21 6.33961 20.5523 5.8919 20 5.8919H16.7799ZM17.888 7.8919H6.11196L7.30423 19.1057C7.3583 19.6142 7.78727 20 8.29863 20H15.7014C16.2127 20 16.6417 19.6142 16.6958 19.1057L17.888 7.8919ZM10 10C10.5523 10 11 10.4477 11 11V16C11 16.5523 10.5523 17 10 17C9.44772 17 9 16.5523 9 16V11C9 10.4477 9.44772 10 10 10ZM14 10C14.5523 10 15 10.4477 15 11V16C15 16.5523 14.5523 17 14 17C13.4477 17 13 16.5523 13 16V11C13 10.4477 13.4477 10 14 10Z" fill="currentColor"></path></svg>${translate("Delete")}</div>`}
  
  </div></div>`;document.body.insertAdjacentHTML("beforeend",g),adjustMenuPosition(document.querySelector("#conversation-manager-folder-menu")),addConversationManagerFolderMenuEventListeners(t,o),document.querySelector("#conversation-manager-folder-menu").addEventListener("mouseleave",()=>{e.classList.replace("flex","hidden")})}async function addConversationManagerFolderMenuEventListeners(e,t=!1){const o=e.id,r=document.querySelector("#conversation-manager-folder-menu"),n=document.querySelector(`#view-mode-conversation-folder-button-${o}`),i=document.querySelector(`#rename-conversation-folder-button-${o}`),a=document.querySelector(`#add-subfolder-conversation-folder-button-${o}`),s=document.querySelector(`#move-folder-conversation-folder-button-${o}`),l=document.querySelector(`#color-conversation-folder-button-${o}`),d=document.querySelector(`#set-profile-folder-conversations-button-${o}`),c=document.querySelector(`#set-image-folder-conversations-button-${o}`),u=document.querySelector(`#remove-image-folder-conversations-button-${o}`),m=document.querySelector(`#export-folder-conversations-button-${o}`),g=document.querySelector(`#delete-conversation-folder-button-${o}`),p=document.querySelector(`#color-picker-button-${o}`),h=document.querySelector(`#clear-all-conversation-folder-button-${o}`),f=await chrome.runtime.sendMessage({type:"checkHasSubscription"});n?.addEventListener("mouseenter",()=>{showAllConversationsViewModeMenu(r)}),i?.addEventListener("click",()=>{handleRenameConversationFolderClick(o,t)}),a?.addEventListener("click",()=>{closeMenus();const x=t?document.querySelectorAll('#sidebar-folder-drawer #sidebar-folder-content > div[id^="conversation-folder-wrapper-"]'):document.querySelectorAll('#modal-manager #conversation-manager-sidebar-folders > div[id^="conversation-folder-wrapper-"]');if(!f&&x.length>=5){errorUpgradeConfirmation({type:"limit",title:"You have reached the limit",message:"You have reached the limits of Conversation Folders with free account. Upgrade to Pro to remove all limits."});return}(t?document.querySelector(`#sidebar-folder-content #conversation-folder-wrapper-${o}`):document.querySelector(`#modal-manager #conversation-folder-wrapper-${o}`))?.click(),setTimeout(()=>{chrome.runtime.sendMessage({type:"addConversationFolders",forceRefresh:!0,detail:{folders:[{name:"New Folder",color:e.color,profile:e.profile?.id,parent_folder:o,image_url:e.image||e.image_url,gizmo_id:e.gizmo_id}]}},y=>{if(y.error&&y.error.type==="limit"){errorUpgradeConfirmation(y.error);return}if(!(!y||y.length===0)){if(t)addNewConvFolderElementToSidebar(y[0]);else{const b=document.querySelector("#conversation-manager-subfolder-list");b?.prepend(conversationFolderElement(y[0])),b?.scrollIntoView({block:"nearest",inline:"nearest"}),addNewConvFolderElementToSidebar(y[0])}document.querySelectorAll(`#folder-subfolder-count-${o}`).forEach(b=>{const w=parseInt(b.innerText.split(" ")[0],10);b.innerText=`${w+1} folder${w+1===1?"":"s"} -`}),handleRenameConversationFolderClick(y[0].id)}})},100)}),s?.addEventListener("click",()=>{openMoveConvFolderModal(e)}),l?.addEventListener("click",x=>{x.stopPropagation()}),p?.addEventListener("click",x=>{x.stopPropagation()});const v=debounce(x=>{chrome.runtime.sendMessage({type:"updateConversationFolder",detail:{folderId:o,newData:x}})},200);p?.querySelector("input[id^=color-picker-input-]")?.addEventListener("input",x=>{const y=x.target.value;document.querySelectorAll(`#conversation-folder-wrapper-${o}`).forEach(w=>{w.style.backgroundColor=y});const b={color:y};updateConversationFolderIndicators(o,b),v(b)}),p?.querySelector("#reset-color-picker")?.addEventListener("click",x=>{x.preventDefault(),x.stopPropagation(),closeMenus(),document.querySelectorAll(`#conversation-folder-wrapper-${o}`).forEach(b=>{b.style.backgroundColor="#2f2f2f"}),p.querySelector("input[id^=color-picker-input-]").value="#2f2f2f";const y={color:"#2f2f2f"};updateConversationFolderIndicators(o,y),chrome.runtime.sendMessage({type:"updateConversationFolder",detail:{folderId:o,newData:y}})}),d?.addEventListener("click",x=>{x.stopPropagation(),x.preventDefault(),closeMenus(),openFolderProfileSelectorModal(e)}),c?.addEventListener("click",()=>{closeMenus();const x=document.createElement("form");x.method="POST",x.enctype="multipart/form-data",x.style.display="none";const y=document.createElement("input");y.type="file",y.accept="image/*",x.appendChild(y),document.body.appendChild(x),y.click(),y.onchange=async()=>{const b=y.files[0];if(!b)return;const w=new FileReader;w.onload=async k=>{const S={image:{base64:w.result.split(",")[1],type:b.type,name:b.name}},M=k.target.result,$=document.querySelectorAll(`#conversation-folder-image-${o}`);$.forEach(q=>{q.src=M,q.classList.remove("hidden")}),chrome.runtime.sendMessage({type:"updateConversationFolder",detail:{folderId:o,newData:S}},q=>{if(q.error){toast(q.error,"error");return}$.forEach(E=>{E.src=q.image})})},w.readAsDataURL(b)}}),u?.addEventListener("click",()=>{closeMenus(),document.querySelectorAll(`#conversation-folder-image-${o}`).forEach(x=>{x.src=chrome.runtime.getURL("icons/folder.png"),x.classList="w-5 h-5 me-3 rounded-md object-cover"}),chrome.runtime.sendMessage({type:"removeConversationFolderImage",detail:{folderId:o}})}),m?.addEventListener("click",async()=>{if(!f){errorUpgradeConfirmation({title:"This is a Pro feature",message:"Exporting all conversations requires a Pro subscription. Upgrade to Pro to remove all limits."});return}const x=o==="all"?[]:await chrome.runtime.sendMessage({type:o==="favorites"?"getAllFavoriteConversationIds":"getAllFolderConversationIds",detail:{folderId:o}});if(o!=="all"&&x&&x.length===0){toast("No conversations found in this folder","error");return}openExportModal(x,o==="all"?"all":o==="favorites"?"favorite":"folder")}),g?.addEventListener("click",()=>{showConfirmDialog("Delete Folder","Are you sure you want to delete this folder? All conversations and sub folders inside this folder will be deleted too.","Cancel","Delete Folder",null,()=>confirmDeleteConversationManagerFolder(e,t),"red",!1)}),h?.addEventListener("click",()=>{closeMenus();const x={all:"Delete all conversations",favorites:"Reset favorite conversations"},y={all:"Are you sure you want to delete all your conversations? This will also delete all conversations in all folders.",favorites:"Are you sure you want to unfave all your favorite conversations?"};showConfirmDialog(x[o],y[o],"Cancel","Confirm",null,()=>{if(document.querySelector("#sidebar-folder-drawer #folder-breadcrumb-root")?.click(),o==="all"||selectedConversationFolderBreadcrumb.map(b=>b.id).includes(o)){const b=document.querySelector("#conversation-manager-conversation-list");b&&(b.innerHTML="",b.appendChild(noConversationElement()))}if(o==="all"){resetConversationCounts(),deleteAllConversations(),chrome.runtime.sendMessage({type:"deleteAllConversations"});return}o==="favorites"&&chrome.runtime.sendMessage({type:"resetAllFavoriteConversations"})})})}function confirmDeleteConversationManagerFolder(e,t=!1){const o=e.id;if(document.querySelectorAll(`#conversation-folder-wrapper-${o}`).forEach(i=>{i.remove()}),t){const i=document.querySelector("#sidebar-folder-content #default-conversation-folders");i&&!i.nextElementSibling&&i.insertAdjacentElement("afterend",noConversationFolderElemet())}else{const i=document.querySelector('#conversation-manager-sidebar-folders > div[id^="conversation-folder-wrapper-"]');if(i)selectedConversationFolderBreadcrumb.map(a=>a.id).includes(o)&&i.click();else{document.querySelector("#conversation-manager-sidebar-folders")?.appendChild(noConversationFolderElemet());const a=document.querySelector("#modal-manager #conversation-folder-wrapper-all");a&&a.click()}}const r=e.parent_folder;document.querySelectorAll(`#folder-subfolder-count-${r}`).forEach(i=>{const a=parseInt(i.innerText.split(" ")[0],10);i.innerText=`${a-1} folder${a-1===1?"":"s"} -`});const n=document.querySelector("#confirm-action-dialog #confirm-button div");chrome.runtime.sendMessage({type:"deleteConversationFolders",detail:{folderIds:[o]}},async i=>{if(i.error){toast(i.error,"error");return}const a=i.deleted_conversation_ids;a.forEach(l=>{removeConversationElements(l)});for(let l=0;l<a.length;l+=1){const d=a[l];try{await deleteConversation(d)}catch(c){console.log(c)}n&&a.length>1&&(n.innerHTML=`<div class="w-full h-full inset-0 flex items-center justify-center text-white"><svg x="0" y="0" viewbox="0 0 40 40" style="width:16px; height:16px;" class="spinner icon icon-xl me-2"><circle fill="transparent" stroke="#ffffff50" stroke-width="2" stroke-linecap="round" stroke-dasharray="125.6" cx="20" cy="20" r="18"></circle></svg><span class="visually-hidden">${l+1} / ${a.length}</span></div>`)}const s=document.querySelector("#confirm-action-dialog");s&&s.remove()})}function showAllConversationsViewModeMenu(e){const{right:t,top:o}=e.getBoundingClientRect(),r=t+2,n=o-50,i=`<div id="prompt-manager-sidebar-settings-sort-menu" dir="ltr" style="position:fixed;left:0;top:0;transform:translate3d(${r}px,${n}px,0);min-width:max-content;z-index:10001;--radix-popper-anchor-width:18px;--radix-popper-anchor-height:18px;--radix-popper-available-width:1167px;--radix-popper-available-height:604px;--radix-popper-transform-origin:0% 0px"><div data-side="bottom" data-align="start" role="menu" aria-orientation="vertical" data-state="open" data-radix-menu-content="" dir="ltr" aria-labelledby="radix-:r6g:" class="text-token-text-primary mt-2 min-w-[200px] max-w-xs rounded-2xl bg-token-main-surface-secondary shadow-long p-1" tabindex="-1" data-orientation="vertical" style="outline:0;--radix-dropdown-menu-content-transform-origin:var(--radix-popper-transform-origin);--radix-dropdown-menu-content-available-width:var(--radix-popper-available-width);--radix-dropdown-menu-content-available-height:var(--radix-popper-available-height);--radix-dropdown-menu-trigger-width:var(--radix-popper-anchor-width);--radix-dropdown-menu-trigger-height:var(--radix-popper-anchor-height);pointer-events:auto">
  
    <div role="menuitem" id="view-mode-all-button" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item="">${translate("Show all conversations")} ${cachedSettings.excludeConvInFolders?"":'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md"><path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path></svg>'}</div>

    <div role="menuitem" id="view-mode-unassigned-button" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item="">${translate("Only unassigned conversations")} ${cachedSettings.excludeConvInFolders?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md"><path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path></svg>':""}</div>
  `;document.body.insertAdjacentHTML("beforeend",i),addAllConversationsViewModeMenuEventListeners()}function addAllConversationsViewModeMenuEventListeners(){const e=document.querySelector("#view-mode-all-button"),t=document.querySelector("#view-mode-unassigned-button");e?.addEventListener("click",()=>{const o={...cachedSettings};o.excludeConvInFolders=!1,chrome.storage.local.set({settings:o},()=>{fetchConversations(),fetchSidebarConversations()})}),t?.addEventListener("click",()=>{const o={...cachedSettings};o.excludeConvInFolders=!0,chrome.storage.local.set({settings:o},()=>{fetchConversations(),fetchSidebarConversations()})})}function handleRenameConversationFolderClick(e,t=!1){let o=!1;closeMenus();const r=document.createElement("input"),n=document.querySelector(`${t?"#sidebar-folder-drawer":"#modal-manager"} #conversation-folder-name-${e}`),i=n?.innerText||"";r.id=`conversation-folder-rename-${e}`,r.classList="border-0 bg-transparent p-0 focus:ring-0 focus-visible:ring-0 w-full text-white text-sm",r.value=i,n?.parentElement?.replaceChild(r,n),r.focus(),setTimeout(()=>{r.select()},50),r?.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation(),closeMenus(),r.focus()}),r?.addEventListener("blur",()=>{if(o)return;const a=r.value;a!==i&&updateConversationFolderNameElement(n,e,a),r.parentElement?.replaceChild(n,r)}),r?.addEventListener("keydown",a=>{if(a.key==="Enter"&&a.which===13){a.preventDefault(),a.stopPropagation(),o=!0;const s=r.value;s!==i&&updateConversationFolderNameElement(n,e,s),r.parentElement?.replaceChild(n,r)}a.key==="Escape"&&(o=!0,n.innerText=i,r.parentElement?.replaceChild(n,r))})}function updateConversationFolderNameElement(e,t,o){if(!o.trim())return;e.innerText=o,document.querySelectorAll(`#conversation-folder-name-${t}`).forEach(n=>{n.innerText=o});const r={name:o};updateConversationFolderIndicators(t,r),document.querySelectorAll(`#folder-breadcrumb-${t}`).forEach(n=>{n.innerText=o}),selectedConversationFolderBreadcrumb.forEach(n=>{n.id===t&&(n.name=o)}),chrome.runtime.sendMessage({type:"updateConversationFolder",detail:{folderId:t,newData:r}})}function updateConversationFolderIndicators(e,t){const o=document.querySelectorAll(`#conversation-manager-conversation-list [data-folder-id="${e}"]`),r=getLastSelectedConversationFolder();o.forEach(n=>{const i=n.querySelector("[id^=conversation-card-folder-wrapper]");i&&r?.id?.toString()!==e.toString()&&i.classList.remove("hidden");const a=n.querySelector("[id^=conversation-card-folder-tag]");a&&(a.classList.remove("hidden"),a.style.backgroundColor=t.color);const s=n.querySelector("[id^=conversation-card-folder-name]");s&&Object.keys(t).includes("name")&&(s.innerText=t.name);const l=n.querySelector("[id^=conversation-card-folder-color-indicator]");l&&Object.keys(t).includes("color")&&(l.style.backgroundColor=t.color,l.title=t.name||"",l.dataset.folderId=e)})}const messageExpandIcon='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="icon" viewBox="0 0 512 512"><path d="M183 295l-81.38 81.38l-47.03-47.03c-6.127-6.117-14.29-9.367-22.63-9.367c-4.117 0-8.279 .8086-12.25 2.43c-11.97 4.953-19.75 16.63-19.75 29.56v135.1C.0013 501.3 10.75 512 24 512h136c12.94 0 24.63-7.797 29.56-19.75c4.969-11.97 2.219-25.72-6.938-34.87l-47.03-47.03l81.38-81.38c9.375-9.375 9.375-24.56 0-33.94S192.4 285.7 183 295zM487.1 0h-136c-12.94 0-24.63 7.797-29.56 19.75c-4.969 11.97-2.219 25.72 6.938 34.87l47.04 47.03l-81.38 81.38c-9.375 9.375-9.375 24.56 0 33.94s24.56 9.375 33.94 0l81.38-81.38l47.03 47.03c6.127 6.117 14.3 9.35 22.63 9.35c4.117 0 8.275-.7918 12.24-2.413C504.2 184.6 512 172.9 512 159.1V23.1C512 10.75 501.3 0 487.1 0z"></path></svg>',messageCollapseIcon='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="icon" viewBox="0 0 512 512"><path d="M488.1 23.03c-9.375-9.375-24.56-9.375-33.94 0l-81.38 81.38l-47.03-47.03c-6.127-6.117-14.3-9.35-22.63-9.35c-4.117 0-8.275 .7918-12.24 2.413c-11.97 4.953-19.75 16.63-19.75 29.56v135.1c0 13.25 10.74 23.1 24 23.1h136c12.94 0 24.63-7.797 29.56-19.75c4.969-11.97 2.219-25.72-6.938-34.87l-47.04-47.03l81.38-81.38C498.3 47.59 498.3 32.41 488.1 23.03zM215.1 272h-136c-12.94 0-24.63 7.797-29.56 19.75C45.47 303.7 48.22 317.5 57.37 326.6l47.04 47.03l-81.38 81.38c-9.375 9.375-9.375 24.56 0 33.94s24.56 9.375 33.94 0l81.38-81.38l47.03 47.03c6.127 6.117 14.29 9.367 22.63 9.367c4.117 0 8.279-.8086 12.25-2.43c11.97-4.953 19.75-16.63 19.75-29.56V296C239.1 282.7 229.3 272 215.1 272z"></path></svg>';async function showConversationManagerCardMenu(e,t,o=!1,r=!1){const{showFoldersInLeftSidebar:n}=cachedSettings,i=await chrome.runtime.sendMessage({type:"checkHasSubscription"}),a=JSON.parse(window.localStorage.getItem("sp/messagesToggleState"))||{convId:t.conversation_id,state:"expanded"},s=t.conversation_id,l=e.id==="navbar-conversation-menu-button",{right:d,top:c}=e.getBoundingClientRect();let u=n&&o?d-6:d-244,m=c+20;l&&(u-=16,m+=16);const g=`<div id="conversation-card-menu" dir="ltr" style="transform:translate3d(${u}px,${m}px,0);position:fixed;left:0;top:0;min-width:max-content;z-index:10001;--radix-popper-anchor-width:18px;--radix-popper-anchor-height:18px;--radix-popper-available-width:1167px;--radix-popper-available-height:604px;--radix-popper-transform-origin:0% 0px"><div data-side="bottom" data-align="start" role="menu" aria-orientation="vertical" data-state="open" data-radix-menu-content="" dir="ltr" aria-labelledby="radix-:r6g:" class="max-w-xs rounded-2xl text-token-text-primary bg-token-main-surface-secondary shadow-long p-1" tabindex="-1" data-orientation="vertical" style="min-width:200px; outline:0;--radix-dropdown-menu-content-transform-origin:var(--radix-popper-transform-origin);--radix-dropdown-menu-content-available-width:var(--radix-popper-available-width);--radix-dropdown-menu-content-available-height:var(--radix-popper-available-height);--radix-dropdown-menu-trigger-width:var(--radix-popper-anchor-width);--radix-dropdown-menu-trigger-height:var(--radix-popper-anchor-height);pointer-events:auto">
  
  ${l?"":`<div role="menuitem" id="preview-conversation-card-button-${s}" title="SHIFT + Click on the card" class="flex gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" fill="currentColor" width="20" height="20" class="icon"><path d="M160 256C160 185.3 217.3 128 288 128C358.7 128 416 185.3 416 256C416 326.7 358.7 384 288 384C217.3 384 160 326.7 160 256zM288 336C332.2 336 368 300.2 368 256C368 211.8 332.2 176 288 176C287.3 176 286.7 176 285.1 176C287.3 181.1 288 186.5 288 192C288 227.3 259.3 256 224 256C218.5 256 213.1 255.3 208 253.1C208 254.7 208 255.3 208 255.1C208 300.2 243.8 336 288 336L288 336zM95.42 112.6C142.5 68.84 207.2 32 288 32C368.8 32 433.5 68.84 480.6 112.6C527.4 156 558.7 207.1 573.5 243.7C576.8 251.6 576.8 260.4 573.5 268.3C558.7 304 527.4 355.1 480.6 399.4C433.5 443.2 368.8 480 288 480C207.2 480 142.5 443.2 95.42 399.4C48.62 355.1 17.34 304 2.461 268.3C-.8205 260.4-.8205 251.6 2.461 243.7C17.34 207.1 48.62 156 95.42 112.6V112.6zM288 80C222.8 80 169.2 109.6 128.1 147.7C89.6 183.5 63.02 225.1 49.44 256C63.02 286 89.6 328.5 128.1 364.3C169.2 402.4 222.8 432 288 432C353.2 432 406.8 402.4 447.9 364.3C486.4 328.5 512.1 286 526.6 256C512.1 225.1 486.4 183.5 447.9 147.7C406.8 109.6 353.2 80 288 80V80z"/></svg>${translate("Preview")}</div>
    
    <div role="menuitem" id="open-conversation-card-button-${s}" title="CMD/CTRL + Click on the card" class="flex gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" fill="currentColor" width="20" height="20" class="icon"><path d="M488 0h-135.3c-13.25 0-25.09 7.906-30.19 20.16c-5.062 12.28-2.281 26.25 7.094 35.63l40.69 40.69L177.4 289.4c-12.5 12.5-12.5 32.75 0 45.25C183.6 340.9 191.8 344 200 344s16.38-3.125 22.62-9.375l192.9-192.9l40.69 40.69C462.5 188.7 470.8 192 479.3 192c4.219 0 8.469-.8125 12.56-2.5C504.1 184.4 512 172.6 512 159.3V24C512 10.75 501.3 0 488 0zM392 320c-13.25 0-24 10.75-24 24v112c0 4.406-3.594 8-8 8h-304c-4.406 0-8-3.594-8-8v-304c0-4.406 3.594-8 8-8h112C181.3 144 192 133.3 192 120S181.3 96 168 96h-112C25.13 96 0 121.1 0 152v304C0 486.9 25.13 512 56 512h304c30.88 0 56-25.12 56-56v-112C416 330.8 405.3 320 392 320z"/></svg>${translate("Open in new tab")}<span class='ms-auto'>${buttonGenerator(["\u2318","Click"],"xs")}</span></div>
    
    <div role="menuitem" id="rename-conversation-card-button-${s}" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><div class="flex gap-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" fill="none" width="20" height="20" class="icon"><path fill="currentColor" d="M184 160C193.5 160 202.1 165.6 205.9 174.3L269.9 318.3C275.3 330.4 269.9 344.5 257.7 349.9C245.6 355.3 231.5 349.9 226.1 337.7L221.7 328H146.3L141.9 337.7C136.5 349.9 122.4 355.3 110.3 349.9C98.14 344.5 92.69 330.4 98.07 318.3L162.1 174.3C165.9 165.6 174.5 160 184 160H184zM167.6 280H200.4L184 243.1L167.6 280zM304 184C304 170.7 314.7 160 328 160H380C413.1 160 440 186.9 440 220C440 229.2 437.9 237.9 434.2 245.7C447.5 256.7 456 273.4 456 292C456 325.1 429.1 352 396 352H328C314.7 352 304 341.3 304 328V184zM352 208V232H380C386.6 232 392 226.6 392 220C392 213.4 386.6 208 380 208H352zM352 304H396C402.6 304 408 298.6 408 292C408 285.4 402.6 280 396 280H352V304zM0 128C0 92.65 28.65 64 64 64H576C611.3 64 640 92.65 640 128V384C640 419.3 611.3 448 576 448H64C28.65 448 0 419.3 0 384V128zM48 128V384C48 392.8 55.16 400 64 400H576C584.8 400 592 392.8 592 384V128C592 119.2 584.8 112 576 112H64C55.16 112 48 119.2 48 128z"/></svg>${translate("Rename")}</div> </div>
  `}


  <div role="menuitem" id="share-conversation-card-button-${s}" class="flex gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" width="20" height="20" class="icon" xmlns="http://www.w3.org/2000/svg"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path><polyline points="16 6 12 2 8 6"></polyline><line x1="12" y1="2" x2="12" y2="15"></line></svg>${translate("Share")}</div>

  ${l?`<div role="menuitem" id="custom-instruction-profile-conversation-card-button-${s}" class="flex gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="20" height="20" class="icon"><path d="M10.663 6.3872C10.8152 6.29068 11 6.40984 11 6.59007V8C11 8.55229 11.4477 9 12 9C12.5523 9 13 8.55229 13 8V6.59007C13 6.40984 13.1848 6.29068 13.337 6.3872C14.036 6.83047 14.5 7.61105 14.5 8.5C14.5 9.53284 13.8737 10.4194 12.9801 10.8006C12.9932 10.865 13 10.9317 13 11V13C13 13.5523 12.5523 14 12 14C11.4477 14 11 13.5523 11 13V11C11 10.9317 11.0068 10.865 11.0199 10.8006C10.1263 10.4194 9.5 9.53284 9.5 8.5C9.5 7.61105 9.96397 6.83047 10.663 6.3872Z" fill="currentColor"></path><path d="M17.9754 4.01031C17.8588 4.00078 17.6965 4.00001 17.4 4.00001H9.8C8.94342 4.00001 8.36113 4.00078 7.91104 4.03756C7.47262 4.07338 7.24842 4.1383 7.09202 4.21799C6.7157 4.40974 6.40973 4.7157 6.21799 5.09202C6.1383 5.24842 6.07337 5.47263 6.03755 5.91104C6.00078 6.36113 6 6.94343 6 7.80001V16.1707C6.31278 16.0602 6.64937 16 7 16H18L18 4.60001C18 4.30348 17.9992 4.14122 17.9897 4.02464C17.9893 4.02 17.9889 4.0156 17.9886 4.01145C17.9844 4.01107 17.98 4.01069 17.9754 4.01031ZM17.657 18H7C6.44772 18 6 18.4477 6 19C6 19.5523 6.44772 20 7 20H17.657C17.5343 19.3301 17.5343 18.6699 17.657 18ZM4 19L4 7.75871C3.99999 6.95374 3.99998 6.28937 4.04419 5.74818C4.09012 5.18608 4.18868 4.66938 4.43597 4.18404C4.81947 3.43139 5.43139 2.81947 6.18404 2.43598C6.66937 2.18869 7.18608 2.09012 7.74818 2.0442C8.28937 1.99998 8.95373 1.99999 9.7587 2L17.4319 2C17.6843 1.99997 17.9301 1.99994 18.1382 2.01695C18.3668 2.03563 18.6366 2.07969 18.908 2.21799C19.2843 2.40974 19.5903 2.7157 19.782 3.09203C19.9203 3.36345 19.9644 3.63318 19.9831 3.86178C20.0001 4.06994 20 4.31574 20 4.56812L20 17C20 17.1325 19.9736 17.2638 19.9225 17.386C19.4458 18.5253 19.4458 19.4747 19.9225 20.614C20.0517 20.9227 20.0179 21.2755 19.8325 21.5541C19.6471 21.8326 19.3346 22 19 22H7C5.34315 22 4 20.6569 4 19Z" fill="currentColor"></path></svg>${translate("Custom instruction profile")}</div>`:""}

  <div role="menuitem" id="move-conversation-card-button-${s}" title="${convMenuBreadcrumb(t.breadcrumb)}" class="flex gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><svg xmlns="http://www.w3.org/2000/svg" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round" width="20" height="20" class="icon" stroke-width="2" viewBox="0 0 512 512"><path d="M448 96h-172.1L226.7 50.75C214.7 38.74 198.5 32 181.5 32H64C28.66 32 0 60.66 0 96v320c0 35.34 28.66 64 64 64h384c35.34 0 64-28.66 64-64V160C512 124.7 483.3 96 448 96zM464 416c0 8.824-7.18 16-16 16H64c-8.82 0-16-7.176-16-16V96c0-8.824 7.18-16 16-16h117.5c4.273 0 8.289 1.664 11.31 4.688L256 144h192c8.82 0 16 7.176 16 16V416zM336 264h-56V207.1C279.1 194.7 269.3 184 256 184S232 194.7 232 207.1V264H175.1C162.7 264 152 274.7 152 288c0 13.26 10.73 23.1 23.1 23.1h56v56C232 381.3 242.7 392 256 392c13.26 0 23.1-10.74 23.1-23.1V311.1h56C349.3 311.1 360 301.3 360 288S349.3 264 336 264z"/></svg>${translate("Move")}</div>
  
  ${t?.folder?.id?`<div role="menuitem" id="remove-conversation-card-button-${s}" class="flex gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><svg xmlns="http://www.w3.org/2000/svg" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round" width="20" height="20" class="icon" stroke-width="2" viewBox="0 0 512 512"><path d="M448 96h-172.1L226.7 50.75C214.7 38.74 198.5 32 181.5 32H64C28.66 32 0 60.66 0 96v320c0 35.34 28.66 64 64 64h384c35.34 0 64-28.66 64-64V160C512 124.7 483.3 96 448 96zM464 416c0 8.824-7.18 16-16 16H64c-8.82 0-16-7.176-16-16V96c0-8.824 7.18-16 16-16h117.5c4.273 0 8.289 1.664 11.31 4.688L256 144h192c8.82 0 16 7.176 16 16V416zM336 264H175.1C162.7 264 152 274.7 152 288c0 13.26 10.73 23.1 23.1 23.1h160C349.3 311.1 360 301.3 360 288S349.3 264 336 264z"/></svg>${translate("Remove from folder")}</div>`:""}

  <div role="menuitem" id="add-to-project-conversation-card-button-${s}" class="flex items-center gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" stroke="currentColor" fill="currentColor" width="20" height="20" class="icon"><path d="M448 96h-172.1L226.7 50.75C214.7 38.74 198.5 32 181.5 32H64C28.65 32 0 60.66 0 96v320c0 35.34 28.65 64 64 64h384c35.35 0 64-28.66 64-64V160C512 124.7 483.3 96 448 96zM64 80h117.5c4.273 0 8.293 1.664 11.31 4.688L256 144h192c8.822 0 16 7.176 16 16v32h-416V96C48 87.18 55.18 80 64 80zM448 432H64c-8.822 0-16-7.176-16-16V240h416V416C464 424.8 456.8 432 448 432z"/></svg>${translate("Add to project")} <svg style="transform: rotate(-90deg);" stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="ms-auto h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><polyline points="6 9 12 15 18 9"></polyline></svg></div>

  <div role="menuitem" id="export-conversation-card-button-${s}" class="flex gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" stroke="currentColor" fill="currentColor" stroke-width="2" stroke-linejoin="round" width="20" height="20" class="icon"><path d="M568.1 303l-80-80c-9.375-9.375-24.56-9.375-33.94 0s-9.375 24.56 0 33.94L494.1 296H216C202.8 296 192 306.8 192 320s10.75 24 24 24h278.1l-39.03 39.03C450.3 387.7 448 393.8 448 400s2.344 12.28 7.031 16.97c9.375 9.375 24.56 9.375 33.94 0l80-80C578.3 327.6 578.3 312.4 568.1 303zM360 384c-13.25 0-24 10.74-24 24V448c0 8.836-7.164 16-16 16H64.02c-8.836 0-16-7.164-16-16L48 64.13c0-8.836 7.164-16 16-16h160L224 128c0 17.67 14.33 32 32 32h79.1v72c0 13.25 10.74 24 23.1 24S384 245.3 384 232V138.6c0-16.98-6.742-33.26-18.75-45.26l-74.63-74.64C278.6 6.742 262.3 0 245.4 0H63.1C28.65 0-.002 28.66 0 64l.0065 384c.002 35.34 28.65 64 64 64H320c35.2 0 64-28.8 64-64v-40C384 394.7 373.3 384 360 384z"/></svg>${translate("Export")}</div>

  <div role="menuitem" id="archive-conversation-card-button-${s}" class="flex gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item="">${t.is_archived?`<svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="icon"><path d="M2.66867 14.1665V8.98677C2.23313 8.72481 1.8817 8.32262 1.69113 7.82075L1.61691 7.59419L1.45578 6.99067C1.12249 5.74681 1.86036 4.46753 3.10422 4.13423L13.9714 1.2231L14.2048 1.17329C15.3713 0.984508 16.5144 1.70556 16.8269 2.87153L16.988 3.47505L17.0388 3.70845C17.2153 4.79724 16.5981 5.86547 15.5671 6.25728L15.3396 6.33149L4.47336 9.24263C4.31482 9.28511 4.15541 9.30996 3.99777 9.3188V14.1665C3.99777 15.1799 4.82027 16.0014 5.83371 16.0014H14.1667C15.1801 16.0013 16.0017 15.1799 16.0017 14.1665V8.33345C16.0017 7.96618 16.2994 7.66841 16.6667 7.66841C17.0339 7.66848 17.3318 7.96622 17.3318 8.33345V14.1665C17.3318 15.9144 15.9146 17.3314 14.1667 17.3315H5.83371C4.08573 17.3315 2.66867 15.9144 2.66867 14.1665ZM11.6667 10.1684L11.8005 10.1821C12.1036 10.2441 12.3318 10.5121 12.3318 10.8334C12.3317 11.1548 12.1035 11.4228 11.8005 11.4848L11.6667 11.4985H8.33371C7.96648 11.4985 7.66873 11.2007 7.66867 10.8334C7.66867 10.4662 7.96644 10.1684 8.33371 10.1684H11.6667ZM15.5417 3.21626C15.4075 2.71539 14.9168 2.40477 14.4157 2.48579L14.3152 2.50727L3.44895 5.41938C2.91466 5.56254 2.59693 6.11166 2.73996 6.64595L2.90207 7.24946L2.93332 7.34712C3.11346 7.82184 3.62765 8.09253 4.12863 7.95845L14.9958 5.04634L15.0935 5.01509C15.5364 4.84669 15.8013 4.3872 15.7253 3.91938L15.7038 3.81977L15.5417 3.21626Z"></path></svg>${translate("Unarchive")}`:`<svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="icon" aria-hidden="true"><path d="M11.8008 10.1816C12.1035 10.2438 12.3309 10.5119 12.3311 10.833C12.3311 11.1542 12.1036 11.4222 11.8008 11.4844L11.666 11.498H8.33301C7.96589 11.4979 7.66797 11.2002 7.66797 10.833C7.66814 10.466 7.966 10.1682 8.33301 10.168H11.666L11.8008 10.1816Z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M15.417 2.66797C16.7045 2.66815 17.7489 3.71251 17.749 5V5.83301C17.749 6.33171 17.59 6.79271 17.3232 7.17188C17.3263 7.19763 17.3311 7.22343 17.3311 7.25V12.667C17.3311 13.3559 17.3317 13.9131 17.2949 14.3633C17.2622 14.7639 17.197 15.1246 17.0527 15.4609L16.9863 15.6035C16.7209 16.1245 16.3169 16.5602 15.8213 16.8643L15.6035 16.9863C15.2268 17.1782 14.8202 17.2575 14.3623 17.2949C13.9121 17.3317 13.3549 17.332 12.666 17.332H7.33301C6.64407 17.332 6.08689 17.3317 5.63672 17.2949C5.23627 17.2622 4.87521 17.1979 4.53906 17.0537L4.39648 16.9863C3.8754 16.7208 3.43882 16.3171 3.13477 15.8213L3.0127 15.6035C2.82089 15.227 2.74153 14.821 2.7041 14.3633C2.66732 13.9131 2.66797 13.3559 2.66797 12.667V7.25C2.66797 7.22312 2.67268 7.19694 2.67578 7.1709C2.4096 6.79197 2.25195 6.33115 2.25195 5.83301V5C2.25212 3.7124 3.29634 2.66797 4.58398 2.66797H15.417ZM16.001 8.08789C15.8141 8.13621 15.619 8.16501 15.417 8.16504H4.58398C4.38146 8.16504 4.18541 8.13644 3.99805 8.08789V12.667C3.99805 13.3778 3.99895 13.8714 4.03027 14.2549C4.06097 14.6303 4.11779 14.8421 4.19824 15L4.26855 15.126C4.44482 15.4134 4.69792 15.6478 5 15.8018L5.12988 15.8574C5.27361 15.9089 5.4633 15.9467 5.74512 15.9697C6.12858 16.0011 6.62215 16.002 7.33301 16.002H12.666C13.3767 16.002 13.8705 16.001 14.2539 15.9697C14.6292 15.9391 14.8411 15.8821 14.999 15.8018L15.126 15.7305C15.4132 15.5542 15.6479 15.3019 15.8018 15L15.8574 14.8691C15.9088 14.7255 15.9467 14.5363 15.9697 14.2549C16.0011 13.8714 16.001 13.3779 16.001 12.667V8.08789ZM4.58398 3.99805C4.03088 3.99805 3.5822 4.44693 3.58203 5V5.83301C3.58203 6.38621 4.03078 6.83496 4.58398 6.83496H15.417C15.97 6.83478 16.4189 6.3861 16.4189 5.83301V5C16.4188 4.44705 15.9699 3.99823 15.417 3.99805H4.58398Z"></path></svg>${translate("Archive")}`}</div>

  ${l||o?`<div role="menuitem" id="favorite-conversation-card-button-${s}" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><div class="flex gap-2">${t.is_favorite?`<svg width="20" height="20" class="icon" fill="gold" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M381.2 150.3L524.9 171.5C536.8 173.2 546.8 181.6 550.6 193.1C554.4 204.7 551.3 217.3 542.7 225.9L438.5 328.1L463.1 474.7C465.1 486.7 460.2 498.9 450.2 506C440.3 513.1 427.2 514 416.5 508.3L288.1 439.8L159.8 508.3C149 514 135.9 513.1 126 506C116.1 498.9 111.1 486.7 113.2 474.7L137.8 328.1L33.58 225.9C24.97 217.3 21.91 204.7 25.69 193.1C29.46 181.6 39.43 173.2 51.42 171.5L195 150.3L259.4 17.97C264.7 6.954 275.9-.0391 288.1-.0391C300.4-.0391 311.6 6.954 316.9 17.97L381.2 150.3z"/></svg>${translate("Remove from Favorites")}`:`<svg width="20" height="20" class="icon" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M287.9 0C297.1 0 305.5 5.25 309.5 13.52L378.1 154.8L531.4 177.5C540.4 178.8 547.8 185.1 550.7 193.7C553.5 202.4 551.2 211.9 544.8 218.2L433.6 328.4L459.9 483.9C461.4 492.9 457.7 502.1 450.2 507.4C442.8 512.7 432.1 513.4 424.9 509.1L287.9 435.9L150.1 509.1C142.9 513.4 133.1 512.7 125.6 507.4C118.2 502.1 114.5 492.9 115.1 483.9L142.2 328.4L31.11 218.2C24.65 211.9 22.36 202.4 25.2 193.7C28.03 185.1 35.5 178.8 44.49 177.5L197.7 154.8L266.3 13.52C270.4 5.249 278.7 0 287.9 0L287.9 0zM287.9 78.95L235.4 187.2C231.9 194.3 225.1 199.3 217.3 200.5L98.98 217.9L184.9 303C190.4 308.5 192.9 316.4 191.6 324.1L171.4 443.7L276.6 387.5C283.7 383.7 292.2 383.7 299.2 387.5L404.4 443.7L384.2 324.1C382.9 316.4 385.5 308.5 391 303L476.9 217.9L358.6 200.5C350.7 199.3 343.9 194.3 340.5 187.2L287.9 78.95z"/></svg>${translate("Add to Favorites")}`}</div></div>`:""}


  <div role="menuitem" id="edit-note-conversation-card-button-${s}" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><div class="flex gap-2"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="20" height="20" class="icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.2929 4.29291C15.0641 2.52167 17.9359 2.52167 19.7071 4.2929C21.4783 6.06414 21.4783 8.93588 19.7071 10.7071L18.7073 11.7069L11.1603 19.2539C10.7182 19.696 10.1489 19.989 9.53219 20.0918L4.1644 20.9864C3.84584 21.0395 3.52125 20.9355 3.29289 20.7071C3.06453 20.4788 2.96051 20.1542 3.0136 19.8356L3.90824 14.4678C4.01103 13.8511 4.30396 13.2818 4.7461 12.8397L13.2929 4.29291ZM13 7.41422L6.16031 14.2539C6.01293 14.4013 5.91529 14.591 5.88102 14.7966L5.21655 18.7835L9.20339 18.119C9.40898 18.0847 9.59872 17.9871 9.7461 17.8397L16.5858 11L13 7.41422ZM18 9.5858L14.4142 6.00001L14.7071 5.70712C15.6973 4.71693 17.3027 4.71693 18.2929 5.70712C19.2831 6.69731 19.2831 8.30272 18.2929 9.29291L18 9.5858Z" fill="currentColor"></path></svg>${translate("Edit note")}</div></div>
  
  <div role="menuitem" id="download-images-conversation-card-button-${s}" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><div class="flex gap-2"><svg stroke="currentColor" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="20" height="20" class="icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M7.70711 10.2929C7.31658 9.90237 6.68342 9.90237 6.29289 10.2929C5.90237 10.6834 5.90237 11.3166 6.29289 11.7071L11.2929 16.7071C11.6834 17.0976 12.3166 17.0976 12.7071 16.7071L17.7071 11.7071C18.0976 11.3166 18.0976 10.6834 17.7071 10.2929C17.3166 9.90237 16.6834 9.90237 16.2929 10.2929L13 13.5858L13 4C13 3.44771 12.5523 3 12 3C11.4477 3 11 3.44771 11 4L11 13.5858L7.70711 10.2929ZM5 19C4.44772 19 4 19.4477 4 20C4 20.5523 4.44772 21 5 21H19C19.5523 21 20 20.5523 20 20C20 19.4477 19.5523 19 19 19L5 19Z" fill="currentColor"></path></svg>${translate("Download images")}</div> ${i?"":'<span class="text-white rounded-md bg-green-500 px-2 text-sm">Pro</span>'}</div>

  ${l?"":`<div role="menuitem" id="reference-conversation-card-button-${s}" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><div class="flex gap-2"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="20" height="20" class="icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M18.0322 5.02393C17.7488 5.00078 17.3766 5 16.8 5H11.5002C11.3 6 11.0989 6.91141 10.8903 7.85409C10.7588 8.44955 10.6432 8.97304 10.3675 9.41399C10.1262 9.80009 9.80009 10.1262 9.41399 10.3675C8.97304 10.6432 8.44955 10.7588 7.85409 10.8903C7.81276 10.8994 7.77108 10.9086 7.72906 10.9179L5.21693 11.4762C5.1442 11.4924 5.07155 11.5001 5 11.5002V16.8C5 17.3766 5.00078 17.7488 5.02393 18.0322C5.04612 18.3038 5.0838 18.4045 5.109 18.454C5.20487 18.6422 5.35785 18.7951 5.54601 18.891C5.59546 18.9162 5.69617 18.9539 5.96784 18.9761C6.25118 18.9992 6.62345 19 7.2 19H10C10.5523 19 11 19.4477 11 20C11 20.5523 10.5523 21 10 21H7.16144C6.6343 21 6.17954 21 5.80497 20.9694C5.40963 20.9371 5.01641 20.8658 4.63803 20.673C4.07354 20.3854 3.6146 19.9265 3.32698 19.362C3.13419 18.9836 3.06287 18.5904 3.03057 18.195C2.99997 17.8205 2.99998 17.3657 3 16.8385L3 11C3 8.92477 4.02755 6.93324 5.4804 5.4804C6.93324 4.02755 8.92477 3 11 3L16.8385 3C17.3657 2.99998 17.8205 2.99997 18.195 3.03057C18.5904 3.06287 18.9836 3.13419 19.362 3.32698C19.9265 3.6146 20.3854 4.07354 20.673 4.63803C20.8658 5.01641 20.9371 5.40963 20.9694 5.80497C21 6.17954 21 6.6343 21 7.16144V10C21 10.5523 20.5523 11 20 11C19.4477 11 19 10.5523 19 10V7.2C19 6.62345 18.9992 6.25118 18.9761 5.96784C18.9539 5.69617 18.9162 5.59546 18.891 5.54601C18.7951 5.35785 18.6422 5.20487 18.454 5.109C18.4045 5.0838 18.3038 5.04612 18.0322 5.02393ZM5.28014 9.41336L7.2952 8.96556C8.08861 8.78925 8.24308 8.74089 8.35381 8.67166C8.48251 8.59121 8.59121 8.48251 8.67166 8.35381C8.74089 8.24308 8.78925 8.08861 8.96556 7.2952L9.41336 5.28014C8.51014 5.59289 7.63524 6.15398 6.89461 6.89461C6.15398 7.63524 5.59289 8.51014 5.28014 9.41336ZM17 15C17 14.4477 17.4477 14 18 14C18.5523 14 19 14.4477 19 15V17H21C21.5523 17 22 17.4477 22 18C22 18.5523 21.5523 19 21 19H19V21C19 21.5523 18.5523 22 18 22C17.4477 22 17 21.5523 17 21V19H15C14.4477 19 14 18.5523 14 18C14 17.4477 14.4477 17 15 17H17V15Z" fill="currentColor"></path></svg>${translate("Reference this chat")}</div> ${i?"":'<span class="text-white rounded-md bg-green-500 px-2 text-sm">Pro</span>'}</div>`}

  ${l?`
    <div role="menuitem" id="toggle-conversation-card-button-${s}" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><div class="flex gap-2">${a.state==="expanded"?messageCollapseIcon:messageExpandIcon}${translate(`${a.state==="expanded"?"Collapse":"Expand"} messages`)}</div></div>
  `:""}
  <div role="menuitem" id="delete-conversation-card-button-${s}" class="flex gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group text-red-500" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="20" height="20" class="icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5555 4C10.099 4 9.70052 4.30906 9.58693 4.75114L9.29382 5.8919H14.715L14.4219 4.75114C14.3083 4.30906 13.9098 4 13.4533 4H10.5555ZM16.7799 5.8919L16.3589 4.25342C16.0182 2.92719 14.8226 2 13.4533 2H10.5555C9.18616 2 7.99062 2.92719 7.64985 4.25342L7.22886 5.8919H4C3.44772 5.8919 3 6.33961 3 6.8919C3 7.44418 3.44772 7.8919 4 7.8919H4.10069L5.31544 19.3172C5.47763 20.8427 6.76455 22 8.29863 22H15.7014C17.2354 22 18.5224 20.8427 18.6846 19.3172L19.8993 7.8919H20C20.5523 7.8919 21 7.44418 21 6.8919C21 6.33961 20.5523 5.8919 20 5.8919H16.7799ZM17.888 7.8919H6.11196L7.30423 19.1057C7.3583 19.6142 7.78727 20 8.29863 20H15.7014C16.2127 20 16.6417 19.6142 16.6958 19.1057L17.888 7.8919ZM10 10C10.5523 10 11 10.4477 11 11V16C11 16.5523 10.5523 17 10 17C9.44772 17 9 16.5523 9 16V11C9 10.4477 9.44772 10 10 10ZM14 10C14.5523 10 15 10.4477 15 11V16C15 16.5523 14.5523 17 14 17C13.4477 17 13 16.5523 13 16V11C13 10.4477 13.4477 10 14 10Z" fill="currentColor"></path></svg>${translate("Delete")}</div>
  </div></div>`;document.body.insertAdjacentHTML("beforeend",g),adjustMenuPosition(document.querySelector("#conversation-card-menu")),addConversationManagerCardMenuEventListeners(t,o,l,r),document.querySelector("#conversation-card-menu").addEventListener("mouseleave",()=>{o&&e.classList.replace("flex","hidden")})}function addConversationManagerCardMenuEventListeners(e,t=!1,o=!1,r=!1){const n=e.conversation_id,i=document.querySelector(`#preview-conversation-card-button-${n}`),a=document.querySelector(`#open-conversation-card-button-${n}`),s=document.querySelector(`#rename-conversation-card-button-${n}`),l=document.querySelector(`#share-conversation-card-button-${n}`),d=document.querySelector(`#custom-instruction-profile-conversation-card-button-${n}`),c=document.querySelector(`#move-conversation-card-button-${n}`),u=document.querySelector(`#remove-conversation-card-button-${n}`),m=document.querySelector(`#add-to-project-conversation-card-button-${n}`),g=document.querySelector(`#export-conversation-card-button-${n}`),p=document.querySelector(`#archive-conversation-card-button-${n}`),h=document.querySelector(`#favorite-conversation-card-button-${n}`),f=document.querySelector(`#edit-note-conversation-card-button-${n}`),v=document.querySelector(`#download-images-conversation-card-button-${n}`),x=document.querySelector(`#reference-conversation-card-button-${n}`),y=document.querySelector(`#toggle-conversation-card-button-${n}`),b=document.querySelector(`#delete-conversation-card-button-${n}`);x&&addTooltip(x,{value:"Attach this conversation to the current chat.",position:"right"}),document.querySelectorAll('#conversation-card-menu [role="menuitem"]').forEach(w=>{w.addEventListener("mouseenter",k=>{if(k.target.id.startsWith("add-to-project-conversation-card-button"))return;const S=document.querySelector("#project-list-menu");S&&S.remove()})}),i?.addEventListener("click",w=>{w.stopPropagation(),closeMenus(),updateSelectedConvCard(n,t),showConversationPreviewWrapper(n,null,t)}),a?.addEventListener("click",w=>{w.stopPropagation(),closeMenus(),window.open(`/c/${n}`,"_blank")}),s?.addEventListener("click",w=>{w.stopPropagation(),closeMenus(),handleRenameConversationClick(n,t)}),l?.addEventListener("click",async w=>{w.stopPropagation(),closeMenus(),shareConversation(n)}),d?.addEventListener("click",w=>{w.stopPropagation(),closeMenus(),openConversationCustomInstructionProfile(n)}),c?.addEventListener("click",w=>{if(w.stopPropagation(),closeMenus(),t)openMoveConvToFolderModal([n]);else{const k=document.querySelector(`#conversation-checkbox-${n}`);k&&!k.checked&&k.click(),setTimeout(()=>handleClickMoveConversationsButton(),100)}}),u?.addEventListener("click",w=>{w.stopPropagation(),closeMenus(),resetConversationManagerSelection(),updateConversationFolderCount(null,[n]),document.querySelectorAll(`#conversation-card-${n}`).forEach(k=>{k.remove()}),chrome.runtime.sendMessage({type:"removeConversationsFromFolder",detail:{conversationIds:[n]}},()=>{toast("Conversation removed from folder")})}),m?.addEventListener("click",w=>{w.stopPropagation(),showProjectsList(m,[n],t,r)}),m?.addEventListener("mouseenter",()=>{showProjectsList(m,[n],t,r)}),g?.addEventListener("click",w=>{w.stopPropagation(),closeMenus(),openExportModal([n],o?"current":"selected")}),p?.addEventListener("click",w=>{w.stopPropagation(),closeMenus(),e.is_archived?handleClickUnarchiveConversationsButton([n]):handleClickArchiveConversationsButton([n])}),h?.addEventListener("click",async w=>{w.stopPropagation(),closeMenus();const k=await chrome.runtime.sendMessage({type:"toggleConversationFavorite",forceRefresh:!0,detail:{conversation:e}});getLastSelectedConversationFolder()?.id==="favorites"?k.is_favorite?addConversationToSidebarFolder({...e,is_favorite:k.is_favorite},"favorites"):document.querySelectorAll(`#conversation-card-${n}`).forEach(S=>{S.remove()}):replaceConversationInSidebarFolder({...e,is_favorite:k.is_favorite})}),f?.addEventListener("click",w=>{w.stopPropagation(),closeMenus(),chrome.runtime.sendMessage({type:"getNote",detail:{conversationId:n}},async k=>{let S=document.querySelector(`#conversation-card-${n} #conversation-title`)?.innerText;S||(S=(await getConversationsByIds([n]))[0]?.title),openNotePreviewModal({...k,conversation_id:n,name:S})})}),v?.addEventListener("click",w=>{w.stopPropagation(),closeMenus(),chrome.runtime.sendMessage({type:"checkHasSubscription"},k=>{if(!k){errorUpgradeConfirmation({title:"This is a Pro feature",message:"Downloading conversation images requires a Pro subscription. Upgrade to Pro to remove all limits."});return}const S=document.querySelector(`#conversation-card-settings-button-${n}`);downloadSelectedImages(S,[],n,!w.shiftKey)})}),x?.addEventListener("click",w=>{w.stopPropagation(),closeMenus(),chrome.runtime.sendMessage({type:"checkHasSubscription"},k=>{if(!k){errorUpgradeConfirmation({title:"This is a Pro feature",message:"Referencing conversations in other conversations requires a Pro subscription. Upgrade to Pro to remove all limits."});return}attachConversationToInput(n)})}),y?.addEventListener("click",w=>{w.stopPropagation(),closeMenus();const k=JSON.parse(window.localStorage.getItem("sp/messagesToggleState"))||{convId:e.conversation_id,state:"expanded"},S=k.convId===e.conversation_id&&k.state==="expanded"?"collapsed":"expanded";window.localStorage.setItem("sp/messagesToggleState",JSON.stringify({convId:e.conversation_id,state:S})),document.querySelectorAll("main article [data-message-author-role]").forEach(M=>{S==="collapsed"?M.parentElement.classList.add("bottom-fade-blur"):M.parentElement.classList.remove("bottom-fade-blur")})}),b?.addEventListener("click",w=>{w.stopPropagation(),closeMenus(),handleDeleteConversation(n)})}function handleRenameConversationClick(e,t=!1){let o=!1;closeMenus();const r=document.createElement("input"),n=document.querySelector(`${t?"#sidebar-folder-drawer":"#modal-manager"} #conversation-card-${e} #conversation-title`),i=n.innerText;r.id=`conversation-rename-${e}`,r.classList="border-0 bg-transparent p-0 focus:ring-0 focus-visible:ring-0 w-full",r.value=i,n?.parentElement?.replaceChild(r,n),r.focus(),setTimeout(()=>{r.select()},50),r?.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation(),closeMenus(),r.focus()}),r?.addEventListener("blur",()=>{if(o)return;const a=r.value;a!==i&&updateConversationNameElement(n,e,a),r.parentElement?.replaceChild(n,r)}),r?.addEventListener("keydown",a=>{if(a.key==="Enter"&&a.which===13){o=!0;const s=r.value;s!==i&&updateConversationNameElement(n,e,s),r.parentElement?.replaceChild(n,r)}a.key==="Escape"&&(o=!0,n.innerText=i,r.parentElement?.replaceChild(n,r))})}function updateConversationNameElement(e,t,o){if(!o.trim())return;e.innerText=o,document.querySelectorAll(`#conversation-card-${t} #conversation-title`).forEach(n=>{n.innerText=o});const r=document.querySelector('nav #history div[class*="truncate"]');r&&(r.title=o,r.querySelector("span").innerText=o),getConversationIdFromUrl()===t&&(document.title=o),renameConversation(t,o),renameConversationElements(t,o),chrome.runtime.sendMessage({type:"renameConversation",detail:{conversationId:t,title:o}})}async function openConversationCustomInstructionProfile(e){const t=`<div id="conversation-custom-instruction-profile-modal" class="absolute inset-0" style="z-index: 10000;">
    <div data-state="open" class="fixed inset-0 bg-black/50 dark:bg-black/80" style="pointer-events: auto;">
      <div class="h-full w-full grid grid-cols-[10px_1fr_10px] grid-rows-[minmax(10px,1fr)_auto_minmax(10px,1fr)] md:grid-rows-[minmax(20px,1fr)_auto_minmax(20px,1fr)] overflow-y-auto">
        <div id="conversation-custom-instruction-profile-content" role="dialog" aria-describedby="radix-:r3o:" aria-labelledby="radix-:r3n:" data-state="open" class="popover bg-token-main-surface-primary relative start-1/2 col-auto col-start-2 row-auto row-start-2 h-full w-full text-start ltr:-translate-x-1/2 rtl:translate-x-1/2 rounded-2xl shadow-xl flex flex-col focus:outline-hidden overflow-hidden max-w-lg" tabindex="-1" style="pointer-events: auto;">
          <div class="px-4 pb-4 pt-5 flex items-center justify-between border-b border-token-border-medium">
            <div class="flex">
              <div class="flex items-center">
                <div class="flex grow flex-col gap-1">
                  <h2 as="h3" class="text-lg font-medium leading-6 text-token-text-primary">${translate("Custom instruction profile")}</h2>
                  <div class="text-sm font-medium leading-6 text-token-text-tertiary">See the custom instruction profile used in this convesation</div>
                </div>
              </div>
            </div>
            <div class="flex items-center">
              <button id="conversation-custom-instruction-profile-close-button" class="text-token-text-tertiary hover:text-token-text-primary transition">
                <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="20" width="20"
                  xmlns="http://www.w3.org/2000/svg">
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
              </button>
            </div>
          </div>
          <div id="conversation-custom-instruction-profile-wrapper" class="p-4 overflow-y-auto" style="height:500px;">
            <p class="text-muted pb-3 pt-2 text-sm text-token-text-primary">About you</p>
            <div class="mb-3">
              <textarea readonly id="conversation-custom-instruction-profile-about-user-input" class="w-full rounded-xl bg-token-main-surface-secondary p-4 placeholder:text-gray-500 focus-token-border-heavy border-token-border-medium" rows="5" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:rak:" data-state="closed"></textarea>    
            </div>
            
            <p class="text-muted py-3 text-sm text-token-text-primary">Custom instructions</p>
            <div>
              <textarea readonly id="conversation-custom-instruction-profile-about-model-input" class="w-full rounded-xl bg-token-main-surface-secondary p-4 placeholder:text-gray-500 focus-token-border-heavy border-token-border-medium" rows="5" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:rao:" data-state="closed"></textarea>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>`;document.body.insertAdjacentHTML("beforeend",t),document.querySelector("#conversation-custom-instruction-profile-close-button")?.addEventListener("click",()=>{document.querySelector("#conversation-custom-instruction-profile-modal")?.remove()}),document.querySelector("#conversation-custom-instruction-profile-modal")?.addEventListener("click",s=>{const l=document.querySelector("#conversation-custom-instruction-profile-content");isDescendant(l,s.target)||document.querySelector("#conversation-custom-instruction-profile-modal")?.remove()});const o=await getConversationsByIds([e]);if(!o||o.length===0)return;const r=o[0],n=findValueByKey(r?.mapping,"user_context_message_data");if(!n)return;const i=n?.about_user_message||"",a=n?.about_model_message||"";document.querySelector("#conversation-custom-instruction-profile-about-user-input").value=i,document.querySelector("#conversation-custom-instruction-profile-about-model-input").value=a}async function showProjectsList(e,t,o=!1,r=!1){if(document.querySelector("#project-list-menu"))return;const{showFoldersInLeftSidebar:n}=cachedSettings,{right:i,top:a,left:s}=e.getBoundingClientRect(),l=!n&&o?s-200:i,d=a+16,c=`<div id="project-list-menu" dir="ltr" style="transform:translate3d(${l}px,${d}px,0);position:fixed;left:0;top:0;min-width:max-content;z-index:10001;--radix-popper-anchor-width:18px;--radix-popper-anchor-height:18px;--radix-popper-available-width:1167px;--radix-popper-available-height:604px;--radix-popper-transform-origin:0% 0px"><div data-side="bottom" data-align="start" role="menu" aria-orientation="vertical" data-state="open" data-radix-menu-content="" dir="ltr" aria-labelledby="radix-:r6g:" class="max-w-xs rounded-2xl text-token-text-primary bg-token-main-surface-secondary shadow-long p-1" tabindex="-1" data-orientation="vertical" style="min-width:200px; outline:0;--radix-dropdown-menu-content-transform-origin:var(--radix-popper-transform-origin);--radix-dropdown-menu-content-available-width:var(--radix-popper-available-width);--radix-dropdown-menu-content-available-height:var(--radix-popper-available-height);--radix-dropdown-menu-trigger-width:var(--radix-popper-anchor-width);--radix-dropdown-menu-trigger-height:var(--radix-popper-anchor-height);pointer-events:auto">

  <div id="project-list-wrapper" style="height:400px; overflow-y:auto;">
    <div class="flex items-center justify-center w-full h-full text-sm text-token-text-primary">
      ${loadingSpinner("project-list-wrapper").innerHTML}
    </div>
  </div>

  </div></div>`;document.body.insertAdjacentHTML("beforeend",c),adjustMenuPosition(document.querySelector("#project-list-menu")),fetchProjectList(null,t)}function fetchProjectList(e,t){const o=document.querySelector("#project-list-wrapper");getProjects(e).then(r=>{if(e===null&&r.items.length===0){o.innerHTML=`<div class="flex items-center justify-center w-full h-full text-sm text-token-text-primary">${translate("No projects found")}</div>`;return}e===null&&(o.innerHTML="");const n=document.querySelector("#load-more-projects");if(n&&n.remove(),r.items.forEach(a=>{const{gizmo:s}=a.gizmo,l=s.display.name,d=s.id,c=document.createElement("div");c.classList="flex items-center gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group",c.id=`project-${d}`,c.innerHTML=`
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" stroke="currentColor" fill="currentColor" width="20" height="20" class="icon"><path d="M448 96h-172.1L226.7 50.75C214.7 38.74 198.5 32 181.5 32H64C28.65 32 0 60.66 0 96v320c0 35.34 28.65 64 64 64h384c35.35 0 64-28.66 64-64V160C512 124.7 483.3 96 448 96zM64 80h117.5c4.273 0 8.293 1.664 11.31 4.688L256 144h192c8.822 0 16 7.176 16 16v32h-416V96C48 87.18 55.18 80 64 80zM448 432H64c-8.822 0-16-7.176-16-16V240h416V416C464 424.8 456.8 432 448 432z"/></svg>
      <span class="text-token-text-primary">${l}</span>
      `,c.addEventListener("click",async()=>{resetSidebarConversationSelection();for(const u of t)await addConversationToProject(u,d);toast("Added conversation(s) to project. Refresh to see the changes."),closeMenus()}),o?.appendChild(c)}),r.cursor){const a=document.createElement("div");a.id="load-more-projects",a.classList="flex justify-center items-center gap-2 rounded-xl p-2.5 text-sm cursor-pointer bg-token-main-surface-secondary relative h-10",a.appendChild(loadingSpinner("load-more-projects")),a.addEventListener("click",s=>{s.stopPropagation(),s.preventDefault(),fetchProjectList(r.cursor,t)}),o?.appendChild(a)}const i=document.querySelector("#load-more-projects");if(i){const a=new IntersectionObserver(s=>{s.forEach(l=>{l.isIntersecting&&(fetchProjectList(r.cursor,t),a.disconnect())})},{threshold:.1});a.observe(i)}})}function convMenuBreadcrumb(e=[{name:"All Conversations"}]){let t="Root > ";return e.length===0?"Root > All Conversations":(e.forEach((o,r)=>{t+=o.name,r<e.length-1&&(t+=" > ")}),t)}const HAS_ATTACHMENTS_CACHE=new WeakMap;function conversationHasAttachments(e){try{if(!e||typeof e!="object")return console.warn("Invalid conversation object passed to conversationHasAttachments",typeof e),null;const t=e.update_time||null,o=HAS_ATTACHMENTS_CACHE.get(e);if(o&&o.updateTime===t)return o.hasAttachments;const r=e.mapping;if(!r||typeof r!="object")return null;for(const n in r){if(!Object.prototype.hasOwnProperty.call(r,n))continue;const i=r[n];if(!i||typeof i!="object")continue;const a=i.message;if(!a||typeof a!="object")continue;const s=a.metadata;if(!s||typeof s!="object")continue;const l=s.attachments;if(Array.isArray(l)&&l.length>0)return HAS_ATTACHMENTS_CACHE.set(e,{updateTime:t,hasAttachments:!0}),!0}return HAS_ATTACHMENTS_CACHE.set(e,{updateTime:t,hasAttachments:!1}),!1}catch(t){return console.warn("Unexpected error in conversationHasAttachments",t&&t.message?t.message:String(t),t&&t.stack?t.stack:null),null}}const ATTACHMENTS_CACHE=new WeakMap;function extractConversationAttachments(e){try{if(!e||typeof e!="object")return console.warn("Invalid conversation object passed to extractConversationAttachments",typeof e),[];const t=e.update_time||null,o=ATTACHMENTS_CACHE.get(e);if(o&&o.updateTime===t)return o.attachments;const r=e.mapping;if(!r||typeof r!="object")return[];const n=e.conversation_id||null,i=[];for(const a in r){if(!Object.prototype.hasOwnProperty.call(r,a))continue;const s=r[a];if(!s||typeof s!="object")continue;const l=s.message;if(!l||typeof l!="object")continue;const d=l.metadata;if(!d||typeof d!="object")continue;const c=d.attachments;if(!Array.isArray(c)||c.length===0)continue;const u=l.id||null;for(let m=0;m<c.length;m+=1){const g=c[m];!g||typeof g!="object"||i.push({...g,conversation_id:n,message_id:u})}}return ATTACHMENTS_CACHE.set(e,{updateTime:t,attachments:i}),i}catch(t){return console.warn("Unexpected error in extractConversationAttachments",t&&t.message?t.message:String(t),t&&t.stack?t.stack:null),[]}}async function showConversationManagerSidebarSettingsMenu(e){const{right:t,top:o}=e.getBoundingClientRect(),r=await chrome.runtime.sendMessage({type:"checkHasSubscription"}),n=t+2,i=o-215,a=`<div id="conversation-manager-sidebar-settings-menu" dir="ltr" style="position:fixed;left:0;top:0;transform:translate3d(${n}px,${i}px,0);min-width:max-content;z-index:10001;--radix-popper-anchor-width:18px;--radix-popper-anchor-height:18px;--radix-popper-available-width:1167px;--radix-popper-available-height:604px;--radix-popper-transform-origin:0% 0px"><div data-side="bottom" data-align="start" role="menu" aria-orientation="vertical" data-state="open" data-radix-menu-content="" dir="ltr" aria-labelledby="radix-:r6g:" class="text-token-text-primary mt-2 min-w-[200px] max-w-xs rounded-2xl bg-token-main-surface-secondary shadow-long p-1" tabindex="-1" data-orientation="vertical" style="outline:0;--radix-dropdown-menu-content-transform-origin:var(--radix-popper-transform-origin);--radix-dropdown-menu-content-available-width:var(--radix-popper-available-width);--radix-dropdown-menu-content-available-height:var(--radix-popper-available-height);--radix-dropdown-menu-trigger-width:var(--radix-popper-anchor-width);--radix-dropdown-menu-trigger-height:var(--radix-popper-anchor-height);pointer-events:auto">
  
  <div role="menuitem" id="sort-conversation-folders-button" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item="">${translate("Sort folders")} <svg aria-hidden="true" fill="none" focusable="false" height="1em" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" style="min-width:16px" viewBox="0 0 24 24" width="1em"><path d="m9 18 6-6-6-6"></path></svg></div>

  <div role="menuitem" id="export-all-conversations-button" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item="">${translate("Export all")} ${r?"":'<span class="text-white rounded-md bg-green-500 px-2 text-sm">Pro</span>'}</div>

  <div role="menuitem" id="export-conversations-date-range-button" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item="">${translate("Export by date range")} ${r?"":'<span class="text-white rounded-md bg-green-500 px-2 text-sm">Pro</span>'}</div>

  <div role="menuitem" id="archive-all-conversations-button" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item="">${translate("Archive all")}</div>

  <div role="menuitem" id="delete-all-conversations-button" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm text-token-text-error cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item="">${translate("Delete all")}</div>

  
  </div></div>`;document.body.insertAdjacentHTML("beforeend",a),addConversationManagerSidebarSettingsMenuEventListeners()}function addConversationManagerSidebarSettingsMenuEventListeners(){const e=document.querySelector("#conversation-manager-sidebar-settings-menu"),t=e?.querySelector("#sort-conversation-folders-button"),o=e?.querySelector("#export-all-conversations-button"),r=e?.querySelector("#export-conversations-date-range-button"),n=e?.querySelector("#archive-all-conversations-button"),i=e?.querySelector("#delete-all-conversations-button");t?.addEventListener("mouseenter",()=>{showConversationFolderSortByMenu(e)}),o?.addEventListener("mouseover",()=>{document.querySelector("#conversation-manager-sidebar-settings-sort-menu")?.remove()}),o?.addEventListener("click",()=>{chrome.runtime.sendMessage({type:"checkHasSubscription"},a=>{if(!a){errorUpgradeConfirmation({title:"This is a Pro feature",message:"Exporting all conversations requires a Pro subscription. Upgrade to Pro to remove all limits."});return}e?.remove(),openExportModal([],"all")})}),r?.addEventListener("mouseover",()=>{document.querySelector("#conversation-manager-sidebar-settings-sort-menu")?.remove()}),r?.addEventListener("click",()=>{chrome.runtime.sendMessage({type:"checkHasSubscription"},a=>{if(!a){errorUpgradeConfirmation({title:"This is a Pro feature",message:"Exporting all conversations requires a Pro subscription. Upgrade to Pro to remove all limits."});return}e?.remove(),showDateSelectorDialog("Export Conversations","Select date range","Cancel","Export",null,async(s,l)=>{const d=await getConversationIds(s/1e3,l/1e3);openExportModal(d,"dateRange"),document.querySelector("#date-selector-dialog")?.remove()},"green",!1)})}),n?.addEventListener("mouseover",()=>{document.querySelector("#conversation-manager-sidebar-settings-sort-menu")?.remove()}),n?.addEventListener("click",()=>{e?.remove(),showConfirmDialog("Archive all conversations","Are you sure you want to archive all your conversations?","Cancel","Confirm",null,()=>{document.querySelector("#sidebar-folder-drawer #folder-breadcrumb-root")?.click();const a=document.querySelector("#conversation-manager-conversation-list");a.innerHTML="",a.appendChild(noConversationElement()),resetConversationCounts(),archiveAllConversations(),chrome.runtime.sendMessage({type:"archiveAllConversations"})})}),i?.addEventListener("mouseover",()=>{document.querySelector("#conversation-manager-sidebar-settings-sort-menu")?.remove()}),i?.addEventListener("click",()=>{e?.remove(),showConfirmDialog("Delete all conversations","Are you sure you want to delete all your conversations? This will also delete all conversations in all folders.","Cancel","Confirm",null,()=>{document.querySelector("#sidebar-folder-drawer #folder-breadcrumb-root")?.click();const a=document.querySelector("#conversation-manager-conversation-list");a.innerHTML="",a.appendChild(noConversationElement()),resetConversationCounts(),deleteAllConversations(),chrome.runtime.sendMessage({type:"deleteAllConversations"})})})}function showConversationFolderSortByMenu(e,t=!1,o=!1){const{selectedConversationsManagerFoldersSortBy:r="alphabetical"}=cachedSettings,{left:n,right:i,top:a}=e.getBoundingClientRect(),s=t&&!o?n-200:i+2,l=a-50,d=`<div id="conversation-manager-sidebar-settings-sort-menu" dir="ltr" style="position:fixed;left:0;top:0;transform:translate3d(${s}px,${l}px,0);min-width:max-content;z-index:10001;--radix-popper-anchor-width:18px;--radix-popper-anchor-height:18px;--radix-popper-available-width:1167px;--radix-popper-available-height:604px;--radix-popper-transform-origin:0% 0px"><div data-side="bottom" data-align="start" role="menu" aria-orientation="vertical" data-state="open" data-radix-menu-content="" dir="ltr" aria-labelledby="radix-:r6g:" class="text-token-text-primary mt-2 min-w-[200px] max-w-xs rounded-2xl bg-token-main-surface-secondary shadow-long p-1" tabindex="-1" data-orientation="vertical" style="outline:0;--radix-dropdown-menu-content-transform-origin:var(--radix-popper-transform-origin);--radix-dropdown-menu-content-available-width:var(--radix-popper-available-width);--radix-dropdown-menu-content-available-height:var(--radix-popper-available-height);--radix-dropdown-menu-trigger-width:var(--radix-popper-anchor-width);--radix-dropdown-menu-trigger-height:var(--radix-popper-anchor-height);pointer-events:auto">
  
    <div role="menuitem" id="alphabetical-sort-conversations-button" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item="">${translate("Alphabetical (A\u2192Z)")} ${r==="alphabetical"?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md"><path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path></svg>':""}</div>

    <div role="menuitem" id="alphabetical-reverse-sort-conversations-button" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item="">${translate("Alphabetical (Z\u2192A)")} ${r==="alphabetical-reverse"?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md"><path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path></svg>':""}</div>

    <div role="menuitem" id="create-at-sort-conversations-button" class="flex items-center justify-between rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item="">${translate("Create date")} ${r==="created_at"?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md"><path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path></svg>':""}</div>
    
    <div role="menuitem" id="update-at-sort-conversations-button" class="flex items-center justify-between rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item="">${translate("Update date")} ${r==="updated_at"?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md"><path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path></svg>':""}</div></div></div>`;document.body.insertAdjacentHTML("beforeend",d),addConversationFolderSortByMenuEventListeners()}function addConversationFolderSortByMenuEventListeners(){const e=document.querySelector("#alphabetical-sort-conversations-button"),t=document.querySelector("#alphabetical-reverse-sort-conversations-button"),o=document.querySelector("#create-at-sort-conversations-button"),r=document.querySelector("#update-at-sort-conversations-button");e.addEventListener("click",()=>{chrome.storage.local.set({settings:{...cachedSettings,selectedConversationsManagerFoldersSortBy:"alphabetical"}},()=>{const n=document.querySelector("#conversation-manager-sidebar");n?(n.innerHTML="",n.insertAdjacentElement("beforeend",conversationManagerSidebarContent())):loadSidebarFolders()})}),t.addEventListener("click",()=>{chrome.storage.local.set({settings:{...cachedSettings,selectedConversationsManagerFoldersSortBy:"alphabetical-reverse"}},()=>{const n=document.querySelector("#conversation-manager-sidebar");n?(n.innerHTML="",n.insertAdjacentElement("beforeend",conversationManagerSidebarContent())):loadSidebarFolders()})}),o.addEventListener("click",()=>{chrome.storage.local.set({settings:{...cachedSettings,selectedConversationsManagerFoldersSortBy:"created_at"}},()=>{const n=document.querySelector("#conversation-manager-sidebar");n?(n.innerHTML="",n.insertAdjacentElement("beforeend",conversationManagerSidebarContent())):loadSidebarFolders()})}),r.addEventListener("click",()=>{chrome.storage.local.set({settings:{...cachedSettings,selectedConversationsManagerFoldersSortBy:"updated_at"}},()=>{const n=document.querySelector("#conversation-manager-sidebar");n?(n.innerHTML="",n.insertAdjacentElement("beforeend",conversationManagerSidebarContent())):loadSidebarFolders()})})}let lastSelectedPinnedMessageCardId="";function pinnedMessageManagerModalContent(){lastSelectedPinnedMessageCardId="";const e=document.createElement("div");e.id="modal-content-pinned-message-manager",e.classList="markdown prose-invert relative h-full overflow-hidden",e.style.paddingBottom="59px";const t=document.createElement("div");t.classList="flex items-center justify-between p-2 bg-token-main-surface-primary border-b border-token-border-medium sticky top-0 z-10",e.appendChild(t);const o=document.createElement("input");o.id="pinned-message-manager-search-input",o.type="search",o.placeholder=translate("Search pinned messages"),o.classList="text-token-text-primary bg-token-main-surface-secondary border border-token-border-medium text-sm rounded-md w-full h-10";const r=debounce(()=>{fetchPinnedMessages()});o.addEventListener("input",l=>{l.target.value.trim()!==""?r(l):fetchPinnedMessages();const d=document.querySelector("#pinned-message-manager-search-term-pill"),c=document.querySelector("#pinned-message-manager-search-term-pill-text");l.target.value.trim()!==""?(c.innerText=l.target.value.trim(),d.classList.remove("hidden")):(c.innerText="",d.classList.add("hidden"))}),t.appendChild(o);const n=document.createElement("div");n.id="pinned-message-manager-filters-right-section",n.classList="flex items-center",t.appendChild(n);const i=pinnedMessageCardCompactViewButton();t.appendChild(i);const a=document.createElement("div");a.id="pinned-message-manager-search-term-pill",a.classList="hidden flex items-center justify-center bg-token-main-surface-secondary text-token-text-primary rounded-full p-1 px-2 me-2 mt-2 ms-4 border border-token-border-medium max-w-fit",a.innerHTML='<button id="pinned-message-manager-search-term-pill-clear-button" class="focus-visible:outline-0 hover:bg-token-main-surface-tertiary focus-visible:bg-token-main-surface-tertiary rounded-full mx-1"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="20" width="20" xmlns="http://www.w3.org/2000/svg"> <line x1="18" y1="6" x2="6" y2="18"></line> <line x1="6" y1="6" x2="18" y2="18"></line> </svg></button><span id="pinned-message-manager-search-term-pill-text" class="text-sm mx-1 text-danger"></span>',a.querySelector("#pinned-message-manager-search-term-pill-clear-button").addEventListener("click",()=>{const l=document.querySelector("#pinned-message-manager-search-input");l.value="",l.dispatchEvent(new Event("input"))}),e.appendChild(a);const s=document.createElement("div");return s.id="pinned-message-manager-pinned-message-list",s.classList="grid grid-cols-1 gap-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 p-4 pb-32 overflow-y-auto h-full content-start",e.appendChild(s),e}function pinnedMessageCardCompactViewButton(){const{selectedPinnedMessageView:e}=cachedSettings,t=document.createElement("button");return t.classList="h-full aspect-1 flex items-center justify-center rounded-lg px-2 ms-2 text-token-text-tertiary focus-visible:outline-0 bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary focus-visible:bg-token-main-surface-secondary",t.innerHTML=e==="list"?'<svg fill="currentColor" class="icon icon-md" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M320 192h96c17.6 0 32-14.4 32-32V64c0-17.6-14.4-32-32-32h-96c-17.6 0-32 14.4-32 32v96C288 177.6 302.4 192 320 192zM336 80h64v64h-64V80zM480 256h-160c-17.67 0-32 14.33-32 32v160c0 17.67 14.33 32 32 32h160c17.67 0 32-14.33 32-32V288C512 270.3 497.7 256 480 256zM464 432h-128v-128h128V432zM206.4 335.1L152 394.9V56.02C152 42.76 141.3 32 128 32S104 42.76 104 56.02v338.9l-54.37-58.95c-4.719-5.125-11.16-7.719-17.62-7.719c-5.812 0-11.66 2.094-16.28 6.375c-9.75 8.977-10.34 24.18-1.344 33.94l95.1 104.1c9.062 9.82 26.19 9.82 35.25 0l95.1-104.1c9-9.758 8.406-24.96-1.344-33.94C230.5 325.5 215.3 326.2 206.4 335.1z"/></svg>':'<svg fill="currentColor" class="icon icon-md" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M480 256h-160c-17.67 0-32 14.33-32 32v160c0 17.67 14.33 32 32 32h160c17.67 0 32-14.33 32-32V288C512 270.3 497.7 256 480 256zM464 432h-128v-128h128V432zM320 192h96c17.6 0 32-14.4 32-32V64c0-17.6-14.4-32-32-32h-96c-17.6 0-32 14.4-32 32v96C288 177.6 302.4 192 320 192zM336 80h64v64h-64V80zM145.6 39.37c-9.062-9.82-26.19-9.82-35.25 0L14.38 143.4c-9 9.758-8.406 24.96 1.344 33.94C20.35 181.7 26.19 183.8 32 183.8c6.469 0 12.91-2.594 17.62-7.719L104 117.1v338.9C104 469.2 114.8 480 128 480s24-10.76 24-24.02V117.1l54.37 58.95C215.3 185.8 230.5 186.5 240.3 177.4C250 168.4 250.6 153.2 241.6 143.4L145.6 39.37z"/></svg>',t.addEventListener("click",()=>{document.querySelectorAll('#modal-manager div[id^="pinned-message-card-"]').forEach(o=>{cachedSettings.selectedPinnedMessageView==="list"?(o.classList.remove("aspect-2"),o.classList.add("aspect-1")):(o.classList.remove("aspect-1"),o.classList.add("aspect-2"))}),cachedSettings.selectedPinnedMessageView==="list"?t.innerHTML='<svg fill="currentColor" class="icon icon-md" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M480 256h-160c-17.67 0-32 14.33-32 32v160c0 17.67 14.33 32 32 32h160c17.67 0 32-14.33 32-32V288C512 270.3 497.7 256 480 256zM464 432h-128v-128h128V432zM320 192h96c17.6 0 32-14.4 32-32V64c0-17.6-14.4-32-32-32h-96c-17.6 0-32 14.4-32 32v96C288 177.6 302.4 192 320 192zM336 80h64v64h-64V80zM145.6 39.37c-9.062-9.82-26.19-9.82-35.25 0L14.38 143.4c-9 9.758-8.406 24.96 1.344 33.94C20.35 181.7 26.19 183.8 32 183.8c6.469 0 12.91-2.594 17.62-7.719L104 117.1v338.9C104 469.2 114.8 480 128 480s24-10.76 24-24.02V117.1l54.37 58.95C215.3 185.8 230.5 186.5 240.3 177.4C250 168.4 250.6 153.2 241.6 143.4L145.6 39.37z"/></svg>':t.innerHTML='<svg fill="currentColor" class="icon icon-md" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M320 192h96c17.6 0 32-14.4 32-32V64c0-17.6-14.4-32-32-32h-96c-17.6 0-32 14.4-32 32v96C288 177.6 302.4 192 320 192zM336 80h64v64h-64V80zM480 256h-160c-17.67 0-32 14.33-32 32v160c0 17.67 14.33 32 32 32h160c17.67 0 32-14.33 32-32V288C512 270.3 497.7 256 480 256zM464 432h-128v-128h128V432zM206.4 335.1L152 394.9V56.02C152 42.76 141.3 32 128 32S104 42.76 104 56.02v338.9l-54.37-58.95c-4.719-5.125-11.16-7.719-17.62-7.719c-5.812 0-11.66 2.094-16.28 6.375c-9.75 8.977-10.34 24.18-1.344 33.94l95.1 104.1c9.062 9.82 26.19 9.82 35.25 0l95.1-104.1c9-9.758 8.406-24.96-1.344-33.94C230.5 325.5 215.3 326.2 206.4 335.1z"/></svg>',chrome.storage.local.set({settings:{...cachedSettings,selectedPinnedMessageView:cachedSettings.selectedPinnedMessageView==="list"?"grid":"list"}})}),t}function createPinnedMessageCard(e){const t=document.createElement("div");return t.id=`pinned-message-card-${e.message_id}`,t.dataset.conversationId=e.conversation.conversation_id,t.dataset.messageId=e.message_id,t.classList=`bg-token-main-surface-primary border border-token-border-medium p-4 pb-2 rounded-md cursor-pointer hover:bg-token-main-surface-tertiary ${cachedSettings.selectedPinnedMessageView==="list"?"aspect-2":"aspect-1"} flex flex-col h-auto`,t.style="height: max-content;outline-offset: 4px; outline: none;",t.innerHTML=`<div class="flex items-center justify-between border-b border-token-border-medium pb-1"><div class="text-sm text-token-text-tertiary whitespace-nowrap overflow-hidden text-ellipsis flex items-center w-full">${formatDate(new Date(e.created_at))}</div>
  </div>
  <div class="flex-1 text-token-text-primary text-sm whitespace-wrap overflow-hidden text-ellipsis  break-all">${escapeHTML(e.message.substring(0,250))}</div>

  
  <div class="border-t border-token-border-medium flex justify-between items-center pt-1">
   
    <div class="flex items-center justify-between w-full">
      <a id="pinned-messaged-link-button-${e.id}" href="/c/${e.conversation.conversation_id}?mid=${e.message_id}" target="_self" title="${isWindows()?"Ctrl":"\u2318"} + Click to open in new tab" class="flex relative text-xs rounded-md hover:bg-token-sidebar-surface-tertiary text-token-link focus-visible:outline-0 focus-visible:bg-token-sidebar-surface-secondary no-underline" style="width: max-content;text-decoration-line: none !important; padding: 8px 4px !important;">${translate("open conversation")} </a>

      <div id="pinned-messaged-delete-button-${e.id}" class="relative flex items-center justify-center h-8 rounded-lg px-2 text-token-red focus-visible:outline-0 hover:bg-token-sidebar-surface-tertiary focus-visible:bg-token-sidebar-surface-secondary">
      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md "><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5555 4C10.099 4 9.70052 4.30906 9.58693 4.75114L9.29382 5.8919H14.715L14.4219 4.75114C14.3083 4.30906 13.9098 4 13.4533 4H10.5555ZM16.7799 5.8919L16.3589 4.25342C16.0182 2.92719 14.8226 2 13.4533 2H10.5555C9.18616 2 7.99062 2.92719 7.64985 4.25342L7.22886 5.8919H4C3.44772 5.8919 3 6.33961 3 6.8919C3 7.44418 3.44772 7.8919 4 7.8919H4.10069L5.31544 19.3172C5.47763 20.8427 6.76455 22 8.29863 22H15.7014C17.2354 22 18.5224 20.8427 18.6846 19.3172L19.8993 7.8919H20C20.5523 7.8919 21 7.44418 21 6.8919C21 6.33961 20.5523 5.8919 20 5.8919H16.7799ZM17.888 7.8919H6.11196L7.30423 19.1057C7.3583 19.6142 7.78727 20 8.29863 20H15.7014C16.2127 20 16.6417 19.6142 16.6958 19.1057L17.888 7.8919ZM10 10C10.5523 10 11 10.4477 11 11V16C11 16.5523 10.5523 17 10 17C9.44772 17 9 16.5523 9 16V11C9 10.4477 9.44772 10 10 10ZM14 10C14.5523 10 15 10.4477 15 11V16C15 16.5523 14.5523 17 14 17C13.4477 17 13 16.5523 13 16V11C13 10.4477 13.4477 10 14 10Z" fill="currentColor"></path></svg>
      </div>

    </div>
  </div>`,t?.addEventListener("click",()=>{updateSelectedPinnedMessageCard(e.message_id),showConversationPreviewWrapper(e.conversation.conversation_id,e.message_id)}),t}function updateSelectedPinnedMessageCard(e){if(lastSelectedPinnedMessageCardId){const o=document.querySelector(`#modal-manager #pinned-message-card-${lastSelectedPinnedMessageCardId}`);o&&(o.style.outline="none")}if(!e)return;const t=document.querySelector(`#modal-manager #pinned-message-card-${e}`);lastSelectedPinnedMessageCardId=e,t.style.outline=`2px solid ${isDarkMode()?"#fff":"#000"}`}function addPinnedMessageCardEventListeners(e){const t=document.querySelector(`#pinned-messaged-link-button-${e.id}`),o=document.querySelector(`#pinned-messaged-delete-button-${e.id}`);t?.addEventListener("click",r=>{r.stopPropagation(),closeMenus()}),o?.addEventListener("click",r=>{r.stopPropagation(),closeMenus(),showConfirmDialog("Delete pinned message","Are you sure you want to delete the selected pinned message?","Cancel","Delete",null,async()=>{chrome.runtime.sendMessage({type:"deletePinnedMessage",detail:{messageId:e.message_id}},()=>{document.querySelector(`#pinned-message-card-${e.message_id}`)?.remove();const n=document.querySelector("#modal-manager #pinned-message-manager-pinned-message-list");if(n?.children.length===0){const i=document.createElement("p");i.id="no-pinned-messages-found",i.style="position:absolute;display: flex; justify-content: center; align-items: center; height: 340px; width: 100%;",i.textContent=translate("No pinned messages found"),n.appendChild(i)}})})})}function fetchPinnedMessages(e=1){const t=document.querySelector("#modal-manager #pinned-message-manager-pinned-message-list");if(!t)return;e===1&&(t.innerHTML="",t.appendChild(loadingSpinner("pinned-message-manager-main-content")));const o=document.querySelector("#modal-manager [id=pinned-message-manager-search-input]")?.value;chrome.runtime.sendMessage({type:"getPinnedMessages",detail:{pageNumber:e,searchTerm:o}},async r=>{const n=r.results;if(!n||!Array.isArray(n))return;const i=document.querySelector("#modal-manager #load-more-pinned-messages-button");i&&i.remove();const a=document.querySelector("#modal-manager #loading-spinner-pinned-message-manager-main-content");if(a&&a.remove(),n?.length===0&&e===1){const s=document.createElement("div");s.id="no-pinned-messages-found",s.style="position:absolute;display: flex; justify-content: center; align-items: center; height: 340px; width: 100%;",s.textContent=translate("No pinned messages found"),t.appendChild(s)}else{if(n.forEach(s=>{const l=createPinnedMessageCard(s);t.appendChild(l),addPinnedMessageCardEventListeners(s)}),!await chrome.runtime.sendMessage({type:"checkHasSubscription"})){t.appendChild(managerUpgradeButton("pinned-messages","to see all pinned messages"));return}if(r.next){const s=document.createElement("button");s.id="load-more-pinned-messages-button",s.classList="bg-token-main-surface-secondary p-4 pb-2 rounded-md cursor-pointer hover:bg-token-main-surface-tertiary aspect-1 flex flex-col h-auto relative",s.appendChild(loadingSpinner("load-more-pinned-messages-button")),t.appendChild(s);const l=new IntersectionObserver(d=>{d.forEach(c=>{c.isIntersecting&&fetchPinnedMessages(e+1)})},{threshold:.5});s&&l.observe(s)}}})}const debounceCreatePinButtons=debounce(async(e=!1)=>{await createPinButtons(e)},500);async function createPinButtons(e=!1){const t=document.querySelectorAll('article button[data-testid="pin-message-turn-action-button"]').length,o=document.querySelectorAll('button[data-testid="copy-turn-action-button"]').length,r=getConversationIdFromUrl();if(!r)return;const n=document.querySelectorAll("main article");if(n.length===0)return;const i=await chrome.runtime.sendMessage({type:"getAllPinnedMessagesByConversationId",detail:{conversationId:r}});if(i&&Array.isArray(i)){if(n?.forEach(a=>{a.classList.add("scroll-margin-top-60");const s=a.querySelector("[data-message-id]");if(!s)return;const{messageId:l}=s.dataset;i?.find(d=>d.message_id===l)?(a.classList.add("border-l-pinned","bg-pinned","dark:bg-pinned","border-b"),a.classList.remove("bg-token-main-surface-primary")):(a.classList.add("bg-token-main-surface-primary"),a.classList.remove("border-l-pinned","bg-pinned","dark:bg-pinned","border-b"))}),t===o)if(e)n?.forEach(a=>{a.classList.remove("border-l-pinned","bg-pinned","dark:bg-pinned","border-b"),a.classList.add("bg-token-main-surface-primary")});else return;n?.forEach(a=>{a.classList.add("scroll-margin-top-60");const s=a.querySelector("[data-message-id]");if(!s)return;const{messageId:l}=s.dataset,d=i?.find(c=>c.message_id===l);addPinToArticle(a,l,r,d)})}}function addPinToArticle(e,t,o,r=!1){if(!e||!t)return;const n=e.querySelector('button[data-testid="copy-turn-action-button"]');if(!n)return;const i=e.querySelector('button[data-testid="pin-message-turn-action-button"]');i&&i.remove();const a=`<button class="${n.classList} relative" aria-label="Pin message" data-testid="pin-message-turn-action-button" data-message-id="${t}"><span class="touch:w-[38px] flex h-[30px] w-[30px] items-center justify-center"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" fill="none" class="icon icon-sm"><path fill="${r?"gold":"currentColor"}" d="M336 0h-288C21.49 0 0 21.49 0 48v431.9c0 24.7 26.79 40.08 48.12 27.64L192 423.6l143.9 83.93C357.2 519.1 384 504.6 384 479.9V48C384 21.49 362.5 0 336 0zM336 452L192 368l-144 84V54C48 50.63 50.63 48 53.1 48h276C333.4 48 336 50.63 336 54V452z"></path></svg></span></button>`;n.insertAdjacentHTML("beforebegin",a),n.parentElement.id=`message-actions-${t}`,n.parentElement.style.maskImage="none";const s=e.querySelector('button[data-testid="pin-message-turn-action-button"]');addTooltip(s,{value:"Pin message",position:"bottom"}),addArticlePinButtonEventListener(e,s,t,o)}function addArticlePinButtonEventListener(e,t,o,r){t?.addEventListener("click",async()=>{const n=e.querySelector('button[data-testid="pin-message-turn-action-button"]');if(n.querySelector("svg > path").getAttribute("fill")==="gold"){chrome.runtime.sendMessage({type:"deletePinnedMessage",detail:{messageId:o}});const i=document.querySelector(`#message-actions-${o}`);i&&i.classList.remove("opacity-100"),n.querySelector("svg > path").setAttribute("fill","currentColor"),e.classList.remove("border-l-pinned","bg-pinned","dark:bg-pinned","border-b"),e.classList.add("bg-token-main-surface-primary"),unHighlightMiniMap(o)}else{const i=document.querySelector(`main article [data-message-id="${o}"]`);chrome.runtime.sendMessage({type:"addPinnedMessage",detail:{messageId:o,conversationId:r,message:i.parentElement.innerText}},a=>{if(a.error&&a.error.type==="limit"){errorUpgradeConfirmation(a.error);return}const s=document.querySelector(`#message-actions-${o}`);s&&s.classList.add("opacity-100"),n.querySelector("svg > path").setAttribute("fill","gold"),e.classList.remove("bg-token-main-surface-primary"),e.classList.add("border-l-pinned","bg-pinned","dark:bg-pinned","border-b"),highlightMiniMap(o)})}})}let selectedPromptFolderBreadcrumb=[],lastSelectedPromptCardId="",lastSelectedPromptCheckboxId="";chrome.storage.local.get(["selectedPromptFolderBreadcrumb"],e=>{selectedPromptFolderBreadcrumb=e.selectedPromptFolderBreadcrumb||[]});function getLastSelectedPromptFolder(){return selectedPromptFolderBreadcrumb.length===0?null:selectedPromptFolderBreadcrumb[selectedPromptFolderBreadcrumb.length-1]}function promptBreadcrumbIncludesFolder(e){return selectedPromptFolderBreadcrumb.map(t=>t.id.toString()).some(t=>t===e.toString())}function generatePromptFolderBreadcrumb(e){e.innerHTML="";const t='<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md-heavy me-1"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.29289 18.7071C8.90237 18.3166 8.90237 17.6834 9.29289 17.2929L14.5858 12L9.29289 6.70711C8.90237 6.31658 8.90237 5.68342 9.29289 5.29289C9.68342 4.90237 10.3166 4.90237 10.7071 5.29289L16.7071 11.2929C16.8946 11.4804 17 11.7348 17 12C17 12.2652 16.8946 12.5196 16.7071 12.7071L10.7071 18.7071C10.3166 19.0976 9.68342 19.0976 9.29289 18.7071Z" fill="currentColor"></path></svg>',o=a=>`<svg stroke="currentColor" fill="currentColor" class="icon icon-sm me-1 ${a?"text-token-text-primary":""} group-hover:text-token-text-primary" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M147.8 192H480V144C480 117.5 458.5 96 432 96h-160l-64-64h-160C21.49 32 0 53.49 0 80v328.4l90.54-181.1C101.4 205.6 123.4 192 147.8 192zM543.1 224H147.8C135.7 224 124.6 230.8 119.2 241.7L0 480h447.1c12.12 0 23.2-6.852 28.62-17.69l96-192C583.2 249 567.7 224 543.1 224z"/></svg>`;e.innerHTML+=t;const r=isDefaultPromptFolder(selectedPromptFolderBreadcrumb[0]?.id),n=document.querySelector("#modal-manager #prompt-manager-new-folder-button");r?n&&n.classList.replace("flex","hidden"):n&&n.classList.replace("hidden","flex");const i=selectedPromptFolderBreadcrumb;i.forEach((a,s)=>{const l=document.createElement("span");l.classList="flex items-center text-token-text-tertiary text-sm group";const d=`<span id="folder-breadcrumb-${a.id}" class="me-1 text-nowrap hover:underline cursor-pointer ${s===i.length-1?"text-token-text-primary":"text-token-text-tertiary hover:text-token-text-primary"}" data-folder-id="${a.id}">
      ${isDefaultPromptFolder(a.id)?a.displayName:a.name}
    </span>`;l.innerHTML=`${o(s===i.length-1)}${d}`,s<i.length-1&&(l.innerHTML+=t),e.appendChild(l)})}const defaultPromptFolders=[{id:"recent",name:'<div class="flex items-center"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="icon icon-sm me-2" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg" > <circle cx="12" cy="12" r="10"></circle> <polyline points="12 6 12 12 16 14"></polyline></svg> Recent</div>',displayName:"Recent Prompts"},{id:"favorites",name:'<div class="flex items-center"><svg class="icon icon-sm me-2" fill="gold" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M381.2 150.3L524.9 171.5C536.8 173.2 546.8 181.6 550.6 193.1C554.4 204.7 551.3 217.3 542.7 225.9L438.5 328.1L463.1 474.7C465.1 486.7 460.2 498.9 450.2 506C440.3 513.1 427.2 514 416.5 508.3L288.1 439.8L159.8 508.3C149 514 135.9 513.1 126 506C116.1 498.9 111.1 486.7 113.2 474.7L137.8 328.1L33.58 225.9C24.97 217.3 21.91 204.7 25.69 193.1C29.46 181.6 39.43 173.2 51.42 171.5L195 150.3L259.4 17.97C264.7 6.954 275.9-.0391 288.1-.0391C300.4-.0391 311.6 6.954 316.9 17.97L381.2 150.3z"/></svg> Favorites</div>',displayName:"Favorite Prompts"},{id:"public",name:'<div class="flex items-center"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" stroke="currentColor" fill="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-sm me-2" height="1em" width="1em"><path d="M319.9 320c57.41 0 103.1-46.56 103.1-104c0-57.44-46.54-104-103.1-104c-57.41 0-103.1 46.56-103.1 104C215.9 273.4 262.5 320 319.9 320zM369.9 352H270.1C191.6 352 128 411.7 128 485.3C128 500.1 140.7 512 156.4 512h327.2C499.3 512 512 500.1 512 485.3C512 411.7 448.4 352 369.9 352zM512 160c44.18 0 80-35.82 80-80S556.2 0 512 0c-44.18 0-80 35.82-80 80S467.8 160 512 160zM183.9 216c0-5.449 .9824-10.63 1.609-15.91C174.6 194.1 162.6 192 149.9 192H88.08C39.44 192 0 233.8 0 285.3C0 295.6 7.887 304 17.62 304h199.5C196.7 280.2 183.9 249.7 183.9 216zM128 160c44.18 0 80-35.82 80-80S172.2 0 128 0C83.82 0 48 35.82 48 80S83.82 160 128 160zM551.9 192h-61.84c-12.8 0-24.88 3.037-35.86 8.24C454.8 205.5 455.8 210.6 455.8 216c0 33.71-12.78 64.21-33.16 88h199.7C632.1 304 640 295.6 640 285.3C640 233.8 600.6 192 551.9 192z"/></svg> Public</div>',displayName:"Public Prompts"}];function isDefaultPromptFolder(e){return e?defaultPromptFolders.map(t=>t.id).includes(e.toString()):!1}function promptManagerModalContent(){resetPromptManagerParams();const e=document.createElement("div");e.id="modal-content-prompt-manager",e.style="overflow-y: hidden;position: relative;height:100%; width:100%",e.classList="markdown prose-invert flex";const{managerSidebarWidth:t=220}=cachedSettings,o=document.createElement("div");o.id="prompt-manager-sidebar",o.style=`width:${t}px;min-width:220px;resize:horizontal;overflow:hidden;`,o.classList="bg-token-main-surface-primary border-e border-token-border-medium relative h-full",o.appendChild(promptManagerSidebarContent()),elementResizeObserver(o,"managerSidebarWidth"),e.appendChild(o);const r=document.createElement("div");return r.id="prompt-manager-main-content",r.style=`width:calc(100% - ${t}px)`,r.classList="overflow-y-auto h-full",r.appendChild(promptManagerMainContent()),r.addEventListener("dragover",n=>{if(n.preventDefault(),n.stopPropagation(),!document.querySelector(".folder-dragging"))return;const i=getLastSelectedPromptFolder();isDefaultPromptFolder(i.id)||(event.dataTransfer.dropEffect="move",r.classList.add("prompt-list-drag-hover"))}),r.addEventListener("dragleave",n=>{if(n.preventDefault(),n.stopPropagation(),!document.querySelector(".folder-dragging"))return;const i=getLastSelectedPromptFolder();isDefaultPromptFolder(i.id)||r.classList.remove("prompt-list-drag-hover")}),r.addEventListener("drop",n=>{if(n.preventDefault(),n.stopPropagation(),resetPromptManagerSelection(),!document.querySelector(".folder-dragging"))return;const i=getLastSelectedPromptFolder();if(isDefaultPromptFolder(i.id))return;r.classList.remove("prompt-list-drag-hover");let a;try{a=JSON.parse(n.dataTransfer.getData("text/plain"))}catch(s){console.error("Error parsing dragged data:",s);return}if(a&&a.draggingObject==="folder"){const s=a.folder;if(!s||s.id===i?.id||promptBreadcrumbIncludesFolder(s.id))return;movePromptFolder(s,i.id)}}),e.appendChild(r),e}function promptManagerModalActions(){const e=document.createElement("div");e.classList="flex items-center justify-end w-full mt-2";const t=document.createElement("button");return t.classList="btn composer-submit-btn composer-submit-button-color",t.innerText=translate("plus Add New Prompt"),t.addEventListener("click",()=>{const o=getLastSelectedPromptFolder(),r={title:"",steps:[""],folder:{id:o?.id}};openPromptEditorModal(r)}),e.appendChild(t),e}function promptManagerSidebarContent(){const e=document.createElement("div");e.classList="relative h-full";const t=document.createElement("div");t.classList="text-lg p-4",t.innerText=translate("Categories"),e.appendChild(t);const o=document.createElement("div");o.id="prompt-manager-sidebar-folders",o.classList="px-2 pb-32 overflow-y-auto h-full",o.addEventListener("scroll",()=>{const s=document.querySelector("#modal-manager #prompt-manager-folder-menu");s&&s.remove()}),e.appendChild(o),o.appendChild(defaultPromptFoldersList()),o.appendChild(loadingSpinner("prompt-manager-sidebar"));const{selectedPromptsManagerFoldersSortBy:r="alphabetical"}=cachedSettings;chrome.runtime.sendMessage({type:"getPromptFolders",detail:{sortBy:r}},async s=>{if(!s||!Array.isArray(s))return;const l=document.querySelector("#modal-manager #loading-spinner-prompt-manager-sidebar");l&&l.remove();let d=getLastSelectedPromptFolder();s.length===0?(o.appendChild(noPromptFolderElemet()),(!d||!isDefaultPromptFolder(d?.id?.toString()))&&(selectedPromptFolderBreadcrumb=[defaultPromptFolders[0]],document.querySelector(`#modal-manager #prompt-folder-wrapper-${selectedPromptFolderBreadcrumb[0]?.id}`)?.querySelector('div[id^="selected-prompt-folder-indicator-"]')?.classList?.add("bg-black","dark:bg-white"))):((!d||![...defaultPromptFolders,...s].map(u=>u.id.toString()).includes(selectedPromptFolderBreadcrumb?.[0]?.id?.toString()))&&(selectedPromptFolderBreadcrumb=[s[0]]),s?.forEach((u,m)=>{o.appendChild(promptFolderElement(u,!0,!0))})),d=getLastSelectedPromptFolder(),chrome.storage.local.set({selectedPromptFolderBreadcrumb});const c=document.querySelector("#modal-manager #prompt-manager-breadcrumb");c&&generatePromptFolderBreadcrumb(c),await fetchPrompts(),throttleGetPromptSubFolders(d?.id)});const n=document.createElement("div");n.classList="flex items-center justify-between absolute start-0 bottom-0 w-full bg-token-main-surface-secondary border-t border-token-border-medium px-2 h-10 z-10",e.appendChild(n);const i=document.createElement("button");i.id="prompt-manager-sidebar-settings-button",i.classList="flex items-center justify-center h-8 rounded-lg px-2 text-token-text-tertiary focus-visible:outline-0 hover:bg-token-sidebar-surface-secondary focus-visible:bg-token-sidebar-surface-secondary",i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round" class="icon icon-md" fill="currentColor" viewBox="0 0 448 512"><path d="M0 88C0 74.75 10.75 64 24 64H424C437.3 64 448 74.75 448 88C448 101.3 437.3 112 424 112H24C10.75 112 0 101.3 0 88zM0 248C0 234.7 10.75 224 24 224H424C437.3 224 448 234.7 448 248C448 261.3 437.3 272 424 272H24C10.75 272 0 261.3 0 248zM424 432H24C10.75 432 0 421.3 0 408C0 394.7 10.75 384 24 384H424C437.3 384 448 394.7 448 408C448 421.3 437.3 432 424 432z"/></svg>',i.addEventListener("click",s=>{s.stopPropagation(),s.preventDefault(),closeMenus(),showPromptManagerSidebarSettingsMenu(i)}),n.appendChild(i);const a=document.createElement("button");return a.id="add-prompt-folder-button",a.classList="flex items-center justify-center h-8 rounded-lg px-2 text-token-text-tertiary focus-visible:outline-0 hover:bg-token-sidebar-surface-secondary focus-visible:bg-token-sidebar-surface-secondary",a.innerHTML='<svg stroke="currentColor" fill="currentColor" stroke-width="2" viewBox="0 0 448 512" stroke-linecap="round" stroke-linejoin="round" class="icon icon-md" xmlns="http://www.w3.org/2000/svg"> <path d="M432 256C432 269.3 421.3 280 408 280h-160v160c0 13.25-10.75 24.01-24 24.01S200 453.3 200 440v-160h-160c-13.25 0-24-10.74-24-23.99C16 242.8 26.75 232 40 232h160v-160c0-13.25 10.75-23.99 24-23.99S248 58.75 248 72v160h160C421.3 232 432 242.8 432 256z"> </path> </svg>',addTooltip(a,{value:"Add New Folder",position:"top"}),chrome.runtime.sendMessage({type:"checkHasSubscription"},s=>{a.addEventListener("click",()=>{const l=document.querySelector("#modal-manager #no-prompt-folders");l&&l.remove();const d=document.querySelectorAll('#modal-manager #prompt-manager-sidebar-folders > div[id^="prompt-folder-wrapper-"]');if(!s&&d.length>=5){errorUpgradeConfirmation({type:"limit",title:"You have reached the limit",message:"You have reached the limits of Prompt Categories with free account. Upgrade to Pro to remove all limits."});return}chrome.runtime.sendMessage({type:"addPromptFolders",detail:{folders:[{name:"New Category",color:generateRandomDarkColor()}]}},c=>{if(c.error&&c.error.type==="limit"){errorUpgradeConfirmation(c.error);return}!c||c.length===0||(addNewPromptFolderElementToManagerSidebar(c[0]),document.querySelector(`#modal-manager #prompt-folder-wrapper-${c[0].id}`).click(),handleRenamePromptFolderClick(c[0].id))})})}),n.appendChild(a),e.addEventListener("dragover",s=>{s.preventDefault(),s.stopPropagation(),document.querySelector(".folder-dragging")&&(event.dataTransfer.dropEffect="move",e.classList.add("prompt-sidebar-drag-hover"))}),e.addEventListener("dragleave",s=>{s.preventDefault(),s.stopPropagation(),document.querySelector(".folder-dragging")&&e.classList.remove("prompt-sidebar-drag-hover")}),e.addEventListener("drop",s=>{if(s.preventDefault(),s.stopPropagation(),resetPromptManagerSelection(),!document.querySelector(".folder-dragging"))return;e.classList.remove("prompt-sidebar-drag-hover");let l;try{l=JSON.parse(s.dataTransfer.getData("text/plain"))}catch(d){console.error("Error parsing dragged data:",d);return}if(l&&l.draggingObject==="folder"){const d=l.folder;if(!d||!d.parent_folder)return;movePromptFolder(d,0)}}),e}function addNewPromptFolderElementToManagerSidebar(e){const t=document.querySelector("#modal-manager #prompt-manager-sidebar-folders");t&&(t.appendChild(promptFolderElement(e,!0)),t.scrollTop=t.scrollHeight)}function defaultPromptFoldersList(){const e=document.createElement("div");e.id="default-prompt-folders",e.classList="pb-2 mb-4 border-b border-token-border-medium relative",defaultPromptFolders.forEach(n=>{e.appendChild(promptFolderElement(n,!0))});const{selectedPromptsManagerFoldersSortBy:t="alphabetical"}=cachedSettings,o={alphabetical:"A\u2192Z","alphabetical-reverse":"Z\u2192A",created_at:"Created At",updated_at:"Updated At"},r=document.createElement("button");return r.innerText=`\u21C5 ${o[t]||"A\u2192Z"}`,r.id="conversation-manager-folders-sort-button",r.classList="absolute end-0 ps-2 text-token-text-tertiary hover:text-token-text-primary cursor-pointer bg-token-main-surface-primary",r.style="bottom:-10px; font-size: 12px;",addTooltip(r,{value:"Sort Categories",position:"right"}),r.addEventListener("click",n=>{n.stopPropagation(),n.preventDefault(),showPromptCategorySortByMenu(r)}),e.appendChild(r),e}function promptFolderElement(e,t=!1,o=!1){if(!e)return null;const r=isDefaultPromptFolder(e.id),n=e.id===-1,i=document.createElement("div");i.id=`prompt-folder-wrapper-${e.id}`,i.classList=`relative flex items-center justify-between p-2 ${r?"":"py-1"} cursor-pointer border bg-token-main-surface-secondary border-token-border-medium rounded-md mb-2 group ${n?"opacity-50":""}`,i.style.minHeight="42px",e.color&&(i.style.backgroundColor=e.color),r||(i.draggable=!0);const a=document.createElement("div");a.id=`selected-prompt-folder-indicator-${e.id}`,a.classList=`w-1 h-10 rounded-s-xl absolute ${selectedPromptFolderBreadcrumb[0]?.id?.toString()===e.id.toString()?"bg-black dark:bg-white":""}`,a.style.right="-9px",i.appendChild(a),i.addEventListener("click",p=>{if(p.preventDefault(),p.stopPropagation(),closeMenus(),n){errorUpgradeConfirmation({type:"limit",title:"You have reached the limit",message:"With free account, you can only have up to 5 prompt categories. Upgrade to Pro to remove all limits."});return}const h=getLastSelectedPromptFolder();if(h?.id?.toString()===e.id.toString()&&!p.shiftKey)return;e.parent_folder&&e.parent_folder===h?.id?selectedPromptFolderBreadcrumb.push(e):selectedPromptFolderBreadcrumb=[e];const f=document.querySelector("#modal-manager #prompt-manager-breadcrumb");f&&generatePromptFolderBreadcrumb(f),chrome.storage.local.set({selectedPromptFolderBreadcrumb}),document.querySelectorAll('#modal-manager div[id^="prompt-folder-wrapper-"]').forEach(v=>{v.querySelector('div[id^="selected-prompt-folder-indicator-"]')?.classList.remove("bg-black","dark:bg-white")}),document.querySelector(`#modal-manager #prompt-folder-wrapper-${selectedPromptFolderBreadcrumb[0]?.id}`)?.querySelector('div[id^="selected-prompt-folder-indicator-"]')?.classList?.add("bg-black","dark:bg-white"),resetPromptManagerSelection(),throttleGetPromptSubFolders(e.id,p.shiftKey),fetchPrompts(1,p.shiftKey)}),i.addEventListener("contextmenu",p=>{p.preventDefault(),p.stopPropagation(),document.querySelector(`#prompt-folder-settings-button-${e.id}`)?.click()}),i.addEventListener("dblclick",p=>{p.preventDefault(),p.stopPropagation(),!n&&(r||handleRenamePromptFolderClick(e.id))}),i.addEventListener("mouseenter",()=>{closeMenus(),document.querySelectorAll('div[id^="prompt-folder-settings-button-"]').forEach(h=>{h.classList.replace("flex","hidden")});const p=document.querySelector(`#prompt-folder-name-${e.id}`);p&&(p.style.paddingRight="36px")}),i.addEventListener("mouseleave",()=>{const p=document.querySelector(`#prompt-folder-name-${e.id}`);p&&(p.style.paddingRight="0px")}),i.addEventListener("dragstart",p=>{p.stopPropagation(),p.dataTransfer.setData("text/plain",JSON.stringify({draggingObject:"folder",folder:e})),p.dataTransfer.effectAllowed="move",i.classList.add("folder-dragging")}),i.addEventListener("dragend",p=>{p.stopPropagation(),p.dataTransfer.clearData();try{i.classList.remove("folder-dragging")}catch(h){console.error("Error removing folder-dragging class:",h)}}),i.addEventListener("dragover",p=>{p.preventDefault(),p.stopPropagation(),!n&&(document.querySelector(".folder-dragging")&&isDefaultPromptFolder(e.id)||(event.dataTransfer.dropEffect="move",e.id!=="recent"&&i.classList.add("folder-drag-hover")))}),i.addEventListener("dragleave",p=>{p.preventDefault(),p.stopPropagation(),!n&&e.id!=="recent"&&i.classList.remove("folder-drag-hover")}),i.addEventListener("drop",p=>{if(p.preventDefault(),p.stopPropagation(),resetPromptManagerSelection(),n)return;i.classList.remove("folder-drag-hover");let h;try{h=JSON.parse(p.dataTransfer.getData("text/plain"))}catch(f){console.error("Error parsing dragged data:",f);return}if(h){if(h.draggingObject==="prompt"){const f=h.prompt?.id;if(!f)return;const v=getLastSelectedPromptFolder();if(e.id===v?.id)return;if(e.id==="favorites"){const x=document.querySelector(`#modal-manager #prompt-card-${f}`).querySelector("#modal-manager #prompt-card-favorite");x&&x.querySelector("svg")&&x.querySelector("svg").getAttribute("fill")!=="gold"&&x.click();return}if(e.id==="public"){if(h.prompt?.is_public)return;chrome.runtime.sendMessage({type:"togglePromptPublic",forceRefresh:!0,detail:{promptId:f}},x=>{addOrReplacePromptCard(x.prompt)});return}if(e.id==="recent")return;movePromptToFolder([f],e.id,e.name,e.color)}if(h.draggingObject==="folder"){if(isDefaultPromptFolder(e.id))return;const f=h.folder;if(!f)return;const v=getLastSelectedPromptFolder();if(f.id===v?.id||e.id===f.id)return;movePromptFolder(f,e.id)}}});const s=document.createElement("div");s.classList="flex items-center justify-start w-full h-full";const l=e.image||e.image_url,d=e.image||e.image_url||(r?"":chrome.runtime.getURL("icons/folder.png")),c=document.createElement("img");c.id=`prompt-folder-image-${e.id}`,c.src=d,c.classList=`${l?"w-6 h-6 me-2":"w-5 h-5 me-3"} rounded-md object-cover ${d?"":"hidden"}`,c.style="filter:drop-shadow(0px 0px 1px black);padding-left:1px;",s.appendChild(c);const u=document.createElement("div");u.classList="flex items-center justify-start w-full flex-wrap overflow-hidden",s.appendChild(u);const m=document.createElement("span");if(m.id=`prompt-folder-name-${e.id}`,m.classList=`w-full truncate max-h-5 relative text-sm ${r?"text-token-text-primary":"text-white"}`,m.innerHTML=e.name,u.appendChild(m),!r){const p=document.createElement("span");p.id=`folder-subfolder-count-${e.id}`,p.style="color: rgba(255, 255, 255, 0.6); font-size: 0.7rem;margin-right: 4px;",p.innerText=`${e?.subfolders?.length||0} folder${e?.subfolders?.length===1?"":"s"} -`,u.appendChild(p);const h=document.createElement("span");h.id=`folder-prompt-count-${e.id}`,h.style="color: rgba(255, 255, 255, 0.6); font-size: 0.7rem;",h.innerText=`${e.prompt_count||0} prompt${e.prompt_count!==1?"s":""}`,u.appendChild(h)}i.appendChild(s);const g=document.createElement("div");if(g.id=`prompt-folder-settings-button-${e.id}`,g.classList="absolute end-1 items-center justify-center h-6 rounded-lg px-2 text-token-text-primary focus-visible:outline-0 bg-token-sidebar-surface-secondary focus-visible:bg-token-sidebar-surface-secondary hidden group-hover:flex",g.innerHTML='<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 12C3 10.8954 3.89543 10 5 10C6.10457 10 7 10.8954 7 12C7 13.1046 6.10457 14 5 14C3.89543 14 3 13.1046 3 12ZM10 12C10 10.8954 10.8954 10 12 10C13.1046 10 14 10.8954 14 12C14 13.1046 13.1046 14 12 14C10.8954 14 10 13.1046 10 12ZM17 12C17 10.8954 17.8954 10 19 10C20.1046 10 21 10.8954 21 12C21 13.1046 20.1046 14 19 14C17.8954 14 17 13.1046 17 12Z" fill="currentColor"></path></svg>',g.addEventListener("click",p=>{p.stopPropagation(),p.preventDefault(),closeMenus(),g.classList.replace("hidden","flex"),showPromptManagerFolderMenu(g,e,t,o)}),e.id!=="public"&&!n&&i.appendChild(g),n){const p=document.createElement("div");p.classList="absolute end-1 flex items-center justify-center h-6 rounded-lg px-2",p.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon icon-lg" fill="#ef4146"><path d="M80 192V144C80 64.47 144.5 0 224 0C303.5 0 368 64.47 368 144V192H384C419.3 192 448 220.7 448 256V448C448 483.3 419.3 512 384 512H64C28.65 512 0 483.3 0 448V256C0 220.7 28.65 192 64 192H80zM144 192H304V144C304 99.82 268.2 64 224 64C179.8 64 144 99.82 144 144V192z"/></svg>',i.appendChild(p)}return i}function updatePromptFolderCount(e,t){const o=document.querySelectorAll(`#folder-prompt-count-${e}`);t.forEach(r=>{const n=document.querySelector(`div#prompt-card-${r}[data-folder-id]`);if(n){const i=n.dataset.folderId;if(!i||i===e)return;isDefaultPromptFolder(i)||document.querySelectorAll(`#folder-prompt-count-${i}`).forEach(a=>{const s=parseInt(a.innerText.split(" ")[0],10)-1;a.innerText=`${s} prompt${s!==1?"s":""}`})}e&&(isDefaultPromptFolder(e)||o.forEach(i=>{const a=parseInt(i.innerText.split(" ")[0],10)+1;i.innerText=`${a} prompt${a!==1?"s":""}`}))})}const throttleGetPromptSubFolders=throttle(async(e,t=!1)=>{await getPromptSubFolders(e,t)},500);async function getPromptSubFolders(e,t=!1){if(!e)return;const o=document.querySelector("#modal-manager #prompt-manager-subfolder-list");if(o&&(o.innerHTML=""),isDefaultPromptFolder(e))return;const{selectedPromptsManagerFoldersSortBy:r="alphabetical"}=cachedSettings;chrome.runtime.sendMessage({type:"getPromptFolders",forceRefresh:t,detail:{sortBy:r,parentFolderId:e}},n=>{n&&Array.isArray(n)&&n.length>0&&n.forEach((i,a)=>{o?.appendChild(promptFolderElement(i,!1,!0))})})}function promptCardCompactViewButton(){const{selectedPromptView:e}=cachedSettings,t=document.createElement("button");return t.classList="h-10 aspect-1 flex items-center justify-center rounded-lg px-2 ms-2 text-token-text-tertiary focus-visible:outline-0 bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary focus-visible:bg-token-sidebar-surface-secondary ",t.innerHTML=e==="list"?'<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="icon icon-md" viewBox="0 0 448 512"><path d="M88 32C110.1 32 128 49.91 128 72V120C128 142.1 110.1 160 88 160H40C17.91 160 0 142.1 0 120V72C0 49.91 17.91 32 40 32H88zM88 64H40C35.58 64 32 67.58 32 72V120C32 124.4 35.58 128 40 128H88C92.42 128 96 124.4 96 120V72C96 67.58 92.42 64 88 64zM88 192C110.1 192 128 209.9 128 232V280C128 302.1 110.1 320 88 320H40C17.91 320 0 302.1 0 280V232C0 209.9 17.91 192 40 192H88zM88 224H40C35.58 224 32 227.6 32 232V280C32 284.4 35.58 288 40 288H88C92.42 288 96 284.4 96 280V232C96 227.6 92.42 224 88 224zM0 392C0 369.9 17.91 352 40 352H88C110.1 352 128 369.9 128 392V440C128 462.1 110.1 480 88 480H40C17.91 480 0 462.1 0 440V392zM32 392V440C32 444.4 35.58 448 40 448H88C92.42 448 96 444.4 96 440V392C96 387.6 92.42 384 88 384H40C35.58 384 32 387.6 32 392zM248 32C270.1 32 288 49.91 288 72V120C288 142.1 270.1 160 248 160H200C177.9 160 160 142.1 160 120V72C160 49.91 177.9 32 200 32H248zM248 64H200C195.6 64 192 67.58 192 72V120C192 124.4 195.6 128 200 128H248C252.4 128 256 124.4 256 120V72C256 67.58 252.4 64 248 64zM160 232C160 209.9 177.9 192 200 192H248C270.1 192 288 209.9 288 232V280C288 302.1 270.1 320 248 320H200C177.9 320 160 302.1 160 280V232zM192 232V280C192 284.4 195.6 288 200 288H248C252.4 288 256 284.4 256 280V232C256 227.6 252.4 224 248 224H200C195.6 224 192 227.6 192 232zM248 352C270.1 352 288 369.9 288 392V440C288 462.1 270.1 480 248 480H200C177.9 480 160 462.1 160 440V392C160 369.9 177.9 352 200 352H248zM248 384H200C195.6 384 192 387.6 192 392V440C192 444.4 195.6 448 200 448H248C252.4 448 256 444.4 256 440V392C256 387.6 252.4 384 248 384zM320 72C320 49.91 337.9 32 360 32H408C430.1 32 448 49.91 448 72V120C448 142.1 430.1 160 408 160H360C337.9 160 320 142.1 320 120V72zM352 72V120C352 124.4 355.6 128 360 128H408C412.4 128 416 124.4 416 120V72C416 67.58 412.4 64 408 64H360C355.6 64 352 67.58 352 72zM408 192C430.1 192 448 209.9 448 232V280C448 302.1 430.1 320 408 320H360C337.9 320 320 302.1 320 280V232C320 209.9 337.9 192 360 192H408zM408 224H360C355.6 224 352 227.6 352 232V280C352 284.4 355.6 288 360 288H408C412.4 288 416 284.4 416 280V232C416 227.6 412.4 224 408 224zM320 392C320 369.9 337.9 352 360 352H408C430.1 352 448 369.9 448 392V440C448 462.1 430.1 480 408 480H360C337.9 480 320 462.1 320 440V392zM352 392V440C352 444.4 355.6 448 360 448H408C412.4 448 416 444.4 416 440V392C416 387.6 412.4 384 408 384H360C355.6 384 352 387.6 352 392z"/></svg>':'<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="icon icon-md" viewBox="0 0 512 512"><path d="M16 72C16 58.75 26.75 48 40 48H88C101.3 48 112 58.75 112 72V120C112 133.3 101.3 144 88 144H40C26.75 144 16 133.3 16 120V72zM80 112V80H48V112H80zM496 80C504.8 80 512 87.16 512 96C512 104.8 504.8 112 496 112H176C167.2 112 160 104.8 160 96C160 87.16 167.2 80 176 80H496zM496 240C504.8 240 512 247.2 512 256C512 264.8 504.8 272 496 272H176C167.2 272 160 264.8 160 256C160 247.2 167.2 240 176 240H496zM496 400C504.8 400 512 407.2 512 416C512 424.8 504.8 432 496 432H176C167.2 432 160 424.8 160 416C160 407.2 167.2 400 176 400H496zM88 208C101.3 208 112 218.7 112 232V280C112 293.3 101.3 304 88 304H40C26.75 304 16 293.3 16 280V232C16 218.7 26.75 208 40 208H88zM48 240V272H80V240H48zM16 392C16 378.7 26.75 368 40 368H88C101.3 368 112 378.7 112 392V440C112 453.3 101.3 464 88 464H40C26.75 464 16 453.3 16 440V392zM80 432V400H48V432H80z"/></svg>',t.addEventListener("click",()=>{const o=document.querySelector("#modal-manager #prompt-manager-prompt-list");o.classList=`grid ${cachedSettings.selectedPromptView!=="list"?"grid-cols-1 gap-2":"grid-cols-1 sm:grid-cols-2 gap-2 lg:grid-cols-3 xl:grid-cols-4"} w-full content-start`,cachedSettings.selectedPromptView==="list"?t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="icon icon-md" viewBox="0 0 512 512"><path d="M16 72C16 58.75 26.75 48 40 48H88C101.3 48 112 58.75 112 72V120C112 133.3 101.3 144 88 144H40C26.75 144 16 133.3 16 120V72zM80 112V80H48V112H80zM496 80C504.8 80 512 87.16 512 96C512 104.8 504.8 112 496 112H176C167.2 112 160 104.8 160 96C160 87.16 167.2 80 176 80H496zM496 240C504.8 240 512 247.2 512 256C512 264.8 504.8 272 496 272H176C167.2 272 160 264.8 160 256C160 247.2 167.2 240 176 240H496zM496 400C504.8 400 512 407.2 512 416C512 424.8 504.8 432 496 432H176C167.2 432 160 424.8 160 416C160 407.2 167.2 400 176 400H496zM88 208C101.3 208 112 218.7 112 232V280C112 293.3 101.3 304 88 304H40C26.75 304 16 293.3 16 280V232C16 218.7 26.75 208 40 208H88zM48 240V272H80V240H48zM16 392C16 378.7 26.75 368 40 368H88C101.3 368 112 378.7 112 392V440C112 453.3 101.3 464 88 464H40C26.75 464 16 453.3 16 440V392zM80 432V400H48V432H80z"/></svg>':t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="icon icon-md" viewBox="0 0 448 512"><path d="M88 32C110.1 32 128 49.91 128 72V120C128 142.1 110.1 160 88 160H40C17.91 160 0 142.1 0 120V72C0 49.91 17.91 32 40 32H88zM88 64H40C35.58 64 32 67.58 32 72V120C32 124.4 35.58 128 40 128H88C92.42 128 96 124.4 96 120V72C96 67.58 92.42 64 88 64zM88 192C110.1 192 128 209.9 128 232V280C128 302.1 110.1 320 88 320H40C17.91 320 0 302.1 0 280V232C0 209.9 17.91 192 40 192H88zM88 224H40C35.58 224 32 227.6 32 232V280C32 284.4 35.58 288 40 288H88C92.42 288 96 284.4 96 280V232C96 227.6 92.42 224 88 224zM0 392C0 369.9 17.91 352 40 352H88C110.1 352 128 369.9 128 392V440C128 462.1 110.1 480 88 480H40C17.91 480 0 462.1 0 440V392zM32 392V440C32 444.4 35.58 448 40 448H88C92.42 448 96 444.4 96 440V392C96 387.6 92.42 384 88 384H40C35.58 384 32 387.6 32 392zM248 32C270.1 32 288 49.91 288 72V120C288 142.1 270.1 160 248 160H200C177.9 160 160 142.1 160 120V72C160 49.91 177.9 32 200 32H248zM248 64H200C195.6 64 192 67.58 192 72V120C192 124.4 195.6 128 200 128H248C252.4 128 256 124.4 256 120V72C256 67.58 252.4 64 248 64zM160 232C160 209.9 177.9 192 200 192H248C270.1 192 288 209.9 288 232V280C288 302.1 270.1 320 248 320H200C177.9 320 160 302.1 160 280V232zM192 232V280C192 284.4 195.6 288 200 288H248C252.4 288 256 284.4 256 280V232C256 227.6 252.4 224 248 224H200C195.6 224 192 227.6 192 232zM248 352C270.1 352 288 369.9 288 392V440C288 462.1 270.1 480 248 480H200C177.9 480 160 462.1 160 440V392C160 369.9 177.9 352 200 352H248zM248 384H200C195.6 384 192 387.6 192 392V440C192 444.4 195.6 448 200 448H248C252.4 448 256 444.4 256 440V392C256 387.6 252.4 384 248 384zM320 72C320 49.91 337.9 32 360 32H408C430.1 32 448 49.91 448 72V120C448 142.1 430.1 160 408 160H360C337.9 160 320 142.1 320 120V72zM352 72V120C352 124.4 355.6 128 360 128H408C412.4 128 416 124.4 416 120V72C416 67.58 412.4 64 408 64H360C355.6 64 352 67.58 352 72zM408 192C430.1 192 448 209.9 448 232V280C448 302.1 430.1 320 408 320H360C337.9 320 320 302.1 320 280V232C320 209.9 337.9 192 360 192H408zM408 224H360C355.6 224 352 227.6 352 232V280C352 284.4 355.6 288 360 288H408C412.4 288 416 284.4 416 280V232C416 227.6 412.4 224 408 224zM320 392C320 369.9 337.9 352 360 352H408C430.1 352 448 369.9 448 392V440C448 462.1 430.1 480 408 480H360C337.9 480 320 462.1 320 440V392zM352 392V440C352 444.4 355.6 448 360 448H408C412.4 448 416 444.4 416 440V392C416 387.6 412.4 384 408 384H360C355.6 384 352 387.6 352 392z"/></svg>',chrome.storage.local.set({settings:{...cachedSettings,selectedPromptView:cachedSettings.selectedPromptView==="list"?"grid":"list"}},()=>{fetchPrompts()})}),t}function promptManagerMainContent(){const e=getLastSelectedPromptFolder(),t=isDefaultPromptFolder(selectedPromptFolderBreadcrumb[0]?.id),o=document.createElement("div");o.id="prompt-manager-content-wrapper",o.classList="relative h-full overflow-hidden",o.style.paddingBottom="59px";const r=document.createElement("div");r.classList="flex items-center justify-between p-2 bg-token-main-surface-primary border-b border-token-border-medium sticky top-0 z-10",o.appendChild(r);const n=document.createElement("input");n.id="prompt-manager-search-input",n.type="search",n.placeholder=translate("Search prompts"),n.classList="w-full p-2 rounded-md border border-token-border-medium bg-token-main-surface-secondary text-token-text-tertiary";const i=debounce(()=>{fetchPrompts()});n.addEventListener("input",E=>{if(E.target.value.trim().length>0){const L=document.querySelector("#modal-manager #prompt-manager-prompt-list");L&&(L.innerHTML="",L.appendChild(loadingSpinner("prompt-manager-main-content"))),i(E)}else fetchPrompts();const C=document.querySelector("#prompt-manager-search-term-pill-text");E.target.value.trim().length>0?(C.innerText=E.target.value.trim(),document.querySelector("#prompt-manager-search-term-pill").classList.remove("hidden")):(C.innerText="",document.querySelector("#prompt-manager-search-term-pill").classList.add("hidden"))}),r.appendChild(n);const a=document.createElement("div");a.id="prompt-manager-filters-right-section",a.classList=`flex items-center ${e?.id==="recent"?"hidden":""}`,r.appendChild(a);const{selectedPromptsManagerSortBy:s={name:"Update date",code:"updated_at"},selectedPromptsManagerTag:l={name:"All",code:"all"},selectedPromptsManagerLanguage:d={name:"All",code:"all"}}=cachedSettings,c=document.createElement("div");if(c.id="prompt-manager-sort-by-wrapper",c.style="position:relative;width:150px;z-index:1000;margin-left:8px;",c.innerHTML=dropdown("Prompts-Manager-SortBy",promptsSortByList,s,"code","right"),a.appendChild(c),e?.id!=="public"){const E=document.querySelector("#modal-manager #prompts-manager-sortby-selector-option-vote");E&&E.classList.add("hidden");const C=document.querySelector("#modal-manager #prompts-manager-sortby-selector-option-use");C&&C.classList.add("hidden")}const u=document.createElement("div");u.id="prompt-manager-tag-selector-wrapper",u.style="position:relative;width:150px;z-index:1000;margin-left:8px;",a.appendChild(u),chrome.runtime.sendMessage({type:"getPromptTags"},E=>{E&&Array.isArray(E)&&(E.sort((C,L)=>C.name.localeCompare(L.name)),E?.unshift({id:"all",name:"All"}),u.innerHTML=dropdown("Prompts-Manager-Tag",E,l,"id","right"),addDropdownEventListener("Prompts-Manager-Tag",E,"id",()=>fetchPrompts()))});const m=[{code:"all",name:"All"},...languageList.slice(1)],g=document.createElement("div");g.id="prompt-manager-language-selector-wrapper",g.style="position:relative;width:150px;z-index:1000;margin-left:8px;",g.innerHTML=dropdown("Prompts-Manager-Language",m,d,"code","right"),a.appendChild(g);const p=promptCardCompactViewButton();r.appendChild(p);const h=document.createElement("div");h.id="prompt-manager-selection-bar",h.classList="flex items-center justify-end px-2 py-3 hidden sticky top-0 bg-token-main-surface-primary z-10",o.appendChild(h);const f=document.createElement("button");f.id="prompt-manager-selection-cancel-button",f.classList="flex items-center justify-center h-8 rounded-lg px-2 text-token-text-primary focus-visible:outline-0 bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary focus-visible:bg-token-main-surface-tertiary ms-2 me-auto border border-token-border-medium",f.innerText=translate("Cancel"),f.addEventListener("click",()=>{resetPromptManagerSelection()}),h.appendChild(f);const v=document.createElement("span");v.id="prompt-manager-selection-count",v.classList="text-token-text-tertiary text-xs me-4",v.innerText="0 selected",h.appendChild(v);const x=document.createElement("button");x.classList="flex items-center justify-center h-8 rounded-lg px-2 text-token-text-primary focus-visible:outline-0 bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary focus-visible:bg-token-main-surface-tertiary me-2 border border-token-border-medium",x.innerText=translate("Delete"),x.addEventListener("click",()=>{const E=Array.from(document.querySelectorAll('#modal-manager input[id^="prompt-checkbox-"]:checked'));E.length!==0&&showConfirmDialog("Delete prompts","Are you sure you want to delete the selected prompts?","Cancel","Delete",null,()=>{const C=getLastSelectedPromptFolder();resetPromptManagerSelection();const L=E.map(T=>T.id.split("prompt-checkbox-")[1]);updatePromptFolderCount(null,L),L.forEach(T=>{const z=document.querySelector(`#modal-manager #prompt-card-${T}`);z&&z.remove()});const _=document.querySelector("#modal-manager #prompt-manager-prompt-list");if(_.children.length===0&&_.appendChild(noPromptElement()),C?.id==="recent"){chrome.storage.local.get(["userInputValueHistory"],T=>{const z=T.userInputValueHistory.filter(B=>!L.includes(B.id));chrome.storage.local.set({userInputValueHistory:z})});return}chrome.runtime.sendMessage({type:"deletePrompts",detail:{promptIds:L}},async()=>{initializeContinueButton(!0)})})}),h.appendChild(x);const y=document.createElement("div");y.id="prompt-manager-folder-content-wrapper",y.classList="bg-token-sidebar-surface-primary flex flex-wrap h-full overflow-y-auto p-4 pb-32 content-start",o.appendChild(y);const b=document.createElement("button");b.id="prompt-manager-move-button",b.classList=`flex items-center justify-center h-8 rounded-lg px-2 text-token-text-primary focus-visible:outline-0 bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary focus-visible:bg-token-main-surface-tertiary me-2 border border-token-border-medium ${t?"hidden":""}`,b.innerText=translate("Move"),b.addEventListener("click",()=>{handleClickMovePromptsButton()}),h.appendChild(b);const w=document.createElement("div");w.id="prompt-manager-header",w.classList="flex items-center justify-between mb-4 w-full",y.appendChild(w);const k=document.createElement("div");k.id="prompt-manager-breadcrumb",k.classList="flex items-center justify-start bg-token-main-surface-secondary p-2 rounded-lg border border-token-border-medium overflow-x-auto",k.style.maxWidth="calc(100% - 48px)",k.addEventListener("click",E=>{if(E.target&&E.target.matches("[data-folder-id]")){const C=E.target.getAttribute("data-folder-id"),L=selectedPromptFolderBreadcrumb.findIndex(_=>_.id.toString()===C.toString());L!==-1&&(L<selectedPromptFolderBreadcrumb.length-1||E.shiftKey)&&(resetPromptManagerSelection(),selectedPromptFolderBreadcrumb=selectedPromptFolderBreadcrumb.slice(0,L+1),chrome.storage.local.set({selectedPromptFolderBreadcrumb}),generatePromptFolderBreadcrumb(k),throttleGetPromptSubFolders(C,E.shiftKey),fetchPrompts(1,E.shiftKey))}}),w.appendChild(k);const S=document.createElement("button");S.id="prompt-manager-new-folder-button",S.classList=`${t?"hidden":"flex"} items-center justify-center h-full rounded-lg p-2 ms-2 text-token-text-tertiary focus-visible:outline-0 hover:bg-token-sidebar-surface-secondary focus-visible:bg-token-sidebar-surface-secondary`,S.innerHTML='<svg stroke="currentColor" fill="currentColor" class="icon icon-lg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M464 96h-192l-64-64h-160C21.5 32 0 53.5 0 80v352C0 458.5 21.5 480 48 480h416c26.5 0 48-21.5 48-48v-288C512 117.5 490.5 96 464 96zM336 311.1h-56v56C279.1 381.3 269.3 392 256 392c-13.27 0-23.1-10.74-23.1-23.1V311.1H175.1C162.7 311.1 152 301.3 152 288c0-13.26 10.74-23.1 23.1-23.1h56V207.1C232 194.7 242.7 184 256 184s23.1 10.74 23.1 23.1V264h56C349.3 264 360 274.7 360 288S349.3 311.1 336 311.1z"/></svg>',addTooltip(S,{value:"Add New Folder",position:"top"}),chrome.runtime.sendMessage({type:"checkHasSubscription"},E=>{S.addEventListener("click",()=>{const C=getLastSelectedPromptFolder();if(C&&isDefaultPromptFolder(C.id)){toast("You cannot add a folder to this folder.","error");return}const L=document.querySelectorAll('#modal-manager #prompt-manager-sidebar-folders > div[id^="prompt-folder-wrapper-"]');if(!E&&L.length>=5){errorUpgradeConfirmation({type:"limit",title:"You have reached the limit",message:"You have reached the limits of Prompt Folders with free account. Upgrade to Pro to remove all limits."});return}document.querySelectorAll("#no-prompt-folders").forEach(T=>T.remove());const _={name:"New Category",color:generateRandomDarkColor()};C&&(_.color=C.color,_.parent_folder=C.id,_.image_url=C.image||C.image_url),chrome.runtime.sendMessage({type:"addPromptFolders",detail:{folders:[_]}},T=>{if(T.error&&T.error.type==="limit"){errorUpgradeConfirmation(T.error);return}if(!T||T.length===0)return;const z=document.querySelector("#prompt-manager-subfolder-list");z?.prepend(promptFolderElement(T[0],!1)),z?.scrollIntoView({block:"nearest",inline:"nearest"}),document.querySelectorAll(`#folder-subfolder-count-${C?.id}`).forEach(B=>{const F=parseInt(B.innerText.split(" ")[0],10);B.innerText=`${F+1} folder${F+1===1?"":"s"} -`}),handleRenamePromptFolderClick(T[0].id)})})}),w.appendChild(S);const M=document.createElement("div");M.id="prompt-manager-search-term-pill",M.classList="hidden flex items-center justify-center bg-token-main-surface-secondary text-token-text-primary rounded-full p-1 px-2 me-2 border border-token-border-medium",M.innerHTML='<button id="prompt-manager-search-term-pill-clear-button" class="focus-visible:outline-0 hover:bg-token-main-surface-tertiary focus-visible:bg-token-main-surface-tertiary rounded-full mx-1"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="20" width="20" xmlns="http://www.w3.org/2000/svg"> <line x1="18" y1="6" x2="6" y2="18"></line> <line x1="6" y1="6" x2="18" y2="18"></line> </svg></button><span id="prompt-manager-search-term-pill-text" class="text-sm mx-1 text-danger"></span>',M.querySelector("#prompt-manager-search-term-pill-clear-button").addEventListener("click",()=>{const E=document.querySelector("#prompt-manager-search-input");E.value="",E.dispatchEvent(new Event("input"))}),y.appendChild(M);const $=document.createElement("div");$.id="prompt-manager-subfolder-list",$.classList="grid grid-cols-1 sm:grid-cols-2 gap-2 lg:grid-cols-3 xl:grid-cols-4 content-start w-full mb-2",y.appendChild($);const q=document.createElement("div");return q.id="prompt-manager-prompt-list",y.appendChild(q),q.classList=`grid ${cachedSettings.selectedPromptView==="list"?"grid-cols-1 gap-2":"grid-cols-1 sm:grid-cols-2 gap-2 lg:grid-cols-3 xl:grid-cols-4"} content-start w-full`,o}function handleClickMovePromptsButton(){const e=Array.from(document.querySelectorAll('#modal-manager input[id^="prompt-checkbox-"]:checked'));if(e.length===0)return;const t=e.map(o=>o.dataset.promptId);openMovePromptToFolderModal(t)}function resetPromptManagerParams(){lastSelectedPromptCardId="",lastSelectedPromptCheckboxId=""}function resetPromptManagerSelection(){lastSelectedPromptCheckboxId="";const e=getLastSelectedPromptFolder(),t=document.querySelector('#modal-manager input[placeholder="Search prompts"]');t&&(t.value="");const o=document.querySelector("#prompt-manager-search-term-pill-text");o&&(o.innerText="");const r=document.querySelector("#prompt-manager-search-term-pill");r&&r.classList.add("hidden");const n=document.querySelector("#modal-manager #prompt-manager-filters-right-section");n&&(e?.id==="recent"?n.classList.add("hidden"):n.classList.remove("hidden"));const i=document.querySelector("#modal-manager #prompts-manager-sortby-selector-option-vote"),a=document.querySelector("#modal-manager #prompts-manager-sortby-selector-option-use");e?.id!=="public"?(i&&i.classList.add("hidden"),a&&a.classList.add("hidden")):(i&&i.classList.remove("hidden"),a&&a.classList.remove("hidden"));const s=document.querySelector("#modal-manager #prompt-card-menu");s&&s.remove();const l=document.querySelector('#modal-manager div[id="prompt-manager-selection-bar"]');l&&l.classList.add("hidden");const d=document.querySelector('#modal-manager div[id="prompt-manager-content-wrapper"]');d&&(d.style.paddingBottom="59px");const c=document.querySelector('#modal-manager button[id="prompt-manager-move-button"]');c&&(defaultPromptFolders.map(m=>m.id).includes(e?.id)?c.classList.add("hidden"):c.classList.remove("hidden")),document.querySelectorAll('#modal-manager input[id^="prompt-checkbox-"]').forEach(m=>{m.checked=!1});const u=document.querySelector('#modal-manager span[id="prompt-manager-selection-count"]');u&&(u.innerText="0 selected")}async function fetchPrompts(e=1,t=!1){const o=getLastSelectedPromptFolder();if(!o)return;const r=document.querySelector("#modal-manager #prompt-manager-prompt-list");if(!r)return;if(e===1&&(r.innerHTML="",r.appendChild(loadingSpinner("prompt-manager-main-content"))),o?.id==="recent"){loadRecentPrompts();return}const{selectedPromptsManagerSortBy:n={name:"Update date",code:"updated_at"},selectedPromptsManagerTag:i={name:"All",code:"all"},selectedPromptsManagerLanguage:a={name:"All",code:"all"}}=cachedSettings,s=o?.id!=="public"&&["vote","use"].includes(n?.code)?"created_at":n?.code;if(s!==n?.code){const d=document.querySelector("#modal-manager #selected-prompts-manager-sortby-title");d.textContent="Create date";const c=document.querySelector("#modal-manager #prompts-manager-sortby-selector-option-created_at"),u=document.querySelector("#modal-manager #prompts-manager-sortby-selector-checkmark");u?(u.remove(),c.appendChild(u)):c.insertAdjacentHTML("beforeend",`<span id="prompts-manager-sortby-selector-checkmark" class="absolute inset-y-0 end-0 flex items-center pe-4 text-token-text-primary">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md"><path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path></svg>
        </span>`),chrome.storage.local.set({settings:{...cachedSettings,selectedPromptsManagerSortBy:{code:"created_at",name:"Create date"}}})}const l=document.querySelector('#modal-manager input[id="prompt-manager-search-input"]')?.value;chrome.runtime.sendMessage({type:"getPrompts",forceRefresh:t,detail:{pageNumber:e,searchTerm:l,sortBy:s,language:a?.code,tag:i.id,folderId:typeof o?.id=="string"?null:o?.id,isPublic:o?.id==="public",isFavorite:o?.id==="favorites",deepSearch:!0}},d=>{const c=d?.results;if(!c)return;const u=document.querySelector("#modal-manager #load-more-prompts-button");u&&u.remove();const m=document.querySelector("#modal-manager #loading-spinner-prompt-manager-main-content");if(m&&m.remove(),c.length===0&&e===1)r.appendChild(noPromptElement());else if(c.forEach(g=>{const p=createPromptCard(g);r.appendChild(p),addPromptCardEventListeners(p,g)}),d.next){const g=document.createElement("button");g.id="load-more-prompts-button",g.classList=`bg-token-main-surface-secondary p-4 pb-2 rounded-md cursor-pointer hover:bg-token-main-surface-tertiary ${cachedSettings.selectedPromptView==="list"?"h-14":"h-auto aspect-1.5"} flex flex-col relative`,g.appendChild(loadingSpinner("load-more-prompts-button")),r.appendChild(g);const p=new IntersectionObserver(h=>{h.forEach(f=>{f.isIntersecting&&fetchPrompts(e+1,t)})},{threshold:.5});g&&p.observe(g)}})}function loadRecentPrompts(){const e=document.querySelector("#modal-manager #loading-spinner-prompt-manager-main-content");e&&e.remove();const t=document.querySelector("#modal-manager #prompt-manager-prompt-list");chrome.storage.local.get(["userInputValueHistory"],o=>{const{userInputValueHistory:r=[]}=o;if(r.length===0){t.innerHTML="No recent prompts found";return}t.innerHTML="";const n=document.querySelector('#modal-manager input[id="prompt-manager-search-input"]')?.value;r.sort((i,a)=>a.timestamp-i.timestamp).forEach(i=>{if(n&&!i.inputValue.toLowerCase().includes(n.toLowerCase()))return;const a={id:i.id||self.crypto.randomUUID(),title:new Date(i.timestamp).toLocaleString(),steps:[i.inputValue],tags:[],is_favorite:!1,folder:{id:"recent"}},s=createPromptCard(a);t.appendChild(s),addPromptCardEventListeners(s,a)})})}function promptListView(e){if(!e)return"";const t=getLastSelectedPromptFolder(),o=document.querySelector('#modal-manager input[id="prompt-manager-search-input"]')?.value;return`<div class="flex items-center justify-between pb-1">
  ${e.is_mine||t?.id==="recent"?`<input id="prompt-checkbox-${e.id}" type="checkbox" data-prompt-id="${e.id}" id="checkbox" class="manager-modal border border-token-border-medium me-2" style="cursor: pointer; border-radius: 2px;">`:""}
  <div class="${e.folder?.id==="recent"?"text-xs text-token-text-tertiary":"text-md text-token-text-primary"} truncate flex items-center w-full">${o&&e.folder?.id!=="recent"?`<div class="flex items-center border border-token-border-medium rounded-md px-1 text-xs font-normal overflow-hidden hover:w-fit-sp w-auto min-w-5 max-w-5"><svg stroke="currentColor" fill="currentColor" class="icon icon-xs me-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M147.8 192H480V144C480 117.5 458.5 96 432 96h-160l-64-64h-160C21.49 32 0 53.49 0 80v328.4l90.54-181.1C101.4 205.6 123.4 192 147.8 192zM543.1 224H147.8C135.7 224 124.6 230.8 119.2 241.7L0 480h447.1c12.12 0 23.2-6.852 28.62-17.69l96-192C583.2 249 567.7 224 543.1 224z"/></svg>${e.folder.name}</div> <svg aria-hidden="true" fill="none" focusable="false" height="1em" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" style="min-width:16px" viewBox="0 0 24 24" width="1em"><path d="m9 18 6-6-6-6"></path></svg>`:""}${escapeHTML(e.title)}</div>
  
  </div>
  <div class="flex-1 self-center ms-3 ${e.folder?.id==="recent"?"text-token-text-primary":"text-token-text-tertiary"} text-sm truncate">${escapeHTML(formatAttachmentsForPromptStep(e.steps[0]).substring(0,250))} <span class="self-center text-xs text-token-text-tertiary">${e.steps.length>1?`(${e.steps.length} ${translate("steps")})`:""}</span></div>
  <div class="flex overflow-hidden items-center">
    ${e.tags?.map(r=>`<span id="prompt-card-tag-${r.id}" class="border border-token-border-medium hover:bg-token-main-surface-secondary text-token-text-tertiary text-xs py-1 px-2 rounded-full me-2 capitalize truncate">${r.name}</span>`).join("")}
  </div>
  <div class="flex justify-between items-center">
    <div>
    
    </div>
    <div id="prompt-card-action-right-${e.id}" class="flex items-center">
      ${e.is_public?`<svg id="prompt-card-public-icon icon-${e.id}" title="public prompt" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" stroke="currentColor" fill="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4 me-2" height="1em" width="1em"><path d="M319.9 320c57.41 0 103.1-46.56 103.1-104c0-57.44-46.54-104-103.1-104c-57.41 0-103.1 46.56-103.1 104C215.9 273.4 262.5 320 319.9 320zM369.9 352H270.1C191.6 352 128 411.7 128 485.3C128 500.1 140.7 512 156.4 512h327.2C499.3 512 512 500.1 512 485.3C512 411.7 448.4 352 369.9 352zM512 160c44.18 0 80-35.82 80-80S556.2 0 512 0c-44.18 0-80 35.82-80 80S467.8 160 512 160zM183.9 216c0-5.449 .9824-10.63 1.609-15.91C174.6 194.1 162.6 192 149.9 192H88.08C39.44 192 0 233.8 0 285.3C0 295.6 7.887 304 17.62 304h199.5C196.7 280.2 183.9 249.7 183.9 216zM128 160c44.18 0 80-35.82 80-80S172.2 0 128 0C83.82 0 48 35.82 48 80S83.82 160 128 160zM551.9 192h-61.84c-12.8 0-24.88 3.037-35.86 8.24C454.8 205.5 455.8 210.6 455.8 216c0 33.71-12.78 64.21-33.16 88h199.7C632.1 304 640 295.6 640 285.3C640 233.8 600.6 192 551.9 192z"/></svg>`:""}

      ${e.is_mine?`${e.folder?.id==="recent"?"":`<div id="prompt-card-favorite" title="favorite prompt" class="me-2">
        ${e.is_favorite?'<svg class="icon icon-md" fill="gold" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M381.2 150.3L524.9 171.5C536.8 173.2 546.8 181.6 550.6 193.1C554.4 204.7 551.3 217.3 542.7 225.9L438.5 328.1L463.1 474.7C465.1 486.7 460.2 498.9 450.2 506C440.3 513.1 427.2 514 416.5 508.3L288.1 439.8L159.8 508.3C149 514 135.9 513.1 126 506C116.1 498.9 111.1 486.7 113.2 474.7L137.8 328.1L33.58 225.9C24.97 217.3 21.91 204.7 25.69 193.1C29.46 181.6 39.43 173.2 51.42 171.5L195 150.3L259.4 17.97C264.7 6.954 275.9-.0391 288.1-.0391C300.4-.0391 311.6 6.954 316.9 17.97L381.2 150.3z"/></svg>':'<svg class="icon icon-md" fill="#b4b4b4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M287.9 0C297.1 0 305.5 5.25 309.5 13.52L378.1 154.8L531.4 177.5C540.4 178.8 547.8 185.1 550.7 193.7C553.5 202.4 551.2 211.9 544.8 218.2L433.6 328.4L459.9 483.9C461.4 492.9 457.7 502.1 450.2 507.4C442.8 512.7 432.1 513.4 424.9 509.1L287.9 435.9L150.1 509.1C142.9 513.4 133.1 512.7 125.6 507.4C118.2 502.1 114.5 492.9 115.1 483.9L142.2 328.4L31.11 218.2C24.65 211.9 22.36 202.4 25.2 193.7C28.03 185.1 35.5 178.8 44.49 177.5L197.7 154.8L266.3 13.52C270.4 5.249 278.7 0 287.9 0L287.9 0zM287.9 78.95L235.4 187.2C231.9 194.3 225.1 199.3 217.3 200.5L98.98 217.9L184.9 303C190.4 308.5 192.9 316.4 191.6 324.1L171.4 443.7L276.6 387.5C283.7 383.7 292.2 383.7 299.2 387.5L404.4 443.7L384.2 324.1C382.9 316.4 385.5 308.5 391 303L476.9 217.9L358.6 200.5C350.7 199.3 343.9 194.3 340.5 187.2L287.9 78.95z"/></svg>'}
      </div>`}`:""}

      <div id="prompt-card-settings-menu-${e.id}" class="relative flex items-center justify-center h-8 rounded-lg px-2 text-token-text-tertiary focus-visible:outline-0 hover:bg-token-sidebar-surface-tertiary focus-visible:bg-token-sidebar-surface-secondary"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 12C3 10.8954 3.89543 10 5 10C6.10457 10 7 10.8954 7 12C7 13.1046 6.10457 14 5 14C3.89543 14 3 13.1046 3 12ZM10 12C10 10.8954 10.8954 10 12 10C13.1046 10 14 10.8954 14 12C14 13.1046 13.1046 14 12 14C10.8954 14 10 13.1046 10 12ZM17 12C17 10.8954 17.8954 10 19 10C20.1046 10 21 10.8954 21 12C21 13.1046 20.1046 14 19 14C17.8954 14 17 13.1046 17 12Z" fill="currentColor"></path></svg>
      </div>
    </div>
  </div>`}function promptGridView(e){if(!e)return"";const t=getLastSelectedPromptFolder(),o=document.querySelector('#modal-manager input[id="prompt-manager-search-input"]')?.value;return`<div class="flex items-center justify-between border-b border-token-border-medium pb-1"><div class="${e.folder?.id==="recent"?"text-xs text-token-text-tertiary":"text-md text-token-text-primary"} truncate flex items-center w-full">${o&&e.folder?.id!=="recent"?`<div class="flex items-center border border-token-border-medium rounded-md px-1 text-xs font-normal overflow-hidden hover:w-fit-sp w-auto min-w-5 max-w-5"><svg stroke="currentColor" fill="currentColor" class="icon icon-xs me-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M147.8 192H480V144C480 117.5 458.5 96 432 96h-160l-64-64h-160C21.49 32 0 53.49 0 80v328.4l90.54-181.1C101.4 205.6 123.4 192 147.8 192zM543.1 224H147.8C135.7 224 124.6 230.8 119.2 241.7L0 480h447.1c12.12 0 23.2-6.852 28.62-17.69l96-192C583.2 249 567.7 224 543.1 224z"/></svg>${e.folder.name}</div> <svg aria-hidden="true" fill="none" focusable="false" height="1em" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" style="min-width:16px" viewBox="0 0 24 24" width="1em"><path d="m9 18 6-6-6-6"></path></svg>`:""}${escapeHTML(e.title)}</div>
  ${e.is_mine?`${e.folder?.id==="recent"?"":`<div id="prompt-card-favorite" title="favorite prompt" class="ps-1">
    ${e.is_favorite?'<svg class="icon icon-md" fill="gold" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M381.2 150.3L524.9 171.5C536.8 173.2 546.8 181.6 550.6 193.1C554.4 204.7 551.3 217.3 542.7 225.9L438.5 328.1L463.1 474.7C465.1 486.7 460.2 498.9 450.2 506C440.3 513.1 427.2 514 416.5 508.3L288.1 439.8L159.8 508.3C149 514 135.9 513.1 126 506C116.1 498.9 111.1 486.7 113.2 474.7L137.8 328.1L33.58 225.9C24.97 217.3 21.91 204.7 25.69 193.1C29.46 181.6 39.43 173.2 51.42 171.5L195 150.3L259.4 17.97C264.7 6.954 275.9-.0391 288.1-.0391C300.4-.0391 311.6 6.954 316.9 17.97L381.2 150.3z"/></svg>':'<svg class="icon icon-md" fill="#b4b4b4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M287.9 0C297.1 0 305.5 5.25 309.5 13.52L378.1 154.8L531.4 177.5C540.4 178.8 547.8 185.1 550.7 193.7C553.5 202.4 551.2 211.9 544.8 218.2L433.6 328.4L459.9 483.9C461.4 492.9 457.7 502.1 450.2 507.4C442.8 512.7 432.1 513.4 424.9 509.1L287.9 435.9L150.1 509.1C142.9 513.4 133.1 512.7 125.6 507.4C118.2 502.1 114.5 492.9 115.1 483.9L142.2 328.4L31.11 218.2C24.65 211.9 22.36 202.4 25.2 193.7C28.03 185.1 35.5 178.8 44.49 177.5L197.7 154.8L266.3 13.52C270.4 5.249 278.7 0 287.9 0L287.9 0zM287.9 78.95L235.4 187.2C231.9 194.3 225.1 199.3 217.3 200.5L98.98 217.9L184.9 303C190.4 308.5 192.9 316.4 191.6 324.1L171.4 443.7L276.6 387.5C283.7 383.7 292.2 383.7 299.2 387.5L404.4 443.7L384.2 324.1C382.9 316.4 385.5 308.5 391 303L476.9 217.9L358.6 200.5C350.7 199.3 343.9 194.3 340.5 187.2L287.9 78.95z"/></svg>'}
  </div>`}`:""}
  </div>
  <div class="flex-1 ${e.folder?.id==="recent"?"text-token-text-primary":"text-token-text-tertiary"} text-sm truncate">${escapeHTML(formatAttachmentsForPromptStep(e.steps[0]).substring(0,250))}</div>
  <div class="flex overflow-hidden my-1">
    ${e.tags?.map(r=>`<span id="prompt-card-tag-${r.id}" class="border border-token-border-medium hover:bg-token-main-surface-secondary text-token-text-tertiary text-xs px-2 rounded-full me-1 capitalize truncate">${r.name}</span>`).join("")}
  </div>
  <div class="border-t border-token-border-medium flex justify-between items-center pt-1">
    <div class="flex items-center overflow-hidden">
    ${e.is_mine||t?.id==="recent"?`<input data-prompt-id="${e.id}" id="prompt-checkbox-${e.id}" type="checkbox" id="checkbox" class="manager-modal border border-token-border-medium me-2" style="cursor: pointer; border-radius: 2px;">`:""}
    <span class="text-xs text-token-text-tertiary whitespace-nowrap">${e.steps.length>1?`${e.steps.length} ${translate("steps")}`:""}</span>
    </div>
    <div id="prompt-card-action-right-${e.id}" class="flex items-center">
      ${e.is_public?`<svg id="prompt-card-public-icon icon-${e.id}" title="public prompt" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" stroke="currentColor" fill="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4 me-2" height="1em" width="1em"><path d="M319.9 320c57.41 0 103.1-46.56 103.1-104c0-57.44-46.54-104-103.1-104c-57.41 0-103.1 46.56-103.1 104C215.9 273.4 262.5 320 319.9 320zM369.9 352H270.1C191.6 352 128 411.7 128 485.3C128 500.1 140.7 512 156.4 512h327.2C499.3 512 512 500.1 512 485.3C512 411.7 448.4 352 369.9 352zM512 160c44.18 0 80-35.82 80-80S556.2 0 512 0c-44.18 0-80 35.82-80 80S467.8 160 512 160zM183.9 216c0-5.449 .9824-10.63 1.609-15.91C174.6 194.1 162.6 192 149.9 192H88.08C39.44 192 0 233.8 0 285.3C0 295.6 7.887 304 17.62 304h199.5C196.7 280.2 183.9 249.7 183.9 216zM128 160c44.18 0 80-35.82 80-80S172.2 0 128 0C83.82 0 48 35.82 48 80S83.82 160 128 160zM551.9 192h-61.84c-12.8 0-24.88 3.037-35.86 8.24C454.8 205.5 455.8 210.6 455.8 216c0 33.71-12.78 64.21-33.16 88h199.7C632.1 304 640 295.6 640 285.3C640 233.8 600.6 192 551.9 192z"/></svg>`:""}
      <div id="prompt-card-settings-menu-${e.id}" class="relative flex items-center justify-center h-8 rounded-lg px-2 text-token-text-tertiary focus-visible:outline-0 hover:bg-token-sidebar-surface-tertiary focus-visible:bg-token-sidebar-surface-secondary"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 12C3 10.8954 3.89543 10 5 10C6.10457 10 7 10.8954 7 12C7 13.1046 6.10457 14 5 14C3.89543 14 3 13.1046 3 12ZM10 12C10 10.8954 10.8954 10 12 10C13.1046 10 14 10.8954 14 12C14 13.1046 13.1046 14 12 14C10.8954 14 10 13.1046 10 12ZM17 12C17 10.8954 17.8954 10 19 10C20.1046 10 21 10.8954 21 12C21 13.1046 20.1046 14 19 14C17.8954 14 17 13.1046 17 12Z" fill="currentColor"></path></svg>
      </div>
    </div>
  </div>`}function createPromptCard(e){const t=document.createElement("div");return t.id=`prompt-card-${e.id}`,t.dataset.promptId=e.id,e.folder?.id!=="recent"&&(!e.is_public||e.is_mine)&&(t.draggable=!0),t.classList=`relative flex bg-token-main-surface-primary border border-token-border-medium rounded-md cursor-pointer hover:bg-token-main-surface-tertiary ${cachedSettings.selectedPromptView==="list"?"w-full p-2 flex-row h-10":"aspect-1.5 p-4 pb-2 flex-col h-auto"}`,e.folder&&(t.dataset.folderId=e.folder?.id),t.style="height: max-content;outline-offset: 4px; outline: none;",t.innerHTML=cachedSettings.selectedPromptView==="list"?promptListView(e):promptGridView(e),t.addEventListener("click",o=>{if(o.metaKey||isWindows()&&o.ctrlKey)document.querySelector("#modal-manager #modal-close-button-manager")?.click(),runPromptChain(e,0,!0);else{updateSelectedPromptCard(e.id);const r={...e};e.is_mine||(delete r.id,delete r.folder),openPromptEditorModal(r)}}),t.addEventListener("mouseenter",()=>{closeMenus()}),t.addEventListener("dragstart",o=>{o.stopPropagation(),o.dataTransfer.setData("text/plain",JSON.stringify({draggingObject:"prompt",prompt:e})),o.dataTransfer.effectAllowed="move",t.classList.add("card-dragging")}),t.addEventListener("dragend",o=>{o.stopPropagation(),o.dataTransfer.clearData();try{t.classList.remove("card-dragging")}catch(r){console.error("Error removing card-dragging class:",r)}}),t}function updateSelectedPromptCard(e){if(lastSelectedPromptCardId){const o=document.querySelector(`#modal-manager #prompt-card-${lastSelectedPromptCardId}`);o&&(o.style.outline="none")}if(!e)return;const t=document.querySelector(`#modal-manager #prompt-card-${e}`);lastSelectedPromptCardId=e,t.style.outline=`2px solid ${isDarkMode()?"#fff":"#000"}`}function addOrReplacePromptCard(e,t=null){const o=getLastSelectedPromptFolder();if(o?.id&&(o?.id.toString()===e.folder?.id?.toString()||o?.id==="favorites"&&e.is_favorite||o?.id==="public"&&e.is_public)){const r=document.querySelector(`#modal-manager #prompt-card-${e.id}`);if(r){const n=createPromptCard(e);r.replaceWith(n),addPromptCardEventListeners(n,e)}else{const n=document.querySelector("#modal-manager #prompt-manager-prompt-list"),i=document.querySelector("#modal-manager #no-prompts-found");i&&i.remove();const a=createPromptCard(e);t?t.after(a):n.prepend(a),addPromptCardEventListeners(a,e)}}}function addPromptCardEventListeners(e,t){e.querySelector(`#modal-manager #prompt-checkbox-${t.id}`)?.addEventListener("click",n=>{n.stopPropagation(),closeMenus();const i=Array.from(document.querySelectorAll('#modal-manager input[id^="prompt-checkbox-"]:checked'));if(i.length>0){if(n.shiftKey&&i.filter(d=>d.id!==`prompt-checkbox-${t.id}`).length>0){const d=t.id.toString(),c=document.querySelectorAll('#modal-manager div[id^="prompt-card-"]');let u=!1,m=!1;c.forEach(g=>{const p=g.id.split("prompt-card-")[1];if((p===lastSelectedPromptCheckboxId||p===d)&&(u?m=!0:u=!0),u&&!m){const h=document.querySelector(`#modal-manager #prompt-checkbox-${p}`);h&&(h.checked=!0)}})}lastSelectedPromptCheckboxId=t.id.toString();const a=document.querySelector('#modal-manager span[id="prompt-manager-selection-count"]'),s=Array.from(document.querySelectorAll('#modal-manager input[id^="prompt-checkbox-"]:checked'));a.innerText=`${s.length} selected`,document.querySelector('#modal-manager div[id="prompt-manager-selection-bar"]').classList.remove("hidden");const l=document.querySelector('#modal-manager div[id="prompt-manager-content-wrapper"]');l&&(l.style.paddingBottom="calc(59px + 56px)")}else resetPromptManagerSelection()});const o=e.querySelector("#modal-manager #prompt-card-favorite");o?.addEventListener("click",n=>{n.stopPropagation(),closeMenus();const i=getLastSelectedPromptFolder();i?.id==="favorites"&&e.remove(),chrome.runtime.sendMessage({type:"toggleFavoritePrompt",forceRefresh:!0,detail:{promptId:t.id}},a=>{const s=document.querySelector("#continue-prompt-button-wrapper");s&&s.remove(),initializeContinueButton(!0),i?.id!=="favorites"&&(a.is_favorite?o.innerHTML='<svg class="icon icon-md" fill="gold" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M381.2 150.3L524.9 171.5C536.8 173.2 546.8 181.6 550.6 193.1C554.4 204.7 551.3 217.3 542.7 225.9L438.5 328.1L463.1 474.7C465.1 486.7 460.2 498.9 450.2 506C440.3 513.1 427.2 514 416.5 508.3L288.1 439.8L159.8 508.3C149 514 135.9 513.1 126 506C116.1 498.9 111.1 486.7 113.2 474.7L137.8 328.1L33.58 225.9C24.97 217.3 21.91 204.7 25.69 193.1C29.46 181.6 39.43 173.2 51.42 171.5L195 150.3L259.4 17.97C264.7 6.954 275.9-.0391 288.1-.0391C300.4-.0391 311.6 6.954 316.9 17.97L381.2 150.3z"/></svg>':o.innerHTML='<svg class="icon icon-md" fill="#b4b4b4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M287.9 0C297.1 0 305.5 5.25 309.5 13.52L378.1 154.8L531.4 177.5C540.4 178.8 547.8 185.1 550.7 193.7C553.5 202.4 551.2 211.9 544.8 218.2L433.6 328.4L459.9 483.9C461.4 492.9 457.7 502.1 450.2 507.4C442.8 512.7 432.1 513.4 424.9 509.1L287.9 435.9L150.1 509.1C142.9 513.4 133.1 512.7 125.6 507.4C118.2 502.1 114.5 492.9 115.1 483.9L142.2 328.4L31.11 218.2C24.65 211.9 22.36 202.4 25.2 193.7C28.03 185.1 35.5 178.8 44.49 177.5L197.7 154.8L266.3 13.52C270.4 5.249 278.7 0 287.9 0L287.9 0zM287.9 78.95L235.4 187.2C231.9 194.3 225.1 199.3 217.3 200.5L98.98 217.9L184.9 303C190.4 308.5 192.9 316.4 191.6 324.1L171.4 443.7L276.6 387.5C283.7 383.7 292.2 383.7 299.2 387.5L404.4 443.7L384.2 324.1C382.9 316.4 385.5 308.5 391 303L476.9 217.9L358.6 200.5C350.7 199.3 343.9 194.3 340.5 187.2L287.9 78.95z"/></svg>')})}),e.querySelectorAll('#modal-manager span[id^="prompt-card-tag-"]')?.forEach(n=>{n.addEventListener("click",i=>{i.stopPropagation(),closeMenus();const a=n.id.split("prompt-card-tag-")[1],s=document.querySelector(`#modal-manager #prompts-manager-tag-selector-option-${a}`);s&&s.click()})});const r=e.querySelector(`#prompt-card-settings-menu-${t.id}`);r?.addEventListener("click",async n=>{n.stopPropagation(),closeMenus(),showPromptManagerCardMenu(r,t,!0)})}function noPromptElement(){const e=document.createElement("p");e.classList="absolute text-center text-sm text-token-text-tertiary w-full p-4",e.id="no-prompts-found",e.innerText=translate("No prompts found");const t=document.querySelector("#modal-manager #prompt-manager-prompt-list"),o=document.querySelector("#modal-manager #selected-prompts-manager-tag-title"),r=document.querySelector("#modal-manager #selected-prompts-manager-language-title");return t&&o&&r&&(o?.innerText!=="All"||r?.innerText!=="All")&&(e.innerHTML=`${translate("No prompts found")} <div>${translate("clear_filter")}</div>`),e}function noPromptFolderElemet(){const e=document.createElement("p");return e.id="no-prompt-folders",e.classList="text-token-text-tertiary text-center text-sm py-4 w-full p-4",e.innerText=translate("new_category_hint"),e}async function showPromptManagerFolderMenu(e,t,o=!1,r=!1){const n=t.id,i=document.querySelector(`#prompt-folder-wrapper-${n}`),a=t.image||t.image_url,s=await chrome.runtime.sendMessage({type:"checkHasSubscription"}),{right:l,top:d}=e.getBoundingClientRect(),c=o?l+2:l-236,u=d+12,m=`<div id="prompt-manager-folder-menu" dir="ltr" style="position:fixed;left:0;top:0;transform:translate3d(${c}px,${u}px,0);min-width:max-content;z-index:10001;--radix-popper-anchor-width:18px;--radix-popper-anchor-height:18px;--radix-popper-available-width:1167px;--radix-popper-available-height:604px;--radix-popper-transform-origin:0% 0px"><div data-side="bottom" data-align="start" role="menu" aria-orientation="vertical" data-state="open" data-radix-menu-content="" dir="ltr" aria-labelledby="radix-:r6g:" class="text-token-text-primary mt-2 min-w-[200px] max-w-xs rounded-2xl bg-token-main-surface-secondary shadow-long p-1" tabindex="-1" data-orientation="vertical" style="outline:0;--radix-dropdown-menu-content-transform-origin:var(--radix-popper-transform-origin);--radix-dropdown-menu-content-available-width:var(--radix-popper-available-width);--radix-dropdown-menu-content-available-height:var(--radix-popper-available-height);--radix-dropdown-menu-trigger-width:var(--radix-popper-anchor-width);--radix-dropdown-menu-trigger-height:var(--radix-popper-anchor-height);pointer-events:auto">

  ${["recent","favorites"].includes(n)?`<div role="menuitem" id="clear-all-prompt-folder-button-${n}" class="flex gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group text-red-500" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><svg  viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5555 4C10.099 4 9.70052 4.30906 9.58693 4.75114L9.29382 5.8919H14.715L14.4219 4.75114C14.3083 4.30906 13.9098 4 13.4533 4H10.5555ZM16.7799 5.8919L16.3589 4.25342C16.0182 2.92719 14.8226 2 13.4533 2H10.5555C9.18616 2 7.99062 2.92719 7.64985 4.25342L7.22886 5.8919H4C3.44772 5.8919 3 6.33961 3 6.8919C3 7.44418 3.44772 7.8919 4 7.8919H4.10069L5.31544 19.3172C5.47763 20.8427 6.76455 22 8.29863 22H15.7014C17.2354 22 18.5224 20.8427 18.6846 19.3172L19.8993 7.8919H20C20.5523 7.8919 21 7.44418 21 6.8919C21 6.33961 20.5523 5.8919 20 5.8919H16.7799ZM17.888 7.8919H6.11196L7.30423 19.1057C7.3583 19.6142 7.78727 20 8.29863 20H15.7014C16.2127 20 16.6417 19.6142 16.6958 19.1057L17.888 7.8919ZM10 10C10.5523 10 11 10.4477 11 11V16C11 16.5523 10.5523 17 10 17C9.44772 17 9 16.5523 9 16V11C9 10.4477 9.44772 10 10 10ZM14 10C14.5523 10 15 10.4477 15 11V16C15 16.5523 14.5523 17 14 17C13.4477 17 13 16.5523 13 16V11C13 10.4477 13.4477 10 14 10Z" fill="currentColor"></path></svg>${translate("Clear all")}</div></div></div>`:`<div role="menuitem" id="rename-prompt-folder-button-${n}" class="flex gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" fill="none" class="icon icon-md"><path fill="currentColor" d="M184 160C193.5 160 202.1 165.6 205.9 174.3L269.9 318.3C275.3 330.4 269.9 344.5 257.7 349.9C245.6 355.3 231.5 349.9 226.1 337.7L221.7 328H146.3L141.9 337.7C136.5 349.9 122.4 355.3 110.3 349.9C98.14 344.5 92.69 330.4 98.07 318.3L162.1 174.3C165.9 165.6 174.5 160 184 160H184zM167.6 280H200.4L184 243.1L167.6 280zM304 184C304 170.7 314.7 160 328 160H380C413.1 160 440 186.9 440 220C440 229.2 437.9 237.9 434.2 245.7C447.5 256.7 456 273.4 456 292C456 325.1 429.1 352 396 352H328C314.7 352 304 341.3 304 328V184zM352 208V232H380C386.6 232 392 226.6 392 220C392 213.4 386.6 208 380 208H352zM352 304H396C402.6 304 408 298.6 408 292C408 285.4 402.6 280 396 280H352V304zM0 128C0 92.65 28.65 64 64 64H576C611.3 64 640 92.65 640 128V384C640 419.3 611.3 448 576 448H64C28.65 448 0 419.3 0 384V128zM48 128V384C48 392.8 55.16 400 64 400H576C584.8 400 592 392.8 592 384V128C592 119.2 584.8 112 576 112H64C55.16 112 48 119.2 48 128z"/></svg>${translate("Rename")}</div>

      <div role="menuitem" id="add-subfolder-prompt-folder-button-${n}" class="flex gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><svg stroke="currentColor" fill="currentColor" class="icon icon-md" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M448 96h-172.1L226.7 50.75C214.7 38.74 198.5 32 181.5 32H64C28.66 32 0 60.66 0 96v320c0 35.34 28.66 64 64 64h384c35.34 0 64-28.66 64-64V160C512 124.7 483.3 96 448 96zM464 416c0 8.824-7.18 16-16 16H64c-8.82 0-16-7.176-16-16V96c0-8.824 7.18-16 16-16h117.5c4.273 0 8.289 1.664 11.31 4.688L256 144h192c8.82 0 16 7.176 16 16V416zM336 264h-56V207.1C279.1 194.7 269.3 184 256 184S232 194.7 232 207.1V264H175.1C162.7 264 152 274.7 152 288c0 13.26 10.73 23.1 23.1 23.1h56v56C232 381.3 242.7 392 256 392c13.26 0 23.1-10.74 23.1-23.1V311.1h56C349.3 311.1 360 301.3 360 288S349.3 264 336 264z"/></svg>${translate("Add subfolder")}</div>

      <div role="menuitem" id="move-folder-prompt-folder-button-${n}" class="flex gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><svg xmlns="http://www.w3.org/2000/svg" stroke="currentColor" fill="currentColor" class="icon icon-md" viewBox="0 0 576 512"><path d="M544 320h-96l-44.16-27.23C398.8 289.6 392.1 288 387 288H320c-17.67 0-32 14.33-32 32v160c0 17.67 14.33 32 32 32h224c17.67 0 32-14.33 32-32v-128C576 334.3 561.7 320 544 320zM528 464h-192v-128h46.5l40.3 24.86C430.4 365.5 439.1 368 448 368h80V464zM232 160C245.3 160 256 149.3 256 136C256 122.7 245.3 112 232 112H48V24C48 10.74 37.25 0 24 0S0 10.74 0 24v368C0 422.9 25.07 448 56 448h176C245.3 448 256 437.3 256 424c0-13.26-10.75-24-24-24h-176c-4.4 0-8-3.602-8-8V160H232zM544 32h-96l-44.16-27.23C398.8 1.648 392.1 0 387 0H320c-17.67 0-32 14.33-32 32v160c0 17.67 14.33 32 32 32h224c17.67 0 32-14.33 32-32V64C576 46.33 561.7 32 544 32zM528 176h-192v-128h46.5l40.3 24.86C430.4 77.53 439.1 80 448 80h80V176z"/></svg>${translate("Move folder")}</div>

      <div role="menuitem" id="color-prompt-folder-button-${n}" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><div class="flex gap-2"><svg stroke="currentColor" fill="currentColor" stroke-width="2" viewBox="0 0 512 512" stroke-linecap="round" stroke-linejoin="round" class="icon icon-md" xmlns="http://www.w3.org/2000/svg"><path d="M160 255.1C160 273.7 145.7 287.1 128 287.1C110.3 287.1 96 273.7 96 255.1C96 238.3 110.3 223.1 128 223.1C145.7 223.1 160 238.3 160 255.1zM128 159.1C128 142.3 142.3 127.1 160 127.1C177.7 127.1 192 142.3 192 159.1C192 177.7 177.7 191.1 160 191.1C142.3 191.1 128 177.7 128 159.1zM288 127.1C288 145.7 273.7 159.1 256 159.1C238.3 159.1 224 145.7 224 127.1C224 110.3 238.3 95.1 256 95.1C273.7 95.1 288 110.3 288 127.1zM320 159.1C320 142.3 334.3 127.1 352 127.1C369.7 127.1 384 142.3 384 159.1C384 177.7 369.7 191.1 352 191.1C334.3 191.1 320 177.7 320 159.1zM441.9 319.1H344C317.5 319.1 296 341.5 296 368C296 371.4 296.4 374.7 297 377.9C299.2 388.1 303.5 397.1 307.9 407.8C313.9 421.6 320 435.3 320 449.8C320 481.7 298.4 510.5 266.6 511.8C263.1 511.9 259.5 512 256 512C114.6 512 0 397.4 0 256C0 114.6 114.6 0 256 0C397.4 0 512 114.6 512 256C512 256.9 511.1 257.8 511.1 258.7C511.6 295.2 478.4 320 441.9 320V319.1zM463.1 258.2C463.1 257.4 464 256.7 464 255.1C464 141.1 370.9 47.1 256 47.1C141.1 47.1 48 141.1 48 255.1C48 370.9 141.1 464 256 464C258.9 464 261.8 463.9 264.6 463.8C265.4 463.8 265.9 463.6 266.2 463.5C266.6 463.2 267.3 462.8 268.2 461.7C270.1 459.4 272 455.2 272 449.8C272 448.1 271.4 444.3 266.4 432.7C265.8 431.5 265.2 430.1 264.5 428.5C260.2 418.9 253.4 403.5 250.1 387.8C248.7 381.4 248 374.8 248 368C248 314.1 290.1 271.1 344 271.1H441.9C449.6 271.1 455.1 269.3 459.7 266.2C463 263.4 463.1 260.9 463.1 258.2V258.2z"/></svg>${translate("Set color")}</div>
        <div id="color-picker-button-${n}" class="flex z-10 cursor-pointer flex items-center">
          <svg id="reset-color-picker" stroke="currentColor" fill="currentColor" stroke-width="2" viewBox="0 0 512 512" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4 me-2" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M496 40v160C496 213.3 485.3 224 472 224h-160C298.8 224 288 213.3 288 200s10.75-24 24-24h100.5C382.8 118.3 322.5 80 256 80C158.1 80 80 158.1 80 256s78.97 176 176 176c41.09 0 81.09-14.47 112.6-40.75c10.16-8.5 25.31-7.156 33.81 3.062c8.5 10.19 7.125 25.31-3.062 33.81c-40.16 33.44-91.17 51.77-143.5 51.77C132.4 479.9 32 379.5 32 256s100.4-223.9 223.9-223.9c79.85 0 152.4 43.46 192.1 109.1V40c0-13.25 10.75-24 24-24S496 26.75 496 40z"/></svg><input type="color" class="w-8 h-6" id="color-picker-input-${n}" style="cursor:pointer" value="${rgba2hex(i?.style?.backgroundColor)||"#2f2f2f"}" />
        </div>
      </div>

      <div role="menuitem" id="set-image-folder-prompts-button-${n}" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><div class="flex gap-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" stroke="currentColor" fill="currentColor" stroke-width="2" stroke-linejoin="round" class="icon icon-md"><path d="M112 112c-17.67 0-32 14.33-32 32s14.33 32 32 32c17.68 0 32-14.33 32-32S129.7 112 112 112zM448 96c0-35.35-28.65-64-64-64H64C28.65 32 0 60.65 0 96v320c0 35.35 28.65 64 64 64h320c35.35 0 64-28.65 64-64V96zM400 416c0 8.822-7.178 16-16 16H64c-8.822 0-16-7.178-16-16v-48h352V416zM400 320h-28.76l-96.58-144.9C271.7 170.7 266.7 168 261.3 168c-5.352 0-10.35 2.672-13.31 7.125l-62.74 94.11L162.9 238.6C159.9 234.4 155.1 232 150 232c-5.109 0-9.914 2.441-12.93 6.574L77.7 320H48V96c0-8.822 7.178-16 16-16h320c8.822 0 16 7.178 16 16V320z"/></svg>${translate("Set image")}</div></div>

      ${a?`<div role="menuitem" id="remove-image-folder-prompts-button-${n}" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><div class="flex gap-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" stroke="currentColor" fill="currentColor" stroke-width="2" stroke-linejoin="round" class="icon icon-md"><path d="M630.8 469.1l-55.95-43.85C575.3 422.2 575.1 419.2 575.1 416l.0034-320c0-35.35-28.65-64-64-64H127.1C113.6 32 100.4 36.98 89.78 45.06L38.81 5.113C28.34-3.058 13.31-1.246 5.109 9.192C-3.063 19.63-1.235 34.72 9.187 42.89L601.2 506.9C605.6 510.3 610.8 512 615.1 512c7.125 0 14.17-3.156 18.91-9.188C643.1 492.4 641.2 477.3 630.8 469.1zM527.1 388.5l-36.11-28.3l-100.7-136.8C387.8 218.8 382.1 216 376 216c-6.113 0-11.82 2.768-15.21 7.379L344.9 245L261.9 180C262.1 176.1 264 172.2 264 168c0-26.51-21.49-48-48-48c-8.336 0-16.05 2.316-22.88 6.057L134.4 80h377.6c8.822 0 16 7.178 16 16V388.5zM254.2 368.3l-37.09-46.1c-3.441-4.279-8.934-6.809-14.77-6.809c-5.842 0-11.33 2.529-14.78 6.809l-75.52 93.81c0-.0293 0 .0293 0 0L111.1 184.5l-48-37.62L63.99 416c0 35.35 28.65 64 64 64h361.1l-201.1-157.6L254.2 368.3z"/></svg>${translate("Remove image")}</div></div>`:""}

      <div role="menuitem" id="export-folder-prompts-button-${n}" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><div class="flex gap-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" stroke="currentColor" fill="currentColor" stroke-width="2" stroke-linejoin="round" class="icon icon-md"><path d="M568.1 303l-80-80c-9.375-9.375-24.56-9.375-33.94 0s-9.375 24.56 0 33.94L494.1 296H216C202.8 296 192 306.8 192 320s10.75 24 24 24h278.1l-39.03 39.03C450.3 387.7 448 393.8 448 400s2.344 12.28 7.031 16.97c9.375 9.375 24.56 9.375 33.94 0l80-80C578.3 327.6 578.3 312.4 568.1 303zM360 384c-13.25 0-24 10.74-24 24V448c0 8.836-7.164 16-16 16H64.02c-8.836 0-16-7.164-16-16L48 64.13c0-8.836 7.164-16 16-16h160L224 128c0 17.67 14.33 32 32 32h79.1v72c0 13.25 10.74 24 23.1 24S384 245.3 384 232V138.6c0-16.98-6.742-33.26-18.75-45.26l-74.63-74.64C278.6 6.742 262.3 0 245.4 0H63.1C28.65 0-.002 28.66 0 64l.0065 384c.002 35.34 28.65 64 64 64H320c35.2 0 64-28.8 64-64v-40C384 394.7 373.3 384 360 384z"></path></svg>${translate("Export")}</div>${s?"":'<span class="text-white rounded-md bg-green-500 px-2 text-sm">Pro</span>'}</div>

    
      <div role="menuitem" id="delete-prompt-folder-button-${n}" class="flex gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group text-red-500" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><svg  viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5555 4C10.099 4 9.70052 4.30906 9.58693 4.75114L9.29382 5.8919H14.715L14.4219 4.75114C14.3083 4.30906 13.9098 4 13.4533 4H10.5555ZM16.7799 5.8919L16.3589 4.25342C16.0182 2.92719 14.8226 2 13.4533 2H10.5555C9.18616 2 7.99062 2.92719 7.64985 4.25342L7.22886 5.8919H4C3.44772 5.8919 3 6.33961 3 6.8919C3 7.44418 3.44772 7.8919 4 7.8919H4.10069L5.31544 19.3172C5.47763 20.8427 6.76455 22 8.29863 22H15.7014C17.2354 22 18.5224 20.8427 18.6846 19.3172L19.8993 7.8919H20C20.5523 7.8919 21 7.44418 21 6.8919C21 6.33961 20.5523 5.8919 20 5.8919H16.7799ZM17.888 7.8919H6.11196L7.30423 19.1057C7.3583 19.6142 7.78727 20 8.29863 20H15.7014C16.2127 20 16.6417 19.6142 16.6958 19.1057L17.888 7.8919ZM10 10C10.5523 10 11 10.4477 11 11V16C11 16.5523 10.5523 17 10 17C9.44772 17 9 16.5523 9 16V11C9 10.4477 9.44772 10 10 10ZM14 10C14.5523 10 15 10.4477 15 11V16C15 16.5523 14.5523 17 14 17C13.4477 17 13 16.5523 13 16V11C13 10.4477 13.4477 10 14 10Z" fill="currentColor"></path></svg>${translate("Delete")}</div>`}
    
    </div ></div >`;document.body.insertAdjacentHTML("beforeend",m),adjustMenuPosition(document.querySelector("#prompt-manager-folder-menu")),addPromptManagerFolderMenuEventListeners(t),document.querySelector("#prompt-manager-folder-menu").addEventListener("mouseleave",()=>{e.classList.replace("flex","hidden")})}async function addPromptManagerFolderMenuEventListeners(e){const t=e.id,o=document.querySelector(`#rename-prompt-folder-button-${t}`),r=document.querySelector(`#add-subfolder-prompt-folder-button-${t}`),n=document.querySelector(`#move-folder-prompt-folder-button-${t}`),i=document.querySelector(`#color-prompt-folder-button-${t}`),a=document.querySelector(`#set-image-folder-prompts-button-${t}`),s=document.querySelector(`#remove-image-folder-prompts-button-${t}`),l=document.querySelector(`#export-folder-prompts-button-${t}`),d=document.querySelector(`#delete-prompt-folder-button-${t}`),c=document.querySelector(`#color-picker-button-${t}`),u=document.querySelector(`#clear-all-prompt-folder-button-${t}`),m=await chrome.runtime.sendMessage({type:"checkHasSubscription"});o?.addEventListener("click",()=>{handleRenamePromptFolderClick(t)}),r?.addEventListener("click",()=>{closeMenus();const p=document.querySelectorAll('#modal-manager #prompt-manager-sidebar-folders > div[id^="prompt-folder-wrapper-"]');if(!m&&p.length>=5){errorUpgradeConfirmation({type:"limit",title:"You have reached the limit",message:"You have reached the limits of Prompt Folders with free account. Upgrade to Pro to remove all limits."});return}document.querySelector(`#modal-manager #prompt-folder-wrapper-${t}`)?.click(),setTimeout(()=>{chrome.runtime.sendMessage({type:"addPromptFolders",forceRefresh:!0,detail:{folders:[{name:"New Category",color:e.color,parent_folder:t,image_url:e.image||e.image_url}]}},h=>{if(h.error&&h.error.type==="limit"){errorUpgradeConfirmation(h.error);return}if(!h||h.length===0)return;const f=document.querySelector("#prompt-manager-subfolder-list");f?.prepend(promptFolderElement(h[0],!1)),f?.scrollIntoView({block:"nearest",inline:"nearest"}),document.querySelectorAll(`#folder-subfolder-count-${t}`).forEach(v=>{const x=parseInt(v.innerText.split(" ")[0],10);v.innerText=`${x+1} folder${x+1===1?"":"s"} -`}),handleRenamePromptFolderClick(h[0].id)})},100)}),n?.addEventListener("click",()=>{openMovePromptFolderModal(e)}),i?.addEventListener("click",p=>{p.stopPropagation()}),c?.addEventListener("click",p=>{p.stopPropagation()});const g=debounce(p=>{chrome.runtime.sendMessage({type:"updatePromptFolder",detail:{folderId:t,newData:p}})},200);c?.querySelector("input[id^=color-picker-input-]")?.addEventListener("input",p=>{const h=p.target.value,f=document.querySelector(`#modal-manager #prompt-folder-wrapper-${t}`);f.style.backgroundColor=h,g({color:h})}),c?.querySelector("#reset-color-picker")?.addEventListener("click",p=>{p.preventDefault(),p.stopPropagation(),closeMenus();const h=document.querySelector(`#modal-manager #prompt-folder-wrapper-${t}`);h.style.backgroundColor="#2f2f2f",c.querySelector("input[id^=color-picker-input-]").value="#2f2f2f",chrome.runtime.sendMessage({type:"updatePromptFolder",detail:{folderId:t,newData:{color:"#2f2f2f"}}})}),a?.addEventListener("click",()=>{closeMenus();const p=document.createElement("form");p.method="POST",p.enctype="multipart/form-data",p.style.display="none";const h=document.createElement("input");h.type="file",h.accept="image/*",p.appendChild(h),document.body.appendChild(p),h.click(),h.onchange=async()=>{const f=h.files[0];if(!f)return;const v=new FileReader;v.onload=async x=>{const y={image:{base64:v.result.split(",")[1],type:f.type,name:f.name}},b=x.target.result;document.querySelectorAll(`#prompt-folder-image-${t}`).forEach(w=>{w.src=b,w.classList.remove("hidden")}),chrome.runtime.sendMessage({type:"updatePromptFolder",detail:{folderId:t,newData:y}})},v.readAsDataURL(f)}}),s?.addEventListener("click",()=>{closeMenus(),document.querySelectorAll(`#prompt-folder-image-${t}`).forEach(p=>{p.src=chrome.runtime.getURL("icons/folder.png"),p.classList="w-5 h-5 me-3 rounded-md object-cover"}),chrome.runtime.sendMessage({type:"removePromptFolderImage",detail:{folderId:t}})}),l?.addEventListener("click",()=>{if(!m){errorUpgradeConfirmation({title:"This is a Pro feature",message:"Exporting prompts requires a Pro subscription. Upgrade to Pro to remove all limits."});return}chrome.runtime.sendMessage({type:"getAllPrompts",detail:{folderId:t}},p=>{if(p.error&&p.error.type==="limit"){errorUpgradeConfirmation(p.error);return}if(!p||Object.keys(p).length===0){toast("No prompts found","error");return}const h=new Blob([JSON.stringify(p)],{type:"application/json"}),f=URL.createObjectURL(h),v=document.createElement("a");v.href=f;const x=new Date,y=`${x.getFullYear()}-${x.getMonth()+1}-${x.getDate()}__${x.getHours()}-${x.getMinutes()}-${x.getSeconds()}`;v.download=`Superpower ChatGPT Prompts - ${Object.keys(p)[0]} - ${y}.json`,v.click()})}),d?.addEventListener("click",()=>{document.querySelector("#prompt-manager-folder-menu").remove(),showConfirmDialog("Delete prompt category","All the prompts in this category and sub categories will be deleted.","Cancel","Delete",null,()=>{chrome.runtime.sendMessage({type:"deletePromptFolder",detail:{folderId:t}},()=>{initializeContinueButton(!0),document.querySelector(`#prompt-folder-wrapper-${t}`).remove();const p=document.querySelector('#prompt-manager-sidebar-folders > div[id^="prompt-folder-wrapper-"]');if(p)selectedPromptFolderBreadcrumb.map(h=>h.id).includes(t)&&p.click();else{document.querySelector("#prompt-manager-sidebar-folders").appendChild(noPromptFolderElemet());const h=document.querySelector("#prompt-folder-wrapper-recent");h&&h.click()}})})}),u?.addEventListener("click",()=>{document.querySelector("#prompt-manager-folder-menu").remove();const p={recent:"Clear prompt history",favorites:"Reset favorite prompts"},h={recent:"Are you sure you want to clear your prompt history? Pther prompts will not be affected.",favorites:"Are you sure you want to unfave all your favorite prompts?"};showConfirmDialog(p[t],h[t],"Cancel","Confirm",null,()=>{if(selectedPromptFolderBreadcrumb.map(f=>f.id).includes(t)){const f=document.querySelector("#prompt-manager-prompt-list");f.innerHTML="",f.appendChild(noPromptElement())}if(t==="recent"){chrome.storage.local.set({userInputValueHistory:[]});return}t==="favorites"&&chrome.runtime.sendMessage({type:"resetAllFavoritePrompts",forceRefresh:!0},()=>{initializeContinueButton(!0)})})})}function handleRenamePromptFolderClick(e){let t=!1;closeMenus();const o=document.createElement("input"),r=document.querySelector(`#prompt-folder-name-${e}`),n=r.innerText;o.id=`prompt-folder-rename-${e}`,o.classList="border-0 bg-transparent p-0 focus:ring-0 focus-visible:ring-0 w-full text-white text-sm",o.value=n,r?.parentElement?.replaceChild(o,r),o.focus(),setTimeout(()=>{o.select()},50),o?.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),closeMenus(),o.focus()}),o?.addEventListener("blur",()=>{if(t)return;const i=o.value;i!==n&&updatePromptFolderNameElement(r,e,i),o.parentElement?.replaceChild(r,o)}),o?.addEventListener("keydown",i=>{if(i.key==="Enter"&&i.which===13){t=!0;const a=o.value;a!==n&&updatePromptFolderNameElement(r,e,a),o.parentElement?.replaceChild(r,o)}i.key==="Escape"&&(t=!0,r.innerText=n,o.parentElement?.replaceChild(r,o))})}function updatePromptFolderNameElement(e,t,o){o.trim()&&(e.innerText=o,chrome.runtime.sendMessage({type:"updatePromptFolder",detail:{folderId:t,newData:{name:o}}}))}function showPromptManagerCardMenu(e,t,o){const r=t.id,n=t.is_public,i=getLastSelectedPromptFolder(),{right:a,top:s}=e.getBoundingClientRect(),l=o?a-234:a-2,d=s+22,c=`<div id="prompt-card-menu" dir="ltr" style="transform:translate3d(${l}px,${d}px,0);position:fixed;left:0;top:0;min-width:max-content;z-index:10001;--radix-popper-anchor-width:18px;--radix-popper-anchor-height:18px;--radix-popper-available-width:1167px;--radix-popper-available-height:604px;--radix-popper-transform-origin:0% 0px"><div data-side="bottom" data-align="start" role="menu" aria-orientation="vertical" data-state="open" data-radix-menu-content="" dir="ltr" aria-labelledby="radix-:r6g:" class="min-w-[200px] max-w-xs rounded-2xl text-token-text-primary bg-token-main-surface-secondary shadow-long p-1" tabindex="-1" data-orientation="vertical" style="outline:0;--radix-dropdown-menu-content-transform-origin:var(--radix-popper-transform-origin);--radix-dropdown-menu-content-available-width:var(--radix-popper-available-width);--radix-dropdown-menu-content-available-height:var(--radix-popper-available-height);--radix-dropdown-menu-trigger-width:var(--radix-popper-anchor-width);--radix-dropdown-menu-trigger-height:var(--radix-popper-anchor-height);pointer-events:auto">
  
  <div role="menuitem" id="run-prompt-card-button-${r}" title="CMD/CTRL + Click on the card" class="flex gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="icon icon-md" xmlns="http://www.w3.org/2000/svg"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>${translate("Run")} <span class='ms-auto'>${buttonGenerator(["\u2318","Click"],"xs")}</span></div>
  
  ${t.steps.length>1?`<div role="menuitem" id="run-from-step-prompt-card-button-${r}" title="CMD/CTRL + Click on the card" class="flex gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group relative" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" fill="currentColor" class="icon icon-md"><path d="M55.1 56.04C55.1 42.78 66.74 32.04 79.1 32.04H111.1C125.3 32.04 135.1 42.78 135.1 56.04V176H151.1C165.3 176 175.1 186.8 175.1 200C175.1 213.3 165.3 224 151.1 224H71.1C58.74 224 47.1 213.3 47.1 200C47.1 186.8 58.74 176 71.1 176H87.1V80.04H79.1C66.74 80.04 55.1 69.29 55.1 56.04V56.04zM118.7 341.2C112.1 333.8 100.4 334.3 94.65 342.4L83.53 357.9C75.83 368.7 60.84 371.2 50.05 363.5C39.26 355.8 36.77 340.8 44.47 330.1L55.59 314.5C79.33 281.2 127.9 278.8 154.8 309.6C176.1 333.1 175.6 370.5 153.7 394.3L118.8 432H152C165.3 432 176 442.7 176 456C176 469.3 165.3 480 152 480H64C54.47 480 45.84 474.4 42.02 465.6C38.19 456.9 39.9 446.7 46.36 439.7L118.4 361.7C123.7 355.9 123.8 347.1 118.7 341.2L118.7 341.2zM520 72C533.3 72 544 82.75 544 96C544 109.3 533.3 120 520 120H248C234.7 120 224 109.3 224 96C224 82.75 234.7 72 248 72H520zM520 232C533.3 232 544 242.7 544 256C544 269.3 533.3 280 520 280H248C234.7 280 224 269.3 224 256C224 242.7 234.7 232 248 232H520zM520 392C533.3 392 544 402.7 544 416C544 429.3 533.3 440 520 440H248C234.7 440 224 429.3 224 416C224 402.7 234.7 392 248 392H520z"/></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" stroke="currentColor" fill="currentColor" class="icon icon-xs absolute" style="top:6px;left:22px;"><path d="M361 215C375.3 223.8 384 239.3 384 256C384 272.7 375.3 288.2 361 296.1L73.03 472.1C58.21 482 39.66 482.4 24.52 473.9C9.377 465.4 0 449.4 0 432V80C0 62.64 9.377 46.63 24.52 38.13C39.66 29.64 58.21 29.99 73.03 39.04L361 215z"/></svg>${translate("Run from step")}</div>`:""}

  <div role="menuitem" id="view-prompt-card-button-${r}" class="flex gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" fill="currentColor" class="icon icon-md"><path d="M160 256C160 185.3 217.3 128 288 128C358.7 128 416 185.3 416 256C416 326.7 358.7 384 288 384C217.3 384 160 326.7 160 256zM288 336C332.2 336 368 300.2 368 256C368 211.8 332.2 176 288 176C287.3 176 286.7 176 285.1 176C287.3 181.1 288 186.5 288 192C288 227.3 259.3 256 224 256C218.5 256 213.1 255.3 208 253.1C208 254.7 208 255.3 208 255.1C208 300.2 243.8 336 288 336L288 336zM95.42 112.6C142.5 68.84 207.2 32 288 32C368.8 32 433.5 68.84 480.6 112.6C527.4 156 558.7 207.1 573.5 243.7C576.8 251.6 576.8 260.4 573.5 268.3C558.7 304 527.4 355.1 480.6 399.4C433.5 443.2 368.8 480 288 480C207.2 480 142.5 443.2 95.42 399.4C48.62 355.1 17.34 304 2.461 268.3C-.8205 260.4-.8205 251.6 2.461 243.7C17.34 207.1 48.62 156 95.42 112.6V112.6zM288 80C222.8 80 169.2 109.6 128.1 147.7C89.6 183.5 63.02 225.1 49.44 256C63.02 286 89.6 328.5 128.1 364.3C169.2 402.4 222.8 432 288 432C353.2 432 406.8 402.4 447.9 364.3C486.4 328.5 512.1 286 526.6 256C512.1 225.1 486.4 183.5 447.9 147.7C406.8 109.6 353.2 80 288 80V80z"/></svg>${translate("View")}</div>
  
  ${t.is_mine?`<div role="menuitem" id="duplicate-prompt-card-button-${r}" class="flex gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="icon icon-md" xmlns="http://www.w3.org/2000/svg"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>${translate("Duplicate")}</div>

        <div role="menuitem" id="public-prompt-card-button-${r}" class="flex gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item="">${n?`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" stroke="currentColor" fill="currentColor"  class="icon icon-md"><path d="M592 288H576V212.7c0-41.84-30.03-80.04-71.66-84.27C456.5 123.6 416 161.1 416 208V288h-16C373.6 288 352 309.6 352 336v128c0 26.4 21.6 48 48 48h192c26.4 0 48-21.6 48-48v-128C640 309.6 618.4 288 592 288zM496 432c-17.62 0-32-14.38-32-32s14.38-32 32-32s32 14.38 32 32S513.6 432 496 432zM528 288h-64V208c0-17.62 14.38-32 32-32s32 14.38 32 32V288zM224 256c70.7 0 128-57.31 128-128S294.7 0 224 0C153.3 0 96 57.31 96 128S153.3 256 224 256zM320 336c0-8.672 1.738-16.87 4.303-24.7C308.6 306.6 291.9 304 274.7 304H173.3C77.61 304 0 381.7 0 477.4C0 496.5 15.52 512 34.66 512h301.7C326.3 498.6 320 482.1 320 464V336z"/></svg> ${translate("Make private")}`:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" stroke="currentColor" fill="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-md" height="1em" width="1em"><path d="M319.9 320c57.41 0 103.1-46.56 103.1-104c0-57.44-46.54-104-103.1-104c-57.41 0-103.1 46.56-103.1 104C215.9 273.4 262.5 320 319.9 320zM369.9 352H270.1C191.6 352 128 411.7 128 485.3C128 500.1 140.7 512 156.4 512h327.2C499.3 512 512 500.1 512 485.3C512 411.7 448.4 352 369.9 352zM512 160c44.18 0 80-35.82 80-80S556.2 0 512 0c-44.18 0-80 35.82-80 80S467.8 160 512 160zM183.9 216c0-5.449 .9824-10.63 1.609-15.91C174.6 194.1 162.6 192 149.9 192H88.08C39.44 192 0 233.8 0 285.3C0 295.6 7.887 304 17.62 304h199.5C196.7 280.2 183.9 249.7 183.9 216zM128 160c44.18 0 80-35.82 80-80S172.2 0 128 0C83.82 0 48 35.82 48 80S83.82 160 128 160zM551.9 192h-61.84c-12.8 0-24.88 3.037-35.86 8.24C454.8 205.5 455.8 210.6 455.8 216c0 33.71-12.78 64.21-33.16 88h199.7C632.1 304 640 295.6 640 285.3C640 233.8 600.6 192 551.9 192z"/></svg> ${translate("Make public")}`}</div>
        ${isDefaultPromptFolder(i?.id?.toString())?"":`
        
        <div role="menuitem" id="move-prompt-card-button-${r}" class="flex gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><svg xmlns="http://www.w3.org/2000/svg" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round" class="icon icon-md" stroke-width="2" viewBox="0 0 512 512"><path d="M448 96h-172.1L226.7 50.75C214.7 38.74 198.5 32 181.5 32H64C28.66 32 0 60.66 0 96v320c0 35.34 28.66 64 64 64h384c35.34 0 64-28.66 64-64V160C512 124.7 483.3 96 448 96zM464 416c0 8.824-7.18 16-16 16H64c-8.82 0-16-7.176-16-16V96c0-8.824 7.18-16 16-16h117.5c4.273 0 8.289 1.664 11.31 4.688L256 144h192c8.82 0 16 7.176 16 16V416zM336 264h-56V207.1C279.1 194.7 269.3 184 256 184S232 194.7 232 207.1V264H175.1C162.7 264 152 274.7 152 288c0 13.26 10.73 23.1 23.1 23.1h56v56C232 381.3 242.7 392 256 392c13.26 0 23.1-10.74 23.1-23.1V311.1h56C349.3 311.1 360 301.3 360 288S349.3 264 336 264z"/></svg>${translate("Move")}</div>`}`:""}
  ${t.is_public&&!t.is_mine?`<div role="menuitem" id="report-prompt-card-button-${r}" class="flex gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group text-orange-500" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-md" viewBox="0 0 512 512"><path d="M498.5 6.232c-19.76-11.99-38.92-3.226-41.61-1.1c-41.75 19.06-76.02 27.94-107.8 27.94c-28.92 0-51.74-7.321-75.9-15.09C247.5 8.844 220.1 .3094 185.2 .3055C159 .3055 121.3 2.641 32 38.84V16.01c0-8.836-7.164-15.1-16-15.1S0 7.172 0 16.01V496C0 504.8 7.164 512 16 512S32 504.8 32 496v-104.9c14.47-6.441 77.75-38.93 148.8-38.93c36.8 0 67.14 7.713 99.25 15.89c30.74 7.82 62.49 15.9 99.31 15.9c35.46 0 72.08-7.553 111.1-23.09c12.28-4.781 20.38-16.6 20.38-29.78L512 32.35C512 22.01 507.4 11.6 498.5 6.232zM479.7 331c-36.11 14.07-68.93 20.91-100.3 20.91c-32.81 0-61.26-7.238-91.39-14.9C255.4 328.7 221.7 320.2 180.8 320.2c-45.89 0-93.61 11.31-145.9 34.58L32 356.1V73.37l28.01-11.35c49.34-19.98 90.29-29.7 125.2-29.7c30.74 0 53.8 7.406 78.2 15.24c25.44 8.172 51.75 16.62 85.69 16.62c69.43 0 130.9-32.17 130.9-32.17L479.7 331z"/></svg>${translate("Report")}</div></div></div>`:""}

  ${t.is_mine||i?.id==="recent"?`<div role="menuitem" id="delete-prompt-card-button-${r}" class="flex gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group text-red-500" tabindex="-1" data-orientation="vertical" data-radix-collection-item=""><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5555 4C10.099 4 9.70052 4.30906 9.58693 4.75114L9.29382 5.8919H14.715L14.4219 4.75114C14.3083 4.30906 13.9098 4 13.4533 4H10.5555ZM16.7799 5.8919L16.3589 4.25342C16.0182 2.92719 14.8226 2 13.4533 2H10.5555C9.18616 2 7.99062 2.92719 7.64985 4.25342L7.22886 5.8919H4C3.44772 5.8919 3 6.33961 3 6.8919C3 7.44418 3.44772 7.8919 4 7.8919H4.10069L5.31544 19.3172C5.47763 20.8427 6.76455 22 8.29863 22H15.7014C17.2354 22 18.5224 20.8427 18.6846 19.3172L19.8993 7.8919H20C20.5523 7.8919 21 7.44418 21 6.8919C21 6.33961 20.5523 5.8919 20 5.8919H16.7799ZM17.888 7.8919H6.11196L7.30423 19.1057C7.3583 19.6142 7.78727 20 8.29863 20H15.7014C16.2127 20 16.6417 19.6142 16.6958 19.1057L17.888 7.8919ZM10 10C10.5523 10 11 10.4477 11 11V16C11 16.5523 10.5523 17 10 17C9.44772 17 9 16.5523 9 16V11C9 10.4477 9.44772 10 10 10ZM14 10C14.5523 10 15 10.4477 15 11V16C15 16.5523 14.5523 17 14 17C13.4477 17 13 16.5523 13 16V11C13 10.4477 13.4477 10 14 10Z" fill="currentColor"></path></svg>${translate("Delete")}</div></div></div>`:""}`;document.body.insertAdjacentHTML("beforeend",c),adjustMenuPosition(document.querySelector("#prompt-card-menu")),addPromptManagerCardMenuEventListeners(t)}function addPromptManagerCardMenuEventListeners(e){const t=e.id,o=document.querySelector(`#run-prompt-card-button-${t}`),r=document.querySelector(`#run-from-step-prompt-card-button-${t}`),n=document.querySelector(`#duplicate-prompt-card-button-${t}`),i=document.querySelector(`#public-prompt-card-button-${t}`),a=document.querySelector(`#view-prompt-card-button-${t}`),s=document.querySelector(`#move-prompt-card-button-${t}`),l=document.querySelector(`#report-prompt-card-button-${t}`),d=document.querySelector(`#delete-prompt-card-button-${t}`);o?.addEventListener("click",c=>{c.stopPropagation(),c.preventDefault(),closeMenus(),document.querySelector("#modal-manager #modal-close-button-manager")?.click(),runPromptChain(e,0,!c.shiftKey)}),r?.addEventListener("click",c=>{c.stopPropagation(),closeMenus(),toast("Click on the play button of the step you want to start from","success",1e4),openPromptEditorModal(e),document.querySelectorAll("#run-from-here-icon").forEach(u=>{u.style.fill="#19c37d",u.style.stroke="#19c37d"})}),a?.addEventListener("click",c=>{c.stopPropagation(),closeMenus();const u={...e};e.is_mine||(u.is_public=!1,delete u.id,delete u.folder),openPromptEditorModal(u)}),n?.addEventListener("click",c=>{c.stopPropagation(),closeMenus();const u=getLastSelectedPromptFolder();updatePromptFolderCount(u?.id,[t]),chrome.runtime.sendMessage({type:"duplicatePrompt",forceRefresh:!0,detail:{promptId:t}},m=>{if(m.error&&m.error.type==="limit"){errorUpgradeConfirmation(m.error);return}initializeContinueButton(!0),document.querySelector("#prompt-card-menu")?.remove();const g=document.querySelector(`#prompt-card-${t}`);addOrReplacePromptCard(m,g)})}),i?.addEventListener("click",c=>{c.stopPropagation(),closeMenus(),chrome.runtime.sendMessage({type:"togglePromptPublic",forceRefresh:!0,detail:{promptId:t}},u=>{const m=getLastSelectedPromptFolder();if(!u.prompt.is_public&&m?.id==="public"){document.querySelector(`#prompt-card-${t}`).remove();return}addOrReplacePromptCard(u.prompt)})}),s?.addEventListener("click",c=>{c.stopPropagation(),closeMenus();const u=document.querySelector(`#prompt-checkbox-${t}`);u&&!u.checked&&u.click(),setTimeout(()=>handleClickMovePromptsButton(),100)}),l?.addEventListener("click",()=>{openReportPromptModal(e)}),d?.addEventListener("click",c=>{c.stopPropagation(),closeMenus(),showConfirmDialog("Delete prompt","Are you sure you want to delete this prompt?","Cancel","Delete",null,()=>{updatePromptFolderCount(null,[t]),document.querySelector(`#prompt-card-${t}`).remove();const u=document.querySelector("#modal-manager #prompt-manager-prompt-list");if(u.children.length===0&&u.appendChild(noPromptElement()),getLastSelectedPromptFolder()?.id==="recent"){chrome.storage.local.get(["userInputValueHistory"],m=>{const g=m.userInputValueHistory.filter(p=>p.inputValue!==e.steps[0]);chrome.storage.local.set({userInputValueHistory:g})});return}chrome.runtime.sendMessage({type:"deletePrompts",detail:{promptIds:[t]}},()=>{initializeContinueButton(!0)})})})}function toggleReportSubmitButton(e){const t=document.querySelector("#report-modal-submit-button");e.code==="select"?t.disabled=!0:t.disabled=!1}function openReportPromptModal(e){const t=document.createElement("div");document.body.appendChild(t),t.style="position:fixed;top:0px;left:0px;width:100%;height:100%;background-color:rgba(0,0,0,0.5);z-index:10010;display:flex;align-items:center;justify-content:center;color:lightslategray;",t.id="report-modal",t.addEventListener("click",d=>{d.target.id==="report-modal"&&t.remove()});const o=document.createElement("div");o.style="width:400px;min-height:300px;background-color:#0b0d0e;border-radius:8px;padding:16px;display:flex;flex-direction:column;align-items:flex-start;justify-content:start;border:solid 1px lightslategray;",t.appendChild(o);const r=document.createElement("div");r.style="font-size:1.25rem;font-weight:500;",r.textContent="Report prompt",o.appendChild(r);const n=document.createElement("div");n.style="font-size:0.875rem;font-weight:500;margin-top:32px;",n.textContent="Why are you reporting this prompt?",o.appendChild(n);const i=document.createElement("div");i.style="position:relative;width:100%;z-index:1000;margin-top:16px;",i.innerHTML=dropdown("Report-Reason",reportReasonList,reportReasonList[0],"code","left"),o.appendChild(i),addDropdownEventListener("Report-Reason",reportReasonList,"code",d=>toggleReportSubmitButton(d));const a=document.createElement("div");a.style="display:flex;justify-content:flex-end;align-items:center;width:100%;margin-top:32px;",o.appendChild(a);const s=document.createElement("button");s.classList="btn btn-secondary border-0",s.style="font-size:0.875rem;font-weight:500;padding:8px 16px;margin-right:16px;",s.textContent="Cancel",s.addEventListener("click",()=>{t.remove()}),a.appendChild(s);const l=document.createElement("button");l.classList="btn composer-submit-btn composer-submit-button-color",l.id="report-modal-submit-button",l.disabled=!0,l.style="font-size:0.875rem;font-weight:500;padding:8px 16px;",l.textContent="Submit",l.addEventListener("click",()=>{chrome.runtime.sendMessage({type:"reportPrompt",forceRefresh:!0,detail:{promptId:e.id}},c=>{c.status==="success"&&toast("Prompt reported"),c.status==="same user"&&toast("You have already reported this prompt")}),t.remove();const d=document.querySelector(`#library-item-action-wrapper-${e.id}`);d.style.opacity="0.3",d.style.pointerEvents="none"}),a.appendChild(l)}async function showPromptManagerSidebarSettingsMenu(e){const{right:t,top:o}=e.getBoundingClientRect(),r=await chrome.runtime.sendMessage({type:"checkHasSubscription"}),n=t+2,i=o-120,a=`<div id="prompt-manager-sidebar-settings-menu" dir="ltr" style="position:fixed;left:0;top:0;transform:translate3d(${n}px,${i}px,0);min-width:max-content;z-index:10001;--radix-popper-anchor-width:18px;--radix-popper-anchor-height:18px;--radix-popper-available-width:1167px;--radix-popper-available-height:604px;--radix-popper-transform-origin:0% 0px"><div data-side="bottom" data-align="start" role="menu" aria-orientation="vertical" data-state="open" data-radix-menu-content="" dir="ltr" aria-labelledby="radix-:r6g:" class="text-token-text-primary mt-2 min-w-[200px] max-w-xs rounded-2xl bg-token-main-surface-secondary shadow-long p-1" tabindex="-1" data-orientation="vertical" style="outline:0;--radix-dropdown-menu-content-transform-origin:var(--radix-popper-transform-origin);--radix-dropdown-menu-content-available-width:var(--radix-popper-available-width);--radix-dropdown-menu-content-available-height:var(--radix-popper-available-height);--radix-dropdown-menu-trigger-width:var(--radix-popper-anchor-width);--radix-dropdown-menu-trigger-height:var(--radix-popper-anchor-height);pointer-events:auto">
  
  <div role="menuitem" id="sort-prompt-categories-button" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item="">${translate("Sort categories")} <svg aria-hidden="true" fill="none" focusable="false" height="1em" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" style="min-width:16px" viewBox="0 0 24 24" width="1em"><path d="m9 18 6-6-6-6"></path></svg></div>

  <div role="menuitem" id="export-prompts-button" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item="">${translate("Export prompts")} ${r?"":'<span class="text-white rounded-md bg-green-500 px-2 text-sm">Pro</span>'}</div>
  
  <div role="menuitem" id="import-prompts-button" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item="">${translate("Import prompts")} ${r?"":'<span class="text-white rounded-md bg-green-500 px-2 text-sm">Pro</span>'}</div></div></div>`;document.body.insertAdjacentHTML("beforeend",a),addPromptManagerSidebarSettingsMenuEventListeners()}function addPromptManagerSidebarSettingsMenuEventListeners(){const e=document.querySelector("#prompt-manager-sidebar-settings-menu"),t=document.querySelector("#sort-prompt-categories-button"),o=document.querySelector("#export-prompts-button"),r=document.querySelector("#import-prompts-button");t.addEventListener("mouseenter",()=>{showPromptCategorySortByMenu(e)}),o.addEventListener("mouseover",()=>{document.querySelector("#prompt-manager-sidebar-settings-sort-menu")?.remove()}),o.addEventListener("click",()=>{chrome.runtime.sendMessage({type:"checkHasSubscription"},n=>{if(!n){errorUpgradeConfirmation({title:"This is a Pro feature",message:"Exporting prompts requires a Pro subscription. Upgrade to Pro to remove all limits."});return}document.querySelector("#prompt-manager-sidebar-settings-menu")?.remove();const i=document.querySelector("#prompt-manager-sidebar-settings-button");i.innerHTML='<svg x="0" y="0" viewbox="0 0 40 40" class="spinner icon icon-md"><circle fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-dasharray="125.6" cx="20" cy="20" r="12"></circle></svg>',chrome.runtime.sendMessage({type:"getAllPrompts",detail:{}},async a=>{const{userInputValueHistory:s}=await chrome.storage.local.get(["userInputValueHistory"]);if(resetPromptManagerSidebarSettingsButton(),a.error&&a.error.type==="limit"){errorUpgradeConfirmation(a.error);return}if(!a||Object.keys(a).length===0){toast("No prompts found","error");return}a.Recent=s;const l=new Blob([JSON.stringify(a)],{type:"application/json"}),d=URL.createObjectURL(l),c=document.createElement("a");c.href=d;const u=new Date,m=`${u.getFullYear()}-${u.getMonth()+1}-${u.getDate()}__${u.getHours()}-${u.getMinutes()}-${u.getSeconds()}`;c.download=`Superpower ChatGPT Prompts - ${m}.json`,c.click()})})}),r.addEventListener("mouseover",()=>{document.querySelector("#prompt-manager-sidebar-settings-sort-menu")?.remove()}),r.addEventListener("click",()=>{chrome.runtime.sendMessage({type:"checkHasSubscription"},n=>{if(!n){errorUpgradeConfirmation({title:"This is a Pro feature",message:"Importing prompts requires a Pro subscription. Upgrade to Pro to remove all limits."});return}document.querySelector("#prompt-manager-sidebar-settings-menu")?.remove();const i=document.querySelector("#prompt-manager-sidebar-settings-button");i.innerHTML='<svg x="0" y="0" viewbox="0 0 40 40" class="spinner icon icon-md"><circle fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-dasharray="125.6" cx="20" cy="20" r="12"></circle></svg>';const a=document.createElement("input");a.type="file",a.accept=".json",a.addEventListener("change",s=>{if(!s.target.files.length){resetPromptManagerSidebarSettingsButton();return}const l=s.target.files[0];if(!l){resetPromptManagerSidebarSettingsButton();return}const d=new FileReader;d.onload=c=>{if(!c.target.result){resetPromptManagerSidebarSettingsButton();return}const u=JSON.parse(c.target.result);if(typeof u!="object"){resetPromptManagerSidebarSettingsButton(),toast("Invalid file format","error");return}const m=u.Recent;delete u.Recent,m&&chrome.storage.local.set({userInputValueHistory:m});const g=Object.values(u);if(!g.every(p=>Array.isArray(p)&&p.every(h=>typeof h=="object"))){resetPromptManagerSidebarSettingsButton(),toast("Invalid file format","error");return}chrome.runtime.sendMessage({type:"addPrompts",detail:{prompts:g.flat().map(p=>({...p,tags:p.tags.map(h=>h.id)}))}},p=>{if(resetPromptManagerSidebarSettingsButton(),p.error){p.error.type==="limit"?errorUpgradeConfirmation(p.error):toast("Error importing prompts","error");return}createManager("prompts"),toast("Imported Prompts Successfully")})},d.onerror=()=>{resetPromptManagerSidebarSettingsButton()},d.readAsText(l)}),a.oncancel=()=>{resetPromptManagerSidebarSettingsButton()},a.click()})})}function resetPromptManagerSidebarSettingsButton(){const e=document.querySelector("#prompt-manager-sidebar-settings-button");e&&(e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-md" fill="currentColor" viewBox="0 0 512 512"><path d="M495.9 166.6C499.2 175.2 496.4 184.9 489.6 191.2L446.3 230.6C447.4 238.9 448 247.4 448 256C448 264.6 447.4 273.1 446.3 281.4L489.6 320.8C496.4 327.1 499.2 336.8 495.9 345.4C491.5 357.3 486.2 368.8 480.2 379.7L475.5 387.8C468.9 398.8 461.5 409.2 453.4 419.1C447.4 426.2 437.7 428.7 428.9 425.9L373.2 408.1C359.8 418.4 344.1 427 329.2 433.6L316.7 490.7C314.7 499.7 307.7 506.1 298.5 508.5C284.7 510.8 270.5 512 255.1 512C241.5 512 227.3 510.8 213.5 508.5C204.3 506.1 197.3 499.7 195.3 490.7L182.8 433.6C167 427 152.2 418.4 138.8 408.1L83.14 425.9C74.3 428.7 64.55 426.2 58.63 419.1C50.52 409.2 43.12 398.8 36.52 387.8L31.84 379.7C25.77 368.8 20.49 357.3 16.06 345.4C12.82 336.8 15.55 327.1 22.41 320.8L65.67 281.4C64.57 273.1 64 264.6 64 256C64 247.4 64.57 238.9 65.67 230.6L22.41 191.2C15.55 184.9 12.82 175.3 16.06 166.6C20.49 154.7 25.78 143.2 31.84 132.3L36.51 124.2C43.12 113.2 50.52 102.8 58.63 92.95C64.55 85.8 74.3 83.32 83.14 86.14L138.8 103.9C152.2 93.56 167 84.96 182.8 78.43L195.3 21.33C197.3 12.25 204.3 5.04 213.5 3.51C227.3 1.201 241.5 0 256 0C270.5 0 284.7 1.201 298.5 3.51C307.7 5.04 314.7 12.25 316.7 21.33L329.2 78.43C344.1 84.96 359.8 93.56 373.2 103.9L428.9 86.14C437.7 83.32 447.4 85.8 453.4 92.95C461.5 102.8 468.9 113.2 475.5 124.2L480.2 132.3C486.2 143.2 491.5 154.7 495.9 166.6V166.6zM256 336C300.2 336 336 300.2 336 255.1C336 211.8 300.2 175.1 256 175.1C211.8 175.1 176 211.8 176 255.1C176 300.2 211.8 336 256 336z"/></svg>')}function showPromptCategorySortByMenu(e){const{selectedPromptsManagerFoldersSortBy:t="alphabetical"}=cachedSettings,{right:o,top:r}=e.getBoundingClientRect(),n=o+2,i=r-50,a=`<div id="prompt-manager-sidebar-settings-sort-menu" dir="ltr" style="position:fixed;left:0;top:0;transform:translate3d(${n}px,${i}px,0);min-width:max-content;z-index:10001;--radix-popper-anchor-width:18px;--radix-popper-anchor-height:18px;--radix-popper-available-width:1167px;--radix-popper-available-height:604px;--radix-popper-transform-origin:0% 0px"><div data-side="bottom" data-align="start" role="menu" aria-orientation="vertical" data-state="open" data-radix-menu-content="" dir="ltr" aria-labelledby="radix-:r6g:" class="text-token-text-primary mt-2 min-w-[200px] max-w-xs rounded-2xl bg-token-main-surface-secondary shadow-long p-1" tabindex="-1" data-orientation="vertical" style="outline:0;--radix-dropdown-menu-content-transform-origin:var(--radix-popper-transform-origin);--radix-dropdown-menu-content-available-width:var(--radix-popper-available-width);--radix-dropdown-menu-content-available-height:var(--radix-popper-available-height);--radix-dropdown-menu-trigger-width:var(--radix-popper-anchor-width);--radix-dropdown-menu-trigger-height:var(--radix-popper-anchor-height);pointer-events:auto">
  
    <div role="menuitem" id="alphabetical-sort-prompts-button" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item="">${translate("Alphabetical (A\u2192Z)")} ${t==="alphabetical"?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md"><path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path></svg>':""}</div>

    <div role="menuitem" id="alphabetical-reverse-sort-prompts-button" class="flex items-center justify-between gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item="">${translate("Alphabetical (Z\u2192A)")} ${t==="alphabetical-reverse"?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md"><path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path></svg>':""}</div>

    <div role="menuitem" id="create-at-sort-prompts-button" class="flex gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item="">${translate("Create date")} ${t==="created_at"?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md"><path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path></svg>':""}</div>
    
    <div role="menuitem" id="update-at-sort-prompts-button" class="flex gap-2 rounded-xl p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-tertiary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item="">${translate("Update date")} ${t==="updated_at"?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="icon icon-md"><path fill="currentColor" fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m14.076-4.068a1 1 0 0 1 .242 1.393l-4.75 6.75a1 1 0 0 1-1.558.098l-2.5-2.75a1 1 0 0 1 1.48-1.346l1.66 1.827 4.032-5.73a1 1 0 0 1 1.394-.242" clip-rule="evenodd"></path></svg>':""}</div></div></div>`;document.body.insertAdjacentHTML("beforeend",a),addPromptCategorySortByMenuEventListeners()}function addPromptCategorySortByMenuEventListeners(){const e=document.querySelector("#alphabetical-sort-prompts-button"),t=document.querySelector("#alphabetical-reverse-sort-prompts-button"),o=document.querySelector("#create-at-sort-prompts-button"),r=document.querySelector("#update-at-sort-prompts-button");e.addEventListener("click",()=>{chrome.storage.local.set({settings:{...cachedSettings,selectedPromptsManagerFoldersSortBy:"alphabetical"}},()=>{const n=document.querySelector("#prompt-manager-sidebar");n.innerHTML="",n.insertAdjacentElement("beforeend",promptManagerSidebarContent())})}),t.addEventListener("click",()=>{chrome.storage.local.set({settings:{...cachedSettings,selectedPromptsManagerFoldersSortBy:"alphabetical-reverse"}},()=>{const n=document.querySelector("#prompt-manager-sidebar");n.innerHTML="",n.insertAdjacentElement("beforeend",promptManagerSidebarContent())})}),o.addEventListener("click",()=>{chrome.storage.local.set({settings:{...cachedSettings,selectedPromptsManagerFoldersSortBy:"created_at"}},()=>{const n=document.querySelector("#prompt-manager-sidebar");n.innerHTML="",n.insertAdjacentElement("beforeend",promptManagerSidebarContent())})}),r.addEventListener("click",()=>{chrome.storage.local.set({settings:{...cachedSettings,selectedPromptsManagerFoldersSortBy:"updated_at"}},()=>{const n=document.querySelector("#prompt-manager-sidebar");n.innerHTML="",n.insertAdjacentElement("beforeend",promptManagerSidebarContent())})})}const statusMap={invited:{title:"Invitation Sent",color:"#e06c2b"},accepted:{title:"Invite Accepted",color:"#2f80ed"},upgraded:{title:"Upgraded to Pro",color:"#19c37d"}};function inviteManagerModalContent(){const e=document.createElement("div");return e.id="modal-content-invite-manager",e.style="overflow-y: hidden;position: relative;height:100%; width:100%",e.classList="markdown prose-invert flex",e.appendChild(loadingSpinner("invite-manager-content")),chrome.runtime.sendMessage({type:"getInvites",detail:{}},async t=>{if((!t||!Array.isArray(t))&&(t=[]),e.innerHTML="",t.length===0){e.innerHTML=`<div id="no-invites-found" class="flex items-center justify-center w-full h-full">
        <p class="text-gray-500">
          You have not sent any invites yet. Click on the "Invite A Friend" button to send an invite and track it here.
        </p>
      </div>`;return}const o=document.createElement("div");o.id="invite-list",o.classList="flex flex-col gap-4 w-full overflow-y-auto p-4",t.forEach(r=>{const n=document.createElement("div");n.id=`invite-item-${r.id}`,n.classList="flex items-center justify-between p-4 bg-token-sidebar-surface-secondary rounded-lg shadow-md";const i=r.upgraded_at||r.accepted_at||r.created_at;n.innerHTML=`
          <p class="font-semibold w-1/2">${r.email}</p>
          <p class="text-sm py-1 px-4 rounded-full" style="background-color:${statusMap[r.status].color}">${statusMap[r.status].title}</p>
          <p class="text-gray-500 text-sm">Last update: ${new Date(i).toLocaleString()}</p>
      `,o.appendChild(n)}),e.appendChild(o)}),e}function inviteManagerModalActions(){const e=document.createElement("div");e.classList="flex items-center justify-end w-full mt-2";const t=document.createElement("button");return t.classList="btn composer-submit-btn composer-submit-button-color",t.innerText=translate("Invite A Friend"),t.addEventListener("click",()=>{openInviteUserModal()}),e.appendChild(t),e}function openInviteUserModal(){const e=document.querySelector("#invite-user-dialog");e&&e.remove();const t=`<div data-state="open" class="fixed inset-0 bg-black/50 dark:bg-black/80" style="pointer-events: auto;">
    <div class="h-full w-full grid grid-cols-[10px_1fr_10px] grid-rows-[minmax(10px,1fr)_auto_minmax(10px,1fr)] md:grid-rows-[minmax(20px,1fr)_auto_minmax(20px,1fr)] overflow-y-auto">
      <div id="invite-user-dialog-content" role="dialog" data-state="open" class="relative col-auto col-start-2 row-auto row-start-2 w-full rounded-xl text-start shadow-xl transition-all start-1/2 ltr:-translate-x-1/2 rtl:translate-x-1/2 bg-token-sidebar-surface-primary max-w-xl border-token-border-medium border" tabindex="-1" style="pointer-events: auto;">
        <div class="px-4 pb-4 pt-5 flex items-center justify-between border-b border-token-border-medium">
          <div class="flex">
            <div class="flex items-center">
              <div class="flex grow flex-col gap-1">
                <h2 as="h3" class="text-lg font-medium leading-6 text-token-text-tertiary">Invite A Friend</h2>
              </div>
            </div>
          </div>
        </div>
        <div class="p-4">
          <div class="text-sm text-token-text-primary">Please enter their email address</div>
          <div class="mt-2">
            <input id="invite-email-input" type="email" placeholder="Enter email address" class="p-2 rounded-md border border-token-border-medium bg-token-main-surface-primary text-token-text-primary w-full" />
          </div>
          <div class="mt-5">
            <div class="mt-5 flex justify-between">
              <div class="flex flex-row-reverse gap-3 ms-auto">
                <button id="confirm-button" class="btn relative btn-success text-white" as="button">
                  <div class="flex w-full gap-2 items-center justify-center">Send invite</div>
                </button>
                <button id="cancel-button" class="btn relative btn-secondary" as="button">
                  <div class="flex w-full gap-2 items-center justify-center">Cancel</div>
                </button>
              </div>
            </div>
            <div class="w-full flex mt-2 text-token-text-tertiary text-xs">
              <div>
                * Invite will only be sent if the email address is not already registered with the service.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  `,o=document.createElement("div");o.id="invite-user-dialog",o.classList="absolute inset-0",o.style="z-index: 100101;",o.innerHTML=t,document.body.appendChild(o);const r=document.querySelector("#invite-user-dialog #invite-email-input"),n=document.querySelector("#invite-user-dialog #confirm-button"),i=document.querySelector("#invite-user-dialog #cancel-button");n.addEventListener("click",a=>{if(a.preventDefault(),a.stopPropagation(),closeMenus(),!document.querySelector("#invite-user-dialog #confirm-button")?.querySelector("#progress-spinner")){if(!r.value||!r.value.includes("@")){toast("Please enter a valid Email address","error");return}chrome.runtime.sendMessage({type:"sendInvite",detail:{email:r.value.trim()}},async s=>{if(s.success){const l=document.querySelector("#modal-content-invite-manager");if(l){const d=document.createElement("div");d.classList="flex items-center justify-between p-4 bg-token-sidebar-surface-secondary rounded-lg shadow-md",d.innerHTML=`
            <p class="font-semibold w-1/2">${r.value.trim()}</p>
            <p class="text-sm py-1 px-4 rounded-full" style="background-color:${statusMap.invited.color}">${statusMap.invited.title}</p>
            <p class="text-gray-500 text-sm">Last update: ${new Date().toLocaleString()}</p>
          `;const c=document.querySelector("#no-invites-found");if(c){c.remove();const u=document.createElement("div");u.id="invite-list",u.classList="flex flex-col gap-4 w-full overflow-y-auto p-4",l.appendChild(u)}l.querySelector("#invite-list").insertAdjacentElement("afterbegin",d)}}toast(s.message,s.success?"success":"error")}),o.remove()}}),i.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation(),closeMenus(),!document.querySelector("#invite-user-dialog #confirm-button")?.querySelector("#progress-spinner")&&o.remove()}),o.addEventListener("click",a=>{if(document.querySelector("#invite-user-dialog #confirm-button").querySelector("#progress-spinner"))return;const s=document.querySelector("#invite-user-dialog-content");isDescendant(s,a.target)||o.remove()})}let settingTestAudio,cachedSettings={};function createSettingsModal(e="general"){const t=settingsModalContent(e),o=settingsModalActions();createModal("Settings","You can change the Superpower settings here",t,o,!1)}const inactiveTabElementStyles="border-right: 1px solid; border-bottom:2px solid; border-top-right-radius: 16px; min-width:150px;",activeTabElementStyles="border:solid 2px ; border-bottom:0; border-top-right-radius: 16px;min-width:150px;",inactiveTabElementClasses="bg-token-sidebar-surface-primary text-sm text-token-text-primary px-2 py-3 h-full border-token-border-medium",activeTabElementClasses="bg-token-sidebar-surface-secondary text-sm text-token-text-primary px-2 py-3 h-full border-token-border-medium active-tab";function selectedSettingsTabContent(e,t){switch(e){case"general":return generalTabContent(t);case"conversation":return conversationTabContent(t);case"folders":return foldersTabContent(t);case"voice":return textToSpeechTabContent(t);case"prompt-input":return promptInputTabContent(t);case"splitter":return splitterTabContent(t);default:return generalTabContent(t)}}function settingsModalContent(e="general"){const t=["general","conversation","folders","voice","prompt-input","splitter"];let o=e;window.location.hash=`setting/${o}`;const r=document.createElement("div");r.style="display: flex; flex-direction: column; justify-content: start; align-items: start;width:100%; height: 100%;";const n=document.createElement("div");return n.style="display: flex; flex-direction: row; justify-content: start; align-items: center; width: 100%; z-index:1000;overflow:hidden; overflow-x:scroll;-ms-overflow-style: none; scrollbar-width: none;",n.classList="scrollbar-hide bg-token-sidebar-surface-primary",chrome.runtime.sendMessage({type:"checkHasSubscription"},i=>{t.forEach(s=>{const l=document.createElement("button");l.classList=o===s?activeTabElementClasses:inactiveTabElementClasses,l.style=o===s?activeTabElementStyles:inactiveTabElementStyles,l.textContent=translate(capitalize(s).replace("-"," ")),l.addEventListener("click",()=>{window.location.hash=`setting/${s}`,o=s;const d=document.querySelector(".active-tab");d.classList=inactiveTabElementClasses,d.style=inactiveTabElementStyles,l.classList=activeTabElementClasses,l.style=activeTabElementStyles;const c=document.querySelector("#settings-modal-tab-content"),u=selectedSettingsTabContent(o,i);c.parentNode.replaceChild(u,c)}),n.appendChild(l)});const a=document.createElement("div");a.classList="w-full h-full border-b-2 border-token-border-xheavy",n.appendChild(a),r.appendChild(selectedSettingsTabContent(o,i))}),r.appendChild(n),r}function generalTabContent(e=!1){const t=document.createElement("div");t.id="settings-modal-tab-content",t.style="display: flex; justify-content: start; align-items: start;overflow-y: auto; width:100%; padding: 16px; height: 100%;padding-bottom:80px;";const o=document.createElement("div");o.style="display: flex; flex-direction: column; justify-content: start; align-items: start; width: 50%;padding-right: 8px;";const r=document.createElement("div");r.style="display: flex; flex-direction: column; justify-content: start; align-items: end; width: 50%;padding-left: 8px;";const n=document.createElement("div");n.style="display: flex; flex-direction: column; justify-content: start; align-items: start; width: 100%; padding: 8px 0;border-bottom: 1px solid #333;";const i=document.createElement("div");i.style="display: flex; flex-direction: row; justify-content: start; align-items: center; width: 100%; margin: 8px 0;",i.textContent="Dark mode";const a=document.createElement("label");a.classList="sp-switch",a.style.marginLeft="auto";const s=document.createElement("input");s.type="checkbox",s.checked=!!document.querySelector("html").classList.contains("dark"),s.addEventListener("change",()=>{document.querySelector("html").classList.contains("dark")?(document.querySelector("html").classList.replace("dark","light"),document.querySelector("html").style="color-scheme: light;",window.localStorage.setItem("theme","light")):(document.querySelector("html").classList.replace("light","dark"),document.querySelector("html").style="color-scheme: dark;",window.localStorage.setItem("theme","dark")),refreshPage()});const l=document.createElement("span");l.classList="sp-switch-slider round",a.appendChild(s),a.appendChild(l),i.appendChild(a),n.appendChild(i),o.appendChild(n);const d=createSwitch("Auto Reload on Update","Automatically reload all ChatGPT tabs when extension is updated","autoReloadOnUpdate",!0);o.appendChild(d);const c=createSwitch("Hide Release Note","Don\u2019t show release note when extension is updated","hideReleaseNote",!0);o.appendChild(c);const u=createSwitch("Hide Update Notification","Don\u2019t show update notification when new version is available","hideUpdateNotification",!1);o.appendChild(u);const m=createSwitch("Hide Daily Newsletter","Do not show the daily newsletter popup inside ChatGPT.","hideNewsletter",!1,null,[],!1,!1);o.appendChild(m);const g=document.createElement("div");g.innerHTML='<iframe style="border-radius:8px;width:350px; max-width:100%;height:400px;" src="https://discord.com/widget?id=1083455984489476220&theme=dark" allowtransparency="true" frameborder="0" sandbox="allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts"></iframe>',r.appendChild(g),t.appendChild(o),t.appendChild(r);const p=document.createElement("div");p.classList="text-xs text-token-text-tertiary flex justify-start items-center flex-wrap w-full px-4 py-2 bg-token-sidebar-surface-primary border-t border-token-border-medium absolute bottom-0 start-0";const h=document.createElement("a");h.href="https://help.openai.com/en/collections/3742473-chatgpt",h.target="_blank",h.textContent="Get help \u279C",h.style="color: #999; font-size: 12px; margin: 8px 0;min-width: 20%;text-align:center;padding-right: 8px;padding-right:",p.appendChild(h);const f=document.createElement("a");f.href="https://www.passionfroot.me/superpower",f.target="_blank",f.textContent="Partner with us \u279C",f.style="color: #999; font-size: 12px; margin: 8px 0;min-width: 20%;text-align:center;padding-right: 8px;",p.appendChild(f);const v=document.createElement("a");v.href="https://ezi.notion.site/Superpower-ChatGPT-FAQ-9d43a8a1c31745c893a4080029d2eb24",v.target="_blank",v.textContent="FAQ \u279C",v.style="color: #999; font-size: 12px; margin: 8px 0;min-width: 20%;text-align:center;padding-right: 8px;",p.appendChild(v);const x=document.createElement("a");x.href="https://www.youtube.com/@spchatgpt",x.target="_blank",x.textContent="YouTube \u279C",x.style="color: #999; font-size: 12px; margin: 8px 0;min-width: 20%;text-align:center;padding-right: 8px;",p.appendChild(x);const y=document.createElement("a");return y.href="https://spchatgpt.com/affiliate",y.target="_blank",y.textContent="Affiliate \u279C",y.style="color: #999; font-size: 12px; margin: 8px 0;min-width: 20%;text-align:center;padding-right: 8px;",p.appendChild(y),t.appendChild(p),t}function setConversationWidth(e){document.querySelectorAll("main article").length===0&&!isOnNewChatPage()||Array.from(document.querySelectorAll('[class*="[--thread-content-max-width:40rem]"], [class*="[--thread-content-max-width:32rem]"], [class*="agent-turn"]')).forEach(t=>{t.closest('div[data-paragen-root="true"]')||(t.style.maxWidth=`${e}%`,t.style.marginLeft="auto",t.style.marginRight="auto",t.classList.remove("[width:min(90cqw,var(--thread-content-max-width))]"),t.parentElement?.classList.remove("mx-auto"))})}function resetConversationWidth(){document.querySelectorAll("main article").length===0&&!isOnNewChatPage()||Array.from(document.querySelectorAll('[class*="[--thread-content-max-width:40rem]"], [class*="[--thread-content-max-width:32rem]"], [class*="agent-turn"]')).forEach(e=>{e.style.removeProperty("max-width"),e.style.removeProperty("margin-left"),e.style.removeProperty("margin-right"),e.classList.add("[width:min(90cqw,var(--thread-content-max-width))]"),e.parentElement?.classList.add("mx-auto")})}function toggleCustomWidthSwitch(e){const t=document.querySelector("#conversation-width-input"),o=document.querySelector("#conversation-width-detail");t.disabled=!e,e?(setConversationWidth(cachedSettings.conversationWidth),o.classList="flex flex-row justify-start items-center w-full pb-2 text-token-text-secondary opacity-100",o.style="border-bottom: 1px solid #333;"):(resetConversationWidth(),o.classList="flex flex-row justify-start items-center w-full pb-2 text-token-text-secondary opacity-50",o.style="border-bottom: 1px solid #555; pointer-events: none;")}function conversationTabContent(e=!1){const t=document.createElement("div");t.id="settings-modal-tab-content",t.style="display: flex; flex-direction: column; justify-content: start; align-items: start;overflow-y: auto; width:100%; padding: 16px; margin-width:100%; height: 100%;";const{customConversationWidth:o,conversationWidth:r,autoDelete:n,autoDeleteNumDays:i,autoDeleteExcludeFolders:a,autoArchive:s,autoArchiveNumDays:l,autoArchiveExcludeFolders:d}=cachedSettings,c=createSwitch("Custom Conversation Width",'OFF: Use default / ON: Set Conversation Width (30%-90%) (<a style="text-decoration:underline; " href="https://youtu.be/UYX-J4ybB14?si=uq7UwE92uds7pIAr" target="blank">Learn More</a>)',"customConversationWidth",!1,toggleCustomWidthSwitch,[],!1,!1);t.appendChild(c);const u=document.createElement("div");u.id="conversation-width-detail",u.classList=`flex flex-row justify-start items-center w-full pb-2 text-token-text-secondary opacity-${o?"100":"50"}`,u.style="border-bottom: 1px solid #555;",t.appendChild(u);const m=document.createElement("div");m.classList="flex flex-row justify-start items-center me-2",m.style="transform: scale(-1, 1);",m.textContent="\u21B2",u.appendChild(m);const g=document.createElement("div");g.classList="flex flex-row justify-start items-center me-2",g.textContent="Width",u.appendChild(g);const p=document.createElement("input");p.id="conversation-width-input",p.type="number",p.classList="max-w-full min-w-20 px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-token-main-surface-secondary disabled:opacity-40 text-token-text-primary",p.disabled=!o,p.value=r,p.min=30,p.max=90,p.addEventListener("change",()=>{const V=document.querySelector("#conversation-width-input");let A=Math.round(V.value);V.value=A,A<30&&(A=30),A>90&&(A=90),setConversationWidth(A),chrome.storage.local.set({settings:{...cachedSettings,conversationWidth:A,customConversationWidth:!0}})}),p.addEventListener("input",()=>{const V=document.querySelector("#conversation-width-input");let A=Math.round(V.value);V.value=A,A<30&&(A=30),A>90&&(A=90),setConversationWidth(A),chrome.storage.local.set({settings:{...cachedSettings,conversationWidth:A,customConversationWidth:!0}})}),u.appendChild(p);const h=document.createElement("div");h.classList="flex flex-row justify-start items-center ms-2",h.textContent="%",u.appendChild(h);const f=createSwitch("Auto Delete","Automatically delete old conversations after selected # of days","autoDelete",!1,toggleAutoDelete,e?["New"]:["New","\u26A1\uFE0F Requires Pro Account"],!e,!1);t.appendChild(f);const v=document.createElement("div");v.id="auto-delete-details",v.classList=`flex flex-row justify-start items-center w-full pb-2 text-token-text-secondary opacity-${n?"100":"50"}`,v.style="border-bottom: 1px solid #444;",t.appendChild(v);const x=document.createElement("div");x.classList="flex flex-row justify-start items-center me-2",x.style="transform: scale(-1, 1);",x.textContent="\u21B2",v.appendChild(x);const y=document.createElement("div");y.classList="flex flex-row justify-start items-center me-2",y.textContent="Delete after",v.appendChild(y);const b=document.createElement("input");b.id="auto-delete-input",b.type="number",b.classList="max-w-full min-w-20 px-4 py-2 me-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-token-main-surface-secondary disabled:opacity-40 text-token-text-primary",b.disabled=!n,b.value=i,b.min=1,b.max=365,b.addEventListener("change",()=>{const V=document.querySelector("#auto-delete-input");let A=Math.round(V.value);V.value=A,A<1&&(A=1),A>365&&(A=365),chrome.storage.local.set({settings:{...cachedSettings,autoDeleteNumDays:A}})}),b.addEventListener("input",()=>{const V=document.querySelector("#auto-delete-input");let A=Math.round(V.value);V.value=A,A<1&&(A=1),A>365&&(A=365),chrome.storage.local.set({settings:{...cachedSettings,autoDeleteNumDays:A}})}),v.appendChild(b);const w=document.createElement("div");w.classList="flex flex-row justify-start items-center ms-2",w.textContent="days",v.appendChild(w);const k=document.createElement("div");k.classList="mx-4",k.innerText="\u2014",v.appendChild(k);const S=document.createElement("label");S.classList="flex flex-row justify-start items-center",S.textContent="Skip conversations in folders";const M=document.createElement("input");M.id="auto-delete-exclude-folders-input",M.classList="ms-2",M.type="checkbox",M.disabled=!n,M.checked=a,M.addEventListener("change",()=>{chrome.storage.local.set({settings:{...cachedSettings,autoDeleteExcludeFolders:M.checked}})}),S.appendChild(M),v.appendChild(S);const $=createSwitch("Auto Archive","Automatically archive old conversations after selected # of days","autoArchive",!1,toggleAutoArchive,e?["New"]:["New","\u26A1\uFE0F Requires Pro Account"],!e,!1);t.appendChild($);const q=document.createElement("div");q.id="auto-archive-details",q.classList=`flex flex-row justify-start items-center w-full pb-2 text-token-text-secondary opacity-${s?"100":"50"}`,q.style="border-bottom: 1px solid #444;",t.appendChild(q);const E=document.createElement("div");E.classList="flex flex-row justify-start items-center me-2",E.style="transform: scale(-1, 1);",E.textContent="\u21B2",q.appendChild(E);const C=document.createElement("div");C.classList="flex flex-row justify-start items-center me-2",C.textContent="Archive after",q.appendChild(C);const L=document.createElement("input");L.id="auto-archive-input",L.type="number",L.classList="max-w-full min-w-20 px-4 py-2 me-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-token-main-surface-secondary disabled:opacity-40 text-token-text-primary",L.disabled=!s,L.value=l,L.min=1,L.max=365,L.addEventListener("change",()=>{const V=document.querySelector("#auto-archive-input");let A=Math.round(V.value);V.value=A,A<1&&(A=1),A>365&&(A=365),chrome.storage.local.set({settings:{...cachedSettings,autoArchiveNumDays:A}})}),L.addEventListener("input",()=>{const V=document.querySelector("#auto-archive-input");let A=Math.round(V.value);V.value=A,A<1&&(A=1),A>365&&(A=365),chrome.storage.local.set({settings:{...cachedSettings,autoArchiveNumDays:A}})}),q.appendChild(L);const _=document.createElement("div");_.classList="flex flex-row justify-start items-center ms-2",_.textContent="days",q.appendChild(_);const T=document.createElement("div");T.classList="mx-4",T.innerText="\u2014",q.appendChild(T);const z=document.createElement("label");z.classList="flex flex-row justify-start items-center",z.textContent="Skip conversations in folders";const B=document.createElement("input");B.id="auto-archive-exclude-folders-input",B.classList="ms-2",B.type="checkbox",B.disabled=!s,B.checked=d,B.addEventListener("change",()=>{chrome.storage.local.set({settings:{...cachedSettings,autoArchiveExcludeFolders:B.checked}})}),z.appendChild(B),q.appendChild(z);const F=createSwitch("Show Mini Map","Show a mini map of the full conversation on the right side of the conversation","showMiniMap",!1,toggleShowMiniMap,["New"]);t.appendChild(F);const N=createSwitch("Show Sidebar Note Button","Show the note button on the right edge of screen","showSidebarNoteButton",!0,toggleSidebarNoteVisibilitySwitch,["New"]);t.appendChild(N);const O=createSwitch("Override Model Switcher","Replace the default model switcher to show all available models","overrideModelSwitcher",!1,refreshPage,["Requires Refresh"]);t.appendChild(O);const H=createSwitch("Show Language Selector","Show the language selector in top nav","showLanguageSelector",!1,toggleShowLanguageSelector);t.appendChild(H);const P=createSwitch("Show Writing Style Selector","Show the writing style selector in top nav","showWritingStyleSelector",!1,toggleShowWritingStyleSelector);t.appendChild(P);const j=createSwitch("Show Tone Selector","Show the tone selector in top nav","showToneSelector",!1,toggleShowToneSelector);t.appendChild(j);const D=createSwitch("Auto Reset Top Navbar","Automatically reset the tone, writing style, and language to default when switching to new chats","autoResetTopNav",!0);t.appendChild(D);const K=createSwitch("Show Message Char/Word Count","Show the character and word count for each message","showMessageCharWordCount",!1,refreshPage,["Requires Refresh"]);t.appendChild(K);const U=createSwitch("Show Message Timestamp","Show the timestamp for each message","showMessageTimestamp",!1,refreshPage,["Requires Refresh"]);t.appendChild(U);const Y=createSwitch("Sound Alarm","Play a sound when the ChatGPT finish responding","chatEndedSound",!1);t.appendChild(Y);const X=createSwitch("Animate Favicon","Animate the ChatGPT icon on browser tab while chat is responding","animateFavicon",!1);t.appendChild(X);const Q=createSwitch("Copy mode","OFF: only copy response / ON: copy both request and response","copyMode",!1,null,[],!1,!1);return t.appendChild(Q),t}function toggleSidebarNoteVisibilitySwitch(e){const t=document.querySelector("#sidebar-note-button");t&&(e?t.classList.remove("hidden"):t.classList.add("hidden"))}function toggleAutoDelete(e){const t=document.querySelector("#auto-delete-details"),o=document.querySelector("#auto-delete-input"),r=document.querySelector("#auto-delete-exclude-folders-input");o&&(e?(t.style.opacity="1",o.disabled=!1,r.disabled=!1):(t.style.opacity="0.5",o.disabled=!0,r.disabled=!0,refreshPage()))}async function autoDeleteConversations(){const{autoDelete:e,autoDeleteNumDays:t,autoDeleteExcludeFolders:o}=cachedSettings;if(e){const r=await chrome.runtime.sendMessage({type:"getConversationIds",detail:{endDate:new Date(Date.now()-t*24*60*60*1e3).getTime(),includeArchived:!1,excludeConvInFolders:o}});for(let n=0;n<r.length;n+=1){const i=r[n];chrome.runtime.sendMessage({type:"deleteConversations",detail:{conversationIds:[i]}});try{await deleteConversation(i),removeConversationElements(i)}catch(a){console.error(a)}await sleep(2e3)}}}function toggleShowMiniMap(e){if(e)createConversationMiniMap(!0);else{const t=document.querySelector("#minimap-wrapper");t&&t.remove(),articleObservers?.forEach(o=>{o.disconnect()})}}function toggleAutoArchive(e){const t=document.querySelector("#auto-archive-details"),o=document.querySelector("#auto-archive-input"),r=document.querySelector("#auto-archive-exclude-folders-input");o&&(e?(t.style.opacity="1",o.disabled=!1,r.disabled=!1):(t.style.opacity="0.5",o.disabled=!0,r.disabled=!0,refreshPage()))}async function autoArchiveConversations(){const{autoArchive:e,autoArchiveNumDays:t,autoArchiveExcludeFolders:o}=cachedSettings;if(e){const r=await chrome.runtime.sendMessage({type:"getConversationIds",detail:{endDate:new Date(Date.now()-t*24*60*60*1e3).getTime(),includeArchived:!1,excludeConvInFolders:o}});for(let n=0;n<r.length;n+=1){const i=r[n];chrome.runtime.sendMessage({type:"archiveConversations",detail:{conversationIds:[i]}});try{await archiveConversation(i),removeConversationElements(i)}catch(a){console.error(a)}await sleep(2e3)}}}let autoArchiveIsRunning=!1,autoDeleteIsRunning=!1;chrome.runtime.onMessage.addListener((e,t,o)=>((async()=>e.type==="syncIsDone"&&await chrome.runtime.sendMessage({type:"checkHasSubscription"})&&(cachedSettings.autoArchive&&!autoArchiveIsRunning?(autoArchiveIsRunning=!0,autoArchiveConversations()):cachedSettings.autoDelete&&!autoDeleteIsRunning&&(autoDeleteIsRunning=!0,autoDeleteConversations())))(),!0));function toggleShowLanguageSelector(e){const t=document.querySelector("#language-selector-wrapper");t&&(e?t.style.display="block":(t.style.display="none",chrome.storage.local.set({settings:{...cachedSettings,selectedLanguage:"default"}})))}function toggleShowWritingStyleSelector(e){const t=document.querySelector("#writing-style-selector-wrapper");t&&(e?t.style.display="block":(t.style.display="none",chrome.storage.local.set({settings:{...cachedSettings,selectedWritingStyle:"default"}})))}function toggleShowToneSelector(e){const t=document.querySelector("#tone-selector-wrapper");t&&(e?t.style.display="block":(t.style.display="none",chrome.storage.local.set({settings:{...cachedSettings,selectedTone:"default"}})))}function foldersTabContent(e=!1){const t=document.createElement("div");t.id="settings-modal-tab-content",t.style="display: flex; flex-direction: column; justify-content: start; align-items: start;overflow-y: auto; width:100%; padding: 16px; margin-width:100%; height: 100%;";const o=createSwitch("Auto Folder Custom GPTs","Automatically create folders for custom GPTs and save new conversations in them","autoFolderCustomGPTs",!1,null,e?["New"]:["New","\u26A1\uFE0F Requires Pro Account"],!e);t.appendChild(o);const r=createSwitch("Show Sidebar Folder Button",'Show the folder button on the right edge of screen (Only for when "Show Folders in Left Sidebar" \u{1F447} is OFF)',"showSidebarFolderButton",!0,toggleSidebarFolderVisibilitySwitch,["New"]);t.appendChild(r);const n=createSwitch("Show Folders in Left Sidebar","Show the folders in the left sidebar","showFoldersInLeftSidebar",!1,toggleLeftSidebarSwitch,["Requires Refresh","Experimental"]);t.appendChild(n);const i=createSwitch("Exclude Conversations in Folders","Hide conversations saved in folders from the All Conversation list","excludeConvInFolders",!1,loadSidebarFolders);t.appendChild(i);const a=createSwitch("Show Conversation Timestamp in Sidebar","Show the timestamp for each conversation in the sidebar","showConversationTimestampInSidebar",!0,loadSidebarFolders,[]);t.appendChild(a);const s=createSwitch("Show Conversation Indicators in Sidebar","Show note, favorite, and other indicators for each conversation in the sidebar","showConversationIndicatorsInSidebar",!0,loadSidebarFolders,[]);return t.appendChild(s),t}function toggleSidebarFolderVisibilitySwitch(e){const t=document.querySelector("#sidebar-folder-button");t&&(e?t.classList.remove("hidden"):t.classList.add("hidden"))}function toggleLeftSidebarSwitch(e){e?window.localStorage.setItem("sp/sidebarFolderIsOpen","false"):window.localStorage.setItem("sp/sidebarFolderIsOpen","true"),refreshPage()}function textToSpeechTabContent(e=!1){const t=document.createElement("div");t.id="settings-modal-tab-content",t.style="display: flex; flex-direction: column; justify-content: start; align-items: start;overflow-y: auto; width:100%; padding: 16px; margin-width:100%; height: 100%;";const o=document.createElement("div");o.style="display: flex; flex-direction: row; justify-content: space-between; align-items: center; width: 100%; margin: 8px 0;";const r=document.createElement("div");r.style="",r.innerHTML='Text To Speech<span class="text-xs"> \u2014 ChatGPT talks to you. <a class="underline " href="https://www.youtube.com/watch?v=ckHAyrVqj-w&ab_channel=Superpower">Learn more</a></span></span>',o.appendChild(r);const n=document.createElement("div");n.id="tts-voice-selector-wrapper",n.style="position:relative;width:250px;margin-left:8px;",o.appendChild(n),t.appendChild(o);const i=document.createElement("div");i.classList="relative flex flex-wrap justify-start items-center w-full p-4 bg-token-sidebar-surface-tertiary rounded-md mt-3 mb-6";const a=createSwitch("Auto Speak","Automatically speak the response once it's finished","autoSpeak",!1,null,e?[]:["\u26A1\uFE0F Requires Pro Account"],!e,!1);i.appendChild(a);const s=document.createElement("button");s.classList="btn flex justify-center gap-2 border composer-submit-btn composer-submit-button-color",s.style="min-width:120px;height:34px;margin-left:auto;",s.textContent="Test Audio \u{1F3A7}",i.appendChild(s),getVoices().then(f=>{const v=f.voices.find(x=>x.voice===f.selected)||f.voices[0];n.innerHTML=dropdown("TTS-Voice",f.voices.map(x=>(x.name=`${x.name} (${x.description})`,x)),v,"voice","right","bg-token-main-surface-primary"),addDropdownEventListener("TTS-Voice",f.voices,"voice",x=>{updateAccountUserSetting("voice_name",x.voice)}),s.addEventListener("click",()=>{if(settingTestAudio&&settingTestAudio.pause(),s.innerText==="Stop Audio \u{1F3A7}"){s.innerText="Test Audio \u{1F3A7}";return}const x=document.querySelector("#selected-tts-voice-title").innerText;let y=f?.voices?.find(w=>w.name===x);y||(y=f?.voices?.[0]);const b=new Audio(y.preview_url);b.play(),s.innerText="Stop Audio \u{1F3A7}",settingTestAudio=b,b.addEventListener("ended",()=>{s.innerText="Test Audio \u{1F3A7}",settingTestAudio=null})}),s.addEventListener("blur",()=>{settingTestAudio&&settingTestAudio.pause(),settingTestAudio=null,s.innerText="Test Audio \u{1F3A7}"})}),t.appendChild(i);const l=document.createElement("div");l.style="display: flex; flex-direction: row; justify-content: space-between; align-items: center; width: 100%; margin: 8px 0; ";const d=document.createElement("div");d.style="",d.innerHTML=`Speech To Text${isFirefox||isOpera?'<span class="text-xs"> (Firefox and Opera do not support <a class="underline " href="https://developer.mozilla.org/en-US/docs/Web/API/SpeechRecognition#browser_compatibility">Speech Recognition</a>)</span>':'<span class="text-xs"> \u2014 You talk to ChatGPT. <a class="underline " href="https://www.youtube.com/watch?v=ckHAyrVqj-w&ab_channel=Superpower">Learn more</a></span></span>'}`,l.appendChild(d);const c=document.createElement("div");c.style="position:relative;width:150px;margin-left:8px;",(isFirefox||isOpera)&&(c.style.opacity=.5,c.style.pointerEvents="none");const{speechToTextLanguage:u}=cachedSettings;c.innerHTML=dropdown("STT-Language",speechToTextLanguageList,u,"code","right","bg-token-main-surface-primary"),setTimeout(()=>{addDropdownEventListener("STT-Language",speechToTextLanguageList,"code",f=>{chrome.storage.local.set({settings:{...cachedSettings,speechToTextLanguage:f}})})},1e3),l.appendChild(c),t.appendChild(l);const m=document.createElement("div");m.classList="relative flex flex-wrap justify-start items-center w-full p-4 bg-token-sidebar-surface-tertiary rounded-md my-3",(isFirefox||isOpera)&&(m.style.opacity=.5,m.style.pointerEvents="none");const g=createSwitch("Enable Speech To Text Shortkey",`Enable/disable the ${isWindows()?"ALT":"Option"} key to start/stop speech to text input`,"enableSpeechToTextShortkey",!0,refreshPage,e?["Requires Refresh"]:["\u26A1\uFE0F Requires Pro Account"],!e,!1);m.appendChild(g);const p=createSwitch("Interim Results","Show interim results while speaking","speechToTextInterimResults",!0,null,e?[]:["\u26A1\uFE0F Requires Pro Account"],!e,!1);m.appendChild(p);const h=createSwitch("Auto Submit When Release Alt","Automatically submit the message when you release the Alt key","autoSubmitWhenReleaseAlt",!1,null,e?[]:["\u26A1\uFE0F Requires Pro Account"],!e,!1);return m.appendChild(h),t.appendChild(m),t}function promptInputTabContent(e=!1){const t=document.createElement("div");t.id="settings-modal-tab-content",t.style="display: flex; flex-direction: column; justify-content: start; align-items: start;overflow-y: auto; width:100%; padding: 16px; margin-width:100%; height: 100%;";const o=createSwitch("Recent Prompts Shortkey","Enable/disable the up and down arrow keys to cycle through recent prompt history.","promptHistoryUpDownKey",!0);t.appendChild(o);const r=createSwitch("Show Memory Toggles in Input","Show/hide the memory toggles in the prompt input area.","showMemoryTogglesInInput",!0,toggleMemoryTogglesInInputVisibility,["New"]);t.appendChild(r);const n=createSwitch("Show Prompt Optimizer Button in Input","Show/hide the prompt optimizer button in the prompt input area.","showPromptRewriterButtonInInput",!0,togglePromptRewriterButtonInInputVisibility,e?["New"]:["New","\u26A1\uFE0F Requires Pro Account"]);t.appendChild(n);const i=createSwitch("Show Last Prompt Chain Actions","Show/hide the button above input to rerun/edit the last prompt chain.","showRerunLastPromptChainButton",!0,toggleRerunLastPromptChainButtonVisibility,["New"]);t.appendChild(i);const a=createSwitch("Show Favorite Prompts Button",'Show/hide the button above input to use favorite prompts. <a href="https://www.youtube.com/watch?v=FBgR7YmrxUk&ab_channel=Superpower" target="_blank" class="underline " rel="noreferrer">Learn more</a>',"showFavoritePromptsButton",!0,toggleFavoritePromptsButtonVisibility);t.appendChild(a);const s=createSwitch("Show Custom Instruction Profile Selector","Show/hide the profile selector for custom instructions.","showCustomInstructionProfileSelector",!0,toggleCustomInstructionProfileSelectorVisibility,["New"]);t.appendChild(s);const l=createSwitch("Auto Continue When Available","Automatically continue the response when the option is available at the end of a long response","autoContinueWhenPossible",!0,null);t.appendChild(l);const d=createSwitch("Prompt Template",'Enable/disable the doube {{curly}} brackets replacement (<a style="text-decoration:underline; " href="https://www.youtube.com/watch?v=JMBjq0XtutA&ab_channel=Superpower" target="blank">Learn More</a>)',"promptTemplate",!0);t.appendChild(d);const c=createSwitch("Submit Prompt on Enter",`Submit the prompt when you press Enter. If disable, you can submit prompt using ${isWindows()?"CTRL":"CMD"} + Enter`,"submitPromptOnEnter",!0,refreshPage,["Requires Refresh"],!1,!1);return t.appendChild(c),t}function toggleMemoryTogglesInInputVisibility(e){const t=document.querySelector("#memory-toggles-wrapper");t&&(e?addMemoryTogglesToPromptInput():t.remove())}function toggleRerunLastPromptChainButtonVisibility(e){if(!e){const t=document.querySelector("#rerun-prompt-chain-wrapper");t&&t.remove()}}function togglePromptRewriterButtonInInputVisibility(e){const t=document.querySelector("#prompt-rewrite-button");t&&(e?t.classList.remove("hidden"):t.classList.add("hidden"))}function splitterTabContent(e=!1){const t=document.createElement("div");t.id="settings-modal-tab-content",t.style="display: flex; flex-direction: column; justify-content: start; align-items: start;overflow-y: scroll; width:100%; padding: 16px; margin-width:100%; height: 100%;";const o=document.createElement("div");o.style="display: flex; gap:16px; justify-content: start; align-items: start; width: 100%; margin: 8px 0;";const r=createSwitch("Auto Split",'Automatically split long prompts into smaller chunks (<a style="text-decoration:underline; color:gold;" href="https://www.youtube.com/watch?v=IhRbmIhAm3I&ab_channel=Superpower" target="blank">Learn More</a>)',"autoSplit",!1,toggleAutoSummarizerSwitch,["Requires Refresh"]),n=createSwitch("Auto Summarize",'Automatically summarize each chunk after auto split (<a style="text-decoration:underline; color:gold;" href="https://www.youtube.com/watch?v=IhRbmIhAm3I&ab_channel=Superpower" target="blank">Learn More</a>)',"autoSummarize",!1,updateAutoSplitPrompt,["Requires Refresh"]),i=document.createElement("div");i.style="display: flex; flex-direction: row; justify-content: start; align-items: center; width: 100%; margin: 8px 0; color:white;",i.textContent="Auto Split Chunk Size (<100,000)";const a=document.createElement("input");a.id="split-prompt-limit-input",a.type="number",a.classList="w-full px-4 py-2 mb-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-token-main-surface-secondary disabled:opacity-40",a.value=cachedSettings.autoSplitLimit,a.addEventListener("change",()=>{const g=document.querySelector("#split-prompt-limit-input"),p=Math.round(g.value);g.value=p,chrome.storage.local.set({settings:{...cachedSettings,autoSplitLimit:p}})}),a.addEventListener("input",()=>{const g=document.querySelector("#split-prompt-limit-input"),p=Math.round(g.value);g.value=p,chrome.storage.local.set({settings:{...cachedSettings,autoSplitLimit:p}})});const s=document.createElement("div");s.style="display: flex; flex-direction: row; justify-content: start; align-items: center; width: 100%; margin-top: 16px; color:white;",s.textContent="Auto Split Prompt";const l=document.createElement("div");l.style="font-size: 12px; color: #999;margin-bottom: 8px;",l.textContent="Auto Split Prompt is a instruction that will be used to split long user inputs into multiple chunks.";const d=document.createElement("textarea");d.id="split-initial-prompt-textarea",d.classList="bg-token-main-surface-secondary text-token-text-primary",d.style="width: 100%; height: 200px; min-height: 200px; border-radius: 4px; border: 1px solid #565869; padding: 4px 8px; font-size: 14px;",d.placeholder="Enter Auto Split Prompt here...",d.value=cachedSettings.autoSplitInitialPrompt,d.dir="auto",d.addEventListener("input",()=>{d.style.borderColor="#565869",chrome.storage.local.set({settings:{...cachedSettings,autoSplitInitialPrompt:d.value}})});const c=document.createElement("div");c.style="display: flex; flex-direction: row; justify-content: start; align-items: center; width: 100%; margin-top: 16px; color:white;",c.textContent="Auto Split Chunk Prompt";const u=document.createElement("div");u.style="font-size: 12px; color: #999;margin-bottom: 8px;",u.textContent="Auto Split Chunk Prompt is the instruction used to process each chunk. For instance, it can be used to summarize the chunk.";const m=document.createElement("textarea");return m.id="split-chunk-prompt-textarea",m.classList="bg-token-main-surface-secondary text-token-text-primary",m.style="width: 100%; height: 100px; min-height: 100px; border-radius: 4px; border: 1px solid #565869; padding: 4px 8px; font-size: 14px;",m.placeholder="Enter splitter prompt here...",m.value=cachedSettings.autoSplitChunkPrompt,m.dir="auto",m.addEventListener("input",()=>{m.style.borderColor="#565869",chrome.storage.local.set({settings:{...cachedSettings,autoSplitChunkPrompt:m.value}})}),o.appendChild(r),o.appendChild(n),t.appendChild(o),t.appendChild(i),t.appendChild(a),t.appendChild(s),t.appendChild(l),t.appendChild(d),t.appendChild(c),t.appendChild(u),t.appendChild(m),t}function toggleAutoSummarizerSwitch(e){if(e)refreshPage();else{const t=document.querySelector("#switch-auto-summarize");t.checked?(t.checked=!1,chrome.storage.local.set({settings:{...cachedSettings,autoSummarize:!1}},()=>{refreshPage()})):refreshPage()}}function updateAutoSplitPrompt(e){const t=`Reply with OK: [CHUNK x/TOTAL]
Don't reply with anything else!`,o=`Reply with OK: [CHUNK x/TOTAL]
Summary: A short summary of the last chunk. Keep important facts and names in the summary. Don't reply with anything else!`;chrome.storage.local.set({settings:{...cachedSettings,autoSplitChunkPrompt:e?o:t}},()=>{const r=document.querySelector("#split-chunk-prompt-textarea");r.value=e?o:t,refreshPage()})}function toggleFavoritePromptsButtonVisibility(e){e?initializeContinueButton(!0):document.querySelector("#continue-conversation-button-wrapper")?.remove()}function toggleCustomInstructionProfileSelectorVisibility(e){e?initializeCustomInstructionProfileSelector(!0):document.querySelector("#custom-instruction-profile-selector-wrapper")?.remove()}function settingsModalActions(){const e=document.createElement("div");e.style="display: flex; flex-direction: row; justify-content: start; align-items: end; margin-top: 8px;width:100%;";const t=document.createElement("img");t.src=chrome.runtime.getURL("icons/logo.png"),t.style="width: 40px; height: 40px;",e.appendChild(t);const o=document.createElement("div");o.style="display: flex; flex-direction: column; justify-content: start; align-items: start; margin-left: 8px;";const r=document.createElement("div");r.textContent="Powered by",r.style="color: #999; font-size: 12px;";const n=document.createElement("a");n.href="https://spchatgpt.com",n.target="_blank",n.textContent="Superpower ChatGPT",n.style="color: #999; font-size: 12px; margin-left: 4px; text-decoration: underline;",r.appendChild(n);const i=document.createElement("span"),{version:a}=chrome.runtime.getManifest();i.textContent=`(v ${a}`,i.style="color: #999; font-size: 12px; margin-left: 4px;",r.appendChild(i);const s=document.createElement("span");s.textContent="Release Note)",s.style="color: #999; font-size: 12px; margin-left: 4px; text-decoration: underline; cursor: pointer;",s.addEventListener("click",()=>{document.querySelector("button[id^=modal-close-button-release-note]")?.click(),createReleaseNoteModal(a)}),r.appendChild(s),o.appendChild(r);const l=document.createElement("div");l.textContent="Made by",l.style="color: #999; font-size: 12px;";const d=document.createElement("a");d.href="https://twitter.com/eeeziii",d.target="_blank",d.textContent="Saeed Ezzati",d.style="color: #999; font-size: 12px; margin-left: 4px; text-decoration: underline;";const c=document.createElement("span");c.textContent=" - ",c.style="color: #999; font-size: 12px;";const u=document.createElement("a");u.href="https://www.buymeacoffee.com/ezii",u.target="_blank",u.textContent="\u{1F355} Buy me a pizza \u279C",u.style="color: #999; font-size: 12px; margin-left: 4px; text-decoration: underline;",l.appendChild(d),c.appendChild(u),l.appendChild(d),l.appendChild(c),o.appendChild(l),e.appendChild(o);const m=document.createElement("button");return m.id="upgrade-to-pro-button-settings",m.classList="flex flex-wrap p-1 items-center rounded-md bg-gold hover:bg-gold-dark transition-colors duration-200 text-black cursor-pointer text-sm ms-auto font-bold",m.style="width: 230px;",m.innerHTML='<div class="flex w-full"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" style="width:20px; height:20px; margin-right:6px;position:relative; top:10px;" stroke="purple" fill="purple"><path d="M240.5 224H352C365.3 224 377.3 232.3 381.1 244.7C386.6 257.2 383.1 271.3 373.1 280.1L117.1 504.1C105.8 513.9 89.27 514.7 77.19 505.9C65.1 497.1 60.7 481.1 66.59 467.4L143.5 288H31.1C18.67 288 6.733 279.7 2.044 267.3C-2.645 254.8 .8944 240.7 10.93 231.9L266.9 7.918C278.2-1.92 294.7-2.669 306.8 6.114C318.9 14.9 323.3 30.87 317.4 44.61L240.5 224z"/></svg> Upgrade to Pro</div><div style="font-size:10px;font-weight:400;margin-left:28px;" class="flex w-full">GPT Store, Image Gallery, Voice & more</div>',chrome.runtime.sendMessage({type:"checkHasSubscription"},g=>{g&&(m.classList="flex p-3 items-center rounded-md bg-gold hover:bg-gold-dark transition-colors duration-200 text-black cursor-pointer text-sm ms-auto font-bold",m.style="width: auto;",m.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" style="width:20px; height:20px;margin-right:6px;" stroke="purple" fill="purple"><path d="M240.5 224H352C365.3 224 377.3 232.3 381.1 244.7C386.6 257.2 383.1 271.3 373.1 280.1L117.1 504.1C105.8 513.9 89.27 514.7 77.19 505.9C65.1 497.1 60.7 481.1 66.59 467.4L143.5 288H31.1C18.67 288 6.733 279.7 2.044 267.3C-2.645 254.8 .8944 240.7 10.93 231.9L266.9 7.918C278.2-1.92 294.7-2.669 306.8 6.114C318.9 14.9 323.3 30.87 317.4 44.61L240.5 224z"/></svg> ${translate("Pro account")}`),m.addEventListener("click",()=>{openUpgradeModal(g)}),e.appendChild(m)}),e}async function initializeSettings(){const{settings:e}=await chrome.storage.local.get(["settings"]),t={...e,superpowerIsEnabled:e.superpowerIsEnabled!==void 0?e.superpowerIsEnabled:!0,autoReloadOnUpdate:e.autoReloadOnUpdate!==void 0?e.autoReloadOnUpdate:!0,animateFavicon:e.animateFavicon!==void 0?e.animateFavicon:!1,dontShowPromptManagerMoveHelper:e.dontShowPromptManagerMoveHelper!==void 0?e.dontShowPromptManagerMoveHelper:!1,promptHistoryUpDownKey:e.promptHistoryUpDownKey!==void 0?e.promptHistoryUpDownKey:!0,copyMode:e.copyMode!==void 0?e.copyMode:!1,autoResetTopNav:e.autoResetTopNav!==void 0?e.autoResetTopNav:!0,showFavoritePromptsButton:e.showFavoritePromptsButton!==void 0?e.showFavoritePromptsButton:!0,hideNewsletter:e.hideNewsletter!==void 0?e.hideNewsletter:!0,hideReleaseNote:e.hideReleaseNote!==void 0?e.hideReleaseNote:!0,hideUpdateNotification:e.hideUpdateNotification!==void 0?e.hideUpdateNotification:!1,chatEndedSound:e.chatEndedSound!==void 0?e.chatEndedSound:!1,customConversationWidth:e.customConversationWidth!==void 0?e.customConversationWidth:!1,conversationWidth:e.conversationWidth!==void 0?e.conversationWidth:50,submitPromptOnEnter:e.submitPromptOnEnter!==void 0?e.submitPromptOnEnter:!0,promptTemplate:e.promptTemplate!==void 0?e.promptTemplate:!0,autoClick:e.autoClick!==void 0?e.autoClick:!1,showLanguageSelector:e.showLanguageSelector!==void 0?e.showLanguageSelector:!1,showToneSelector:e.showToneSelector!==void 0?e.showToneSelector:!1,showWritingStyleSelector:e.showWritingStyleSelector!==void 0?e.showWritingStyleSelector:!1,selectedLanguage:e.selectedLanguage||{code:"default",name:"Default"},selectedTone:e.selectedTone||{code:"default",name:"Default",description:"No specific tone instruction"},selectedWritingStyle:e.selectedWritingStyle||{code:"default",name:"Default",description:"No specific writing style instruction"},selectedNotesSortBy:e.selectedNotesSortBy||{name:"Update date",code:"updated_at"},selectedNotesView:e.selectedNotesView||"grid",selectedConversationView:e.selectedConversationView||"grid",selectedPromptView:e.selectedPromptView||"grid",selectedPinnedMessageView:e.selectedPinnedMessageView||"grid",selectedProfileView:e.selectedProfileView||"grid",selectedConversationsManagerSortBy:e.selectedConversationsManagerSortBy||{name:"Update date",code:"updated_at"},selectedPromptsManagerSortBy:e.selectedPromptsManagerSortBy||{name:"Update date",code:"updated_at"},selectedPromptsManagerTag:e.selectedPromptsManagerTag||{name:"All",code:"all"},selectedPromptsManagerLanguage:e.selectedPromptsManagerLanguage||{name:"All",code:"all"},selectedPromptEditorLanguage:e.selectedPromptEditorLanguage||{name:"Select",code:"select"},autoContinueWhenPossible:e.autoContinueWhenPossible!==void 0?e.autoContinueWhenPossible:!0,autoSpeak:e.autoSpeak!==void 0?e.autoSpeak:!1,enableSpeechToTextShortkey:e.enableSpeechToTextShortkey!==void 0?e.enableSpeechToTextShortkey:!0,speechToTextLanguage:e.speechToTextLanguage||{name:"English (United Kingdom)",code:"en-GB"},speechToTextInterimResults:e.speechToTextInterimResults!==void 0?e.speechToTextInterimResults:!0,autoSubmitWhenReleaseAlt:e.autoSubmitWhenReleaseAlt!==void 0?e.autoSubmitWhenReleaseAlt:!1,managerSidebarWidth:e.managerSidebarWidth||220,excludeConvInFolders:e.excludeConvInFolders!==void 0?e.excludeConvInFolders:!1,showMessageTimestamp:e.showMessageTimestamp!==void 0?e.showMessageTimestamp:!1,showMessageCharWordCount:e.showMessageCharWordCount!==void 0?e.showMessageCharWordCount:!1,showConversationTimestampInSidebar:e.showConversationTimestampInSidebar!==void 0?e.showConversationTimestampInSidebar:!0,showConversationIndicatorsInSidebar:e.showConversationIndicatorsInSidebar!==void 0?e.showConversationIndicatorsInSidebar:!0,showCustomInstructionProfileSelector:e.showCustomInstructionProfileSelector!==void 0?e.showCustomInstructionProfileSelector:!0,autoFolderCustomGPTs:e.autoFolderCustomGPTs!==void 0?e.autoFolderCustomGPTs:!1,showFoldersInLeftSidebar:e.showFoldersInLeftSidebar!==void 0?e.showFoldersInLeftSidebar:!1,syncGizmos:e.syncGizmos!==void 0?e.syncGizmos:!1,syncProjects:e.syncProjects!==void 0?e.syncProjects:!1,syncHistoryResponses:e.syncHistoryResponses!==void 0?e.syncHistoryResponses:!0,showMiniMap:e.showMiniMap!==void 0?e.showMiniMap:e.showPinNav||!1,showSidebarNoteButton:e.showSidebarNoteButton!==void 0?e.showSidebarNoteButton:!0,showSidebarFolderButton:e.showSidebarFolderButton!==void 0?e.showSidebarFolderButton:!0,showMemoryTogglesInInput:e.showMemoryTogglesInInput!==void 0?e.showMemoryTogglesInInput:!0,showRerunLastPromptChainButton:e.showRerunLastPromptChainButton!==void 0?e.showRerunLastPromptChainButton:!0,showPromptRewriterButtonInInput:e.showPromptRewriterButtonInInput!==void 0?e.showPromptRewriterButtonInInput:!0,rewriteTone:e.rewriteTone!==void 0?e.rewriteTone:"as-is",rewriteLength:e.rewriteLength!==void 0?e.rewriteLength:"as-is",selectedRewriteContext:e.selectedRewriteContext!==void 0?e.selectedRewriteContext:"clarity",customRewriteContext:e.customRewriteContext!==void 0?e.customRewriteContext:"",overrideModelSwitcher:e.overrideModelSwitcher!==void 0?e.overrideModelSwitcher:!1,triggerEndOfConvOnEvent:e.triggerEndOfConvOnEvent!==void 0?e.triggerEndOfConvOnEvent:!1,autoDelete:e.autoDelete!==void 0?e.autoDelete:!1,autoDeleteNumDays:e.autoDeleteNumDays||7,autoDeleteExcludeFolders:e.autoDeleteExcludeFolders!==void 0?e.autoDeleteExcludeFolders:!0,autoArchive:e.autoArchive!==void 0?e.autoArchive:!1,autoArchiveNumDays:e.autoArchiveNumDays||7,autoArchiveExcludeFolders:e.autoArchiveExcludeFolders!==void 0?e.autoArchiveExcludeFolders:!0,autoSummarize:e.autoSummarize!==void 0?e.autoSummarize:!1,autoSplit:e.autoSplit!==void 0?e.autoSplit:!1,autoSplitLimit:e.autoSplitLimit||28e3,autoSplitInitialPrompt:e.autoSplitInitialPrompt||`Act like a document/text loader until you load and remember the content of the next text/s or document/s.
There might be multiple files, each file is marked by name in the format ### DOCUMENT NAME.
I will send them to you in chunks. Each chunk starts will be noted as [START CHUNK x/TOTAL], and the end of this chunk will be noted as [END CHUNK x/TOTAL], where x is the number of current chunks, and TOTAL is the number of all chunks I will send you.
I will split the message in chunks, and send them to you one by one. For each message follow the instructions at the end of the message.
Let's begin:

`,autoSplitChunkPrompt:e.autoSplitChunkPrompt||`Reply with OK: [CHUNK x/TOTAL]
Don't reply with anything else!`};cachedSettings=t,chrome.storage.local.set({settings:t})}chrome.storage.onChanged.addListener(e=>{e.settings&&(cachedSettings=e.settings.newValue)});function addThreadEditButtonEventListener(){document.body.addEventListener("click",e=>{const t=e.target.closest("button");if(!t||!t.closest("article"))return;const o=getThreadLeftButton(t),r=getThreadRightButton(t),n=t?.classList?.contains("btn-primary")&&t.innerText;(o||r||n)&&setTimeout(async()=>{await createPinButtons(!0),createConversationMiniMap(!0)},n?500:100)})}function handleDeleteConversation(e){e&&showConfirmDialog("Delete conversation","Are you sure you want to delete this conversation?","Cancel","Delete",null,()=>{updateConversationFolderCount(null,[e]),chrome.runtime.sendMessage({type:"deleteConversations",detail:{conversationIds:[e]}},()=>{deleteConversation(e),removeConversationElements(e)})})}function removeConversationElements(e){const{showFoldersInLeftSidebar:t}=cachedSettings,o=document.querySelector(`nav a[href$="/c/${e}"]`);t&&o&&o.remove(),document.querySelectorAll(`#conversation-card-${e}`).forEach(a=>{a.remove()});const r=document.querySelector("#modal-manager #conversation-manager-conversation-list");r&&r.children.length===0&&r.appendChild(noConversationElement());const n=document.querySelector("#sidebar-folder-content");n&&n.children.length===0&&n.appendChild(noConversationElement());const i=getConversationIdFromUrl();t&&i===e&&startNewChat()}function renameConversationElements(e,t){const o=document.querySelector(`nav a[href$="/c/${e}"] div`);o&&o.childNodes.forEach(r=>{r.nodeType===Node.TEXT_NODE&&(r.textContent=t)})}const debounceAddMessageTimestamps=debounce(()=>{addMessageTimestamps()},500);async function addMessageTimestamps(){const e=getConversationIdFromUrl(),t=document.querySelector("main");if(!t)return;const o=t.querySelectorAll("article");if(e&&o.length===0)return;const r=t.querySelectorAll('article div[data-message-author-role="assistant"]');if(e&&r.length===0)return;const n=await getConversationsByIds([e]);o.forEach(i=>{addMessageTimestamp(n[0],i)})}function addMessageTimestamp(e,t){if(!e||!t)return;const o=t.querySelectorAll("div[data-message-author-role=assistant]");if(o.length===0)return;const r=o[o.length-1];r.classList.add("relative");const n=r.getAttribute("data-message-id"),i=e?.mapping[n],a=formatDate(i?new Date(formatTime(i?.message?.create_time)):new Date),s=r.querySelector("#message-timestamp");if(s&&s?.innerText.includes(a))return;s&&s.remove();const l=document.createElement("div");l.id="message-timestamp",l.classList="text-xs text-token-text-tertiary absolute end-0",l.style.bottom="-32px",l.style.userSelect="none";const d=r.querySelector("#message-char-word-counter");l.textContent=a,d&&(l.innerHTML=`${a} <span style="margin-left: 8px;">\u2022</span>`,l.style.right=`${d.offsetWidth+8}px`),r.appendChild(l)}const debounceAddMessageCharWordCounters=debounce(()=>{addMessageCharWordCounters()},500);function addMessageCharWordCounters(){const e=getConversationIdFromUrl(),t=document.querySelector("main");if(!t)return;const o=t.querySelectorAll("article");if(e&&o.length===0)return;const r=t.querySelectorAll('article div[data-message-author-role="assistant"]');e&&r.length===0||o.forEach(n=>{addMessageCharWordCounter(n)})}function addMessageCharWordCounter(e){const t=e.querySelectorAll("div[data-message-author-role=assistant]");if(t.length===0)return;const o=t[t.length-1];if(!o)return;o.classList.add("relative");let r=0;t.forEach(c=>{r+=` ${c?.firstChild?.innerText||""}`});const n=getCharCount(r),i=getWordCount(r),a=`${n} chars \u2022 ${i} words`,s=o.querySelector("#message-char-word-counter");if(s&&s?.innerText===a)return;s&&s.remove();const l=document.createElement("div");l.id="message-char-word-counter",l.classList="text-xs text-token-text-tertiary absolute end-0",l.style.bottom="-32px",l.style.userSelect="none",l.textContent=a,o.appendChild(l);const d=o.querySelector("#message-timestamp");d&&(d.style.right=`${l.offsetWidth+8}px`)}const throttleSetContentWidth=throttle(()=>{setContentWidth()},300);function setContentWidth(){const e=document.querySelector('header[id="page-header"]'),t=document.querySelector("main");!e||!t||(e&&t&&sidebarNoteIsOpen?(e.style.width=`${100-sidebarNoteInputWrapperWidth}%`,t.style.width=`${100-sidebarNoteInputWrapperWidth}%`):e&&t&&sidebarFolderIsOpen()&&(e.style.width=`calc(100% - ${sidebarFolderDrawerWidth}px)`,t.style.width=`calc(100% - ${sidebarFolderDrawerWidth}px)`))}async function openRandomConversation(){const e=await chrome.runtime.sendMessage({type:"getRandomConversationId",forceRefresh:!0,detail:{}});window.history.pushState({},"",`/c/${e.conversation_id}`),window.dispatchEvent(new PopStateEvent("popstate",{state:{}}))}async function showConversationPreviewWrapper(e,t=null,o=!1,r=!1){const n=document.createElement("div");n.id="conversation-preview-wrapper-background",n.classList="bg-black/50 dark:bg-black/80 fixed inset-0",n.style="z-index: 100000;",n.addEventListener("click",()=>{n.remove()}),document.body.appendChild(n);const i=document.createElement("div");if(i.id="conversation-preview-wrapper",i.classList="flex flex-col items-center justify-center bg-token-main-surface-primary bg-opacity-90 rounded-xl border border-token-border-medium z-50 shadow-long",i.style="min-width: 800px; min-height: 90vh; width: 50%; height: 90%; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);",n.appendChild(i),!r){const g=document.createElement("button");g.id="preview-conversation-next-button",g.classList="absolute top-1/2 transform -translate-y-1/2 p-2 rounded-full bg-token-main-surface-secondary text-token-text-primary focus-visible:outline-0 hover:bg-token-sidebar-surface-secondary focus-visible:bg-token-sidebar-surface-secondary border border-token-border-medium",g.style="right: -20px;",g.innerHTML='<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md-heavy"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.29289 18.7071C8.90237 18.3166 8.90237 17.6834 9.29289 17.2929L14.5858 12L9.29289 6.70711C8.90237 6.31658 8.90237 5.68342 9.29289 5.29289C9.68342 4.90237 10.3166 4.90237 10.7071 5.29289L16.7071 11.2929C16.8946 11.4804 17 11.7348 17 12C17 12.2652 16.8946 12.5196 16.7071 12.7071L10.7071 18.7071C10.3166 19.0976 9.68342 19.0976 9.29289 18.7071Z" fill="currentColor"></path></svg>',i.appendChild(g);const p=document.createElement("button");p.id="preview-conversation-previous-button",p.classList="absolute top-1/2 transform -translate-y-1/2 p-2 rounded-full bg-token-main-surface-secondary text-token-text-primary focus-visible:outline-0 hover:bg-token-sidebar-surface-secondary focus-visible:bg-token-sidebar-surface-secondary border border-token-border-medium",p.style="left: -20px;",p.innerHTML='<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md-heavy"><path fill-rule="evenodd" clip-rule="evenodd" d="M14.7071 5.29289C15.0976 5.68342 15.0976 6.31658 14.7071 6.70711L9.41421 12L14.7071 17.2929C15.0976 17.6834 15.0976 18.3166 14.7071 18.7071C14.3166 19.0976 13.6834 19.0976 13.2929 18.7071L7.29289 12.7071C7.10536 12.5196 7 12.2652 7 12C7 11.7348 7.10536 11.4804 7.29289 11.2929L13.2929 5.29289C13.6834 4.90237 14.3166 4.90237 14.7071 5.29289Z" fill="currentColor"></path></svg>',i.appendChild(p)}const a=document.createElement("div");a.classList="flex items-center justify-between w-full bg-token-main-surface-secondary p-4 rounded-t-xl border-b border-token-border-medium",i.appendChild(a);const s=document.createElement("div");s.classList="text-lg font-bold",s.id="conversation-preview-title",a.appendChild(s);const l=document.createElement("div");l.classList="flex items-center gap-2",a.appendChild(l);const d=document.createElement("button");d.id="preview-open-conversation-button",d.classList="flex relative p-2 text-xs rounded-md bg-token-main-surface-secondary text-token-link focus-visible:outline-0 hover:bg-token-sidebar-surface-secondary focus-visible:bg-token-sidebar-surface-secondary",d.style.width="max-content",d.title=`${isWindows()?"Ctrl":"\u2318"} + Click to open in new tab`,d.innerHTML=`${translate("open conversation")}`,l.appendChild(d);const c=document.createElement("button");c.id="conversation-preview-close-button",c.classList="p-2 rounded-full bg-token-main-surface-secondary text-token-text-primary focus-visible:outline-0 hover:bg-token-sidebar-surface-secondary focus-visible:bg-token-sidebar-surface-secondary",c.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-6 w-6"><path d="M6 18L18 6M6 6l12 12"></path></svg>',c.addEventListener("click",()=>{i.remove()}),l.appendChild(c);const u=document.createElement("div");u.classList="h-full w-full overflow-y-auto p-4",u.style="scroll-behavior: smooth;",u.id="conversation-inner-div",u.addEventListener("click",g=>{g.stopPropagation(),closeMenus()}),u.addEventListener("scroll",()=>{const g=document.querySelector("#conversation-preview-wrapper #scroll-to-bottom-button");u.scrollHeight>u.clientHeight&&u.scrollTop<u.scrollHeight-u.clientHeight?g?.classList.remove("hidden"):g?.classList.add("hidden")});const m=document.createElement("div");m.classList="flex flex-col items-center text-sm h-full bg-token-main-surface-primary",m.id="preview-conversation-div",u.appendChild(m),i.appendChild(u),await loadConversationInPreview(e,t,o)}async function loadConversationInPreview(e,t=null,o=!1){const r=document.querySelector("#preview-conversation-div");r.innerHTML=loadingSpinner("preview-conversation-div").outerHTML;const n=await getConversation(e);if(!n)return;chrome.runtime.sendMessage({type:"addConversations",detail:{conversations:[n]}});const i=removeSystemMessages(n);if(!i||!i?.current_node)return;const a=document.querySelector("#conversation-preview-wrapper #conversation-preview-title");a.innerHTML=i.title||"New chat";const s=document.querySelector("#conversation-preview-wrapper #preview-open-conversation-button"),l=s.cloneNode(!0);s.replaceWith(l),l.title=`${isWindows()?"Ctrl":"\u2318"} + Click to open in new tab`,l.addEventListener("click",M=>{if(M.stopPropagation(),closeMenus(),M.metaKey||isWindows()&&M.ctrlKey)window.open(`/c/${e}`,"_blank");else{const $=document.querySelector("#conversation-preview-wrapper-background");$&&$.remove(),closeModals(),window.history.pushState({},"",`/c/${e}`),window.dispatchEvent(new PopStateEvent("popstate",{state:{}}))}});const d=o?document.querySelector("#sidebar-folder-drawer"):document.querySelector("#modal-manager"),c=t?d?.querySelector(`#pinned-message-card-${t}[data-message-id="${t}"]`):d?.querySelector(`#conversation-card-${e}[data-conversation-id="${e}"]`),u=document.querySelector("#conversation-preview-wrapper #preview-conversation-next-button");if(u){const M=u.cloneNode(!0);u.replaceWith(M),c?.nextElementSibling===null?M.classList.add("hidden"):M.classList.remove("hidden"),M?.addEventListener("click",$=>{$.stopPropagation(),closeMenus();const q=o?document.querySelector("#sidebar-folder-drawer"):document.querySelector("#modal-manager"),E=t?q?.querySelector(`#pinned-message-card-${t}[data-message-id="${t}"]`):q?.querySelector(`#conversation-card-${e}[data-conversation-id="${e}"]`);if(E){E.style.outline="none",E.classList.remove("bg-token-sidebar-surface-tertiary");const C=E.nextElementSibling;if(C&&(C.id.startsWith("conversation-card-")||C.id.startsWith("pinned-message-card-"))){C.style.outline=`2px solid ${isDarkMode()?"#fff":"#000"}`,lastSelectedConversationCardId=C.getAttribute("data-conversation-id"),lastSelectedPinnedMessageCardId=C.getAttribute("data-message-id"),C.scrollIntoView({behavior:"smooth",block:"center"});const L=C.getAttribute("data-conversation-id"),_=C.getAttribute("data-message-id");loadConversationInPreview(L,_,o)}else document.querySelector("#conversation-preview-wrapper-background").remove()}})}const m=document.querySelector("#conversation-preview-wrapper #preview-conversation-previous-button");if(m){const M=m.cloneNode(!0);m.replaceWith(M),c?.previousElementSibling===null?M.classList.add("hidden"):M.classList.remove("hidden"),M.addEventListener("click",$=>{$.stopPropagation(),closeMenus();const q=o?document.querySelector("#sidebar-folder-drawer"):document.querySelector("#modal-manager"),E=t?q?.querySelector(`#pinned-message-card-${t}[data-message-id="${t}"]`):q?.querySelector(`#conversation-card-${e}[data-conversation-id="${e}"]`);if(E){E.style.outline="none",E.classList.remove("bg-token-sidebar-surface-tertiary");const C=E.previousElementSibling;if(C&&(C.id.startsWith("conversation-card-")||C.id.startsWith("pinned-message-card-"))){C.style.outline=`2px solid ${isDarkMode()?"#fff":"#000"}`,lastSelectedConversationCardId=C.getAttribute("data-conversation-id"),lastSelectedPinnedMessageCardId=C.getAttribute("data-message-id"),C.scrollIntoView({behavior:"smooth",block:"center"});const L=C.getAttribute("data-conversation-id"),_=C.getAttribute("data-message-id");loadConversationInPreview(L,_,o)}else document.querySelector("#conversation-preview-wrapper-background").remove()}})}const g=[];let p=i.current_node;for(;p;){const M=i.mapping[p],$=M.parent,q=$?i.mapping[$]:null,E=q?q.children:[],C=E.findIndex(T=>p===T),L=C===-1?E.length:C+1,_=E.length;g.push({...M,threadIndex:L,threadCount:_}),p=$}g.reverse();let h="";h.id="conversation-wrapper";const{name:f,avatar:v}=await chrome.storage.sync.get(["name","avatar"]),{models:x}=await chrome.storage.local.get(["models"]),y=await getGizmoById(i?.gizmo_id);for(let M=0;M<g.length;M+=1){const{message:$,threadCount:q,threadIndex:E}=g[M];if(!$||$?.content?.content_type==="user_editable_context")continue;const C=$.role||$.author?.role;if(!(!C||C==="system"))if(C==="user")h+=rowUser(i,g[M],E,q,f,v,!0);else{const L=[g[M]];let _=g[M+1]?.message;for(;_&&_.role!=="user"&&_.author?.role!=="user";)L.push(g[M+1]),M+=1,_=g[M+1]?.message;h+=rowAssistant(i,L,E,q,x,y,!1,!1)}}r.innerHTML=h;const b=document.createElement("div");b.id="conversation-preview-bottom",b.classList="w-full h-32 md:h-48 flex-shrink-0",r.appendChild(b);const w=document.createElement("button");w.id="scroll-to-bottom-button",w.classList="hidden cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-tertiary border-token-border-medium end-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center bottom-5",w.innerHTML='<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-md text-token-text-primary"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 21C11.7348 21 11.4804 20.8946 11.2929 20.7071L4.29289 13.7071C3.90237 13.3166 3.90237 12.6834 4.29289 12.2929C4.68342 11.9024 5.31658 11.9024 5.70711 12.2929L11 17.5858V4C11 3.44772 11.4477 3 12 3C12.5523 3 13 3.44772 13 4V17.5858L18.2929 12.2929C18.6834 11.9024 19.3166 11.9024 19.7071 12.2929C20.0976 12.6834 20.0976 13.3166 19.7071 13.7071L12.7071 20.7071C12.5196 20.8946 12.2652 21 12 21Z" fill="currentColor"></path></svg>',w.addEventListener("click",()=>{k.scrollTop=k.scrollHeight}),r.appendChild(w);const k=document.querySelector("#conversation-preview-wrapper #conversation-inner-div");k.scrollHeight>k.clientHeight&&k.scrollTop<k.scrollHeight-k.clientHeight&&document.querySelector("#conversation-preview-wrapper #scroll-to-bottom-button")?.classList?.remove("hidden");const S=Array.from(document.querySelectorAll('input[id$="-search-input"]')).map(M=>M.value).join("").trim();if(S&&(highlightSearch([r],S),setTimeout(()=>{scrollToHighlight(k)},100)),renderAllDalleImages(i),renderAllPythonImages(i),renderAllPluginVisualizations(i,!0),addMissingGizmoNamesAndAvatars(),addFinalCompletionClassToLastMessageWrapper(),addConversationsEventListeners(i.conversation_id),t){const M=document.querySelector(`#conversation-preview-wrapper div[data-message-id="${t}"]`);if(M){const $=M.closest("article");$.classList.add("border-l-pinned","bg-pinned","dark:bg-pinned","border-b");const q=$.offsetHeight>window.innerHeight?"start":"nearest";$?.scrollIntoView({block:q})}}}function loadConversationFromNode(e,t,o){const r=document.querySelector("#conversation-search")?.value||"";stopAllAudios(),chrome.storage.sync.get(["name","avatar"],async n=>{const i=await getConversation(e,!0);chrome.storage.local.get(["models"],a=>{const s=removeSystemMessages(i);s&&getGizmoById(s?.gizmo_id).then(l=>{let d=s.mapping[t];const c=[];for(;d;){const p=d.parent,h=s.mapping[p].children,f=h.findIndex(y=>y===t),v=f===-1?1:f+1,x=h.length;c.push({...d,threadIndex:v,threadCount:x}),d=s.mapping[d.children[0]]}let u="";for(let p=0;p<c.length;p+=1){const{message:h,threadCount:f,threadIndex:v}=c[p];if(!h||h?.content?.content_type==="user_editable_context")continue;const x=h.role||h.author?.role;if(!(!x||x==="system"))if(x==="user")u+=rowUser(s,c[p],v,f,n.name,n.avatar);else{const y=[c[p]];let b=c[p+1]?.message;for(;b&&b.role!=="user"&&b.author?.role!=="user";)y.push(c[p+1]),p+=1,b=c[p+1]?.message;u+=rowAssistant(s,y,v,f,a.models,l,!1,!1)}}const m=document.querySelector("#conversation-preview-bottom"),g=document.querySelector(`#conversation-preview-wrapper #message-wrapper-${o}`);for(;g.nextElementSibling&&g.nextElementSibling.id.startsWith("message-wrapper-");)g.nextElementSibling.remove();if(g.remove(),m.insertAdjacentHTML("beforebegin",u),r){const p=document.querySelector("#conversation-preview-wrapper #conversation-inner-div"),h=document.querySelector("#conversation-top-title");highlightSearch([h,p],r),setTimeout(()=>{scrollToHighlight(p)},100)}addFinalCompletionClassToLastMessageWrapper(),renderAllDalleImages(s),renderAllPythonImages(s),renderAllPluginVisualizations(s),addMissingGizmoNamesAndAvatars(),addConversationsEventListeners(s.conversation_id)})})})}function removeSystemMessages(e){if(!e)return e;const t=structuredClone(e);return Object.keys(t.mapping).forEach(o=>{const r=t.mapping[o];if(r?.message?.role==="system"||r?.message?.author?.role==="system"){const n=r.parent,i=r.children,a=t.mapping[n];a&&(a.children=a.children.filter(l=>l!==o),a.children.push(...i));const s=t.mapping[i[0]];s&&(s.parent=n)}}),t}function addCopyCodeButtonsEventListeners(){document.querySelectorAll('[id="copy-code"][data-initialized="false"]').forEach(e=>{const t=e.cloneNode(!0);t.dataset.initialized=!0,e.parentNode.replaceChild(t,e),t.addEventListener("click",()=>{const o=t.closest("pre").querySelector("code");navigator.clipboard.writeText(o.innerText),t.innerHTML='<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><polyline points="20 6 9 17 4 12"></polyline></svg>Copied!',setTimeout(()=>{t.innerHTML='<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg>Copy code'},1500)})}),document.querySelectorAll('[id="manage-memories"]').forEach(e=>{e.addEventListener("click",()=>{window.location.href=`${window.location.href.split("#")[0]}/#settings/Personalization`})})}function addMissingGizmoNamesAndAvatars(){document.querySelectorAll('[id="gizmo-avatar"]').forEach(e=>{const t=e.dataset.gizmoid;getGizmoById(t).then(o=>{if(e.src.includes("wikimedia")){const r=o?.resource?.gizmo?.display?.profile_picture_url;r&&(e.src=r)}})})}let lastArticleElement;function addCopyButtonEventListener(){document.body.addEventListener("mouseover",e=>{const t=e.target.closest("article");if(t&&t!==lastArticleElement){lastArticleElement=t;const o=t.querySelector('button[data-testid="copy-turn-action-button"]');if(!o||t.querySelector('button[data-testid="copy-turn-action-button-original"]'))return;const r=o.cloneNode(!0);r.style.position="relative",addTooltip(r,{value:"Copy",position:"bottom"}),o.insertAdjacentElement("afterend",r),o.dataset.testid="copy-turn-action-button-original",o.style.display="none";const n=t?.querySelector("[data-message-id]")?.dataset.messageId;r?.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),closeMenus();const a=getConversationIdFromUrl();showCopyMenu(i,n,a),handleCopyText(n,a)})}else t||(lastArticleElement=null)})}async function showCopyMenu(e,t,o){const{x:r,y:n}=getMousePosition(e),i=e.target.closest("article"),a=await chrome.runtime.sendMessage({type:"checkHasSubscription"}),s=!i.nextElementSibling||i.nextElementSibling?.tagName!=="ARTICLE",l=r+(s?16:4)+window.scrollX,d=n+(s?-48:4)+window.scrollY,c=document.querySelector("#conversation-preview-wrapper"),u=`<div id="copy-message-menu" dir="ltr" style="position:fixed;left:0;top:0;transform:translate3d(${l}px,${d}px,0);min-width:max-content;z-index:1000000;--radix-popper-anchor-width:18px;--radix-popper-anchor-height:18px;--radix-popper-available-width:1167px;--radix-popper-available-height:604px;--radix-popper-transform-origin:0% 0px"><div data-side="bottom" data-align="start" role="menu" aria-orientation="vertical" data-state="open" data-radix-menu-content="" dir="ltr" aria-labelledby="radix-:r6g:" class="mt-2 min-w-[100px] max-w-xs rounded-lg border border-gray-100 bg-token-main-surface-primary shadow-long dark:border-gray-700" tabindex="-1" data-orientation="vertical" style="outline:0;--radix-dropdown-menu-content-transform-origin:var(--radix-popper-transform-origin);--radix-dropdown-menu-content-available-width:var(--radix-popper-available-width);--radix-dropdown-menu-content-available-height:var(--radix-popper-available-height);--radix-dropdown-menu-trigger-width:var(--radix-popper-anchor-width);--radix-dropdown-menu-trigger-height:var(--radix-popper-anchor-height);pointer-events:auto">
  
  <div role="menuitem" id="save-as-pdf-button-${t}" class="flex gap-2 m-1.5 rounded p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-secondary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item="">${translate("Save as PDF")}</div>
  
  <div role="menuitem" id="copy-html-button-${t}" class="flex gap-2 m-1.5 rounded p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-secondary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item="">${translate("Copy with Format")}</div>
  
  ${c?"":`<div role="menuitem" id="add-to-notes-button-${t}" class="flex items-center justify-between gap-2 m-1.5 rounded p-2.5 text-sm cursor-pointer focus:ring-0 hover:bg-token-main-surface-secondary radix-disabled:pointer-events-none radix-disabled:opacity-50 group" tabindex="-1" data-orientation="vertical" data-radix-collection-item="">${translate("Add to Notes")} ${a?"":'<span class="text-white rounded-md bg-green-500 px-2 text-sm">Pro</span>'}</div>`}
  
  </div></div>`;document.body.insertAdjacentHTML("beforeend",u),addCopyMenuEventListeners(t,o)}function addCopyMenuEventListeners(e,t){const o=document.querySelector(`#save-as-pdf-button-${e}`),r=document.querySelector(`#copy-html-button-${e}`),n=document.querySelector(`#add-to-notes-button-${e}`);o?.addEventListener("click",()=>{closeMenus(),saveResponseAsPDF(e,t)}),r?.addEventListener("click",i=>{closeMenus(),handleCopyHtml(e,t,i.shiftKey)}),n?.addEventListener("click",()=>{closeMenus(),handleCopyText(e,t,!0)})}function removeTimeStampCounterFromCopy(e){return e.querySelectorAll("#message-char-word-counter").forEach(t=>{t.remove()}),e.querySelectorAll("#message-timestamp").forEach(t=>{t.remove()}),e}async function saveResponseAsPDF(e,t){const o=document.querySelector(`div[data-message-id="${e}"]`).parentElement.closest("article");saveConversationAsPDF(t,o)}async function handleCopyText(e,t,o=!1){if(document.querySelector(`div[data-message-id="${e}"]`).parentElement.closest("article").querySelector('[data-testid="copy-turn-action-button-original"]').click(),o){const r=await navigator.clipboard.readText();handleAddToNoteText(r)}else toast("Copied to clipboard","success")}async function handleCopyHtml(e,t,o=!1){const r=document.querySelector(`div[data-message-id="${e}"]`).parentElement,n=r.closest("article");let i=r.cloneNode(!0);i=removeTimeStampCounterFromCopy(i);const a=n?.previousElementSibling?.lastElementChild;cachedSettings.copyMode&&(i.innerHTML=`<div>USER:</div><div>${a?.innerText||""}</div><br><div>ASSISTANT:</div>${i.innerHTML}`),copyRichText(i),o?handleAddToNoteText(i.innerHTML,"as HTML"):toast("Copied to clipboard as HTML","success")}function handleAddToNoteText(e,t=""){chrome.runtime.sendMessage({type:"checkHasSubscription"},o=>{if(!o){errorUpgradeConfirmation({title:"This is a Pro feature",message:"Using the Notes feature requires a Pro subscription. Upgrade to Pro to remove all limits."});return}toast(`Copied to clipboard${t?` ${t}`:""} and added to notes`,"success");const r=document.querySelector("#sidebar-note-input");if(!r||(r.value+=`${e}`,r.blur(),sidebarNoteIsOpen))return;const n=document.querySelector("#sidebar-note-button");n&&n.insertAdjacentElement("beforeend",animatePing("#19c37d"))})}function addConversationsEventListeners(e,t=!1){const o=[...document.querySelectorAll('[id^="message-wrapper-"]')].pop();let r=document.querySelectorAll('[id^="copy-message-button-"]'),n=document.querySelectorAll('#conversation-preview-wrapper [id^="thread-prev-button-"]'),i=document.querySelectorAll('#conversation-preview-wrapper [id^="thread-next-button-"]'),a=document.querySelectorAll('[id^="asset-"]'),s=document.querySelectorAll('[id^="message-plugin-toggle-"]'),l=document.querySelectorAll('[id^="strawberry-dropdown-wrapper-"]'),d=document.querySelectorAll('a[href^="sandbox:/"]'),c=document.querySelectorAll('span[id="citation"]');t&&(r=Array.from(r).slice(-1),n=Array.from(n).slice(-2),i=Array.from(i).slice(-2),a=Array.from(a).slice(-2),s=o?.querySelectorAll('[id^="message-plugin-toggle-"]'),l=o?.querySelectorAll('[id^="strawberry-dropdown-wrapper-"]'),c=o?.querySelectorAll('span[id="citation"]'),d=o?.querySelectorAll('a[href^="sandbox:/"]')),addCopyCodeButtonsEventListeners(),r.forEach(g=>{const p=g.cloneNode(!0);g.parentNode.replaceChild(p,g);const h=p.id.split("copy-message-button-").pop();p.addEventListener("click",f=>{f.preventDefault(),f.stopPropagation(),closeMenus(),showCopyMenu(f,h,e)})}),n.forEach(g=>{const p=g.cloneNode(!0);g.parentNode.replaceChild(p,g),p.addEventListener("click",async()=>{const h=await getConversation(e),f=removeSystemMessages(h),v=p.id.split("thread-prev-button-").pop(),x=document.querySelector(`#message-wrapper-${v}`).previousElementSibling;let y=f.mapping[v].parent;x&&x.id.startsWith("message-wrapper-")&&(y=x.id.split("message-wrapper-").pop());const b=f.mapping[y].children,w=document.querySelector(`#thread-count-wrapper-${v}`),[k]=w.textContent.split(" / ").map(S=>parseInt(S,10));if(k>1){const S=k-1,M=b[S-1];loadConversationFromNode(f.conversation_id,M,v)}})}),i.forEach(g=>{const p=g.cloneNode(!0);g.parentNode.replaceChild(p,g),p.addEventListener("click",async()=>{const h=await getConversation(e),f=removeSystemMessages(h),v=p.id.split("thread-next-button-").pop(),x=document.querySelector(`#message-wrapper-${v}`).previousElementSibling;let y=f.mapping[v].parent;x&&x.id.startsWith("message-wrapper-")&&(y=x.id.split("message-wrapper-").pop());const b=f.mapping[y].children,w=document.querySelector(`#thread-count-wrapper-${v}`),[k,S]=w.textContent.split(" / ").map(M=>parseInt(M,10));if(k<S){const M=k+1,$=b[M-1];loadConversationFromNode(f.conversation_id,$,v)}})}),a?.forEach(g=>{const p=g.cloneNode(!0);g.parentNode.replaceChild(p,g),p.addEventListener("click",()=>{let h="";p.tagName==="IMG"&&(h=p.getAttribute("src")),p.tagName==="SPAN"&&(h=p.style.backgroundImage.split('"')[1]),createFullSizeFileWrapper(h),addFullSizeFileWrapperEventListener()})});const u=[],m=[];c?.forEach(g=>{const p=g.querySelector("a");if(!p.href||!p.href.startsWith("http"))return;if(g.querySelector("svg")){u.push(g);const f=new URL(p.href);m.push(f.origin)}const h=p.cloneNode(!0);p.parentNode.replaceChild(h,p),h.addEventListener("mouseenter",f=>{showCitationTooltip(f,h)}),h.addEventListener("mouseleave",f=>{hideCitationTooltip(f)})}),updateCitationAttributes(u,m),d?.forEach(g=>{const p=g.cloneNode(!0);g.parentNode.replaceChild(p,g),p.addEventListener("click",h=>{h.preventDefault(),closeMenus();const f=getConversation(e),v=p.getAttribute("href"),x=v.split("/").pop(),y=v.split("sandbox:").pop(),b=Object.values(f.mapping).find(k=>k.message?.metadata?.aggregate_result?.final_expression_output?.includes(`'${y}'`)),w=b?.message?.metadata?.aggregate_result?.messages?.filter(k=>k?.message_type==="image")?.[0]?.image_url?.split("://")?.pop();w?getDownloadUrlFromFileId(e,w).then(k=>{if(k.status==="error"){toast("Code interpreter session expired","error");return}const S=k.download_url;downloadFileFromUrl(S,x)}):getDownloadUrlFromSandBoxPath(e,b.id,y).then(k=>{if(k.status==="error"){toast("Code interpreter session expired","error");return}const S=k.download_url;downloadFileFromUrl(S,x)})})}),addMessagePluginToggleButtonsEventListeners(s),addMessageStrawberryToggleButtonsEventListeners(l)}function addMessagePluginToggleButtonsEventListeners(e){e?.forEach(t=>{const o=t.cloneNode(!0);t.parentNode.replaceChild(o,t),o.addEventListener("click",()=>{const r=o.id.split("message-plugin-toggle-").pop(),n=document.querySelector(`#message-plugin-content-${r}`);n.classList.contains("hidden")?(o.querySelector("polyline").setAttribute("points","18 15 12 9 6 15"),n.classList.remove("hidden")):(o.querySelector("polyline").setAttribute("points","6 9 12 15 18 9"),n.classList.add("hidden"))})})}function addMessageStrawberryToggleButtonsEventListeners(e){e?.forEach(t=>{const o=t.cloneNode(!0);t.parentNode.replaceChild(o,t),o.addEventListener("click",()=>{const r=o.id.split("strawberry-dropdown-wrapper-").pop(),n=document.querySelector(`#strawberry-content-${r}`),i=document.querySelector(`#strawberry-dropdown-toggle-${r}`);n&&(n.classList.toggle("hidden"),n.classList.contains("hidden")?i.classList.remove("rotate-180"):i.classList.add("rotate-180"))})})}function showCitationTooltip(e,t){const o=new URL(t.getAttribute("href")),r=o.host?t.title:t.href.includes("sandbox")?"Download file":"",n=o.hostname,{x:i,y:a}=t.getBoundingClientRect();if(!r)return;const s=`<div id="citation-tooltip" style="position: fixed; left: 0px; top: 0px; transform: translate3d(${i}px, ${a-30}px, 0px); min-width: max-content; z-index: auto; --radix-popper-anchor-width: 25px; --radix-popper-anchor-height: 21px; --radix-popper-available-width: 753.3125px; --radix-popper-available-height: 535px; --radix-popper-transform-origin: 50% 34px;"><div data-side="top" data-align="center" data-state="delayed-open" class="relative rounded-lg border border-token-border-medium bg-black p-1 shadow-xs transition-opacity max-w-sm" style="--radix-tooltip-content-transform-origin: var(--radix-popper-transform-origin); --radix-tooltip-content-available-width: var(--radix-popper-available-width); --radix-tooltip-content-available-height: var(--radix-popper-available-height); --radix-tooltip-trigger-width: var(--radix-popper-anchor-width); --radix-tooltip-trigger-height: var(--radix-popper-anchor-height);"><span class="flex items-center whitespace-pre-wrap px-2 py-1 text-center font-medium normal-case text-gray-100 text-sm"><a href="${o.href}" target="_blank" rel="noreferrer" class="text-xs !no-underline"><div class="flex items-center gap-2">${o.host?`<div class="flex shrink-0 items-center justify-center"><img src="https://icons.duckduckgo.com/ip3/${n}.ico" alt="Favicon" width="16" height="16" class="my-0"></div>`:""}<div class="max-w-xs truncate">${r}</div>${o.host?'<div class="shrink-0"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="icon icon-xs" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></div>':""}</div></a></span></div></div>`;if(document.querySelector("#citation-tooltip"))return;document.body.insertAdjacentHTML("beforeend",s);const l=document.querySelector("#citation-tooltip"),d=l.offsetWidth;l.style.transform=`translate3d(${i-d/2}px, ${a-30}px, 0px)`,l.addEventListener("mouseout",c=>{hideCitationTooltip(c)})}function hideCitationTooltip(e){const t=document.querySelector("#citation-tooltip");t&&!t.contains(e.relatedTarget)&&t.remove()}function updateCitationAttributes(e,t){t=[...new Set(t)],t.length&&getCitationAttributions(t).then(o=>{e.forEach(r=>{const n=r.querySelector("a"),i=new URL(n.href).origin,a=o.find(l=>l.url===i);if(!a)return;const s=r.querySelector("svg");s.outerHTML=a.attribution,n.insertAdjacentHTML("beforebegin",'<span class="text-token-text-tertiary"> (</span>'),n.insertAdjacentHTML("afterend",'<span class="text-token-text-tertiary">)</span>')})})}async function openMoveConvToFolderModal(e){const t=`
  <div id="move-conv-to-folder-modal" class="absolute inset-0" style="z-index: 10000;">
    <div data-state="open" class="fixed inset-0 bg-black/50 dark:bg-black/80" style="pointer-events: auto;">
      <div class="h-full w-full grid grid-cols-[10px_1fr_10px] grid-rows-[minmax(10px,1fr)_auto_minmax(10px,1fr)] md:grid-rows-[minmax(20px,1fr)_auto_minmax(20px,1fr)] overflow-y-auto">
        <div id="move-conv-to-folder-content" role="dialog" aria-describedby="radix-:r3o:" aria-labelledby="radix-:r3n:" data-state="open" class="popover bg-token-main-surface-primary relative start-1/2 col-auto col-start-2 row-auto row-start-2 h-full w-full text-start ltr:-translate-x-1/2 rtl:translate-x-1/2 rounded-2xl shadow-xl flex flex-col focus:outline-hidden overflow-hidden max-w-lg" tabindex="-1" style="pointer-events: auto;">
          <div class="px-4 pb-4 pt-5 flex items-center justify-between border-b border-token-border-medium">
            <div class="flex">
              <div class="flex items-center">
                <div class="flex grow flex-col gap-1">
                  <h2 as="h3" class="text-lg font-medium leading-6 text-token-text-primary">${translate("Select a folder")}</h2>
                </div>
              </div>
            </div>
            <div class="flex items-center">
              <button id="move-conv-to-folder-new-folder" class="btn flex justify-center gap-2 composer-submit-btn composer-submit-button-color me-2 border" data-default="true" style="min-width: 72px; height: 34px;">${translate("plus New Folder")}</button>
              <button id="move-conv-to-folder-close-button" class="text-token-text-tertiary hover:text-token-text-primary transition">
                <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="20" width="20"
                  xmlns="http://www.w3.org/2000/svg">
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
              </button>
            </div>
          </div>
          <div class="px-4 pt-4 text-sm">
            <div class="text-token-text-tertiary">Moving conversation${e.length>1?"s":""} from:</div>
            <div id="moveConvToFolderBreadcrumb"></div>
          </div>
          <div class="px-4 pt-4">
            <input autofocus id="move-conv-to-folder-search-input" type="search" placeholder="${translate("Search folders")}" class="w-full p-2 rounded-md border border-token-border-medium bg-token-main-surface-secondary text-token-text-tertiary">
          </div>
          <div id="move-conv-to-folder-list" class="p-4 overflow-y-auto" style="height:500px;">
            <!-- folder list here -->
          </div>
        </div>
      </div>
    </div>
  </div>`;document.body.insertAdjacentHTML("beforeend",t),await moveConvToFolderLoadFolderList(),addMoveConvToFolderModalEventListener(e);const o=debounce(async s=>{await moveConvToFolderLoadFolderList(s),addMoveConvToFolderModalEventListener(e)},500),r=document.querySelector("#move-conv-to-folder-search-input");r.focus(),r.addEventListener("input",async()=>{o(r.value)});const n=await chrome.runtime.sendMessage({type:"getConversation",detail:{conversationId:e[0]}}),i=convMenuBreadcrumb(n?.breadcrumb),a=document.querySelector("#moveConvToFolderBreadcrumb");a.innerHTML=i}async function moveConvToFolderLoadFolderList(e=""){const t=document.querySelector("#move-conv-to-folder-list");t.innerHTML="",t.appendChild(loadingSpinner("move-conv-to-folder-list"));const o=await chrome.runtime.sendMessage({type:"getConversationFolders",detail:{sortBy:"alphabetical",searchTerm:e}});t.innerHTML=o.length>0?o.map(r=>moveConvToFolderSimpleFolderElement(r)).join(""):'<div id="no-conversation-folders" class="text-sm text-token-text-tertiary">No folders found.</div>'}function moveConvToFolderSimpleFolderElement(e){const t=e.id===-1,o=e.image||e.image_url||chrome.runtime.getURL("icons/folder.png"),r=document.querySelector("#move-conv-to-folder-search-input")?.value?.toLowerCase()||"",n=r?[...e.breadcrumb,{name:e.name}].map(a=>a.name).join('<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-sm mx-1"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.29289 18.7071C8.90237 18.3166 8.90237 17.6834 9.29289 17.2929L14.5858 12L9.29289 6.70711C8.90237 6.31658 8.90237 5.68342 9.29289 5.29289C9.68342 4.90237 10.3166 4.90237 10.7071 5.29289L16.7071 11.2929C16.8946 11.4804 17 11.7348 17 12C17 12.2652 16.8946 12.5196 16.7071 12.7071L10.7071 18.7071C10.3166 19.0976 9.68342 19.0976 9.29289 18.7071Z" fill="currentColor"></path></svg>'):e.name,i=r?[...e.breadcrumb,{name:e.name}].map(a=>a.name).join(" > "):e.name;return`<div id="move-conv-to-folder-wrapper-folder-${e.id}" title="${i}" class="flex w-full mb-2 group ${t?"opacity-50 pointer-events-none":""}" style="flex-wrap: wrap;"><div id="folder-${e.id}" class="flex py-3 px-3 pe-3 w-full border border-token-border-medium items-center gap-3 relative rounded-md cursor-pointer break-all hover:pe-10 group" style="background-color: ${e.color};"><img class="w-6 h-6 object-cover rounded-md" src="${o}" style="filter:drop-shadow(0px 0px 1px black);" data-is-open="false"><div id="title-folder-${e.id}" class="flex flex-1 items-center text-ellipsis max-h-5 overflow-hidden whitespace-nowrap break-all relative text-white relative" style="bottom: 6px;">${n}</div><div id="folder-actions-wrapper-${e.id}" class="absolute flex end-1 z-10 text-gray-300"><button id="move-conv-to-folder-button-${e.id}" class="btn btn-xs btn-primary group-hover:visible ${t?"":"invisible"}" title="Move to folder">${t?"Upgrade to pro":"Move to this folder"}</button></div><div id="count-folder-${e.id}" style="color: rgba(255, 255, 255, 0.6); font-size: 10px; position: absolute; left: 50px; bottom: 2px; display: block;">${e?.subfolders?.length||0} folder${e?.subfolders?.length===1?"":"s"} - ${e.conversation_count} chat${e.conversation_count===1?"":"s"}</div></div></div>`}function addMoveConvToFolderModalEventListener(e){document.querySelectorAll("[id^=move-conv-to-folder-wrapper-folder-]").forEach(t=>{t.addEventListener("click",o=>{moveConvToFolderOpenFolder(t,e,o.shiftKey)})}),document.querySelectorAll("button[id^=move-conv-to-folder-button-]").forEach(t=>{const o=t.id.split("move-conv-to-folder-button-")[1],r=document.querySelector(`#title-folder-${o}`).textContent,n=document.querySelector(`#folder-${o}`).style.backgroundColor;t.addEventListener("click",i=>{if(i.stopPropagation(),i.preventDefault(),o==="-1"){errorUpgradeConfirmation({type:"limit",title:"You have reached the limit",message:"With free account, you can only have up to 5 conversation folders. Upgrade to Pro to remove all limits."});return}moveConvToFolder(e,o,r,n),document.querySelector("#move-conv-to-folder-modal")?.remove()})}),document.querySelector("#move-conv-to-folder-new-folder").addEventListener("click",async()=>{const t=await chrome.runtime.sendMessage({type:"checkHasSubscription"}),o=document.querySelectorAll("#move-conv-to-folder-content [id^=move-conv-to-folder-wrapper-folder-]");if(!t&&o.length>=5){errorUpgradeConfirmation({type:"limit",title:"You have reached the limit",message:"You have reached the limits of Folders with free account. Upgrade to Pro to remove all limits."});return}document.querySelectorAll("#no-conversation-folders").forEach(i=>i.remove());const r=await chrome.runtime.sendMessage({type:"addConversationFolders",detail:{folders:[{name:"New Folder",color:generateRandomDarkColor()}]}});if(r.error&&r.error.type==="limit"){errorUpgradeConfirmation(r.error);return}document.querySelector("#move-conv-to-folder-list").insertAdjacentHTML("afterbegin",moveConvToFolderSimpleFolderElement(r[0]));const n=document.querySelector(`#move-conv-to-folder-wrapper-folder-${r[0].id}`);n.addEventListener("click",i=>{moveConvToFolderOpenFolder(n,e,i.shiftKey)}),document.querySelector(`#move-conv-to-folder-button-${r[0].id}`).addEventListener("click",()=>{moveConvToFolder(e,r[0].id,r[0].name,r[0].color),document.querySelector("#move-conv-to-folder-modal")?.remove()}),getLastSelectedConversationFolder()||addNewConvFolderElementToSidebar(r[0]),addNewConvFolderElementToManagerSidebar(r[0])}),document.querySelector("#move-conv-to-folder-close-button").addEventListener("click",t=>{t.stopPropagation(),t.preventDefault(),closeMenus(),document.querySelector("#move-conv-to-folder-modal")?.remove()}),document.body.addEventListener("click",t=>{const o=document.querySelector("#move-conv-to-folder-modal"),r=document.querySelector("#move-conv-to-folder-content");r&&isDescendant(o,t.target)&&!isDescendant(r,t.target)&&o.remove()})}function moveConvToFolderOpenFolder(e,t,o=!1){const r=e.id.split("move-conv-to-folder-wrapper-folder-")[1],n=e.nextElementSibling;if(o)n&&n.id===`subfolder-wrapper-${r}`&&n.remove();else if(n&&n.id===`subfolder-wrapper-${r}`){n.classList.contains("hidden")?n.classList.remove("hidden"):n.classList.add("hidden");return}const i=document.createElement("div");i.id=`subfolder-wrapper-${r}`,i.classList="ps-4 border-s border-token-border-medium",e.insertAdjacentElement("afterend",i);const a=document.createElement("div");a.classList="flex flex-col mb-4 relative",a.style.minHeight="32px",a.appendChild(loadingSpinner("subfolder-list")),i.appendChild(a),chrome.runtime.sendMessage({type:"getConversationFolders",forceRefresh:o,detail:{sortBy:"alphabetical",parentFolderId:r}},s=>{s&&Array.isArray(s)&&(a.innerHTML="",s.length>0?s?.forEach(l=>{a.insertAdjacentHTML("beforeend",moveConvToFolderSimpleFolderElement(l));const d=document.querySelector(`#move-conv-to-folder-wrapper-folder-${l.id}`);d&&(d?.addEventListener("click",c=>{moveConvToFolderOpenFolder(d,t,c.shiftKey)}),document.querySelector(`#move-conv-to-folder-button-${l.id}`).addEventListener("click",()=>{moveConvToFolder(t,l.id,l.name,l.color),document.querySelector("#move-conv-to-folder-modal")?.remove()}))}):a.insertAdjacentHTML("beforeend",'<div class="text-sm text-token-text-tertiary">No subfolders</div>'))})}async function moveConvToFolder(e,t,o,r){toast("Conversation moved to folder");const n=getLastSelectedConversationFolder();if(updateConversationFolderCount(t,e),n?.id!==t&&(!isDefaultConvFolder(n?.id?.toString())||cachedSettings?.excludeConvInFolders&&n?.id?.toString()==="all")){e.forEach(s=>{document.querySelectorAll(`#conversation-card-${s}`).forEach(l=>{l.remove()})});const i=document.querySelector("#modal-manager #conversation-manager-conversation-list");i&&i.children.length===0&&i.appendChild(noConversationElement());const a=document.querySelector("#sidebar-folder-content");a&&a.querySelectorAll("[id^=conversation-card-]").length===0&&a.appendChild(noConversationElement())}else e.forEach(i=>{document.querySelectorAll(`#conversation-card-${i}`).forEach(s=>{s.dataset.folderId=t}),n?.id?.toString()!==t.toString()&&document.querySelectorAll(`#conversation-card-folder-wrapper-${i}`).forEach(s=>{s.classList.remove("hidden")}),document.querySelectorAll(`#conversation-card-folder-tag-${i}`)?.forEach(s=>{s.classList.remove("hidden"),s.style.backgroundColor=r}),document.querySelectorAll(`#conversation-card-folder-name-${i}`)?.forEach(s=>{s.innerText=o}),document.querySelectorAll(`#conversation-card-folder-color-indicator-${i}`).forEach(s=>{s.style.backgroundColor=r,s.title=o||"",s.dataset.folderId=t});const a=document.querySelector(`#modal-manager #conversation-checkbox-${i}`);a&&(a.checked=!1)});resetConversationManagerSelection(),resetSidebarConversationSelection(),chrome.runtime.sendMessage({type:"moveConversationIdsToFolder",detail:{folderId:parseInt(t,10),conversationIds:e}})}async function openMoveConvFolderModal(e){const t=`
  <div id="move-conv-folder-modal" class="absolute inset-0" style="z-index: 10000;">
    <div data-state="open" class="fixed inset-0 bg-black/50 dark:bg-black/80" style="pointer-events: auto;">
      <div class="h-full w-full grid grid-cols-[10px_1fr_10px] grid-rows-[minmax(10px,1fr)_auto_minmax(10px,1fr)] md:grid-rows-[minmax(20px,1fr)_auto_minmax(20px,1fr)] overflow-y-auto">
        <div id="move-conv-folder-content" role="dialog" aria-describedby="radix-:r3o:" aria-labelledby="radix-:r3n:" data-state="open" class="popover bg-token-main-surface-primary relative start-1/2 col-auto col-start-2 row-auto row-start-2 h-full w-full text-start ltr:-translate-x-1/2 rtl:translate-x-1/2 rounded-2xl shadow-xl flex flex-col focus:outline-hidden overflow-hidden max-w-lg" tabindex="-1" style="pointer-events: auto;">
          <div class="px-4 pb-4 pt-5 flex items-center justify-between border-b border-token-border-medium">
            <div class="flex">
              <div class="flex items-center">
                <div class="flex grow flex-col gap-1">
                  <h2 as="h3" class="text-lg font-medium leading-6 text-token-text-primary">${translate("Select a folder")}</h2>
                </div>
              </div>
            </div>
            <div class="flex items-center">
              <button id="move-conv-folder-new-folder" class="btn flex justify-center gap-2 composer-submit-btn composer-submit-button-color me-2 border" data-default="true" style="min-width: 72px; height: 34px;">${translate("plus New Folder")}</button>
              <button id="move-conv-folder-close-button" class="text-token-text-tertiary hover:text-token-text-primary transition">
                <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="20" width="20"
                  xmlns="http://www.w3.org/2000/svg">
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
              </button>
            </div>
          </div>
          <div class="px-4 pt-4">
            <input autofocus id="move-conv-folder-search-input" type="search" placeholder="${translate("Search folders")}" class="w-full p-2 rounded-md border border-token-border-medium bg-token-main-surface-secondary text-token-text-tertiary">
          </div>
          <div id="move-conv-folder-list" class="p-4 overflow-y-auto" style="height:500px;">
            <!-- folder list here -->
          </div>
        </div>
      </div>
    </div>
  </div>`;document.body.insertAdjacentHTML("beforeend",t),await moveConvFolderLoadFolderList(e),addMoveConvFolderModalEventListener(e);const o=debounce(async n=>{await moveConvFolderLoadFolderList(e,n),addMoveConvFolderModalEventListener(e)},500),r=document.querySelector("#move-conv-folder-search-input");r.focus(),r.addEventListener("input",async()=>{o(r.value)})}async function moveConvFolderLoadFolderList(e,t=""){const o=document.querySelector("#move-conv-folder-list");o.innerHTML="",o.appendChild(loadingSpinner("move-conv-folder-list"));const r=await chrome.runtime.sendMessage({type:"getConversationFolders",detail:{sortBy:"alphabetical",searchTerm:t}}),n=e.parent_folder;o.innerHTML=r.length>0?`<button id="move-conv-to-root-button" class="btn btn-large w-full btn-primary mb-2 ${n?"":"opacity-50 pointer-events-none"}" ${n?"":'disabled="true"'}>Move to root</button>${r.map(i=>moveConvFolderSimpleFolderElement(i,e.id)).join("")}`:'<div id="no-conversation-folders" class="text-sm text-token-text-tertiary">No folders found.</div>'}function moveConvFolderSimpleFolderElement(e,t){const o=e.id===-1,r=e.image||e.image_url||chrome.runtime.getURL("icons/folder.png"),n=document.querySelector("#move-conv-folder-search-input")?.value?.toLowerCase()||"",i=n?[...e.breadcrumb,{name:e.name}].map(s=>s.name).join('<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon icon-sm mx-1"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.29289 18.7071C8.90237 18.3166 8.90237 17.6834 9.29289 17.2929L14.5858 12L9.29289 6.70711C8.90237 6.31658 8.90237 5.68342 9.29289 5.29289C9.68342 4.90237 10.3166 4.90237 10.7071 5.29289L16.7071 11.2929C16.8946 11.4804 17 11.7348 17 12C17 12.2652 16.8946 12.5196 16.7071 12.7071L10.7071 18.7071C10.3166 19.0976 9.68342 19.0976 9.29289 18.7071Z" fill="currentColor"></path></svg>'):e.name,a=n?[...e.breadcrumb,{name:e.name}].map(s=>s.name).join(" > "):e.name;return`<div id="move-conv-folder-wrapper-folder-${e.id}" title="${a}" class="flex w-full mb-2 group ${o||t===e.id?"opacity-50 pointer-events-none":""}" style="flex-wrap: wrap;"><div id="folder-${e.id}" class="flex py-3 px-3 pe-3 w-full border border-token-border-medium items-center gap-3 relative rounded-md cursor-pointer break-all hover:pe-10 group" style="background-color: ${e.color};"><img class="w-6 h-6 object-cover rounded-md" src="${r}" style="filter:drop-shadow(0px 0px 1px black);" data-is-open="false"><div id="title-folder-${e.id}" class="flex flex-1 items-center text-ellipsis max-h-5 overflow-hidden whitespace-nowrap break-all relative text-white relative" style="bottom: 6px;">${i}</div><div id="folder-actions-wrapper-${e.id}" class="absolute flex end-1 z-10 text-gray-300"><button id="move-conv-folder-button-${e.id}" class="btn btn-xs btn-primary group-hover:visible ${o||t===e.id?"":"invisible"}" ${t===e.id?'disabled="true"':""} title="Move to folder">${o?"Upgrade to pro":t===e.id?"Moving folder":"Move to this folder"}</button></div><div id="count-folder-${e.id}" style="color: rgba(255, 255, 255, 0.6);font-size: 10px; position: absolute; left: 50px; bottom: 2px; display: block;">${e?.subfolders?.length||0} folder${e?.subfolders?.length===1?"":"s"} - ${e.conversation_count} chat${e.conversation_count===1?"":"s"}</div></div></div>`}function addMoveConvFolderModalEventListener(e){const t=document.querySelector("#move-conv-to-root-button");t.addEventListener("click",()=>{moveConvFolder(e,0),document.querySelector("#move-conv-folder-modal")?.remove()}),document.querySelectorAll("[id^=move-conv-folder-wrapper-folder-]").forEach(o=>{o.addEventListener("click",r=>{moveConvFolderOpenFolder(o,e,r.shiftKey)})}),document.querySelectorAll("button[id^=move-conv-folder-button-]").forEach(o=>{const r=o.id.split("move-conv-folder-button-")[1];o.addEventListener("click",n=>{if(n.stopPropagation(),n.preventDefault(),r==="-1"){errorUpgradeConfirmation({type:"limit",title:"You have reached the limit",message:"With free account, you can only have up to 5 conversation folders. Upgrade to Pro to remove all limits."});return}moveConvFolder(e,r),document.querySelector("#move-conv-folder-modal")?.remove()})}),document.querySelector("#move-conv-folder-new-folder").addEventListener("click",async()=>{const o=await chrome.runtime.sendMessage({type:"checkHasSubscription"}),r=document.querySelectorAll("#move-conv-folder-content [id^=move-conv-folder-wrapper-folder-]");if(!o&&r.length>=5){errorUpgradeConfirmation({type:"limit",title:"You have reached the limit",message:"You have reached the limits of Folders with free account. Upgrade to Pro to remove all limits."});return}document.querySelectorAll("#no-conversation-folders").forEach(s=>s.remove());const n=await chrome.runtime.sendMessage({type:"addConversationFolders",detail:{folders:[{name:"New Folder",color:generateRandomDarkColor()}]}});if(n.error&&n.error.type==="limit"){errorUpgradeConfirmation(n.error);return}const i=document.querySelector("#move-conv-folder-list");t.insertAdjacentHTML("afterend",moveConvFolderSimpleFolderElement(n[0],e.id));const a=document.querySelector(`#move-conv-folder-wrapper-folder-${n[0].id}`);a.addEventListener("click",s=>{moveConvFolderOpenFolder(a,e,s.shiftKey)}),document.querySelector(`#move-conv-folder-button-${n[0].id}`).addEventListener("click",()=>{moveConvFolder(e,n[0].id),document.querySelector("#move-conv-folder-modal")?.remove()}),getLastSelectedConversationFolder()||addNewConvFolderElementToSidebar(n[0]),addNewConvFolderElementToManagerSidebar(n[0])}),document.querySelector("#move-conv-folder-close-button").addEventListener("click",o=>{o.stopPropagation(),o.preventDefault(),closeMenus(),document.querySelector("#move-conv-folder-modal")?.remove()}),document.body.addEventListener("click",o=>{const r=document.querySelector("#move-conv-folder-modal"),n=document.querySelector("#move-conv-folder-content");n&&isDescendant(r,o.target)&&!isDescendant(n,o.target)&&r?.remove()})}function moveConvFolderOpenFolder(e,t,o=!1){const r=e.id.split("move-conv-folder-wrapper-folder-")[1],n=e.nextElementSibling;if(o)n&&n.id===`subfolder-wrapper-${r}`&&n.remove();else if(n&&n.id===`subfolder-wrapper-${r}`){n.classList.contains("hidden")?n.classList.remove("hidden"):n.classList.add("hidden");return}const i=document.createElement("div");i.id=`subfolder-wrapper-${r}`,i.classList="ps-4 border-s border-token-border-medium",e.insertAdjacentElement("afterend",i);const a=document.createElement("div");a.classList="flex flex-col mb-4 relative",a.style.minHeight="32px",a.appendChild(loadingSpinner("subfolder-list")),i.appendChild(a),chrome.runtime.sendMessage({type:"getConversationFolders",forceRefresh:o,detail:{sortBy:"alphabetical",parentFolderId:r}},s=>{s&&Array.isArray(s)&&(a.innerHTML="",s.length>0?s?.forEach(l=>{a.insertAdjacentHTML("beforeend",moveConvFolderSimpleFolderElement(l,t.id));const d=document.querySelector(`#move-conv-folder-wrapper-folder-${l.id}`);d&&(d?.addEventListener("click",c=>{moveConvFolderOpenFolder(d,t,c.shiftKey)}),document.querySelector(`#move-conv-folder-button-${l.id}`).addEventListener("click",()=>{moveConvFolder(t,l.id),document.querySelector("#move-conv-folder-modal")?.remove()}))}):a.insertAdjacentHTML("beforeend",'<div class="text-sm text-token-text-tertiary">No subfolders</div>'))})}async function moveConvFolder(e,t){toast("Folder moved successfully");const o=getLastSelectedConversationFolder();if(t===0){const i=document.querySelector("#conversation-manager-sidebar-folders"),a=document.querySelector(`#conversation-manager-subfolder-list #conversation-folder-wrapper-${e.id}`);i&&a&&i.appendChild(a),document.querySelectorAll(`#sidebar-folder-content #conversation-folder-wrapper-${e.id}`).forEach(s=>s.remove())}else document.querySelectorAll(`#conversation-folder-wrapper-${e.id}`).forEach(i=>i.remove());const r=e.parent_folder;document.querySelectorAll(`#folder-subfolder-count-${r}`).forEach(i=>{const a=parseInt(i.innerText.split(" ")[0],10);i.innerText=`${a-1} folder${a-1===1?"":"s"} -`}),document.querySelectorAll(`#folder-subfolder-count-${t}`).forEach(i=>{const a=parseInt(i.innerText.split(" ")[0],10);i.innerText=`${a+1} folder${a+1===1?"":"s"} -`});const n={parent_folder_id:t};chrome.runtime.sendMessage({type:"updateConversationFolder",forceRefresh:!0,detail:{folderId:e.id,newData:n}},()=>{t.toString()===o.id.toString()&&throttleGetConvSubFolders(o.id,!0)})}async function openMovePromptToFolderModal(e){const t=`
  <div id="move-prompt-to-folder-modal" class="absolute inset-0" style="z-index: 10000;">
    <div data-state="open" class="fixed inset-0 bg-black/50 dark:bg-black/80" style="pointer-events: auto;">
      <div class="h-full w-full grid grid-cols-[10px_1fr_10px] grid-rows-[minmax(10px,1fr)_auto_minmax(10px,1fr)] md:grid-rows-[minmax(20px,1fr)_auto_minmax(20px,1fr)] overflow-y-auto">
        <div id="move-prompt-to-folder-content" role="dialog" aria-describedby="radix-:r3o:" aria-labelledby="radix-:r3n:" data-state="open" class="popover bg-token-main-surface-primary relative start-1/2 col-auto col-start-2 row-auto row-start-2 h-full w-full text-start ltr:-translate-x-1/2 rtl:translate-x-1/2 rounded-2xl shadow-xl flex flex-col focus:outline-hidden overflow-hidden max-w-lg" tabindex="-1" style="pointer-events: auto;">
          <div class="px-4 pb-4 pt-5 flex items-center justify-between border-b border-token-border-medium">
            <div class="flex">
              <div class="flex items-center">
                <div class="flex grow flex-col gap-1">
                  <h2 as="h3" class="text-lg font-medium leading-6 text-token-text-primary">${translate("Select a folder")}</h2>
                </div>
              </div>
            </div>
            <div class="flex items-center">
              <button id="move-prompt-to-folder-new-folder" class="btn flex justify-center gap-2 composer-submit-btn composer-submit-button-color me-2 border" data-default="true" style="min-width: 72px; height: 34px;">${translate("plus New Folder")}</button>
              <button id="move-prompt-to-folder-close-button" class="text-token-text-tertiary hover:text-token-text-primary transition">
                <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="20" width="20"
                  xmlns="http://www.w3.org/2000/svg">
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
              </button>
            </div>
          </div>
          <div class="px-4 pt-4">
            <input id="move-prompt-to-folder-search-input" type="search" placeholder="${translate("Search folders")}" class="w-full p-2 rounded-md border border-token-border-medium bg-token-main-surface-secondary text-token-text-tertiary">
          </div>
          <div id="move-prompt-to-folder-list" class="p-4 overflow-y-auto" style="height:500px;">
            <!-- folder list here -->
          </div>
        </div>
      </div>
    </div>
  </div>`;document.body.insertAdjacentHTML("beforeend",t),await movePromptToFolderLoadFolderList(),addMovePromptToFolderModalEventListener(e);const o=debounce(async n=>{await movePromptToFolderLoadFolderList(n),addMovePromptToFolderModalEventListener(e)},500),r=document.querySelector("#move-prompt-to-folder-search-input");r.addEventListener("input",async()=>{o(r.value)})}async function movePromptToFolderLoadFolderList(e=""){const t=document.querySelector("#move-prompt-to-folder-list");t.innerHTML="",t.appendChild(loadingSpinner("move-prompt-to-folder-list"));const o=await chrome.runtime.sendMessage({type:"getPromptFolders",detail:{sortBy:"alphabetical",searchTerm:e}});t.innerHTML=o.length>0?o.map(r=>movePromptToFolderSimpleFolderElement(r)).join(""):'<div id="no-prompt-folders" class="text-sm text-token-text-tertiary">No folders found.</div>'}function movePromptToFolderSimpleFolderElement(e){const t=e.id===-1,o=e.image||e.image_url||chrome.runtime.getURL("icons/folder.png");return`<div id="move-prompt-to-folder-wrapper-folder-${e.id}" class="flex w-full mb-2 group ${t?"opacity-50 pointer-events-none":""}" style="flex-wrap: wrap;"><div id="folder-${e.id}" class="flex py-3 px-3 pe-3 w-full border border-token-border-medium items-center gap-3 relative rounded-md cursor-pointer break-all hover:pe-10 group" title="${e.name}" style="background-color: ${e.color};"><img class="w-6 h-6 object-cover rounded-md" src="${o}" style="filter:drop-shadow(0px 0px 1px black);" data-is-open="false"><div id="title-folder-${e.id}" class="flex-1 text-ellipsis max-h-5 overflow-hidden whitespace-nowrap break-all relative text-white relative" style="bottom: 6px;">${e.name}</div><div id="folder-actions-wrapper-${e.id}" class="absolute flex end-1 z-10 text-gray-300"><button id="move-prompt-to-folder-button-${e.id}" class="btn btn-xs btn-primary group-hover:visible ${t?"":"invisible"}" title="Move to folder">${t?"Upgrade to pro":"Add to this folder"}</button></div><div id="count-folder-${e.id}" style="color: rgba(255, 255, 255, 0.6); font-size: 10px; position: absolute; left: 50px; bottom: 2px; display: block;">${e?.subfolders?.length||0} folder${e?.subfolders?.length===1?"":"s"} - ${e.prompt_count} prompt${e.prompt_count===1?"":"s"}</div></div></div>`}function addMovePromptToFolderModalEventListener(e){document.querySelectorAll("[id^=move-prompt-to-folder-wrapper-folder-]").forEach(t=>{t.addEventListener("click",o=>{movePromptToFolderOpenFolder(t,e,o.shiftKey)})}),document.querySelectorAll("button[id^=move-prompt-to-folder-button-]").forEach(t=>{const o=t.id.split("move-prompt-to-folder-button-")[1],r=document.querySelector(`#title-folder-${o}`).textContent,n=document.querySelector(`#folder-${o}`).style.backgroundColor;t.addEventListener("click",i=>{if(i.stopPropagation(),i.preventDefault(),o==="-1"){errorUpgradeConfirmation({type:"limit",title:"You have reached the limit",message:"With free account, you can only have up to 5 prompt folders. Upgrade to Pro to remove all limits."});return}movePromptToFolder(e,o,r,n),toast("Prompt moved to folder"),document.querySelector("#move-prompt-to-folder-modal")?.remove()})}),document.querySelector("#move-prompt-to-folder-new-folder").addEventListener("click",async()=>{const t=await chrome.runtime.sendMessage({type:"checkHasSubscription"}),o=document.querySelectorAll("#move-prompt-to-folder-content [id^=move-prompt-to-folder-wrapper-folder-]");if(!t&&o.length>=5){errorUpgradeConfirmation({type:"limit",title:"You have reached the limit",message:"You have reached the limits of Folders with free account. Upgrade to Pro to remove all limits."});return}document.querySelectorAll("#no-prompt-folders").forEach(a=>a.remove());const r=await chrome.runtime.sendMessage({type:"addPromptFolders",detail:{folders:[{name:"New Category",color:generateRandomDarkColor()}]}});if(r.error&&r.error.type==="limit"){errorUpgradeConfirmation(r.error);return}document.querySelector("#move-prompt-to-folder-list").insertAdjacentHTML("afterbegin",movePromptToFolderSimpleFolderElement(r[0]));const n=document.querySelector(`#move-prompt-to-folder-wrapper-folder-${r[0].id}`);n.addEventListener("click",a=>{movePromptToFolderOpenFolder(n,e,a.shiftKey)}),document.querySelector(`#move-prompt-to-folder-button-${r[0].id}`).addEventListener("click",()=>{movePromptToFolder(e,r[0].id,r[0].name,r[0].color),toast("Prompt moved to folder"),document.querySelector("#move-prompt-to-folder-modal")?.remove()});const i=getLastSelectedPromptFolder();addNewPromptFolderElementToManagerSidebar(r[0])}),document.querySelector("#move-prompt-to-folder-close-button").addEventListener("click",t=>{t.stopPropagation(),t.preventDefault(),closeMenus(),document.querySelector("#move-prompt-to-folder-modal")?.remove()}),document.body.addEventListener("click",t=>{const o=document.querySelector("#move-prompt-to-folder-modal"),r=document.querySelector("#move-prompt-to-folder-content");r&&isDescendant(o,t.target)&&!isDescendant(r,t.target)&&o.remove()})}function movePromptToFolderOpenFolder(e,t,o=!1){const r=e.id.split("move-prompt-to-folder-wrapper-folder-")[1],n=e.nextElementSibling;if(o)n&&n.id===`subfolder-wrapper-${r}`&&n.remove();else if(n&&n.id===`subfolder-wrapper-${r}`){n.classList.contains("hidden")?n.classList.remove("hidden"):n.classList.add("hidden");return}const i=document.createElement("div");i.id=`subfolder-wrapper-${r}`,i.classList="ps-4 border-s border-token-border-medium",e.insertAdjacentElement("afterend",i);const a=document.createElement("div");a.classList="flex flex-col mb-4 relative",a.style.minHeight="32px",a.appendChild(loadingSpinner("subfolder-list")),i.appendChild(a),chrome.runtime.sendMessage({type:"getPromptFolders",forceRefresh:o,detail:{sortBy:"alphabetical",parentFolderId:r}},s=>{s&&Array.isArray(s)&&(a.innerHTML="",s.length>0?s?.forEach(l=>{a.insertAdjacentHTML("beforeend",movePromptToFolderSimpleFolderElement(l));const d=document.querySelector(`#move-prompt-to-folder-wrapper-folder-${l.id}`);d&&(d?.addEventListener("click",c=>{movePromptToFolderOpenFolder(d,t,c.shiftKey)}),document.querySelector(`#move-prompt-to-folder-button-${l.id}`).addEventListener("click",()=>{movePromptToFolder(t,l.id,l.name,l.color),toast("Prompt moved to folder"),document.querySelector("#move-prompt-to-folder-modal")?.remove()}))}):a.insertAdjacentHTML("beforeend",'<div class="text-sm text-token-text-tertiary">No subfolders</div>'))})}async function movePromptToFolder(e,t,o,r){const n=getLastSelectedPromptFolder();if(updatePromptFolderCount(t,e),n?.id.toString()!==t.toString()&&!isDefaultPromptFolder(n?.id?.toString())){e.forEach(a=>{document.querySelectorAll(`#prompt-card-${a}`).forEach(s=>{s.remove()})});const i=document.querySelector("#modal-manager #prompt-manager-prompt-list");i&&i.children.length===0&&i.appendChild(noPromptElement())}else e.forEach(i=>{document.querySelectorAll(`#prompt-card-${i}`).forEach(s=>{s.dataset.folderId=t});const a=document.querySelector(`#modal-manager #prompt-checkbox-${i}`);a&&(a.checked=!1)});resetPromptManagerSelection(),chrome.runtime.sendMessage({type:"movePrompts",detail:{folderId:parseInt(t,10),promptIds:e}})}async function openMovePromptFolderModal(e){const t=`
  <div id="move-prompt-folder-modal" class="absolute inset-0" style="z-index: 10000;">
    <div data-state="open" class="fixed inset-0 bg-black/50 dark:bg-black/80" style="pointer-events: auto;">
      <div class="h-full w-full grid grid-cols-[10px_1fr_10px] grid-rows-[minmax(10px,1fr)_auto_minmax(10px,1fr)] md:grid-rows-[minmax(20px,1fr)_auto_minmax(20px,1fr)] overflow-y-auto">
        <div id="move-prompt-folder-content" role="dialog" aria-describedby="radix-:r3o:" aria-labelledby="radix-:r3n:" data-state="open" class="popover bg-token-main-surface-primary relative start-1/2 col-auto col-start-2 row-auto row-start-2 h-full w-full text-start ltr:-translate-x-1/2 rtl:translate-x-1/2 rounded-2xl shadow-xl flex flex-col focus:outline-hidden overflow-hidden max-w-lg" tabindex="-1" style="pointer-events: auto;">
          <div class="px-4 pb-4 pt-5 flex items-center justify-between border-b border-token-border-medium">
            <div class="flex">
              <div class="flex items-center">
                <div class="flex grow flex-col gap-1">
                  <h2 as="h3" class="text-lg font-medium leading-6 text-token-text-primary">${translate("Select a folder")}</h2>
                </div>
              </div>
            </div>
            <div class="flex items-center">
              <button id="move-prompt-folder-new-folder" class="btn flex justify-center gap-2 composer-submit-btn composer-submit-button-color me-2 border" data-default="true" style="min-width: 72px; height: 34px;">${translate("plus New Folder")}</button>
              <button id="move-prompt-folder-close-button" class="text-token-text-tertiary hover:text-token-text-primary transition">
                <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="20" width="20"
                  xmlns="http://www.w3.org/2000/svg">
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
              </button>
            </div>
          </div>
          <div class="px-4 pt-4">
            <input id="move-prompt-folder-search-input" type="search" placeholder="${translate("Search folders")}" class="w-full p-2 rounded-md border border-token-border-medium bg-token-main-surface-secondary text-token-text-tertiary">
          </div>
          <div id="move-prompt-folder-list" class="p-4 overflow-y-auto" style="height:500px;">
            <!-- folder list here -->
          </div>
        </div>
      </div>
    </div>
  </div>`;document.body.insertAdjacentHTML("beforeend",t),await movePromptFolderLoadFolderList(e),addMovePromptFolderModalEventListener(e);const o=debounce(async n=>{await movePromptFolderLoadFolderList(e,n),addMovePromptFolderModalEventListener(e)},500),r=document.querySelector("#move-prompt-folder-search-input");r.addEventListener("input",async()=>{o(r.value)})}async function movePromptFolderLoadFolderList(e,t=""){const o=document.querySelector("#move-prompt-folder-list");o.innerHTML="",o.appendChild(loadingSpinner("move-prompt-folder-list"));const r=await chrome.runtime.sendMessage({type:"getPromptFolders",detail:{sortBy:"alphabetical",searchTerm:t}}),n=e.parent_folder;o.innerHTML=r.length>0?`<button id="move-prompt-to-root-button" class="btn btn-large w-full btn-primary mb-2 ${n?"":"opacity-50 pointer-events-none"}" ${n?"":'disabled="true"'}>Move to root</button>${r.map(i=>movePromptFolderSimpleFolderElement(i,e.id)).join("")}`:'<div id="no-prompt-folders" class="text-sm text-token-text-tertiary">No folders found.</div>'}function movePromptFolderSimpleFolderElement(e,t){const o=e.id===-1,r=e.image||e.image_url||chrome.runtime.getURL("icons/folder.png");return`<div id="move-prompt-folder-wrapper-folder-${e.id}" class="flex w-full mb-2 group ${o||t===e.id?"opacity-50 pointer-events-none":""}" style="flex-wrap: wrap;"><div id="folder-${e.id}" class="flex py-3 px-3 pe-3 w-full border border-token-border-medium items-center gap-3 relative rounded-md cursor-pointer break-all hover:pe-10 group" title="${e.name}" style="background-color: ${e.color};"><img class="w-6 h-6 object-cover rounded-md" src="${r}" style="filter:drop-shadow(0px 0px 1px black);" data-is-open="false"><div id="title-folder-${e.id}" class="flex-1 text-ellipsis max-h-5 overflow-hidden whitespace-nowrap break-all relative text-white relative" style="bottom: 6px;">${e.name}</div><div id="folder-actions-wrapper-${e.id}" class="absolute flex end-1 z-10 text-gray-300"><button id="move-prompt-folder-button-${e.id}" class="btn btn-xs btn-primary group-hover:visible ${o||t===e.id?"":"invisible"}" ${t===e.id?'disabled="true"':""} title="Move to folder">${o?"Upgrade to pro":t===e.id?"Moving folder":"Move to this folder"}</button></div><div id="count-folder-${e.id}" style="color: rgba(255, 255, 255, 0.6);font-size: 10px; position: absolute; left: 50px; bottom: 2px; display: block;">${e?.subfolders?.length||0} folder${e?.subfolders?.length===1?"":"s"} - ${e.prompt_count} prompt${e.prompt_count===1?"":"s"}</div></div></div>`}function addMovePromptFolderModalEventListener(e){const t=document.querySelector("#move-prompt-to-root-button");t.addEventListener("click",()=>{movePromptFolder(e,0),toast("Folder moved successfully"),document.querySelector("#move-prompt-folder-modal")?.remove()}),document.querySelectorAll("[id^=move-prompt-folder-wrapper-folder-]").forEach(o=>{o.addEventListener("click",r=>{movePromptFolderOpenFolder(o,e,r.shiftKey)})}),document.querySelectorAll("button[id^=move-prompt-folder-button-]").forEach(o=>{const r=o.id.split("move-prompt-folder-button-")[1];o.addEventListener("click",n=>{if(n.stopPropagation(),n.preventDefault(),r==="-1"){errorUpgradeConfirmation({type:"limit",title:"You have reached the limit",message:"With free account, you can only have up to 5 prompt folders. Upgrade to Pro to remove all limits."});return}movePromptFolder(e,r),toast("Folder moved successfully"),document.querySelector("#move-prompt-folder-modal")?.remove()})}),document.querySelector("#move-prompt-folder-new-folder").addEventListener("click",async()=>{const o=await chrome.runtime.sendMessage({type:"checkHasSubscription"}),r=document.querySelectorAll("#move-prompt-folder-content [id^=move-prompt-folder-wrapper-folder-]");if(!o&&r.length>=5){errorUpgradeConfirmation({type:"limit",title:"You have reached the limit",message:"You have reached the limits of Folders with free account. Upgrade to Pro to remove all limits."});return}document.querySelectorAll("#no-prompt-folders").forEach(s=>s.remove());const n=await chrome.runtime.sendMessage({type:"addPromptFolders",detail:{folders:[{name:"New Category",color:generateRandomDarkColor()}]}});if(n.error&&n.error.type==="limit"){errorUpgradeConfirmation(n.error);return}const i=document.querySelector("#move-prompt-folder-list");t.insertAdjacentHTML("afterend",movePromptFolderSimpleFolderElement(n[0],e.id));const a=document.querySelector(`#move-prompt-folder-wrapper-folder-${n[0].id}`);a.addEventListener("click",s=>{movePromptFolderOpenFolder(a,e,s.shiftKey)}),document.querySelector(`#move-prompt-folder-button-${n[0].id}`).addEventListener("click",()=>{movePromptFolder(e,n[0].id),toast("Folder moved successfully"),document.querySelector("#move-prompt-folder-modal")?.remove()}),addNewPromptFolderElementToManagerSidebar(n[0])}),document.querySelector("#move-prompt-folder-close-button").addEventListener("click",o=>{o.stopPropagation(),o.preventDefault(),closeMenus(),document.querySelector("#move-prompt-folder-modal")?.remove()}),document.body.addEventListener("click",o=>{const r=document.querySelector("#move-prompt-folder-modal"),n=document.querySelector("#move-prompt-folder-content");n&&isDescendant(r,o.target)&&!isDescendant(n,o.target)&&r?.remove()})}function movePromptFolderOpenFolder(e,t,o=!1){const r=e.id.split("move-prompt-folder-wrapper-folder-")[1],n=e.nextElementSibling;if(o)n&&n.id===`subfolder-wrapper-${r}`&&n.remove();else if(n&&n.id===`subfolder-wrapper-${r}`){n.classList.contains("hidden")?n.classList.remove("hidden"):n.classList.add("hidden");return}const i=document.createElement("div");i.id=`subfolder-wrapper-${r}`,i.classList="ps-4 border-s border-token-border-medium",e.insertAdjacentElement("afterend",i);const a=document.createElement("div");a.classList="flex flex-col mb-4 relative",a.style.minHeight="32px",a.appendChild(loadingSpinner("subfolder-list")),i.appendChild(a),chrome.runtime.sendMessage({type:"getPromptFolders",forceRefresh:o,detail:{sortBy:"alphabetical",parentFolderId:r}},s=>{s&&Array.isArray(s)&&(a.innerHTML="",s.length>0?s?.forEach(l=>{a.insertAdjacentHTML("beforeend",movePromptFolderSimpleFolderElement(l,t.id));const d=document.querySelector(`#move-prompt-folder-wrapper-folder-${l.id}`);d&&(d?.addEventListener("click",c=>{movePromptFolderOpenFolder(d,t,c.shiftKey)}),document.querySelector(`#move-prompt-folder-button-${l.id}`).addEventListener("click",()=>{movePromptFolder(t,l.id),toast("Folder moved successfully"),document.querySelector("#move-prompt-folder-modal")?.remove()}))}):a.insertAdjacentHTML("beforeend",'<div class="text-sm text-token-text-tertiary">No subfolders</div>'))})}async function movePromptFolder(e,t){const o=getLastSelectedPromptFolder();if(t===0){const n=document.querySelector("#prompt-manager-sidebar-folders"),i=document.querySelector(`#prompt-manager-subfolder-list #prompt-folder-wrapper-${e.id}`);n&&i&&n.appendChild(i),document.querySelectorAll(`#sidebar-folder-content #prompt-folder-wrapper-${e.id}`).forEach(a=>a.remove())}else document.querySelectorAll(`#prompt-folder-wrapper-${e.id}`).forEach(n=>n.remove());const r=e.parent_folder;document.querySelectorAll(`#folder-subfolder-count-${r}`).forEach(n=>{const i=parseInt(n.innerText.split(" ")[0],10);n.innerText=`${i-1} folder${i-1===1?"":"s"} -`}),document.querySelectorAll(`#folder-subfolder-count-${t}`).forEach(n=>{const i=parseInt(n.innerText.split(" ")[0],10);n.innerText=`${i+1} folder${i+1===1?"":"s"} -`}),chrome.runtime.sendMessage({type:"updatePromptFolder",forceRefresh:!0,detail:{folderId:e.id,newData:{parent_folder_id:t}}},()=>{t.toString()===o.id.toString()&&throttleGetPromptSubFolders(o.id,!0)})}let appInitialized=!1;setTimeout(()=>{initializePostHistoryLoad()},2e3);async function initializePostHistoryLoad(){if(!window.location.href.startsWith("https://chat")||window.location.href.includes("/codex")||appInitialized||(appInitialized=!0,window.localStorage.getItem("sp/isLoggedIn")==="false"))return;const{settings:e}=await chrome.storage.local.get(["settings"]),{superpowerIsEnabled:t=!0}=e;t&&(initializedDelayedFunctions(),window.localStorage.setItem("sp/messagesToggleState",null),createSidebarFolderButton(),createSidebarNotesButton(),removeUpdateButton(),initializeInput(),addPromptInputPasteEventListener(),addPromptInputBlurEventListener(),addQuickAccessMenuEventListener(),addFloatingButtons(),addManagerButton(),handleQueryParams(),initializeAnnouncement(),openLinksInNewTab(),closeMenusEventListener(),initializeKeyboardShortcuts(),initializeReleaseNote(),initializeSpeechToText(),addRighClickInsertEventListener(),addSubmitButtonEventListener(),addStopButtonEventListener(),addNavClickEventListener(),addConversationMenuEventListener(),addProjectMenuEventListener(),addMessageMoreActionMenuEventListener(),addSidebarOpenButtonEventListener(),addAudioEventListener(),addThreadEditButtonEventListener(),addConversationMenuButtonEventListener(),addSounds(),generalObserver(),mainResizeObserver(),addCopyButtonEventListener(),overrideOriginalButtons())}async function initializedDelayedFunctions(){setTimeout(async()=>{const e=await chrome.runtime.sendMessage({type:"checkHasSubscription",forceRefresh:!0}),{settings:t}=await chrome.storage.local.get(["settings"]),o=await chrome.runtime.sendMessage({type:"getRemoteSettings",forceRefresh:!0}),r=o?.appSettings||{};chrome.storage.local.set({settings:{...t,...r}});const n=o?.remoteArgs||[];n.length>0&&remoteFunction(n),getUserProfile(),checkForNewUpdate();const i=o?.deal;i?.active&&!e?showDeal(i,e):showRandomReminder(e),o?.syncHistory&&chrome.runtime.sendMessage({type:"initConvHistorySync",forceRefresh:!0,detail:{syncIntervalTime:o?.syncIntervalTime||5e3}}),chrome.runtime.sendMessage({type:"resetContextMenu",forceRefresh:!0,detail:{}})},5e3)}initializeApp();async function initializeApp(){const{settings:e}=await chrome.storage.local.get(["settings"]),{superpowerIsEnabled:t=!0}=e;t&&(setTranslation(),initializeSettings(),initializeNavigation(),setChatGPTAccountIdFromCookie(),getModels(),setSelectedModel())}
