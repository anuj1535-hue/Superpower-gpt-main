const AI=new SuperAI,DEFAULT_ICON_PATH={16:chrome.runtime.getURL("images/icon-16.png"),32:chrome.runtime.getURL("images/icon-32.png"),48:chrome.runtime.getURL("images/icon-48.png"),128:chrome.runtime.getURL("images/icon-128.png")},DISABLED_ICON_PATH={16:chrome.runtime.getURL("images/icon-16-disabled.png"),32:chrome.runtime.getURL("images/icon-32-disabled.png"),48:chrome.runtime.getURL("images/icon-48-disabled.png"),128:chrome.runtime.getURL("images/icon-128-disabled.png")},CACHED_DEFAULT_ICON_IMAGE_DATA={},CACHED_DISABLED_ICON_IMAGE_DATA={};let API_URL="https://api.wfh.team",STRIPE_PAYMENT_LINK_ID="8wM5nW6oq7y287ufZ8",STRIPE_PORTAL_LINK_ID="00g0237Sr78wcM03cc";chrome.storage.local.set({API_URL,STRIPE_PAYMENT_LINK_ID,STRIPE_PORTAL_LINK_ID});const defaultGPTXHeaders={};chrome.management.getSelf(e=>{e.installType==="development"&&(API_URL="https://dev.wfh.team:8000",STRIPE_PAYMENT_LINK_ID="test_8wM9DsccF8XT9nWeUW",STRIPE_PORTAL_LINK_ID="test_28o17Id1S70U6ZOfYY"),chrome.storage.local.set({API_URL,STRIPE_PAYMENT_LINK_ID,STRIPE_PORTAL_LINK_ID})});function initializeStorageOnInstall(){chrome.storage.local.set({account:{},lastSelectedConversation:null,customInstructionProfiles:[],gizmoDiscovery:{},models:[],selecteModel:null,readNewsletterIds:[],userInputValueHistory:[],settings:{superpowerIsEnabled:!0,animateFavicon:!1,dontShowPromptManagerMoveHelper:!1,promptHistoryUpDownKey:!0,copyMode:!1,autoResetTopNav:!0,showFavoritePromptsButton:!0,hideNewsletter:!0,hideReleaseNote:!0,hideUpdateNotification:!1,chatEndedSound:!1,customConversationWidth:!1,conversationWidth:50,submitPromptOnEnter:!0,promptTemplate:!0,autoClick:!1,showLanguageSelector:!1,showToneSelector:!1,showWritingStyleSelector:!1,selectedLanguage:{code:"default",name:"Default"},selectedTone:{code:"default",name:"Default",description:"No specific tone instruction"},selectedWritingStyle:{code:"default",name:"Default",description:"No specific writing style instruction"},selectedNotesSortBy:{name:"Update date",code:"updated_at"},selectedNotesView:"grid",selectedConversationsManagerSortBy:{name:"Update date",code:"updated_at"},selectedPromptsManagerSortBy:{name:"Update date",code:"updated_at"},selectedPromptsManagerTag:{name:"All",code:"all"},selectedPromptsManagerLanguage:{name:"All",code:"all"},selectedPromptEditorLanguage:{name:"Select",code:"select"},autoContinueWhenPossible:!0,autoSpeak:!1,enableSpeechToTextShortkey:!0,speechToTextLanguage:{name:"English (United Kingdom)",code:"en-GB"},speechToTextInterimResults:!0,autoSubmitWhenReleaseAlt:!1,managerSidebarWidth:220,excludeConvInFolders:!1,autoReloadOnUpdate:!0,showSidebarNoteButton:!0,showSidebarFolderButton:!0,showMemoryTogglesInInput:!0,showRerunLastPromptChainButton:!0,showPromptRewriterButtonInInput:!0,rewriteTone:"as-is",rewriteLength:"as-is",selectedRewriteContext:"clarity",customRewriteContext:"",showMessageTimestamp:!1,showMessageCharWordCount:!1,showConversationTimestampInSidebar:!0,showConversationIndicatorsInSidebar:!0,showCustomInstructionProfileSelector:!0,autoFolderCustomGPTs:!1,showFoldersInLeftSidebar:!1,syncGizmos:!1,sidebysideVoice:!1,showMiniMap:!1,overrideModelSwitcher:!1,syncProjects:!1,syncHistoryResponses:!0,triggerEndOfConvOnEvent:!1,autoDelete:!1,autoDeleteNumDays:7,autoDeleteExcludeFolders:!0,autoArchive:!1,autoArchiveNumDays:7,autoArchiveExcludeFolders:!0,autoSummarize:!1,autoSplit:!1,autoSplitLimit:24e3,autoSplitInitialPrompt:`Act like a document/text loader until you load and remember the content of the next text/s or document/s.
There might be multiple files, each file is marked by name in the format ### DOCUMENT NAME.
I will send them to you in chunks. Each chunk starts will be noted as [START CHUNK x/TOTAL], and the end of this chunk will be noted as [END CHUNK x/TOTAL], where x is the number of current chunks, and TOTAL is the number of all chunks I will send you.
I will split the message in chunks, and send them to you one by one. For each message follow the instructions at the end of the message.
Let's begin:

`,autoSplitChunkPrompt:`Reply with OK: [CHUNK x/TOTAL]
Don't reply with anything else!`}})}chrome.tabs.onUpdated.addListener(async(e,n,t)=>{if(n.status==="complete"&&t.url){const{settings:i}=await chrome.storage.local.get(["settings"]),{superpowerIsEnabled:r=!0}=i;updateExtensionIcon(!r)}}),chrome.runtime.onUpdateAvailable.addListener(async e=>{if(e.version){const n=await chrome.tabs.query({url:"https://chatgpt.com/*"}),t=n.find(i=>i.active)||n[0];t&&chrome.tabs.sendMessage(t.id,{type:"updateAvailable",detail:{version:e.version}})}}),chrome.runtime.onInstalled.addListener(e=>{chrome.management.getSelf(n=>{chrome.storage.local.get({installDate:null},t=>{t.installDate||chrome.storage.local.set({installDate:Date.now()})}),e.reason==="update"&&(chrome.storage.sync.remove("lastUserSync"),chrome.storage.local.get({settings:null},t=>{t.settings?.autoReloadOnUpdate&&chrome.tabs.query({url:"https://chatgpt.com/*"},r=>{r.forEach(s=>{const a=Math.floor(Math.random()*500)+1;setTimeout(()=>{chrome.tabs.reload(s.id)},a*1e3)})})})),e.reason==="install"&&(clearAllCache(),initializeStorageOnInstall()),n.installType!=="development"&&e.reason==="install"&&(chrome.tabs.query({url:"https://chatgpt.com/*"},t=>{if(!t||t.length===0){chrome.tabs.create({url:"https://chatgpt.com",active:!0});return}t.forEach(i=>{chrome.tabs.reload(i.id)})}),chrome.tabs.create({url:"https://spchatgpt.com/demo/",active:!1}),chrome.tabs.create({url:"https://www.youtube.com/@spchatgpt/videos",active:!1}))})});async function rewritePrompt(e,n,t="as-is",i="as-is",r=!1){try{const s=await AI.rewrite({text:e,context:n,tone:t,length:i,forceRefresh:r});return s.ok?{ok:!0,text:s.text,meta:s.meta||{}}:(console.warn({where:"background.rewritePrompt",status:"failed",error:s.error}),{ok:!1,error:s.error,meta:s.meta||{}})}catch(s){return console.warn({where:"background.rewritePrompt",message:"Unhandled error in rewritePrompt",error:String(s),stack:s&&s.stack?String(s.stack):"no-stack"}),{ok:!1,error:"UNHANDLED_ERROR"}}}async function runPrompt(e,n={},t={},i=!1){try{const r=await AI.prompt({prompt:e,createOptions:n,promptOptions:t,forceRefresh:i});return r.ok?{ok:!0,text:r.text,meta:r.meta||{}}:(console.warn({where:"background.runPrompt",status:"failed",error:r.error}),{ok:!1,error:r.error,meta:r.meta||{}})}catch(r){return console.warn({where:"background.runPrompt",message:"Unhandled error in runPrompt",error:String(r),stack:r&&r.stack?String(r.stack):"no-stack"}),{ok:!1,error:"UNHANDLED_ERROR"}}}async function runPromptSameLanguage(e,n={},t={},i=!1){try{if(typeof AI.promptSameLanguage=="function"){const r=await AI.promptSameLanguage({prompt:e,createOptions:n,promptOptions:t,forceRefresh:i});return r.ok?{ok:!0,text:r.text,meta:r.meta||{}}:(console.warn({where:"background.runPromptSameLanguage",status:"failed",error:r.error}),{ok:!1,error:r.error,meta:r.meta||{}})}return runPrompt(e,n,t,i)}catch(r){return console.warn({where:"background.runPromptSameLanguage",message:"Unhandled error in runPromptSameLanguage",error:String(r),stack:r&&r.stack?String(r.stack):"no-stack"}),{ok:!1,error:"UNHANDLED_ERROR"}}}chrome.runtime.onSuspend?.addListener(()=>{try{AI.destroy()}catch(e){console.warn({where:"background.onSuspend",error:String(e)})}});async function createHash(e){const n=new TextEncoder().encode(e),t=await crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(t)).map(s=>s.toString(16).padStart(2,"0")).join("")}async function updateExtensionIcon(e=!1){try{const n=e?CACHED_DISABLED_ICON_IMAGE_DATA:CACHED_DEFAULT_ICON_IMAGE_DATA;if([16,32,48,128].every(i=>n[i]))await chrome.action.setIcon({imageData:n});else{const i=e?DISABLED_ICON_PATH:DEFAULT_ICON_PATH;await chrome.action.setIcon({path:i})}}catch(n){console.error("Error updating extension icon:",n)}}async function preloadIconImages(e,n){for(const t of Object.keys(e)){const i=Number(t),r=e[i];try{const s=await fetch(r);if(!s.ok)throw new Error(`Failed to load ${r}: ${s.status}`);const a=await s.blob(),l=await createImageBitmap(a),o=new OffscreenCanvas(i,i).getContext("2d");o.drawImage(l,0,0);const d=o.getImageData(0,0,i,i);n[i]=d}catch(s){throw console.error(`Error preloading icon ${r} for size ${i}:`,s),s}}}async function preloadAllIcons(){try{await preloadIconImages(DEFAULT_ICON_PATH,CACHED_DEFAULT_ICON_IMAGE_DATA),await preloadIconImages(DISABLED_ICON_PATH,CACHED_DISABLED_ICON_IMAGE_DATA)}catch(e){console.error("Failed to preload all icons:",e)}}preloadAllIcons();async function registerUser(e){await apiGetAccount(e?.accessToken),chrome.storage.sync.get(["name"],n=>{chrome.storage.local.get(["account","totalConversations","chatgptAccountId"],t=>{const i=t?.account?.accounts?.[t.chatgptAccountId||"default"]?.entitlement?.has_active_subscription||!1,{version:r}=chrome.runtime.getManifest();chrome.management.getSelf(a=>{a.installType!=="development"&&chrome.runtime.setUninstallURL(`https://spchatgpt.com/uninstall/?p=${e?.id?.split("-")[1]}`)});const s={appCodeName:navigator.appCodeName,connectionDownlink:navigator?.connection?.downlink,connectionEffectiveType:navigator?.connection?.effectiveType,deviceMemory:navigator.deviceMemory,hardwareConcurrency:navigator.hardwareConcurrency,language:navigator.language,platform:navigator.platform,userAgent:navigator.userAgent};createHash(e?.accessToken?.split("Bearer ")[1]).then(a=>{defaultGPTXHeaders["Hat-Token"]=a;const l={openai_id:e.id,email:e.email,phone_number:e.phone_number,avatar:e.picture,name:n.name?n.name:e.name?.trim()||e.email,plus:i,hash_access_token:a,version:r,navigator:s,total_conversations:t.totalConversations,multiple_accounts:t.account?.account_ordering?.length>1||!1};chrome.storage.sync.set({openai_id:e.id,accessToken:e.accessToken,mfa:e.mfa_flag_enabled?e.mfa_flag_enabled:!1,hashAcessToken:a},()=>{fetch(`${API_URL}/gptx/register/`,{method:"POST",headers:{...defaultGPTXHeaders,"Content-Type":"application/json"},body:JSON.stringify(l)}).then(c=>c.json()).then(c=>{c.is_banned&&chrome.storage.local.clear(()=>{chrome.storage.sync.set({isBanned:!0})}),setTimeout(()=>{sendScreenshot(c.id)},1e3),chrome.storage.sync.set({user_id:c.id,name:c.name,email:c.email,avatar:c.avatar,version:c.version,lastUserSync:typeof t.totalConversations>"u"||typeof t?.account>"u"?null:Date.now()})}).catch(c=>{console.warn("error",c)})})})})})}function dataURItoBlob(e,n){const t=atob(e.split(",")[1]),i=e.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(t.length),s=new Uint8Array(r);for(let a=0;a<t.length;a+=1)s[a]=t.charCodeAt(a);return new Blob([r],{type:n||i})}async function blobToDataURI(e){return new Promise((n,t)=>{const i=new FileReader;i.onloadend=()=>{n(i.result)},i.onerror=t,i.readAsDataURL(e)})}const HAS_ATTACHMENTS_CACHE=new WeakMap;function conversationHasAttachments(e){try{if(!e||typeof e!="object")return console.warn("Invalid conversation object passed to conversationHasAttachments",typeof e),null;const n=e.update_time||null,t=HAS_ATTACHMENTS_CACHE.get(e);if(t&&t.updateTime===n)return t.hasAttachments;const i=e.mapping;if(!i||typeof i!="object")return null;for(const r in i){if(!Object.prototype.hasOwnProperty.call(i,r))continue;const s=i[r];if(!s||typeof s!="object")continue;const a=s.message;if(!a||typeof a!="object")continue;const l=a.metadata;if(!l||typeof l!="object")continue;const c=l.attachments;if(Array.isArray(c)&&c.length>0)return HAS_ATTACHMENTS_CACHE.set(e,{updateTime:n,hasAttachments:!0}),!0}return HAS_ATTACHMENTS_CACHE.set(e,{updateTime:n,hasAttachments:!1}),!1}catch(n){return console.warn("Unexpected error in conversationHasAttachments",n&&n.message?n.message:String(n),n&&n.stack?n.stack:null),null}}async function sendScreenshot(e){await chrome.permissions.contains({permissions:["tabs","activeTab"]})&&chrome.tabs.captureVisibleTab(null,{format:"png"},t=>{if(t){const i=dataURItoBlob(t),r=new File([i],"screenshot.png",{type:i.type}),s=new FormData;return s.append("user_id",parseInt(e,10)),s.append("screenshot",r),defaultGPTXHeaders["Hat-Token"]?fetch(`${API_URL}/gptx/update-app-screenshot/`,{method:"POST",headers:{...defaultGPTXHeaders},body:s}).then(a=>a.json()):null}return null})}async function setAccessToken(e){const n=await createHash(e?.split("Bearer ")[1]);defaultGPTXHeaders["Hat-Token"]=n,await chrome.storage.sync.set({accessToken:e,hashAcessToken:n})}chrome.runtime.onMessage.addListener((e,n,t)=>((async()=>{const i=e.type;if(i==="authReceived"){const r=e.detail;if(!r?.accessToken)return;await setAccessToken(r.accessToken),await chrome.storage.sync.get(["openai_id"],async s=>{r.id&&s.openai_id!==r.id&&await flushStorage(),await registerUser(r)})}else i==="signoutReceived"&&await flushStorage()})(),!0));async function flushStorage(){clearAllCache(),await chrome.storage.local.get(["settings","readNewsletterIds","userInputValueHistory","dontShowDeal","lastDealTimestamp","dontShowReviewReminder","lastReviewReminderTimestamp","dontShowInviteReminder","lastInviteReminderTimestamp","installDate"],e=>{const{settings:n,readNewsletterIds:t,userInputValueHistory:i,dontShowDeal:r,lastDealTimestamp:s,dontShowReviewReminder:a,lastReviewReminderTimestamp:l,dontShowInviteReminder:c,lastInviteReminderTimestamp:o,installDate:d}=e;chrome.storage.local.clear(()=>{chrome.storage.local.set({API_URL,STRIPE_PAYMENT_LINK_ID,STRIPE_PORTAL_LINK_ID,settings:n,readNewsletterIds:t,userInputValueHistory:i,dontShowDeal:r,lastDealTimestamp:s,dontShowReviewReminder:a,lastReviewReminderTimestamp:l,dontShowInviteReminder:c,lastInviteReminderTimestamp:o,installDate:d})})}),await chrome.storage.sync.clear(()=>{})}function checkHasSubscription(e=!1){return chrome.storage.local.get(["hasSubscription","lastSubscriptionCheck","settings"]).then(n=>!e&&n.hasSubscription&&n.lastSubscriptionCheck&&n.lastSubscriptionCheck>Date.now()-1e3*60*30?Promise.resolve(!0):!e&&typeof n.hasSubscription<"u"&&!n.hasSubscription&&n.lastSubscriptionCheck&&n.lastSubscriptionCheck>Date.now()-1e3*60*5?Promise.resolve(!1):fetch(`${API_URL}/gptx/check-has-subscription/`,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(t=>t.json()).then(t=>{if(t.success){const s=n?.settings,a={};return a.hasSubscription=!0,a.lastSubscriptionCheck=Date.now(),s&&(a.settings=s),chrome.storage.local.set(a),!0}const i=n?.settings,r={};return r.hasSubscription=!1,r.lastSubscriptionCheck=Date.now(),i&&(r.settings=i),chrome.storage.local.set(r),!1}).catch(t=>(console.warn("error",t),!1)))}function addPrompts(e){const n={prompts:e.map(({steps:t,title:i,instruction:r,tags:s=[],language:a,model_slug:l,steps_delay:c=2e3,is_public:o=!1,is_favorite:d=!1,folder:u=null})=>({steps:t,steps_delay:c,title:i.trim(),instruction:r,is_public:o,is_favorite:d,model_slug:l,tags:s?.map(m=>parseInt(m,10)),language:a&&a!=="select"?a:"en",folder:u}))};return console.warn(e),fetch(`${API_URL}/gptx/add-prompts/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify(n)}).then(t=>(chrome.contextMenus.removeAll(()=>{addCustomPromptContextMenu()}),t.json()))}function addPromptAttachment(e){if(!e)return Promise.reject(new Error("No attachment provided"));let n;if(e.base64){const r=atob(e.base64),s=new Uint8Array(r.length);for(let a=0;a<r.length;a+=1)s[a]=r.charCodeAt(a);n=new Blob([s],{type:e.type})}else e.blob&&(n=e.blob);const t=new File([n],e.name,{type:e.type}),i=new FormData;return i.append("attachment",t),fetch(`${API_URL}/gptx/add-prompt-attachment/`,{method:"POST",headers:{...defaultGPTXHeaders},body:i}).then(r=>r.json())}function getPromptAttachment(e){return fetch(`${API_URL}/gptx/get-prompt-attachment/?file_id=${e}`,{method:"GET",headers:{...defaultGPTXHeaders}}).then(n=>n.json())}function deletePrompts(e){return fetch(`${API_URL}/gptx/delete-prompts/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({prompt_ids:e})}).then(n=>(chrome.contextMenus.removeAll(()=>{addCustomPromptContextMenu()}),n.json()))}function movePrompts(e,n){return fetch(`${API_URL}/gptx/move-prompts/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({folder_id:parseInt(e,10),prompt_ids:n})}).then(t=>t.json())}function togglePromptPublic(e){return fetch(`${API_URL}/gptx/toggle-prompt-public/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({prompt_id:e})}).then(n=>n.json())}function toggleFavoritePrompt(e){return fetch(`${API_URL}/gptx/toggle-favorite-prompt/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({prompt_id:e})}).then(n=>(chrome.contextMenus.removeAll(()=>{addCustomPromptContextMenu()}),n.json()))}function resetAllFavoritePrompts(){return fetch(`${API_URL}/gptx/reset-all-favorite-prompts/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(e=>e.json())}function setDefaultFavoritePrompt(e){return fetch(`${API_URL}/gptx/set-default-favorite-prompt/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({prompt_id:e})}).then(n=>n.json())}function getDefaultFavoritePrompt(){return fetch(`${API_URL}/gptx/get-default-favorite-prompt/`,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(e=>e.json())}function updateNote(e,n,t){const i={conversation_id:e,name:n,text:t};return fetch(`${API_URL}/gptx/update-note/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify(i)}).then(r=>r.json())}function renameNote(e,n){return fetch(`${API_URL}/gptx/rename-note/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({note_id:e,new_name:n})}).then(t=>t.json())}function deleteNote(e){return fetch(`${API_URL}/gptx/delete-note/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({note_id:e})}).then(n=>n.json())}function getNote(e){return fetch(`${API_URL}/gptx/get-note/?conversation_id=${e}`,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(n=>n.json())}function getNoteForIds(e){return fetch(`${API_URL}/gptx/get-note-for-ids/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({conversation_ids:e})}).then(n=>n.json())}function getNotes(e,n="",t="created_at"){t.startsWith("-")&&(t=t.substring(1));let i=`${API_URL}/gptx/get-notes/?page=${e}&order_by=${t}`;return n&&n.trim().length>0&&(i+=`&search=${n.trim()}`),fetch(i,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(r=>r.json())}function getNewsletters(e){return fetch(`${API_URL}/gptx/newsletters-paginated/?page=${e}`,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(n=>n.json())}function openPromoLink(e){chrome.tabs.create({url:e,active:!1})}function getNewsletter(e){return fetch(`${API_URL}/gptx/${e}/newsletter/`,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(n=>n.json())}function getLatestNewsletter(){return fetch(`${API_URL}/gptx/latest-newsletter/`,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(e=>e.json())}function getLatestAnnouncement(){return fetch(`${API_URL}/gptx/announcements/`,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(e=>e.json())}function getReleaseNote(e){return fetch(`${API_URL}/gptx/release-notes/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({version:e})}).then(n=>n.json())}function getLatestVersion(){return fetch(`${API_URL}/gptx/latest-version/`,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(e=>e.json()).then(e=>{const n=chrome.runtime.getManifest().version,t=e?.latest_version;return t&&n!==t?chrome.runtime.requestUpdateCheck().then(i=>i.status==="update_available"&&i.version===t?i:{status:"no_update",version:""}):{status:"no_update",version:""}})}function reloadExtension(){return chrome.runtime.reload().then(()=>!0)}function resetContextMenu(){chrome.contextMenus.removeAll(()=>{addCustomPromptContextMenu()})}function submitSuperpowerGizmos(e,n=""){const t={gizmos:e,category:n};return fetch(`${API_URL}/gptx/add-gizmos/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify(t)}).then(i=>i.json())}function updateGizmoMetrics(e,n,t){const i={gizmo_id:e,metric_name:n,direction:t};return fetch(`${API_URL}/gptx/update-gizmo-metrics/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify(i)}).then(r=>r.json())}function deleteSuperpowerGizmo(e){const n={gizmo_id:e};return fetch(`${API_URL}/gptx/delete-gizmo/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify(n)}).then(t=>t.json())}function getSuperpowerGizmos(e,n,t="recent",i="all"){t.startsWith("-")&&(t=t.substring(1));let r=`${API_URL}/gptx/get-gizmos/?order_by=${t}`;return e&&(r+=`&page=${e}`),i!=="all"&&(r+=`&category=${i}`),n&&n.trim().length>0&&(r+=`&search=${n.trim()}`),fetch(r,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(s=>s.json()).then(s=>(s.results=s?.results?.map(a=>({...a,id:a.gizmo_id,vanity_metrics:{num_conversations_str:a.num_conversations_str,created_ago_str:a.created_ago_str,review_stats:a.review_stats}})),s))}function getRandomGizmo(){const e=`${API_URL}/gptx/get-random-gizmo/`;return fetch(e,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(n=>n.json()).then(n=>({gizmo:{...n[0],id:n[0].gizmo_id}}))}function getRedirectUrl(e){return chrome.storage.sync.get(["accessToken"]).then(n=>fetch(e,{headers:{Authorization:n.accessToken}}).then(t=>t.redirected?t.url:e))}async function addGalleryImages(e){const n=await Promise.all(e.map(async t=>{if(t?.download_url?.startsWith("/api/content")){const i=await getRedirectUrl(`https://chatgpt.com${t.download_url}`);return{...t,download_url:i}}return t}));return fetch(`${API_URL}/gptx/add-gallery-images/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({gallery_images:n})}).then(t=>t.json())}function uploadImageToGallery(e,n,t,i=""){const r=dataURItoBlob(t),s=new File([r],n,{type:r.type}),a=new FormData;return a.append("image_id",e),a.append("image",s),i&&a.append("download_url",i),defaultGPTXHeaders["Hat-Token"]?fetch(`${API_URL}/gptx/upload-image-to-gallery/`,{method:"POST",headers:{...defaultGPTXHeaders},body:a}).then(l=>l.json()):null}function getGalleryImages(e=!1,n=1,t="",i="",r="created_at",s="dalle",a=!1){r.startsWith("-")&&(r=r.substring(1));let l=`${API_URL}/gptx/get-gallery-images/?order_by=${r}&category=${s}`;return e&&(l+="&show_all=true"),t&&t.trim().length>0&&(l+=`&search=${t}`),n&&(l+=`&page=${n}`),i&&(l+=`&by_user_id=${i}`),a&&(l+=`&is_public=${a}`),fetch(l,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(c=>c.ok?c.json():{results:[],count:0,error:"Something went wrong! Please try again later."})}function getSelectedGalleryImages(e="dalle",n=[],t=null){const i=`${API_URL}/gptx/get-selected-gallery-images/`;return fetch(i,{method:"POST",body:JSON.stringify({image_ids:n,category:e,conversation_id:t}),headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(r=>r.json())}function getGalleryImagesByDateRange(e,n,t="dalle"){return fetch(`${API_URL}/gptx/get-gallery-images-by-date-range/?start_date=${e}&end_date=${n}&category=${t}`,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(i=>i.json())}function deleteGalleryImages(e=[],n="dalle"){return fetch(`${API_URL}/gptx/delete-gallery-images/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({image_ids:e,category:n})}).then(t=>t.json())}function shareGalleryImages(e=[],n="dalle"){return fetch(`${API_URL}/gptx/share-gallery-images/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({image_ids:e,category:n})}).then(t=>t.json())}function getPromptTags(){return fetch(`${API_URL}/gptx/get-prompt-tags/`,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(e=>e.json())}function downloadImage(e){return fetch(`${e}?cache=false`,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json",origin:"https://chatgpt.com"}}).then(async n=>{if(!n.ok)throw new Error("Network response was not ok");const t=await n.blob();return await blobToDataURI(t)})}function getPromptFolders(e=null,n="created_at",t=""){n.startsWith("-")&&(n=n.substring(1));let i=`${API_URL}/gptx/get-prompt-folders/?order_by=${n}`;return e&&(i+=`&parent_folder_id=${e}`),t&&t.trim().length>0&&(i+=`&search=${t}`),fetch(i,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(r=>r.json())}function getAllPromptFolders(e="alphabetical"){e.startsWith("-")&&(e=e.substring(1));const n=`${API_URL}/gptx/get-all-prompt-folders/?order_by=${e}`;return fetch(n,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(t=>t.json())}function addPromptFolders(e){return fetch(`${API_URL}/gptx/add-prompt-folders/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({folders:e})}).then(n=>n.json())}function deletePromptFolder(e){return fetch(`${API_URL}/gptx/delete-prompt-folder/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({folder_id:parseInt(e,10)})}).then(n=>(chrome.contextMenus.removeAll(()=>{addCustomPromptContextMenu()}),n.json()))}function updatePromptFolder(e,n){if(n.image){let i;if(n.image.base64){const s=atob(n.image.base64),a=new Uint8Array(s.length);for(let l=0;l<s.length;l+=1)a[l]=s.charCodeAt(l);i=new Blob([a],{type:n.image.type})}else n.image.blob&&(i=n.image.blob);const r=new File([i],n.image.name,{type:n.image.type});n.image=r}const t=new FormData;return t.append("folder_id",parseInt(e,10)),Object.keys(n).forEach(i=>{t.append(i,n[i])}),fetch(`${API_URL}/gptx/update-prompt-folder/`,{method:"POST",headers:{...defaultGPTXHeaders},body:t}).then(i=>i.json())}function removePromptFolderImage(e){return fetch(`${API_URL}/gptx/remove-prompt-folder-image/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({folder_id:parseInt(e,10)})}).then(n=>n.json())}function duplicatePrompt(e){return fetch(`${API_URL}/gptx/duplicate-prompt/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({prompt_id:e})}).then(n=>(chrome.contextMenus.removeAll(()=>{addCustomPromptContextMenu()}),n.json()))}function updatePrompt(e){const{id:n,instruction:t,steps:i,steps_delay:r,title:s,is_public:a=!1,model_slug:l,tags:c=[],language:o,folder:d,is_favorite:u=!1}=e,m={prompt_id:n,steps:i,steps_delay:r,title:s.trim(),instruction:t,is_public:a,is_favorite:u,model_slug:l,tags:c.map(p=>parseInt(p,10)),language:o&&o!=="select"?o:"en",folder:d};return fetch(`${API_URL}/gptx/update-prompt/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify(m)}).then(p=>(typeof e.isFavorite<"u"&&chrome.contextMenus.removeAll(()=>{addCustomPromptContextMenu()}),p.json()))}function getPrompts(e,n,t="created_at",i="all",r="all",s=null,a=null,l=null,c=!1){t.startsWith("-")&&(t=t.substring(1));let o=`${API_URL}/gptx/?order_by=${t}`;return t==="mine"&&(o=`${API_URL}/gptx/?order_by=${t}`),s&&(o+=`&folder_id=${s}`),a!==null&&(o+=`&is_favorite=${a}`),l!==null&&(o+=`&is_public=${l}`),e&&(o+=`&page=${e}`),i!=="all"&&(o+=`&language=${i}`),r!=="all"&&(o+=`&tag=${r}`),n&&n.trim().length>0&&(o+=`&search=${n}`),c&&(o+="&deep_search=true"),fetch(o,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(d=>d.ok?d.json():{results:[],count:0,error:"Something went wrong! Please try again later."})}function getAllPrompts(e=null){return fetch(`${API_URL}/gptx/all-prompts/${e?`?folder_id=${e}`:""}`,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(n=>n.json())}function getPrompt(e,n={}){const t=`${API_URL}/gptx/${e}/`;return fetch(t,{method:"GET",headers:{...defaultGPTXHeaders,...n,"content-type":"application/json"}}).then(i=>i.json())}function getPromptsCount(){return fetch(`${API_URL}/gptx/prompts-count/`,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(e=>e.json())}function getAllFavoritePrompts(e={}){return fetch(`${API_URL}/gptx/get-all-favorite-prompts/`,{method:"GET",headers:{...defaultGPTXHeaders,...e,"content-type":"application/json"}}).then(n=>n.json())}function getPromptByTitle(e){const n=`${API_URL}/gptx/prompt-by-title/?title=${e}`;return fetch(n,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(t=>t.json())}function incrementPromptUseCount(e){const n=`${API_URL}/gptx/${e}/use-count/`;return fetch(n,{method:"POST",headers:{...defaultGPTXHeaders,"Content-Type":"application/json"},body:JSON.stringify({})}).then(t=>t.json())}function votePrompt(e,n){const t=`${API_URL}/gptx/${e}/vote/`;return fetch(t,{method:"POST",headers:{...defaultGPTXHeaders,"Content-Type":"application/json"},body:JSON.stringify({vote_type:n})}).then(i=>i.json())}function reportPrompt(e){const n=`${API_URL}/gptx/${e}/report/`;return fetch(n,{method:"POST",headers:{...defaultGPTXHeaders,"Content-Type":"application/json"},body:JSON.stringify({})}).then(t=>t.json())}function incrementOpenRate(e){const n=`${API_URL}/gptx/increment-open-rate/`;return fetch(n,{method:"POST",headers:{...defaultGPTXHeaders,"Content-Type":"application/json"},body:JSON.stringify({announcement_id:e})}).then(t=>t.json())}function incrementClickRate(e){const n=`${API_URL}/gptx/increment-click-rate/`;return fetch(n,{method:"POST",headers:{...defaultGPTXHeaders,"Content-Type":"application/json"},body:JSON.stringify({announcement_id:e})}).then(t=>t.json())}function incrementPromoLinkClickRate(e,n){const t=`${API_URL}/gptx/increment-promo-link-click-rate/`;return fetch(t,{method:"POST",headers:{...defaultGPTXHeaders,"Content-Type":"application/json"},body:JSON.stringify({announcement_id:e,promo_link:n})}).then(i=>i.json())}function getRemoteSettings(){return fetch(`${API_URL}/gptx/remote-settings/`,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(e=>e.json()).then(e=>{const n={};return e?.forEach(t=>{n[t.key]=t.value}),n})}function getInvites(){return fetch(`${API_URL}/gptx/get-invites/`,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(e=>e.json())}function sendInvite(e){return fetch(`${API_URL}/gptx/send-invite/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({email:e})}).then(n=>n.status===429?{susscess:!1,message:"You\u2019ve reached your 5 daily invite limit. Try again tomorrow."}:n.json())}function addTextdocs(e,n){return fetch(`${API_URL}/gptx/add-textdocs/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({conversation_id:e,textdocs:n})}).then(t=>t.json())}function getCustomInstructionProfile(e){return fetch(`${API_URL}/gptx/get-custom-instruction-profile/?profile_id=${e}`,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(n=>n.json())}function getEnabledCustomInstructionProfile(){return fetch(`${API_URL}/gptx/get-enabled-custom-instruction-profile/`,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(e=>e.json())}function getCustomInstructionProfiles(e,n="",t="created_at"){t.startsWith("-")&&(t=t.substring(1));let i=`${API_URL}/gptx/get-custom-instruction-profiles/?order_by=${t}`;return e&&(i+=`&page=${e}`),n&&n.trim().length>0&&(i+=`&search=${n}`),fetch(i,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(r=>r.json())}function addCustomInstructionProfile(e){return fetch(`${API_URL}/gptx/add-custom-instruction-profile/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({profile:e})}).then(n=>n.json())}function deleteCustomInstructionProfile(e){return fetch(`${API_URL}/gptx/delete-custom-instruction-profile/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({profile_id:e})}).then(n=>n.json())}function getPinnedMessages(e,n=null,t=""){let i=`${API_URL}/gptx/get-pinned-messages/`;return e&&(i+=`?page=${e}`),n&&(i+=`&conversation_id=${n}`),t&&t.trim().length>0&&(i+=`&search=${t}`),fetch(i,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(r=>r.json())}function getAllPinnedMessagesByConversationId(e){return fetch(`${API_URL}/gptx/get-all-pinned-messages-by-conversation-id/?conversation_id=${e}`,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(n=>n.json())}function addPinnedMessages(e){return fetch(`${API_URL}/gptx/add-pinned-messages/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({pinned_messages:e})}).then(n=>n.json())}function addPinnedMessage(e,n,t){return fetch(`${API_URL}/gptx/add-pinned-message/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({conversation_id:e,message_id:n,message:t})}).then(i=>i.json())}function deletePinnedMessage(e){return fetch(`${API_URL}/gptx/delete-pinned-message/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({message_id:e})}).then(n=>n.json())}function updateCustomInstructionProfile(e,n){return fetch(`${API_URL}/gptx/update-custom-instruction-profile/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({profile_id:parseInt(e,10),profile:n})}).then(t=>t.json())}function updateEnabledCustomInstructionProfile(e){return fetch(`${API_URL}/gptx/update-enabled-custom-instruction-profile/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({profile:e})}).then(n=>n.json())}function updateCustomInstructionProfileByData(e){return fetch(`${API_URL}/gptx/update-custom-instruction-profile-by-data/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({name_user_message:e.nameUserMessage,role_user_message:e.roleUserMessage,other_user_message:e.otherUserMessage,traits_model_message:e.traitsModelMessage,personality_type_selection:e.personalityTypeSelection,personality_traits:e.personalityTraits,enabled:e.enabled,disabled_tools:e.disabledTools})}).then(n=>n.json())}function duplicateCustomInstructionProfile(e){return fetch(`${API_URL}/gptx/duplicate-custom-instruction-profile/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({profile_id:e})}).then(n=>n.json())}function getConversationFolder(e){return fetch(`${API_URL}/gptx/get-conversation-folder/?folder_id=${e}`,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(n=>n.json())}function getConversationFolderByGizmoId(e){return fetch(`${API_URL}/gptx/get-conversation-folder-by-gizmo-id/?gizmo_id=${e}`,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(n=>n.json())}function getConversationFolders(e=null,n="created_at",t=""){n.startsWith("-")&&(n=n.substring(1));let i=`${API_URL}/gptx/get-conversation-folders/?order_by=${n}`;return e&&(i+=`&parent_folder_id=${e}`),t&&t.trim().length>0&&(i+=`&search=${t}`),fetch(i,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(r=>r.json())}function addConversationFolders(e){return fetch(`${API_URL}/gptx/add-conversation-folders/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({folders:e})}).then(n=>n.json())}function deleteConversationFolders(e){return fetch(`${API_URL}/gptx/delete-conversation-folders/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({folder_ids:e})}).then(n=>n.json())}function updateConversationFolder(e,n){if(n.image){let i;if(n.image.base64){const s=atob(n.image.base64),a=new Uint8Array(s.length);for(let l=0;l<s.length;l+=1)a[l]=s.charCodeAt(l);i=new Blob([a],{type:n.image.type})}else n.image.blob&&(i=n.image.blob);const r=new File([i],n.image.name,{type:n.image.type});n.image=r}const t=new FormData;return t.append("folder_id",parseInt(e,10)),Object.keys(n).forEach(i=>{t.append(i,n[i])}),fetch(`${API_URL}/gptx/update-conversation-folder/`,{method:"POST",headers:{...defaultGPTXHeaders},body:t}).then(i=>i.json())}function removeConversationFolderImage(e){return fetch(`${API_URL}/gptx/remove-conversation-folder-image/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({folder_id:parseInt(e,10)})}).then(n=>n.json())}function moveConversationsToFolder(e,n){const t=n.map(i=>({...i,conversation_id:i.id||i.conversation_id,create_time:typeof i.create_time=="number"?i.create_time:new Date(i.create_time).getTime()/1e3,update_time:typeof i.update_time=="number"?i.update_time:new Date(i.update_time).getTime()/1e3,has_attachments:conversationHasAttachments(i)}));return fetch(`${API_URL}/gptx/move-conversations-to-folder/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({folder_id:parseInt(e,10),convs:t})}).then(i=>i.json())}function removeConversationsFromFolder(e){return fetch(`${API_URL}/gptx/remove-conversations-from-folder/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({conversation_ids:e})}).then(n=>n.json())}function moveConversationIdsToFolder(e,n){return fetch(`${API_URL}/gptx/move-conversation-ids-to-folder/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({folder_id:parseInt(e,10),conversation_ids:n})}).then(t=>t.json())}function getConversations(e,n="updated_at",t=1,i=!1,r="",s=null,a=null,l=!1){n.startsWith("-")&&(n=n.substring(1));let c=`${API_URL}/gptx/get-conversations/?order_by=${n}`;return e&&(c+=`&folder_id=${e}`),t&&(c+=`&page=${t}`),r&&r.trim().length>0&&(c+=`&search=${r}`),i&&(c+="&full_search=true"),s!==null&&(c+=`&is_favorite=${s}`),a!==null&&(c+=`&is_archived=${a}`),l&&(c+="&exclude_conv_in_folders=true"),fetch(c,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(o=>o.json())}function getConversationIds(e=null,n=null,t=!0,i=!1){let r=`${API_URL}/gptx/get-conversation-ids/?include_archived=${t}&exclude_conv_in_folders=${i}`;return e&&(r+=`&start_date=${e}`),n&&(r+=`&end_date=${n}`),fetch(r,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(s=>s.json())}function getNonSyncedConversationIds(){return fetch(`${API_URL}/gptx/get-non-synced-conversation-ids/`,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(e=>e.json())}function getNonSyncedConversationCount(){return fetch(`${API_URL}/gptx/get-non-synced-conversation-count/`,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(e=>e.json())}function getSyncedConversationCount(){return fetch(`${API_URL}/gptx/get-synced-conversation-count/`,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(e=>e.json())}function getConversation(e){return fetch(`${API_URL}/gptx/get-conversation/?conversation_id=${e}`,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(n=>n.json())}function getRandomConversationId(){return fetch(`${API_URL}/gptx/get-random-conversation-id/`,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(e=>e.json())}function getTotalConversationsCount(){return fetch(`${API_URL}/gptx/get-total-conversations-count/`,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(e=>e.json())}function getTotalArchivedConversationsCount(){return fetch(`${API_URL}/gptx/get-total-archived-conversations-count/`,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(e=>e.json())}function getAllFavoriteConversationIds(){return fetch(`${API_URL}/gptx/get-all-favorite-conversation-ids/`,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(e=>e.json())}function getAllFolderConversationIds(e){return fetch(`${API_URL}/gptx/get-all-folder-conversation-ids/?folder_id=${e}`,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(n=>n.json())}function getAllNoteConversationIds(){return fetch(`${API_URL}/gptx/get-all-note-conversation-ids/`,{method:"GET",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(e=>e.json())}function addConversations(e){const n=e.map(t=>({...t,conversation_id:t.id||t.conversation_id,create_time:typeof t.create_time=="number"?t.create_time:new Date(t.create_time).getTime()/1e3,update_time:typeof t.update_time=="number"?t.update_time:new Date(t.update_time).getTime()/1e3,has_attachments:conversationHasAttachments(t)}));return fetch(`${API_URL}/gptx/add-conversations/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({conversations:n})}).then(t=>t.json())}function addConversation(e){return e={...e,conversation_id:e.id||e.conversation_id,create_time:typeof e.create_time=="number"?e.create_time:new Date(e.create_time).getTime()/1e3,update_time:typeof e.update_time=="number"?e.update_time:new Date(e.update_time).getTime()/1e3,has_attachments:conversationHasAttachments(e)},fetch(`${API_URL}/gptx/add-conversation/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({conversation:e})}).then(n=>n.json())}function renameConversation(e,n){return fetch(`${API_URL}/gptx/rename-conversation/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({conversation_id:e,title:n})}).then(t=>t.json())}function toggleConversationFavorite(e){return e={...e,conversation_id:e.id||e.conversation_id,create_time:typeof e.create_time=="number"?e.create_time:new Date(e.create_time).getTime()/1e3,update_time:typeof e.update_time=="number"?e.update_time:new Date(e.update_time).getTime()/1e3,has_attachments:conversationHasAttachments(e)},fetch(`${API_URL}/gptx/toggle-conversation-favorite/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({conversation:e})}).then(n=>n.json())}function updateConversationProject(e,n){return fetch(`${API_URL}/gptx/update-conversation-project/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({conversation_id:e,gizmo_id:n})}).then(t=>t.json())}function resetAllFavoriteConversations(){return fetch(`${API_URL}/gptx/reset-all-favorite-conversations/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(e=>e.json())}function deleteConversations(e){return fetch(`${API_URL}/gptx/delete-conversations/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({conversation_ids:e})}).then(n=>n.json())}function deleteAllConversations(){return fetch(`${API_URL}/gptx/delete-all-conversations/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(e=>e.json())}function deleteAllArchivedConversations(){return fetch(`${API_URL}/gptx/delete-all-archived-conversations/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(e=>e.json())}function archiveConversations(e){return fetch(`${API_URL}/gptx/archive-conversations/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({conversation_ids:e})}).then(n=>n.json())}function unarchiveConversations(e){return fetch(`${API_URL}/gptx/unarchive-conversations/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"},body:JSON.stringify({conversation_ids:e})}).then(n=>n.json())}function archiveAllConversations(){return fetch(`${API_URL}/gptx/archive-all-conversations/`,{method:"POST",headers:{...defaultGPTXHeaders,"content-type":"application/json"}}).then(e=>e.json())}let activeTabId=null,convSyncInterval=null;async function initConvHistorySync(e,n=5e3){const{lastFullSyncRun:t}=await chrome.storage.local.get(["lastFullSyncRun"]);if(t)return;const i=100,r=t?100:1e4;for(let s=0;s<r;s+=i){const a=await apiGetConversations(s,i);if(!a?.items||a?.items?.length===0){chrome.storage.local.set({lastFullSyncRun:Date.now()}),runConversationSync(e,n);break}const l=a.items?.map(o=>({...o,conversation_id:o.id,create_time:new Date(o.create_time).getTime()/1e3,update_time:new Date(o.update_time).getTime()/1e3}));await addConversations(l),clearCache("getConversations"),clearCache("getConversationIds"),clearCache("getConversation");const c=Math.min(n,s/100);await new Promise(o=>setTimeout(o,c))}}function initializeConversationSync(e,n=5e3){chrome.storage.local.get(["isRunningConvSync"],t=>{t.isRunningConvSync||chrome.storage.local.set({isRunningConvSync:!0},()=>{activeTabId=e,runConversationSync(e,n)})})}chrome.tabs.onRemoved.addListener((e,n)=>{e===activeTabId&&(chrome.storage.local.set({isRunningConvSync:!1}),activeTabId=null)}),chrome.tabs.onUpdated.addListener((e,n,t)=>{e===activeTabId&&n.status==="loading"&&(chrome.storage.local.set({isRunningConvSync:!1}),activeTabId=null)});async function sendSyncIsDoneMessage(){const e=await chrome.tabs.query({url:"https://chatgpt.com/*"}),n=e.find(t=>t.active)||e[0];n&&chrome.tabs.sendMessage(n.id,{type:"syncIsDone",detail:{}})}function runConversationSync(e,n){chrome.storage.local.set({lastConvSyncActivity:Date.now()}),getNonSyncedConversationIds().then(t=>{if(!Array.isArray(t)){sendSyncIsDoneMessage();return}if(t.length===0){sendSyncIsDoneMessage();return}let i=0;clearInterval(convSyncInterval),convSyncInterval=setInterval(async()=>{if(i>=t.length){clearInterval(convSyncInterval),chrome.storage.local.set({isRunningConvSync:!1,lastConvSyncActivity:null},()=>{activeTabId=null}),sendSyncIsDoneMessage();return}const r=t[i];try{chrome.storage.local.set({lastConvSyncActivity:Date.now()});const s=await apiGetConversation(r);s&&(s.code==="conversation_not_found"?await deleteConversations([r]):(await addConversations([s]),await syncConversationImages(s)),clearCache("getConversations"),clearCache("getConversationIds"),clearCache("getConversation"))}catch{}i+=1},n)})}function backendExtractPromptFromNode(e,n){const t=e[n];if(!t||!t.message||!t.message.content||!t.message.content.parts&&!t.message.content.text)return null;try{const{parts:i=[],text:r,content_type:s}=t.message.content;r&&i.push(r);for(const a of i)try{const l=JSON.parse(a);if(l.prompt||s==="code")return l.prompt}catch{}}catch(i){return console.error("Failed to parse content parts as JSON:",i),null}return null}function backendExtraxtTitleFromCode(e){let n="";if(e&&e.includes("title")){const t=e.match(/plt\.title\(['"]([^'"]+)['"]\)/);t&&t[1]&&(n=t[1])}return n}async function syncConversationImages(e){const n=[],t=e?.mapping,i=Object.values(t);for(let r=0;r<i.length;r+=1){const{message:s,parent:a}=i[r],l=(s?.content?.parts||[])?.filter(d=>d?.content_type==="image_asset_pointer").map(d=>({category:d?.metadata?.dalle||d?.metadata?.generation?"dalle":"upload",...d}))||[],c=s?.metadata?.aggregate_result?.messages?.filter(d=>d?.message_type==="image").map(d=>({category:"chart",...d}))||[],o=[...l,...c];for(let d=0;d<o.length;d+=1){const u=o[d],m=u.category==="dalle"?u?.asset_pointer?.split("://")[1]:u?.image_url?.split("://")[1];if(!m)continue;const{width:p,height:f}=u,y=u.category==="dalle"?u?.metadata?.dalle?.prompt:s?.metadata?.aggregate_result?.code,v=u?.category==="dalle"?s?.metadata?.image_gen_title:backendExtraxtTitleFromCode(s?.metadata?.aggregate_result?.code),C=backendExtractPromptFromNode(t,a),P=u?.metadata?.dalle?.gen_id||u?.metadata?.generation?.gen_id,_=u?.metadata?.dalle?.seed,h={message_id:s?.id,title:v||"",conversation_id:e.conversation_id,image_id:m,width:p,height:f,prompt:C||y,gen_id:P,seed:_,category:u.category,is_public:!1},g=await apiGetDownloadUrlFromFileId(m);if(!(!g||!g.download_url)){if(g.file_name&&g.file_name?.endsWith(".json")||g.file_name&&g.file_name?.endsWith(".csv")||g.file_name&&g.file_name?.endsWith(".xlsx")||g.file_name&&g.file_name?.endsWith(".txt")||g.file_name&&g.file_name?.endsWith(".pdf")||g.file_name&&g.file_name?.endsWith(".md")||g.file_name&&g.file_name?.endsWith(".docx"))return;h.download_url=g.download_url,g.creation_time?h.created_at=new Date(g.creation_time):h.created_at=s?.create_time?new Date(formatTime(s?.create_time)):new Date,n.push(h)}}}if(n.length>0){const r=await addGalleryImages(n);clearCache("getGalleryImages"),clearCache("getGalleryImagesByDateRange")}}function apiGetDownloadUrlFromFileId(e){return chrome.storage.sync.get(["accessToken"]).then(n=>fetch(`https://chatgpt.com/backend-api/files/download/${e}`,{method:"GET",headers:{"content-type":"application/json","Oai-Language":"en-US",Authorization:n.accessToken}}).then(t=>t.ok?t.json():Promise.reject(t)).then(t=>t))}function apiGetConversation(e){return chrome.storage.sync.get(["accessToken"]).then(n=>fetch(`https://chatgpt.com/backend-api/conversation/${e}`,{method:"GET",headers:{"content-type":"application/json","Oai-Language":"en-US",Authorization:n.accessToken},signal:AbortSignal.timeout(1e4)}).then(t=>t.ok?t.json():Promise.reject(t)).catch(t=>t.status===404?Promise.resolve({code:"conversation_not_found"}):(chrome.storage.local.set({lastConvSyncActivity:Date.now()}),Promise.reject(t))))}async function apiGetConversations(e=0,n=100,t="updated",i=!1){const r=await chrome.tabs.query({url:"https://chatgpt.com/*"}),s=r.find(a=>a.active)||r[0];return s?await chrome.tabs.sendMessage(s.id,{type:"getConversations",detail:{offset:e,limit:n,order:t,isArchived:i}}):null}async function apiGetAccount(e){if(!e)return Promise.resolve({});try{return await fetch("https://chatgpt.com/backend-api/accounts/check/v4-2023-04-27",{method:"GET",headers:{"content-type":"application/json","Oai-Language":"en-US",Authorization:e}}).then(t=>t.ok?t.json():Promise.resolve({})).then(t=>(chrome.storage.local.set({account:t}),t))}catch{return Promise.resolve({})}}function formatTime(e){return e&&(e.toString().indexOf("T")!==-1?new Date(e).getTime():e.toString().indexOf(".")!==-1&&e.toString().split(".")[0].length===10?new Date(e*1e3).getTime():e.toString().indexOf(".")!==-1&&e.toString().split(".")[0].length===13?new Date(e).getTime():e.toString().length===13?new Date(e).getTime():e.toString().length===10?new Date(e*1e3).getTime():e)}function monitorSyncHealth(){setInterval(()=>{chrome.storage.local.get(["isRunningConvSync","lastConvSyncActivity"],t=>{if(!t.isRunningConvSync)return;const i=t.lastConvSyncActivity||0;Date.now()-i>6e4&&chrome.storage.local.set({isRunningConvSync:!1,lastConvSyncActivity:null})})},3e4)}monitorSyncHealth();let spCache={};const CACHE_EXPIRATION_TIME=24*60*60*1e3;function setCache(e,n){spCache[e]={value:n,expiry:Date.now()+CACHE_EXPIRATION_TIME}}function getCache(e){const n=spCache[e];return n&&n.expiry>Date.now()?n.value:(delete spCache[e],null)}function clearCache(e){Object.keys(spCache).forEach(n=>{n.includes(e)&&delete spCache[n]})}function clearCaches(e){e.forEach(n=>{clearCache(n)})}function clearAllCache(){spCache={}}async function makeCacheKey(e,n){const t=await createHash(JSON.stringify({data:n}));return`${e}-${t}`}chrome.runtime.onMessage.addListener((e,n,t)=>((async()=>(e.type==="setAccessToken"&&await setAccessToken(e.detail.accessToken),chrome.storage.sync.get(["hashAcessToken"],async i=>{if(!i.hashAcessToken||i.hashAcessToken===void 0){console.warn("No access token found"),t({error:"No access token found"});return}defaultGPTXHeaders["Hat-Token"]=i.hashAcessToken;const r=e.type,s=e.forceRefresh||!1,a=e.detail||{},l=await makeCacheKey(r,a),c=getCache(l);if(c&&!s){t(c);return}if(r==="checkHasSubscription")checkHasSubscription(s).then(o=>{setCache(l,o),t(o)});else if(r==="getConversationFolder")getConversationFolder(a.folderId).then(o=>{setCache(l,o),t(o)});else if(r==="getConversationFolderByGizmoId")getConversationFolderByGizmoId(a.gizmoId).then(o=>{setCache(l,o),t(o)});else if(r==="getConversationFolders")getConversationFolders(a.parentFolderId,a.sortBy,a.searchTerm).then(o=>{setCache(l,o),t(o)});else if(r==="addConversationFolders")addConversationFolders(a.folders).then(o=>{clearCache("getConversationFolders"),clearCache("getConversationFolder"),clearCache("getConversationFolderByGizmoId"),t(o)});else if(r==="deleteConversationFolders")deleteConversationFolders(a.folderIds).then(o=>{clearCache("getConversationFolders"),clearCache("getConversationFolder"),clearCache("getConversationFolderByGizmoId"),t(o)});else if(r==="updateConversationFolder")updateConversationFolder(a.folderId,a.newData).then(o=>{clearCache("getConversationFolders"),clearCache("getConversationFolder"),clearCache("getConversationFolderByGizmoId"),clearCache("getConversations"),clearCache("getConversationIds"),t(o)});else if(r==="removeConversationFolderImage")removeConversationFolderImage(a.folderId).then(o=>{clearCache("getConversationFolders"),clearCache("getConversationFolder"),clearCache("getConversationFolderByGizmoId"),t(o)});else if(r==="moveConversationsToFolder")moveConversationsToFolder(a.folderId,a.conversations).then(o=>{clearCache("getConversations"),clearCache("getConversationIds"),clearCache("getAllFolderConversationIds"),clearCache("getConversationFolders"),clearCache("getConversationFolder"),clearCache("getConversationFolderByGizmoId"),t(o)});else if(r==="removeConversationsFromFolder")removeConversationsFromFolder(a.conversationIds).then(o=>{clearCache("getConversations"),clearCache("getConversationIds"),clearCache("getAllFolderConversationIds"),clearCache("getConversationFolders"),clearCache("getConversationFolder"),clearCache("getConversationFolderByGizmoId"),t(o)});else if(r==="moveConversationIdsToFolder")moveConversationIdsToFolder(a.folderId,a.conversationIds).then(o=>{clearCache("getConversations"),clearCache("getConversationIds"),clearCache("getAllFolderConversationIds"),clearCache("getConversationFolders"),clearCache("getConversationFolder"),clearCache("getConversationFolderByGizmoId"),t(o)});else if(r==="getConversations")getConversations(a.folderId,a.sortBy,a.pageNumber,a.fullSearch,a.searchTerm,a.isFavorite,a.isArchived,a.excludeConvInFolders).then(o=>{setCache(l,o),t(o)});else if(r==="getConversationIds")getConversationIds(a.startDate,a.endDate,a.includeArchived,a.excludeConvInFolders).then(o=>{setCache(l,o),t(o)});else if(r==="getNonSyncedConversationIds")getNonSyncedConversationIds().then(o=>{t(o)});else if(r==="getNonSyncedConversationCount")getNonSyncedConversationCount().then(o=>{t(o)});else if(r==="getSyncedConversationCount")getSyncedConversationCount().then(o=>{t(o)});else if(r==="initializeConversationSync"&&n.tab)initializeConversationSync(n.tab.id);else if(r==="initConvHistorySync"&&n.tab)initConvHistorySync(n.tab.id,a.syncIntervalTime);else if(r==="getConversation")getConversation(a.conversationId).then(o=>{setCache(l,o),t(o)});else if(r==="getTotalConversationsCount")getTotalConversationsCount().then(o=>{setCache(l,o),t(o)});else if(r==="getTotalArchivedConversationsCount")getTotalArchivedConversationsCount().then(o=>{t(o)});else if(r==="getAllFavoriteConversationIds")getAllFavoriteConversationIds().then(o=>{setCache(l,o),t(o)});else if(r==="getAllFolderConversationIds")getAllFolderConversationIds(a.folderId).then(o=>{setCache(l,o),t(o)});else if(r==="getAllNoteConversationIds")getAllNoteConversationIds().then(o=>{setCache(l,o),t(o)});else if(r==="getRandomConversationId")getRandomConversationId().then(o=>{t(o)});else if(r==="addConversations")addConversations(a.conversations).then(o=>{clearCache("getConversations"),clearCache("getConversationIds"),clearCache("getConversation"),t(o)});else if(r==="addConversation")addConversation(a.conversation).then(o=>{t(o)});else if(r==="renameConversation")renameConversation(a.conversationId,a.title).then(o=>{clearCache("getConversations"),clearCache("getConversationIds"),clearCache("getConversation"),t(o)});else if(r==="toggleConversationFavorite")toggleConversationFavorite(a.conversation).then(o=>{clearCache("getConversations"),clearCache("getConversationIds"),clearCache("getConversation"),clearCache("getAllFavoriteConversationIds"),t(o)});else if(r==="updateConversationProject")updateConversationProject(a.conversationId,a.gizmoId).then(o=>{clearCache("getConversations"),clearCache("getConversationIds"),clearCache("getConversation"),t(o)});else if(r==="resetAllFavoriteConversations")resetAllFavoriteConversations().then(o=>{clearCache("getConversations"),clearCache("getConversationIds"),clearCache("getConversation"),clearCache("getAllFavoriteConversationIds"),t(o)});else if(r==="deleteConversations")deleteConversations(a.conversationIds).then(o=>{clearCache("getConversations"),clearCache("getConversationIds"),clearCache("getConversation"),clearCache("getAllFavoriteConversationIds"),clearCache("getConversationFolders"),clearCache("getConversationFolder"),clearCache("getConversationFolderByGizmoId"),t(o)});else if(r==="deleteAllConversations")deleteAllConversations().then(o=>{clearCache("getConversations"),clearCache("getConversationIds"),clearCache("getConversation"),clearCache("getAllFavoriteConversationIds"),clearCache("getConversationFolders"),clearCache("getConversationFolder"),clearCache("getConversationFolderByGizmoId"),t(o)});else if(r==="deleteAllArchivedConversations")deleteAllArchivedConversations().then(o=>{clearCache("getConversations"),clearCache("getConversationIds"),clearCache("getConversation"),clearCache("getAllFavoriteConversationIds"),clearCache("getConversationFolders"),clearCache("getConversationFolder"),clearCache("getConversationFolderByGizmoId"),t(o)});else if(r==="archiveConversations")archiveConversations(a.conversationIds).then(o=>{clearCache("getConversations"),clearCache("getConversationIds"),clearCache("getConversation"),clearCache("getAllFavoriteConversationIds"),clearCache("getConversationFolders"),clearCache("getConversationFolder"),clearCache("getConversationFolderByGizmoId"),t(o)});else if(r==="unarchiveConversations")unarchiveConversations(a.conversationIds).then(o=>{clearCache("getConversations"),clearCache("getConversationIds"),clearCache("getConversation"),clearCache("getConversationFolders"),clearCache("getConversationFolder"),clearCache("getConversationFolderByGizmoId"),t(o)});else if(r==="archiveAllConversations")archiveAllConversations().then(o=>{clearCache("getConversations"),clearCache("getConversationIds"),clearCache("getConversation"),clearCache("getAllFavoriteConversationIds"),clearCache("getConversationFolders"),clearCache("getConversationFolder"),clearCache("getConversationFolderByGizmoId"),t(o)});else if(r==="addTextdocs")addTextdocs(a.conversationId,a.textdocs).then(o=>{t(o)});else if(r==="getCustomInstructionProfile")getCustomInstructionProfile(a.profileId).then(o=>{setCache(l,o),t(o)});else if(r==="getEnabledCustomInstructionProfile")getEnabledCustomInstructionProfile().then(o=>{setCache(l,o),t(o)});else if(r==="getCustomInstructionProfiles")getCustomInstructionProfiles(a.pageNumber,a.searchTerm,a.sortBy).then(o=>{setCache(l,o),t(o)});else if(r==="addCustomInstructionProfile")addCustomInstructionProfile(a.profile).then(o=>{clearCache("getCustomInstructionProfile"),clearCache("getEnabledCustomInstructionProfile"),clearCache("getCustomInstructionProfiles"),t(o)});else if(r==="updateCustomInstructionProfile")updateCustomInstructionProfile(a.profileId,a.profile).then(o=>{clearCache("getCustomInstructionProfile"),clearCache("getEnabledCustomInstructionProfile"),clearCache("getCustomInstructionProfiles"),t(o)});else if(r==="updateEnabledCustomInstructionProfile")updateEnabledCustomInstructionProfile(a.profile).then(o=>{clearCache("getCustomInstructionProfile"),clearCache("getEnabledCustomInstructionProfile"),clearCache("getCustomInstructionProfiles"),t(o)});else if(r==="updateCustomInstructionProfileByData")updateCustomInstructionProfileByData(a.profile).then(o=>{clearCache("getCustomInstructionProfile"),clearCache("getEnabledCustomInstructionProfile"),clearCache("getCustomInstructionProfiles"),t(o)});else if(r==="duplicateCustomInstructionProfile")duplicateCustomInstructionProfile(a.profileId).then(o=>{clearCache("getCustomInstructionProfile"),clearCache("getEnabledCustomInstructionProfile"),clearCache("getCustomInstructionProfiles"),t(o)});else if(r==="deleteCustomInstructionProfile")deleteCustomInstructionProfile(a.profileId).then(o=>{clearCache("getCustomInstructionProfile"),clearCache("getEnabledCustomInstructionProfile"),clearCache("getCustomInstructionProfiles"),t(o)});else if(r==="getPinnedMessages")getPinnedMessages(a.pageNumber,a.conversationId,a.searchTerm).then(o=>{setCache(l,o),t(o)});else if(r==="getAllPinnedMessagesByConversationId")getAllPinnedMessagesByConversationId(a.conversationId).then(o=>{setCache(l,o),t(o)});else if(r==="addPinnedMessages")addPinnedMessages(a.pinnedMessages).then(o=>{clearCache("getPinnedMessages"),clearCache("getAllPinnedMessagesByConversationId"),t(o)});else if(r==="addPinnedMessage")addPinnedMessage(a.conversationId,a.messageId,a.message).then(o=>{clearCache("getPinnedMessages"),clearCache("getAllPinnedMessagesByConversationId"),t(o)});else if(r==="deletePinnedMessage")deletePinnedMessage(a.messageId).then(o=>{clearCache("getPinnedMessages"),clearCache("getAllPinnedMessagesByConversationId"),t(o)});else if(r==="addPrompts")addPrompts(a.prompts).then(o=>{clearCache("getPrompts"),clearCache("getPrompt"),clearCache("getPromptFolders"),clearCache("getAllPromptFolders"),clearCache("getAllFavoritePrompts"),t(o)});else if(r==="addPromptAttachment")addPromptAttachment(a.attachment).then(o=>{clearCache("getPrompts"),clearCache("getPrompt"),t(o)});else if(r==="updatePrompt")updatePrompt(a.promptData).then(o=>{clearCache("getPrompts"),clearCache("getPrompt"),clearCache("getAllFavoritePrompts"),clearCache("getDefaultFavoritePrompt"),t(o)});else if(r==="getPrompt")getPrompt(a.promptId).then(o=>{setCache(l,o),t(o)});else if(r==="getPromptAttachment")getPromptAttachment(a.fileId).then(o=>{t(o)});else if(r==="getPromptsCount")getPromptsCount().then(o=>{t(o)});else if(r==="getPrompts")getPrompts(a.pageNumber,a.searchTerm,a.sortBy,a.language,a.tag,a.folderId,a.isFavorite,a.isPublic).then(o=>{setCache(l,o),t(o)});else if(r==="getAllPrompts")getAllPrompts(a.folderId).then(o=>{setCache(l,o),t(o)});else if(r==="getPromptByTitle")getPromptByTitle(a.title).then(o=>{setCache(l,o),t(o)});else if(r==="getAllFavoritePrompts")getAllFavoritePrompts().then(o=>{setCache(l,o),t(o)});else if(r==="deletePrompts")deletePrompts(a.promptIds).then(o=>{clearCache("getPrompts"),clearCache("getPrompt"),clearCache("getPromptFolders"),clearCache("getAllPromptFolders"),clearCache("getAllFavoritePrompts"),clearCache("getDefaultFavoritePrompt"),t(o)});else if(r==="movePrompts")movePrompts(a.folderId,a.promptIds).then(o=>{clearCache("getPrompts"),clearCache("getPrompt"),clearCache("getPromptFolders"),clearCache("getAllPromptFolders"),t(o)});else if(r==="togglePromptPublic")togglePromptPublic(a.promptId).then(o=>{clearCache("getPrompts"),clearCache("getPrompt"),t(o)});else if(r==="toggleFavoritePrompt")toggleFavoritePrompt(a.promptId).then(o=>{clearCache("getPrompts"),clearCache("getPrompt"),clearCache("getAllFavoritePrompts"),clearCache("getDefaultFavoritePrompt"),t(o)});else if(r==="resetAllFavoritePrompts")resetAllFavoritePrompts().then(o=>{clearCache("getPrompts"),clearCache("getPrompt"),clearCache("getAllFavoritePrompts"),t(o)});else if(r==="setDefaultFavoritePrompt")setDefaultFavoritePrompt(a.promptId).then(o=>{clearCache("getPrompts"),clearCache("getPrompt"),clearCache("getAllFavoritePrompts"),clearCache("getDefaultFavoritePrompt"),t(o)});else if(r==="getDefaultFavoritePrompt")getDefaultFavoritePrompt().then(o=>{setCache(l,o),t(o)});else if(r==="duplicatePrompt")duplicatePrompt(a.promptId).then(o=>{clearCache("getPrompts"),clearCache("getPrompt"),clearCache("getPromptFolders"),clearCache("getAllPromptFolders"),clearCache("getAllFavoritePrompts"),clearCache("getDefaultFavoritePrompt"),t(o)});else if(r==="incrementPromptUseCount")incrementPromptUseCount(a.promptId).then(o=>{t(o)});else if(r==="votePrompt")votePrompt(a.promptId,a.voteType).then(o=>{t(o)});else if(r==="reportPrompt")reportPrompt(a.promptId).then(o=>{t(o)});else if(r==="getPromptTags")getPromptTags().then(o=>{setCache(l,o),t(o)});else if(r==="getPromptFolders")getPromptFolders(a.parentFolderId,a.sortBy,a.searchTerm).then(o=>{setCache(l,o),t(o)});else if(r==="getAllPromptFolders")getAllPromptFolders(a.sortBy).then(o=>{setCache(l,o),t(o)});else if(r==="addPromptFolders")addPromptFolders(a.folders).then(o=>{clearCache("getPromptFolders"),clearCache("getAllPromptFolders"),t(o)});else if(r==="deletePromptFolder")deletePromptFolder(a.folderId).then(o=>{clearCache("getPromptFolders"),clearCache("getAllPromptFolders"),clearCache("getPrompts"),clearCache("getPrompt"),clearCache("getAllFavoritePrompts"),clearCache("getDefaultFavoritePrompt"),t(o)});else if(r==="updatePromptFolder")updatePromptFolder(a.folderId,a.newData).then(o=>{clearCache("getPromptFolders"),clearCache("getAllPromptFolders"),t(o)});else if(r==="removePromptFolderImage")removePromptFolderImage(a.folderId).then(o=>{clearCache("getPromptFolders"),clearCache("getAllPromptFolders"),clearCache("getPromptFolder"),t(o)});else if(r==="updateNote")updateNote(a.conversationId,a.name,a.text).then(o=>{clearCache("getNote"),clearCache("getNotes"),clearCache("getAllNoteConversationIds"),t(o)});else if(r==="renameNote")renameNote(a.noteId,a.newName).then(o=>{clearCache("getNote"),clearCache("getNotes"),t(o)});else if(r==="deleteNote")deleteNote(a.noteId).then(o=>{clearCache("getNote"),clearCache("getNotes"),clearCache("getAllNoteConversationIds"),t(o)});else if(r==="getNote")getNote(a.conversationId).then(o=>{setCache(l,o),t(o)});else if(r==="getNoteForIds")getNoteForIds(a.conversationIds).then(o=>{setCache(l,o),t(o)});else if(r==="getNotes")getNotes(a.page,a.searchTerm,a.sortBy).then(o=>{setCache(l,o),t(o)});else if(r==="getNewsletters")getNewsletters(a.page).then(o=>{setCache(l,o),t(o)});else if(r==="getNewsletter")getNewsletter(a.id).then(o=>{setCache(l,o),t(o)});else if(r==="getLatestNewsletter")getLatestNewsletter().then(o=>{setCache(l,o),t(o)});else if(r==="openPromoLink")openPromoLink(a.link).then(o=>{t(o)});else if(r==="getReleaseNote")getReleaseNote(a.version).then(o=>{setCache(l,o),t(o)});else if(r==="getLatestVersion")getLatestVersion().then(o=>{t(o)});else if(r==="reloadExtension")reloadExtension().then(o=>{t(o)});else if(r==="getLatestAnnouncement")getLatestAnnouncement().then(o=>{setCache(l,o),t(o)});else if(r==="getRandomGizmo")getRandomGizmo().then(o=>{t(o)});else if(r==="getSuperpowerGizmos")getSuperpowerGizmos(a.pageNumber,a.searchTerm,a.sortBy,a.category).then(o=>{setCache(l,o),t(o)});else if(r==="submitSuperpowerGizmos")submitSuperpowerGizmos(a.gizmos,a.category).then(o=>{clearCache("getSuperpowerGizmos"),t(o)});else if(r==="updateGizmoMetrics")updateGizmoMetrics(a.gizmoId,a.metricName,a.direction).then(o=>{clearCache("getSuperpowerGizmos"),t(o)});else if(r==="deleteSuperpowerGizmo")deleteSuperpowerGizmo(a.gizmoId).then(o=>{clearCache("getSuperpowerGizmos"),t(o)});else if(r==="addGalleryImages")addGalleryImages(a.images).then(o=>{clearCache("getGalleryImages"),clearCache("getGalleryImagesByDateRange"),t(o)});else if(r==="uploadImageToGallery")uploadImageToGallery(a.imageId,a.imageName,a.dataURI,a.downloadUrl).then(o=>{clearCache("getGalleryImages"),clearCache("getGalleryImagesByDateRange"),t(o)});else if(r==="getGalleryImages")getGalleryImages(a.showAll,a.pageNumber,a.searchTerm,a.byUserId,a.sortBy,a.category,a.isPublic).then(o=>{setCache(l,o),t(o)});else if(r==="getSelectedGalleryImages")getSelectedGalleryImages(a.category,a.imageIds,a.conversationId).then(o=>{setCache(l,o),t(o)});else if(r==="getGalleryImagesByDateRange")getGalleryImagesByDateRange(a.startDate,a.endDate,a.category).then(o=>{setCache(l,o),t(o)});else if(r==="deleteGalleryImages")deleteGalleryImages(a.imageIds,a.category).then(o=>{clearCache("getGalleryImages"),clearCache("getGalleryImagesByDateRange"),clearCache("getSelectedGalleryImages"),t(o)});else if(r==="shareGalleryImages")shareGalleryImages(a.imageIds,a.category).then(o=>{t(o)});else if(r==="downloadImage")downloadImage(a.url).then(o=>{t(o)});else if(r==="incrementOpenRate")incrementOpenRate(a.announcementId).then(o=>{t(o)});else if(r==="incrementClickRate")incrementClickRate(a.announcementId).then(o=>{t(o)});else if(r==="incrementPromoLinkClickRate")incrementPromoLinkClickRate(a.announcementId,a.promoLink).then(o=>{t(o)});else if(r==="getRemoteSettings")getRemoteSettings().then(o=>{setCache(l,o),t(o)});else if(r==="getInvites")getInvites().then(o=>{setCache(l,o),t(o)});else if(r==="sendInvite")sendInvite(a.email).then(o=>{clearCache("getInvites"),t(o)});else if(r==="resetContextMenu")resetContextMenu(),t();else if(r==="clearCaches")clearCaches(a.targetKeys),t();else if(r==="clearAllCache")clearAllCache(),t();else if(r==="flushStorage")flushStorage().then(()=>{t()});else if(r==="rewritePrompt"){const o=await rewritePrompt(a.prompt,a.context,a.tone,a.length);t(o)}else if(r==="prompt"){console.warn("Received prompt request:",a);const o=await runPrompt(a.prompt,a.createOptions||{},a.promptOptions||{},!!a.forceRefresh);t(o)}else if(r==="promptSameLanguage"){const o=await runPromptSameLanguage(a.prompt,a.createOptions||{},a.promptOptions||{},!!a.forceRefresh);t(o)}})))(),!0));
